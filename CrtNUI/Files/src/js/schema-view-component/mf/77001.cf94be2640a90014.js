(self.webpackChunkapp_studio_enterprise_schema_view=self.webpackChunkapp_studio_enterprise_schema_view||[]).push([[77001],{77001:(Yt,bt,y)=>{y.r(bt),y.d(bt,{BaseDataGridActionsPreprocessor:()=>nt,BulkActionsPostprocessor:()=>q,BulkActionsPreprocessor:()=>V,BulkActionsPreprocessorsModule:()=>B,ChartWidgetAdaptAxesFormattingPreprocessor:()=>ve,ChartWidgetPreprocessor:()=>Me,ComboboxPreprocessor:()=>H,ComponentsPreprocessorsModule:()=>rt,DISABLE_CHART_WIDGET_AXES_FORMATTING_ADAPTATION:()=>Nt,DataGridActionsPreprocessor:()=>J,DataGridActiveRowPreprocessor:()=>ne,DataGridCancelItemsChangesPreprocessor:()=>Q,DataGridColumnsPreprocessor:()=>L,DataGridCreateItemPreprocessor:()=>ee,DataGridDeleteItemPreprocessor:()=>te,DataGridEditingCellViewPreprocessor:()=>Y,DataGridFilterOptionsBackwardCompatibilityPreprocessor:()=>X,DataGridFilterOptionsPostprocessorsModule:()=>ct,DataGridFilterOptionsPreprocessor:()=>K,DataGridFilterOptionsPreprocessorsModule:()=>ot,DataGridHeaderToolbarPreprocessor:()=>Z,DataGridPagingPreprocessor:()=>ae,DataGridPlaceholderPreprocessor:()=>se,DataGridPreprocessorsModule:()=>Ae,DataGridReloadItemsPreprocessor:()=>re,DataGridRestrictionsPreprocessor:()=>fe,DataGridRowDoubleClickPreprocessor:()=>oe,DataGridRowsSelectionPreprocessor:()=>ce,DataGridSaveItemsChangesPreprocessor:()=>ie,DataGridSelectionOptionsBackwardCompatibilityPreprocessor:()=>j,DataGridSelectionOptionsPostprocessorsModule:()=>lt,DataGridSelectionOptionsPreprocessorsModule:()=>de,DataGridStageCellViewPreprocessor:()=>me,SearchFilterPreprocessor:()=>Ee,SearchFilterPreprocessorService:()=>x,SelectionOptionsPreprocessor:()=>le,SelectionOptionsPreprocessorService:()=>M,SelectionOptionsPreprocessorsModule:()=>ue,ShellHeaderPreprocessor:()=>at,WidgetDataProvidingPostprocessor:()=>Ne,WidgetDataProvidingPostprocessorModule:()=>Re,WidgetDataProvidingPreprocessor:()=>Pe,WidgetDataProvidingPreprocessorModule:()=>w,WidgetPreprocessorsModule:()=>k,getDefaultPagingConfig:()=>pt,getPaginationChange:()=>gt,getSearchFilterAttributeName:()=>Dt});var st=y(40297),N=y(96590),S=y(85638),u=y(20822),R=y(52552),dt=y(94973),Mt=y(27331),U=y(26222),g=y(21018),m=y(10850),l=y(73308),h=y(22438),A=y(62278),o=y(59131);class Fe{get isProcessingDisabled(){return(0,A.lastValueFrom)(this._featureService.getFeatureState(this._actionDashboardPreprocessingDisableFeature))}constructor(e,t){this._featureService=e,this._dcmSettingsService=t,this._actionDashboardPreprocessingDisableFeature="DisableActionDashboardPreprocessing"}_addStageAttribute(e,t,i){const r=e.viewModelConfig.attributes||{},a=`${i}.${t}`;if(!(0,h.findViewModelAttributeByModelPath)(r,a)){const s=`LookupAttribute_${t}`;r[s]={modelConfig:{path:a}},e.viewModelConfig.attributes=r}}_extendWithDcmStageAttribute(e,t){var i=this;return(0,l.A)(function*(){const r=yield(0,A.lastValueFrom)(i._dcmSettingsService.getStageColumnName(t.viewConfig.entitySchemaName),{defaultValue:null});r&&i._addStageAttribute(e,r,t.viewConfig.dataSourceName)})()}_extendWithPrimaryValueAttribute(e,t,i,r){const a=e.viewModelConfig.attributes||{},s=`${i}.${r}`;let n=(0,h.findViewModelAttributeByModelPath)(a,s);n||(n=`ActionDashboard_${r}`,a[n]={modelConfig:{path:s}},e.viewModelConfig.attributes=a),t.viewConfig.primaryColumnValue=`$${n}`}processItemsAsync(e,t,i){var r=this;return(0,l.A)(function*(){if(!t)return;const a=e.map(function(){var s=(0,l.A)(function*(n){const c=t.getDataSource(),d=yield(0,A.lastValueFrom)(t.getSchema());n.viewConfig.dataSourceName=c.dataSourceName,n.viewConfig.entitySchemaName=d.name,n.viewConfig.primaryDisplayColumnValue=`$${d.primaryDisplayAttributeName}`,yield r._extendWithDcmStageAttribute(i,n),r._extendWithPrimaryValueAttribute(i,n,c.dataSourceName,d.primaryAttributeName||"Id")});return function(n){return s.apply(this,arguments)}}());yield Promise.all(a)})()}crtOnMetaDataInit(e){var t=this;return(0,l.A)(function*(){if(yield t.isProcessingDisabled)return e;const i=e;return g.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.ActionDashboard",i.viewConfig).forEach(a=>{a.viewConfig.allowedActions||(a.viewConfig.allowedActions=(0,u.getDefaultDashboardActions)())}),e})()}crtOnModelInit(e,t){var i=this;return(0,l.A)(function*(){if((yield i.isProcessingDisabled)||t.length===0)return e;const r=e,a=g.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.ActionDashboard",r.viewConfig),s=r.modelConfig?.primaryDataSourceName,n=t.find(c=>c.name===s);return yield i.processItemsAsync(a,n,r),e})()}static{this.\u0275fac=function(t){return new(t||Fe)(o.\u0275\u0275inject(S.FeatureService),o.\u0275\u0275inject(S.DcmSettingsService))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:Fe,factory:Fe.\u0275fac})}}const mt=new o.InjectionToken("Represents a list of view element types that support bulk actions.");class V{constructor(){this._availableViewElementTypes=(0,o.inject)(mt),this._bulkActionsCreatorFactory=(0,o.inject)(u.BULK_ACTIONS_VIEW_ELEMENT_CREATOR_FACTORY)}_createDefaultBulkActions(e,t){return this._bulkActionsCreatorFactory?.create(t?.type)?.createDefaultBulkActions(e,t)}_setDefaultBulkActions(e,t){const i=(0,h.parseExpression)(e.items).attributePath;if(!i)return;const a=t[i]?.modelConfig?.path;a&&(e.bulkActions=this._createDefaultBulkActions(a,e))}crtOnMetaDataInit(e){const t=e,i=t.viewModelConfig.attributes??{};return(0,h.getCollectionViewConfigsWithItemsBinding)(t,this._availableViewElementTypes).filter(r=>r.bulkActions===void 0).forEach(r=>this._setDefaultBulkActions(r,i)),Promise.resolve(e)}static{this.\u0275fac=function(t){return new(t||V)}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:V,factory:V.\u0275fac})}}var _=y(28399);class q{constructor(){this._availableViewElementTypes=(0,o.inject)(mt),this._bulkActionsCreatorFactory=(0,o.inject)(u.BULK_ACTIONS_VIEW_ELEMENT_CREATOR_FACTORY)}_createDefaultBulkActions(e,t){return this._bulkActionsCreatorFactory?.create(t?.type)?.createDefaultBulkActions(e,t)}_clearDefaultBulkActions(e,t){const i=(0,h.parseExpression)(e.items).attributePath;if(!i)return;const a=t[i]?.modelConfig?.path;if(!a)return;const s=this._createDefaultBulkActions(a,e);s&&(0,_.isEqual)(e.bulkActions,s)&&(e.bulkActions=void 0)}crtOnMetaDataChanged(e){const t=e,i=t.viewModelConfig.attributes??{};return(0,h.getCollectionViewConfigsWithItemsBinding)(t,this._availableViewElementTypes).forEach(r=>this._clearDefaultBulkActions(r,i)),Promise.resolve(e)}static{this.\u0275fac=function(t){return new(t||q)}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:q,factory:q.\u0275fac})}}function Ft(v,e){const t=new Map(e.map(([i,r])=>[i,{injectable:r}]));return new N.Factory(v,t)}class B{static withCreators(e){return{ngModule:B,providers:e.map(t=>[{provide:u.BULK_ACTIONS_VIEW_ELEMENT_CREATORS,useValue:t,multi:!0},{provide:mt,useValue:t[0],multi:!0}]).flat()}}static{this.\u0275fac=function(t){return new(t||B)}}static{this.\u0275mod=o.\u0275\u0275defineNgModule({type:B})}static{this.\u0275inj=o.\u0275\u0275defineInjector({providers:[{provide:m.CRT_METADATA_PREPROCESSOR,useClass:V,multi:!0},{provide:m.CRT_DESIGN_TIME_METADATA_POSTPROCESSOR,useClass:q,multi:!0},{provide:m.CRT_DESIGN_TIME_METADATA_PREPROCESSOR,useClass:V,multi:!0},{provide:u.BULK_ACTIONS_VIEW_ELEMENT_CREATOR_FACTORY,useFactory:Ft,deps:[o.Injector,u.BULK_ACTIONS_VIEW_ELEMENT_CREATORS]}]})}}var W=y(23958);class Oe{_getMenuItem(e,t,i){return{type:"crt.MenuItem",caption:e.caption||e.captionLcz,clicked:{request:"crt.CreateRecordRequest",params:{entityName:t,defaultValues:i}}}}_getDefaultValues(e,t,i){const r=i?[{attributeName:i,value:e.UId}]:[];return t.length&&r.splice(0,0,...t),r}_getEntityName(e,t){const i=e.viewConfig.clicked.params;let r=i.entityName||"";if(!r){const a=i.itemsAttributeName;if(a){const s=t.getBoundDataSourceNameByAttributePath(a);r=t.dataSchemas[s]?.name}}return r}_getButtonsWithCreateRecordRequest(e){return g.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.Button",e.viewConfig).filter(i=>{const r=i.viewConfig.clicked;return r?.params&&r.request==="crt.CreateRecordRequest"})}_fillMenuItems(e,t){const i=this._getEntityName(e,t);if(!i)return;const r=W.NavigationUtils.getEntityStructure(i,W.UITypePriority.PreferFreedomUI);if(!r)return;const a=W.NavigationUtils.getPagesForAddAction(r.pages);if(!a?.length)return;const s=r.attribute,n=e.viewConfig.clicked.params?.defaultValues||[];if(!n.find(d=>d.attributeName===s)?.value){if(a.length>1){e.viewConfig.clickMode="menu";const d=a.map(f=>{const p=this._getDefaultValues(f,n,s);return this._getMenuItem(f,i,p)});e.viewConfig.menuItems??=[],e.viewConfig.menuItems.splice(0,0,...d)}else if(s){const d=this._getDefaultValues(a[0],n,s);e.viewConfig.clicked.params.defaultValues=d}}}crtOnViewModelInit(e,t,i){var r=this;return(0,l.A)(function*(){return r._getButtonsWithCreateRecordRequest(e).forEach(a=>{r._fillMenuItems(a,i)}),e})()}static{this.\u0275fac=function(t){return new(t||Oe)}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:Oe,factory:Oe.\u0275fac})}}var I=y(38495);class we{constructor(e){this.crtRoute=e}_getButtonsWithDefaultPageRequest(e){return g.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.Button",e.viewConfig).filter(i=>i?.viewConfig?.clicked?.request==="crt.ContinueInOtherPageRequest")}_prepareButton(e,t){const i=e.viewConfig;(0,_.isString)(i.visible)||(i.visible=t)}_getEntityNavigationOptions(e){const t=(0,h.resolveSchemaPrimaryEntityName)(e),i=this.crtRoute.getState(),r=(0,_.last)(i?.children),a=(0,_.last)(r?.modelInitConfigs),s=(0,_.last)(i?.modelInitConfigs);return{defaultValues:a?.defaultValues||s?.defaultValues||[],entityName:t,recordId:a?.recordId}}crtOnMetaDataInit(e){var t=this;return(0,l.A)(function*(){const i=e,r=t._getEntityNavigationOptions(i);if(!r.entityName)return Promise.resolve(e);const a=t._getButtonsWithDefaultPageRequest(i),s=yield W.NavigationUtils.getPageForActionAsync({action:I.ModelInPageAction.Edit,...r}),n=yield W.NavigationUtils.getPageForActionAsync({action:I.ModelInPageAction.Add,...r}),c=s?.cardSchema===n?.cardSchema,d=s?.cardSchema===i.name,f=!!(!c&&!d&&n&&s?.cardSchema);return a.forEach(p=>{t._prepareButton(p,f)}),Promise.resolve(e)})()}static{this.\u0275fac=function(t){return new(t||we)(o.\u0275\u0275inject(W.LocationStrategy))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:we,factory:we.\u0275fac})}}const Ct="Telephony.Use",yt="MailboxSynchronization.Use",It="Chats.Use",Ot="SelectedItem";class Ve{constructor(e,t,i){this._userInfo=e,this._profileAttributeService=t,this._licenseOperationValues=i}_getButtonToggleGroups(e){return g.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.ButtonToggleGroup",e.viewConfig).filter(i=>i.viewConfig.for)}_getDefaultSelectedTabValue(e){return e.selectedTab?{value:e.selectedTab}:{}}_removeTab(e,t){const i=e.findIndex(r=>r.name===t);i!==-1&&e.splice(i,1)}_isRemoveTab(e){return!this._licenseOperationValues[e]}_getLicenseOperations(){const e=new Map;return e.set(Ct,"CtiTab"),e.set(yt,"EmailsTab"),e.set(It,"ChatsTab"),e}_filterTabs(e){return this._userInfo.isSSP?e.filter(i=>i.name==="FeedsTab"):(this._getLicenseOperations().forEach((i,r)=>{this._isRemoveTab(r)&&this._removeTab(e,i)}),e)}crtOnModelInit(e){var t=this;return(0,l.A)(function*(){const i=e,r=i?.viewModelConfig?.attributes,a=t._getButtonToggleGroups(i);for(const s of a){const n=s.viewConfig,c=n.for,f=g.MetadataSchemaUtils.getViewConfigInfoByFilter(T=>T.name===c,i.viewConfig)?.[0]?.viewConfig,p=`${c}_Items`;n.items=`$${p}`;let b=f?.items??[];f.name==="CommunicationsPanelItemsTabPanel"&&(b=t._filterTabs(b));const C=(0,u.mapTabItemsToToggleValues)(b);r[p]={value:C};const E=`${c}_${Ot}`;r[E]=r[E]||t._getDefaultSelectedTabValue(f),n.value=`$${E}`,f.selectedTab=`$${E}`,f.visible=`$${E} | crt.ToBoolean`,yield t._profileAttributeService.prepareAttributeWithFeatureCheck(i,f,"selectedTab",E,"DisableSaveToProfileToggleGroupSelectedTab"),f?.allowToggleClose!==void 0&&(n.allowUntoggle=f?.allowToggleClose)}return Promise.resolve(e)})()}static{this.\u0275fac=function(t){return new(t||Ve)(o.\u0275\u0275inject(g.UserInfo),o.\u0275\u0275inject(u.ProfileAttributeService),o.\u0275\u0275inject(S.LICENSE_RESTRICTION_OPERATION_VALUES))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:Ve,factory:Ve.\u0275fac})}}class H{constructor(e){this._comboboxPreprocessorService=e}_getComboboxesViewConfigs(e){return g.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.ComboBox",e.viewConfig).map(t=>t.viewConfig)}crtOnMetaDataInit(e){const t=e,i=t.viewModelConfig.attributes,r=this._getComboboxesViewConfigs(t);return this._comboboxPreprocessorService.crtOnMetaDataInit(r,i),Promise.resolve(e)}crtOnModelInit(e,t){var i=this;return(0,l.A)(function*(){const r=e,a=r.viewModelConfig.attributes,s=i._getComboboxesViewConfigs(r);return yield i._comboboxPreprocessorService.crtOnModelInit(s,a,t),e})()}crtOnViewModelInit(e,t,i){var r=this;return(0,l.A)(function*(){const a=e,s=a.viewModelConfig.attributes,n=r._getComboboxesViewConfigs(a);return yield r._comboboxPreprocessorService.crtOnViewModelInit(n,s,i),e})()}static{this.\u0275fac=function(t){return new(t||H)(o.\u0275\u0275inject(U.ComboboxPreprocessorService))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:H,factory:H.\u0275fac})}}var z=y(79772);class nt{hasEntityEditPage(e,t){return(0,l.A)(function*(){const i={type:"crt.7XRequest",action:"HasEntityEditPage",$context:e,payload:{entityName:t}};return yield I.HandlerChainService.instance.process(i)})()}crtOnViewModelInit(e,t,i){var r=this;return(0,l.A)(function*(){return yield Promise.all((0,u.getDataGridViewConfigsWithItemsBinding)(e,r.viewItemTypes).filter(a=>!a.rowToolbarItems).map(a=>r.setRowToolbarMenuItems(a,i))),e})()}}class J extends nt{constructor(e){super(),this._translateService=e,this.viewItemTypes=["crt.DataGrid"]}setRowToolbarMenuItems(e,t){var i=this;return(0,l.A)(function*(){const r=e.items.slice(1),a=t.getBoundDataSourceNameByAttributePath(r),s=t.getBoundDataSchemaByAttributePath(r)?.name,n=yield i.hasEntityEditPage(t,s),c=`$${r}.PrimaryModelMode | crt.IsEqual : 'create'`;e.rowToolbarItems=[{type:"crt.MenuItem",caption:i._translateService.instant("DataGrid.RowToolbar.Open"),icon:"edit-row-action",visible:n,disabled:c,clicked:{request:"crt.UpdateRecordRequest",params:{itemsAttributeName:r,recordId:`$${r}.${a}_Id`},useRelativeContext:!0}},{type:"crt.MenuItem",caption:i._translateService.instant("DataGrid.RowToolbar.Copy"),icon:"copy-row-action",visible:n,disabled:c,clicked:{request:"crt.CopyRecordRequest",params:{itemsAttributeName:r,recordId:`$${r}.${a}_Id`},useRelativeContext:!0}},{type:"crt.MenuItem",caption:i._translateService.instant("DataGrid.RowToolbar.Delete"),icon:"delete-row-action",clicked:{request:"crt.DeleteRecordRequest",params:{itemsAttributeName:r,recordId:`$${r}.${a}_Id`},useRelativeContext:!1}}]})()}static{this.\u0275fac=function(t){return new(t||J)(o.\u0275\u0275inject(z.TranslateService))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:J,factory:J.\u0275fac})}}var ft=y(47742);const wt={[I.DataValueType.Integer]:0,[I.DataValueType.FLOAT1]:1,[I.DataValueType.FLOAT2]:2,[I.DataValueType.FLOAT3]:3,[I.DataValueType.FLOAT4]:4,[I.DataValueType.FLOAT8]:8,[I.DataValueType.Money]:2};class G{process(e,t){const i=wt[t]??null;i!==null&&!e.format&&(e.format={decimalPrecision:i})}static{this.\u0275fac=function(t){return new(t||G)}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:G,factory:G.\u0275fac})}}class Be{constructor(e){this._numberInputPreprocessorService=e}_process(e,t){if(!(0,h.isBindingExpression)(e.control))return;const i=(0,h.parseExpression)(e.control).attributePath;if(!i)return;const a=t.getBoundDataSchemaAttributeByAttributePath(i)?.dataValueType;a&&this._numberInputPreprocessorService.process(e,a)}crtOnViewModelInit(e,t,i){const r=e;return g.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.NumberInput",r.viewConfig).forEach(s=>{this._process(s.viewConfig,i)}),Promise.resolve(e)}static{this.\u0275fac=function(t){return new(t||Be)(o.\u0275\u0275inject(G))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:Be,factory:Be.\u0275fac})}}class Y{constructor(e,t,i,r,a){this._editingCellViewConfigCreatorFactory=e,this._featureService=t,this._metadataModifierService=i,this._comboboxPreprocessorService=r,this._numberInputPreprocessorService=a}_isEditingModeDisabled(){return(0,A.firstValueFrom)(this._featureService.getFeatureState(R.DISABLE_DATA_GRID_EDITING_MODE_FEATURE_CODE))}_updateAttributeProperties(e,t,i){ft.ViewElementConfigUtils.updateCollectionAttributeProperties(t,e,i,[{name:"readonly",defaultValue:!1}])}_addColumnsEditingCellViewConfigs(e,t,i,r=!1){var a=this;return(0,l.A)(function*(){const s=e.columns;if(!Array.isArray(s))return;const n=e.items,c=s.filter(d=>!d.editingCellView);for(const d of c){const p=yield a._editingCellViewConfigCreatorFactory.create({dataValueType:d.dataValueType,columnName:d.code}).getViewElementConfig({column:d,itemsAttributeName:n,context:t});r&&p&&a._updateAttributeProperties(i,p,n),p&&a._metadataModifierService.addProperty(d,"editingCellView",p)}})()}_getColumnDefinitionByPredicate(e,t){return Array.isArray(e.columns)?(e.columns||[]).filter(t):[]}_getComboboxesViewConfigsFromDataGridViewConfig(e){return this._getDataGridComboBoxColumnDefinitions(e).map(t=>t.editingCellView)}_getDataGridComboBoxColumnDefinitions(e){return this._getColumnDefinitionByPredicate(e,t=>!!(t.dataValueType===I.DataValueType.Lookup&&t.editingCellView))}_getDataGridNumberInputColumnDefinitions(e){return this._getColumnDefinitionByPredicate(e,t=>t.editingCellView?.type==="crt.DataTableEditNumericCell")}_getDataGridItemsAttributeConfig(e,t){const i=(0,u.getViewModelItemsAttributeName)(e);return i?t.viewModelConfig.attributes[i]?.viewModelConfig?.attributes:void 0}_addEditableFeature(e,t){const i=e.features;if((0,h.isBindingExpression)(i))return;const r=(0,u.fullInDataTableEditingFeatures)(i?.editable,!t);if(!i)return this._metadataModifierService.addProperty(e,"features",{editable:r});const a=i.editable;if(a==null)return this._metadataModifierService.addProperty(i,"editable",r);typeof a!="boolean"&&(a.enable==null&&this._metadataModifierService.addProperty(a,"enable",r.enable),a.itemsCreation==null&&this._metadataModifierService.addProperty(a,"itemsCreation",a.enable&&r.itemsCreation),a.floatingEditPanel==null&&this._metadataModifierService.addProperty(a,"floatingEditPanel",a.enable&&r.floatingEditPanel),a.lookupItemsCreation==null&&this._metadataModifierService.addProperty(a,"lookupItemsCreation",a.enable&&r.lookupItemsCreation))}_comboboxesOnViewModelInit(e,t,i){var r=this;return(0,l.A)(function*(){const a=r._getComboboxesViewConfigsForOnViewModelInit(e,t);yield r._comboboxPreprocessorService.crtOnViewModelInit(a,t,i)})()}_getComboboxesViewConfigsForOnViewModelInit(e,t){return e.map(i=>{const r=this._getComboboxesViewConfigsFromDataGridViewConfig(i);return this._addActionAddRecordToListActionsIfNeed(r,t,i),r}).flat(1)}_addActionAddRecordToListActionsIfNeed(e,t,i){const r=this._getLookupItemsCreationFeatureValue(i);(!(0,_.isBoolean)(r)||r)&&e.forEach(s=>this._addActionAddRecordToListActions(s,t))}_getLookupItemsCreationFeatureValue(e){return e.features?.editable?.lookupItemsCreation}_addActionAddRecordToListActions(e,t){const i=t[`${e.attributeName}_List`],r=i&&"embeddedModel"in i&&i.embeddedModel?.config?.config?.entitySchemaName;if(!r)return;const a=e.control.split(".").pop(),s={...U.defaultAddRecordActionConfig,clicked:{request:"crt.CreateRecordFromEditLookupCellRequest",params:{schemaName:r,attributeName:a,detail:"@event.detail"},useRelativeContext:!0},name:N.NameGenerator.generateUnique("ListAction")};this._addComboboxActionIfNotExist(e,U.ComboboxActionCodeEnum.AddRecord,s)}_addComboboxActionIfNotExist(e,t,i){e.listActions||(e.listActions=[]),!e.listActions.some(a=>a.code===t)&&e.listActions.push(i)}_numbersOnViewModelInit(e){this._getDataGridNumberInputColumnDefinitions(e).forEach(i=>{const r=i.dataValueType,a=i.editingCellView;this._numberInputPreprocessorService.process(a,r)})}_updateCellPropertiesOnViewModelInit(e,t,i){var r=this;return(0,l.A)(function*(){const a=e.items,s=r._getColumnDefinitionByPredicate(e,n=>n.editingCellView?.type===i);for(const n of s){const d=yield r._editingCellViewConfigCreatorFactory.create({dataValueType:n.dataValueType,columnName:n.code}).getViewElementConfig({column:n,itemsAttributeName:a,context:t});r._metadataModifierService.addProperty(n,"editingCellView",d)}})()}_phoneOnViewModelInit(e,t){var i=this;return(0,l.A)(function*(){yield i._updateCellPropertiesOnViewModelInit(e,t,"crt.DataTableEditPhoneCell")})()}_emailOnViewModelInit(e,t){var i=this;return(0,l.A)(function*(){yield i._updateCellPropertiesOnViewModelInit(e,t,"crt.DataTableEditEmailCell")})()}_isDataGridEditingEnabled(e){const t=e.features;return(0,h.isBindingExpression)(t)?!0:(0,u.fullInDataTableEditingFeatures)(t?.editable).enable}crtOnMetaDataInit(e){var t=this;return(0,l.A)(function*(){const i=e,r=yield t._isEditingModeDisabled(),a=(0,u.getDataGridViewConfigs)(e);for(const s of a){if(t._addEditableFeature(s,r),!t._isDataGridEditingEnabled(s)||r)continue;yield t._addColumnsEditingCellViewConfigs(s,null,i,!0);const n=t._getDataGridItemsAttributeConfig(s,e);if(!n)continue;const c=t._getComboboxesViewConfigsFromDataGridViewConfig(s);t._comboboxPreprocessorService.crtOnMetaDataInit(c,n)}return e})()}crtOnModelInit(e,t){var i=this;return(0,l.A)(function*(){if(yield i._isEditingModeDisabled())return e;const r=(0,u.getDataGridViewConfigs)(e);for(const a of r){if(!i._isDataGridEditingEnabled(a))continue;const s=i._getDataGridItemsAttributeConfig(a,e);if(!s)continue;const n=i._getComboboxesViewConfigsFromDataGridViewConfig(a);yield i._comboboxPreprocessorService.crtOnModelInit(n,s,t)}return e})()}crtOnViewModelInit(e,t,i){var r=this;return(0,l.A)(function*(){if(yield r._isEditingModeDisabled())return e;const a=e,s=(0,u.getDataGridViewConfigs)(e);let n={};const c=[];for(const d of s){if(!r._isDataGridEditingEnabled(d))continue;const f=r._getDataGridItemsAttributeConfig(d,e);f&&(n={...n,...f},c.push(d),yield r._addColumnsEditingCellViewConfigs(d,i,a),r._numbersOnViewModelInit(d),yield r._phoneOnViewModelInit(d,i),yield r._emailOnViewModelInit(d,i))}return yield r._comboboxesOnViewModelInit(c,n,i),e})()}static{this.\u0275fac=function(t){return new(t||Y)(o.\u0275\u0275inject(R.DATA_GRID_EDITING_CELL_VIEW_CONFIG_CREATOR_FACTORY),o.\u0275\u0275inject(S.FeatureService),o.\u0275\u0275inject(m.MetadataModifierService),o.\u0275\u0275inject(U.ComboboxPreprocessorService),o.\u0275\u0275inject(G))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:Y,factory:Y.\u0275fac})}}var P=y(36486);class L{constructor(e,t,i){this.featureService=e,this.metadataModifierService=t,this.dataGridColumnDefinitionService=i,this.featureName="DisableDataGridColumnsPreprocessing",this.viewItemTypes=["crt.DataGrid"]}_getColumnDefinitions(e,t){var i=this;return(0,l.A)(function*(){const r=e.columns,a=yield i.getGenerateCellViewConfig(e,t);return a?(0,A.lastValueFrom)(i.dataGridColumnDefinitionService.processDataGridColumnDefinitions(a,r)):[]})()}_addColumnsCellViewConfigs(e,t){var i=this;return(0,l.A)(function*(){const r=e.columns;if(!Array.isArray(r)||r.length===0)return;const a=yield i._getColumnDefinitions(e,t);i._addColumnProperty(r,a,"cellView"),i._addColumnProperty(r,a,"readonly"),r.forEach(s=>{delete s.path,delete s.referenceSchemaName})})()}_addColumnProperty(e,t,i){e.filter(r=>!r[i]).map(r=>[r,t.find(a=>a.code===r.code)]).forEach(([r,a])=>this.metadataModifierService.addProperty(r,i,a?.[i]))}getGenerateCellViewConfig(e,t){const i=(0,A.of)(t),r=(0,u.getViewModelItemsAttributeName)(e);if(!r)return Promise.resolve(null);const a=i.pipe((0,P.map)(c=>c?.getBoundDataSourceNameByAttributePath(r))),s=i.pipe((0,P.map)(c=>c?.getBoundDataSchemaByAttributePath(r))),n=e.items;return(0,A.lastValueFrom)((0,A.forkJoin)([a,s]).pipe((0,P.switchMap)(([c,d])=>c&&d?(0,A.of)({dataSchema:d,dataSourceName:c,itemsAttributeName:n,viewModel:t,features:e.features,dataGridName:e.name}):(0,A.of)(null))))}crtOnViewModelInit(e,t,i){var r=this;return(0,l.A)(function*(){if(yield(0,A.lastValueFrom)(r.featureService.getFeatureState(r.featureName),{defaultValue:null}))return e;const s=g.MetadataSchemaUtils.getViewConfigInfoByPropertyForValues("type",r.viewItemTypes,e.viewConfig);for(const n of s)yield r._addColumnsCellViewConfigs(n.viewConfig,i);return e})()}static{this.\u0275fac=function(t){return new(t||L)(o.\u0275\u0275inject(S.FeatureService),o.\u0275\u0275inject(m.MetadataModifierService),o.\u0275\u0275inject(R.DataGridColumnDefinitionService))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:L,factory:L.\u0275fac})}}class X{constructor(e){this._filterOptionsBackwardCompatibilityModifier=e}_isEmptyExposeFilters(e){const t=e?._filterOptions;return t?!t.expose?.length:!1}crtOnMetaDataInit(e){return(0,u.getDataGridViewConfigs)(e,["crt.DataGrid"]).filter(t=>this._isEmptyExposeFilters(t)).forEach(t=>this._filterOptionsBackwardCompatibilityModifier.modify(t)),Promise.resolve(e)}static{this.\u0275fac=function(t){return new(t||X)(o.\u0275\u0275inject(u.DataGridFilterOptionsBackwardCompatibilityModifier))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:X,factory:X.\u0275fac})}}class K{_setInitialFilterOptions(e){e.items??=`$${(0,u.createDataGridItemsAttributeName)(e)}`,e.activeRow??=`$${(0,u.createDataGridActiveRowAttributeName)(e)}`;const t=(0,u.createDataGridInitialFilterOptions)(e);t&&(e._filterOptions=t)}_canSetInitialFilterOptions(e){return(0,_.isEmpty)(e?._filterOptions)&&(0,u.canDataGridContainsFilterOptions)(e)}crtOnMetaDataInit(e){return(0,u.getDataGridViewConfigs)(e,["crt.DataGrid"]).filter(this._canSetInitialFilterOptions).forEach(t=>this._setInitialFilterOptions(t)),Promise.resolve(e)}static{this.\u0275fac=function(t){return new(t||K)}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:K,factory:K.\u0275fac})}}class ot{static{this.\u0275fac=function(t){return new(t||ot)}}static{this.\u0275mod=o.\u0275\u0275defineNgModule({type:ot})}static{this.\u0275inj=o.\u0275\u0275defineInjector({providers:[u.DataGridFilterOptionsBackwardCompatibilityModifier,{provide:m.CRT_DESIGN_TIME_METADATA_PREPROCESSOR,useClass:K,multi:!0},{provide:m.CRT_DESIGN_TIME_METADATA_PREPROCESSOR,useClass:X,multi:!0}]})}}class Ge{_cleanupDefaultFilterOptionsMetadata(e){const t=e._filterOptions;if(!t)return this._cleanupDefaultActiveRow(e);const i=(0,_.cloneDeep)(e),r=`$${(0,u.createDataGridActiveRowAttributeName)(e)}`;i.activeRow??=r;const a=(0,u.createDataGridInitialFilterOptions)(i);(0,_.isEqual)(t,a)&&(delete e._filterOptions,this._cleanupDefaultActiveRow(e))}_cleanupDefaultActiveRow(e){const t=e.activeRow,i=`$${(0,u.createDataGridActiveRowAttributeName)(e)}`;(0,_.isEqual)(t,i)&&delete e.activeRow}crtOnMetaDataChanged(e){return(0,u.getDataGridViewConfigs)(e,["crt.DataGrid"]).forEach(t=>this._cleanupDefaultFilterOptionsMetadata(t)),Promise.resolve(e)}static{this.\u0275fac=function(t){return new(t||Ge)}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:Ge,factory:Ge.\u0275fac})}}class ct{static{this.\u0275fac=function(t){return new(t||ct)}}static{this.\u0275mod=o.\u0275\u0275defineNgModule({type:ct})}static{this.\u0275inj=o.\u0275\u0275defineInjector({providers:[{provide:m.CRT_DESIGN_TIME_METADATA_POSTPROCESSOR,useClass:Ge,multi:!0}]})}}class Z{constructor(e,t,i,r,a){this._defaultFeatures=e,this._featureValues=t,this._translateService=i,this._dataGridFolderTreeRelationsProvider=r,this._licenseOperationValues=a}_createGeneralListSettingsMenuItems(e,t){const i=`$${t} | crt.ToBoolean | crt.InvertBooleanValue`,r=this._defaultFeatures?.operations?.canCreateDefaultGridSettings,a={type:"crt.MenuItem",caption:this._translateService.instant("DataGrid.ActionsToolbar.SaveForAll"),icon:"save",visible:i,clicked:{request:"crt.DataGridSaveConfigsForAllRequest",params:{dataGridName:e.name}}};return[{type:"crt.MenuLabel",caption:this._translateService.instant("DataGrid.ActionsToolbar.GeneralListSettingsLabel"),visible:i},...r?[a]:[],{type:"crt.MenuItem",caption:this._translateService.instant("DataGrid.ActionsToolbar.ResetToDefault"),icon:"reset",visible:i,clicked:{request:"crt.DataGridResetConfigsToDefaultRequest",params:{dataGridName:e.name}}}]}_setupSaveConfigsForActiveFolderActionVisibleAttribute(e,t,i,r){const a=`${t}_Exist`,s=`${i}_NotExist`;r.viewModelConfig??={},r.viewModelConfig.attributes={...r.viewModelConfig.attributes,[a]:{from:t,converter:"crt.ToBoolean"},[s]:{from:i,converter:"crt.ToBoolean | crt.InvertBooleanValue"},[e]:{from:[a,s],converter:"crt.IsEveryEqualTo : true"}}}_createFolderListSettingsMenuItems(e,t,i){const r=this._licenseOperationValues[u.CAN_MANAGE_LIST_COLUMNS_LICENSE_OPERATION_CODE];if(this._featureValues.DisableDataGridSettingsByFolders||!r)return[];const a=this._dataGridFolderTreeRelationsProvider.getSingleRelatedFolderTreeViewConfig(e,i);if(!a?.name)return[];const s=this._translateService.instant("DataGrid.ActionsToolbar.SaveListSettingsForFolder"),n=this._translateService.instant("DataGrid.ActionsToolbar.ClearListSettingsForFolder"),c=`$${t} | crt.ToBoolean`,{activeFolderFolderTreeIdAttrName:d,activeFolderNameAttrName:f}=(0,g.buildFolderTreeAttributeNames)(a.name),p=`$${f} | crt.InterpolateString : '${s}'`,b=e.name+"_SaveConfigsForActiveFolderAction_Visible";return this._setupSaveConfigsForActiveFolderActionVisibleAttribute(b,d,t,i),[{type:"crt.MenuLabel",caption:this._translateService.instant("DataGrid.ActionsToolbar.FolderListSettingsLabel"),visible:`$${d} | crt.ToBoolean`},{type:"crt.MenuItem",caption:p,icon:"save-for-folder-icon",visible:`$${b}`,clicked:{request:"crt.DataGridSaveConfigsForActiveFolderRequest",params:{folderTreeName:a.name,dataGridName:e.name}}},{type:"crt.MenuItem",caption:p,icon:"save-for-folder-icon",visible:c,clicked:{request:"crt.DataGridUpdateConfigsForActiveFolderRequest",params:{folderTreeName:a.name,dataGridName:e.name}}},{type:"crt.MenuItem",caption:`$${f} | crt.InterpolateString : '${n}'`,icon:"discard-for-folder-icon",visible:c,clicked:{request:"crt.DataGridClearConfigsForActiveFolderRequest",params:{dataGridName:e.name,folderTreeName:a.name}}}]}crtOnMetaDataInit(e){return(0,u.getDataGridViewConfigs)(e).filter(i=>!i.headerToolbarItems).forEach(i=>{const r=(0,u.createDataGridActiveFolderSettingsAttributeName)(i),a=this._createGeneralListSettingsMenuItems(i,r),s=this._createFolderListSettingsMenuItems(i,r,e);i.headerToolbarItems=[...a,...s]}),Promise.resolve(e)}static{this.\u0275fac=function(t){return new(t||Z)(o.\u0275\u0275inject(u.DATA_GRID_FEATURES,8),o.\u0275\u0275inject(g.FEATURE_VALUES),o.\u0275\u0275inject(z.TranslateService),o.\u0275\u0275inject(u.DataGridFolderTreeRelationsProvider),o.\u0275\u0275inject(S.LICENSE_RESTRICTION_OPERATION_VALUES))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:Z,factory:Z.\u0275fac})}}class Q{constructor(e){this._featureService=e}_isEditingModeDisabled(){return(0,A.firstValueFrom)(this._featureService.getFeatureState(R.DISABLE_DATA_GRID_EDITING_MODE_FEATURE_CODE))}_setCancelItemsChangesOutput(e){const t=e.items.slice(1);e.cancelItemsChanges={request:"crt.DataGridCancelItemsChangesRequest",params:{itemsAttributeName:t,changedItems:"@event"}}}crtOnMetaDataInit(e){var t=this;return(0,l.A)(function*(){return(yield t._isEditingModeDisabled())||(0,u.getDataGridViewConfigsWithItemsBinding)(e).filter(i=>i.cancelItemsChanges==null).forEach(i=>t._setCancelItemsChangesOutput(i)),e})()}static{this.\u0275fac=function(t){return new(t||Q)(o.\u0275\u0275inject(S.FeatureService))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:Q,factory:Q.\u0275fac})}}class ee{constructor(e){this._featureService=e}_isEditingModeDisabled(){return(0,A.firstValueFrom)(this._featureService.getFeatureState(R.DISABLE_DATA_GRID_EDITING_MODE_FEATURE_CODE))}_isItemsCreationEnabled(e){const t=e.features;return(0,h.isBindingExpression)(t)?!0:!!(0,u.fullInDataTableEditingFeatures)(t?.editable,!0).itemsCreation}_bindEditingCellsInput(e,t){if(e.editingCells)return;const i=e.name&&`${e.name}_EditingCells`;i&&(t[i]||(t[i]={value:null}),e.editingCells=`$${i}`)}_bindItemCreatingOutput(e,t,i){if(e.createItem)return;const r=this._getDefaultValuesFromDependencies(e,t,i);e.createItem={request:"crt.DataGridCreateItemRequest",params:{dataGridName:e.name,insertionIndex:"@event.index",defaultValues:r.map(({attributeName:a,value:s})=>({attributeName:a,value:s}))}}}_getDefaultValuesFromDependencies(e,t,i){const r=i.dependencies,a=i.dataSources,s=i.primaryDataSourceName||"",n=e.items.slice(1),d=t[n]?.modelConfig?.path,f=d&&r?.[d];return f?f.filter(p=>this._isDependOnPageDataSource(p,a)).map(p=>this._getDependencyAttributeName(p,t,s)).map((p,b)=>p||`${e.name}_DependencyValue_${b}`).map((p,b)=>{const C=f[b];return this._setDependencyViewModelAttribute(p,C,t),this._getDefaultValue(p,C,a)}):[]}_getRelatedDataSourceName(e){return e.relationPath.split(".").shift()??""}_isDependOnPageDataSource(e,t){const i=this._getRelatedDataSourceName(e);return t?.[i]?.scope===I.DataSourceScope.Page}_getDefaultValue(e,t,i){const r=this._getRelatedDataSourceName(t),a=i?.[r]?.config||{},s=a.entitySchemaName?`$${e} | crt.ToLookup : '${a.entitySchemaName}'`:`$${e}`;return{attributeName:t.attributePath,value:s}}_setDependencyViewModelAttribute(e,t,i){i[e]||(i[e]={modelConfig:{path:t.relationPath}})}_getDependencyAttributeName(e,t,i){return Object.keys(t).find(r=>(t[r]?.modelConfig?.path||"").replace("#PrimaryDataSourceName()#",i)===e.relationPath)}crtOnMetaDataInit(e){var t=this;return(0,l.A)(function*(){if(yield t._isEditingModeDisabled())return e;const i=e;i.viewModelConfig=i.viewModelConfig??{};const r=i.viewModelConfig.attributes=i.viewModelConfig.attributes||{},a=i.modelConfig||{};return(0,u.getDataGridViewConfigsWithItemsBinding)(i).filter(s=>t._isItemsCreationEnabled(s)).forEach(s=>{t._bindEditingCellsInput(s,r),t._bindItemCreatingOutput(s,r,a)}),e})()}static{this.\u0275fac=function(t){return new(t||ee)(o.\u0275\u0275inject(S.FeatureService))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:ee,factory:ee.\u0275fac})}}class te{_bindItemDeletionOutput(e){const t=e.items.slice(1);e.deleteItem||!t||(e.deleteItem={request:"crt.DeleteRecordRequest",params:{itemsAttributeName:t,recordId:"@event.rowId"}})}crtOnMetaDataInit(e){const t=e;return t.viewModelConfig=t.viewModelConfig??{},(0,u.getDataGridViewConfigsWithItemsBinding)(t).forEach(i=>{this._bindItemDeletionOutput(i)}),Promise.resolve(e)}static{this.\u0275fac=function(t){return new(t||te)}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:te,factory:te.\u0275fac})}}class ie{constructor(e){this._featureService=e,this._featureName="DisableDataGridEditingMode"}_isEditingModeDisabled(){return(0,A.firstValueFrom)(this._featureService.getFeatureState(R.DISABLE_DATA_GRID_EDITING_MODE_FEATURE_CODE))}_setSaveItemsChangesOutput(e){const t=e.items.slice(1);e.saveItemsChanges={request:"crt.SaveRecordsRequest",params:{itemsAttributeName:t}}}crtOnMetaDataInit(e){var t=this;return(0,l.A)(function*(){return(yield t._isEditingModeDisabled())||(0,u.getDataGridViewConfigsWithItemsBinding)(e).filter(i=>i.saveItemsChanges==null).forEach(i=>t._setSaveItemsChangesOutput(i)),e})()}static{this.\u0275fac=function(t){return new(t||ie)(o.\u0275\u0275inject(S.FeatureService))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:ie,factory:ie.\u0275fac})}}class re{constructor(e){this._featureValues=e}_createActivateRowBusinessRulesRequest(e,t){return{request:"crt.DataGridActivateRowBusinessRulesRequest",params:{rowValueAttributeName:e,dataGridViewElementName:t.name}}}_getActiveRowAttributeName(e){let t=e.activeRow;return t==null&&(t=`$${(0,u.createDataGridActiveRowAttributeName)(e)}`),(0,h.isBindingExpression)(t)?(0,h.parseExpression)(t).attributePath:""}crtOnMetaDataInit(e){if(this._featureValues.DisableActivateGridRowOnReload)return Promise.resolve(e);const t=e;return(0,u.getDataGridViewConfigsWithItemsBinding)(e).forEach(i=>{const r=this._getActiveRowAttributeName(i);if(r){const a=(0,u.getDataGridItemsAttributeName)(i);g.MetadataSchemaUtils.addViewModelAttributeChangeRequest(t,{attributeName:a,requests:[this._createActivateRowBusinessRulesRequest(r,i)]})}}),Promise.resolve(e)}static{this.\u0275fac=function(t){return new(t||re)(o.\u0275\u0275inject(g.FEATURE_VALUES))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:re,factory:re.\u0275fac})}}function gt(v){return{request:"crt.LoadDataRequest",params:{dataSourceName:v,parameters:[]}}}function pt(){return{rowCount:30}}class ae{constructor(e){this._featureService=e,this._featureName="DisableDataGridPagingPreprocessing"}_setPaginationChange(e,t){if(e.paginationChange)return;const i=e.items?.slice(1),r=t.getBoundDataSourceNameByAttributePath(i);e.paginationChange=gt(r)}_setPagingConfig(e,t){const i=e.items?.slice(1),r=(t?.viewModelConfig?.attributes)[i]??{};if(!(0,m.isModelAttributeConfig)(r))return;const a=r.modelConfig;!a||a?.pagingConfig||(a.pagingConfig=pt())}get _isFeatureDisabled(){return(0,A.lastValueFrom)(this._featureService.getFeatureState(this._featureName))}crtOnMetaDataInit(e){var t=this;return(0,l.A)(function*(){if(yield t._isFeatureDisabled)return e;const i=e,r=(0,u.getDataGridViewConfigsWithItemsBinding)(e);for(const a of r)t._setPagingConfig(a,i);return e})()}crtOnViewModelInit(e,t,i){var r=this;return(0,l.A)(function*(){if(yield r._isFeatureDisabled)return e;const a=(0,u.getDataGridViewConfigsWithItemsBinding)(e);for(const s of a)r._setPaginationChange(s,i);return e})()}static{this.\u0275fac=function(t){return new(t||ae)(o.\u0275\u0275inject(S.FeatureService))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:ae,factory:ae.\u0275fac})}}function Dt(v,e){return`${v}_${e}`}class se{constructor(e){this._featureService=e,this._featureName="DisableDataGridPlaceholderPreprocessing"}_setNoConfiguredPlaceholder(e){e.skeleton==null&&(e.skeleton=[{type:"crt.Placeholder",image:{type:"icon",icon:"data-table",width:null,height:null,padding:null},title:"",subhead:""}])}_setNoItemsPlaceholders(e,t,i){const r=t.placeholder,a=t.items?.split("$")?.pop(),s=this._getSearchFilterAttributesNames(i,a),c=[...this._getFilterAttributesNames(e,a),...s];if(!r?.length||!c.length)return;r.map(f=>f.visible).map(f=>(f??"")?.split("$")?.pop()).filter(Boolean).map(f=>e[f]).filter(Boolean).forEach(f=>f.from=(0,_.uniq)([...f.from,...c]))}_getFilterAttributesNames(e,t){const r=e[t]?.modelConfig?.filterAttributes??[];return Object.values(r).filter(a=>a.loadOnChange).filter(a=>!a.name.endsWith("_PredefinedFilter")).map(a=>a.name)}_getSearchFilterAttributesNames(e,t){return e.filter(i=>i.targetAttributes?.includes(t)).map(({name:i})=>Dt(i,t))}_getSearchFilterViewConfigs(e){return g.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.SearchFilter",e.viewConfig).map(t=>t?.viewConfig).filter(Boolean)}crtOnMetaDataInit(e){var t=this;return(0,l.A)(function*(){if(yield(0,A.lastValueFrom)(t._featureService.getFeatureState(t._featureName),{defaultValue:null}))return e;const r=e;r.viewModelConfig.attributes=r.viewModelConfig.attributes??{};const a=r.viewModelConfig.attributes,s=t._getSearchFilterViewConfigs(r);return(0,u.getDataGridViewConfigs)(e).forEach(n=>{(0,h.isBindToViewModelAttribute)(n.items,a)?t._setNoItemsPlaceholders(a,n,s):t._setNoConfiguredPlaceholder(n)}),e})()}static{this.\u0275fac=function(t){return new(t||se)(o.\u0275\u0275inject(S.FeatureService))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:se,factory:se.\u0275fac})}}class ne{_bindActiveRow(e,t,i){if(t.activeRow===void 0&&(t.activeRow=`$${(0,u.createDataGridActiveRowAttributeName)(t)}`),!(0,h.isBindingExpression)(t.activeRow))return;const r=(0,h.parseExpression)(t.activeRow).attributePath;i[r]??={value:null},g.MetadataSchemaUtils.addViewModelAttributeChangeRequest(e,{attributeName:r,requests:[{request:"crt.DataGridActivateRowBusinessRulesRequest",params:{rowValueAttributeName:r,dataGridViewElementName:t.name}}]})}crtOnMetaDataInit(e){const t=e,i=t.viewModelConfig.attributes??={};return(0,u.getDataGridViewConfigs)(e).forEach(r=>this._bindActiveRow(t,r,i)),Promise.resolve(e)}static{this.\u0275fac=function(t){return new(t||ne)}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:ne,factory:ne.\u0275fac})}}class oe{constructor(e){this._featureService=e,this._featureName="DisableDataGridRowDoubleClickPreprocessing"}_hasSectionEditPage(e,t){return(0,l.A)(function*(){const i={type:"crt.7XRequest",action:"HasEntityEditPage",$context:t,payload:{entityName:e}};return yield I.HandlerChainService.instance.process(i)})()}_getReferenceSchemaName(e,t){return(0,l.A)(function*(){return(yield(0,m.getEntitySchemaAttribute)(t,e))?.referenceSchemaName})()}_getPrimaryAttributeName(e,t){const i=(0,u.getViewModelItemsAttributeName)(e),r=t.getBoundDataSourceNameByAttributePath(i),a=t.getBoundDataSchemaByAttributePath(i),{primaryAttributeName:s}=a??{};return s?`${r}_${s}`:""}_isPageExists(e,t){var i=this;return(0,l.A)(function*(){const r=i._getPrimaryAttributeName(e,t),a=yield i._getReferenceSchemaName(r,t);return i._hasSectionEditPage(a,t)})()}_getDataGridViewConfigs(e,t){var i=this;return(0,l.A)(function*(){const r=(0,u.getDataGridViewConfigsWithItemsBinding)(e);return(yield Promise.all(r.map(s=>i._isPageExists(s,t)))).reduce((s,n,c)=>(n&&!r[c].rowDoubleClick&&s.push(r[c]),s),[])})()}crtOnViewModelInit(e,t,i){var r=this;return(0,l.A)(function*(){if(yield(0,A.lastValueFrom)(r._featureService.getFeatureState(r._featureName),{defaultValue:null}))return e;const s=yield r._getDataGridViewConfigs(e,i);for(const n of s)n.rowDoubleClick={request:"crt.DataGridRowDoubleClickRequest",params:{itemsAttributeName:(0,u.getViewModelItemsAttributeName)(n),rowId:"@event.rowId"}};return e})()}static{this.\u0275fac=function(t){return new(t||oe)(o.\u0275\u0275inject(S.FeatureService))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:oe,factory:oe.\u0275fac})}}class ce{constructor(e){this._featureService=e}_isSelectionPreprocessingDisabled(){const e=this._featureService.getFeatureState("DisableDataGridRowsSelectionPreprocessing");return(0,A.lastValueFrom)(e,{defaultValue:!1})}_bindSelectedRows(e,t){if(e.selectedRows??=`$${(0,u.createDataGridSelectedRowsAttributeName)(e)}`,!(0,h.isBindingExpression)(e.selectedRows))return;const i=(0,h.parseExpression)(e.selectedRows).attributePath;t[i]||(t[i]={value:null})}_bindSelectionState(e,t,i){if(t.selectionState??=`$${(0,u.createDataGridSelectionStateAttributeName)(t)}`,!(0,h.isBindingExpression)(t.selectionState))return;const r=(0,h.parseExpression)(t.selectionState).attributePath;if(i[r]??={value:null},!(0,h.isBindingExpression)(t.items))return;const a=(0,h.parseExpression)(t.items).attributePath;if(t.totalItemsCount??=`$${a}_TotalItemsCount`,!(0,h.isBindingExpression)(t.totalItemsCount))return;const s=(0,h.parseExpression)(t.totalItemsCount).attributePath,n=`${a}_SelectedItemsCount`;if(this._createTotalItemsCountAttribute(s,{itemsAttributeName:a,selectionStateAttributeName:r},i),this._createSelectedItemsCountAttribute(n,{itemsAttributeName:a,selectionStateAttributeName:r,totalItemsCountAttributeName:s},i),g.MetadataSchemaUtils.addViewModelAttributeChangeRequest(e,{attributeName:r,requests:[{request:"crt.DataGridCleanupCachedItemsCountLoadParametersRequest",params:{itemsAttributeName:a,selectionStateAttributeName:r}},{request:"crt.DataGridRunSelectedItemsCountAttributeCalculationRequest",params:{selectionStateAttributeName:r,selectedItemsCountAttributeName:n}}]}),!(0,h.isBindingExpression)(t.selectedRows))return;const c=(0,h.parseExpression)(t.selectedRows).attributePath;g.MetadataSchemaUtils.addViewModelAttributeChangeRequest(e,{attributeName:r,requests:[{request:"crt.DataGridSetSelectedRowsFromSelectionStateRequest",params:{selectedRowsAttributeName:c,selectionStateAttributeName:r}}]})}_createTotalItemsCountAttribute(e,t,i){const{itemsAttributeName:r,selectionStateAttributeName:a}=t,s=`${e}_Actualization`;i[e]??={from:[r,s],converter:`crt.ToCollectionItemsCount : '${r}' : '${e}'`},i[s]??={from:a,converter:"crt.IsAnySelected"}}_createSelectedItemsCountAttribute(e,t,i){const{itemsAttributeName:r,selectionStateAttributeName:a,totalItemsCountAttributeName:s}=t;i[e]??={from:[r,a,s],converter:`crt.ToCollectionSelectedItemsCount : '${r}' : '${e}'`,change:{request:"crt.DataGridSetSelectedCountToRowsSelectionStateRequest",params:{selectionStateAttributeName:a,selectedItemsCountAttributeName:e}}}}crtOnMetaDataInit(e){var t=this;return(0,l.A)(function*(){if(yield t._isSelectionPreprocessingDisabled())return e;const i=e,r=i.viewModelConfig.attributes??={};return(0,u.getDataGridViewConfigs)(e).forEach(a=>{t._bindSelectedRows(a,r),t._bindSelectionState(i,a,r)}),e})()}static{this.\u0275fac=function(t){return new(t||ce)(o.\u0275\u0275inject(S.FeatureService))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:ce,factory:ce.\u0275fac})}}class le{constructor(e){this._exposeAttributeConverterMetadataGenerator=e}_getSelectionElementViewConfigs(e){return g.MetadataSchemaUtils.getViewConfigInfoByFilter(t=>!!t?._selectionOptions,e).map(t=>t.viewConfig)}_generateSelectionAttributes(e){const t=e._selectionOptions.attribute;if(typeof t=="string")return{[t]:{value:null}};const{from:i,expose:r}=t??{};if((0,_.isEmpty)(i)||(0,_.isEmpty)(r))return{};const a=r.attribute;if(!a)return{};const s=this._exposeAttributeConverterMetadataGenerator.generate(r);return s?{[a]:{from:i,converter:s.converterExpression},...s.converterArgsAttributes}:{[a]:{from:i}}}_setSelectionAttributes(e,t){const i=e.viewModelConfig.attributes??={};Object.entries(t).filter(([r,a])=>!!r).forEach(([r,a])=>{i[r]??=a})}crtOnMetaDataInit(e){const t=e;return this._getSelectionElementViewConfigs(t.viewConfig).map(i=>this._generateSelectionAttributes(i)).forEach(i=>{this._setSelectionAttributes(t,i)}),Promise.resolve(e)}static{this.\u0275fac=function(t){return new(t||le)(o.\u0275\u0275inject(h.ExposeAttributeConverterMetadataGenerator))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:le,factory:le.\u0275fac})}}class ue{static{this.\u0275fac=function(t){return new(t||ue)}}static{this.\u0275mod=o.\u0275\u0275defineNgModule({type:ue})}static{this.\u0275inj=o.\u0275\u0275defineInjector({providers:[h.ExposeAttributeConverterMetadataGenerator,{provide:m.CRT_METADATA_PREPROCESSOR,useClass:le,multi:!0}]})}}class M{_canSetSelectionOptions(e){return(0,_.isEmpty)(e?._selectionOptions)&&(0,h.canComponentContainSelectionOptions)(e)}_setSelectionOptions(e,t){e.selectionState??=`$${(0,h.createComponentSelectionStateAttributeName)(t)}`;const i=(0,h.createComponentInitialSelectionOptions)(e);i&&(e._selectionOptions=i)}setInitialSelectionOptions(e,t){this._canSetSelectionOptions(e)&&this._setSelectionOptions(e,t)}static{this.\u0275fac=function(t){return new(t||M)}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:M,factory:M.\u0275fac})}}class j{constructor(e=!1){this._isDesignTime=e,this._selectionOptionsPreprocessorService=(0,o.inject)(M)}_setInitialSelectionOptions(e){(0,u.getDataGridViewConfigs)(e,["crt.DataGrid"]).forEach(t=>this._selectionOptionsPreprocessorService.setInitialSelectionOptions(t,t.name||"DataGrid"))}_setExportToExcelRequestFiltersParameter(e){(0,ft.getRequestBindingConfigs)(e.viewConfig,"crt.ExportDataGridToExcelRequest",this._canSetExportToExcelRequestFiltersParameter).forEach(t=>{const i=t.params.viewName,r=this._getExportToExcelRequestFiltersParameter(e,i);r&&(t.params={...t.params,filters:r})})}_canSetExportToExcelRequestFiltersParameter(e){const{viewName:t,filters:i}=e?.params??{};return!!t&&i===void 0}_getExportToExcelRequestFiltersParameter(e,t){const i=g.MetadataSchemaUtils.getViewConfigInfoByName(e,t);if(!i?.viewConfig)return null;const{items:r,_selectionOptions:a}=i.viewConfig,s=(0,h.isBindingExpression)(r)&&(0,h.parseExpression)(r).attributePath,n=a?(0,h.getSelectionStateAttributeName)(a):null;return!s||!n?null:(0,h.createCollectionFiltersBindingExpression)(s,n,{supportEmptySelection:!0})}crtOnMetaDataInit(e){const t=e;return this._setInitialSelectionOptions(t),this._isDesignTime||this._setExportToExcelRequestFiltersParameter(t),Promise.resolve(e)}static{this.\u0275fac=function(t){return new(t||j)(o.\u0275\u0275inject(g.IS_DESIGN_TIME,8))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:j,factory:j.\u0275fac})}}class de{static{this.\u0275fac=function(t){return new(t||de)}}static{this.\u0275mod=o.\u0275\u0275defineNgModule({type:de})}static{this.\u0275inj=o.\u0275\u0275defineInjector({providers:[{provide:m.CRT_METADATA_PREPROCESSOR,useClass:j,multi:!0},{provide:m.CRT_DESIGN_TIME_METADATA_PREPROCESSOR,useClass:j,multi:!0}]})}}class Le{_isSelectionStateAttributeBound(e,t,i){const r=(0,_.cloneDeep)(i),s=g.MetadataSchemaUtils.getViewConfigInfoByName(r,e).viewConfig;return delete s._selectionOptions,delete s.selectionState,g.MetadataSchemaUtils.isViewModelAttributeBound(r,t)}_cleanupDefaultSelectionOptionsMetadata(e,t){const i=e._selectionOptions;if(!i)return this._cleanupDefaultSelectionState(e,t);const r=(0,_.cloneDeep)(e),a=`$${(0,u.createDataGridSelectionStateAttributeName)(e)}`;r.selectionState??=a;const s=(0,h.createComponentInitialSelectionOptions)(r);if(!(0,_.isEqual)(i,s))return;const n=(0,h.getSelectionStateAttributeName)(i);e.name&&this._isSelectionStateAttributeBound(e.name,n,t)||(delete e._selectionOptions,this._cleanupDefaultSelectionState(e,t))}_cleanupDefaultSelectionState(e,t){const i=e.selectionState,r=`$${(0,u.createDataGridSelectionStateAttributeName)(e)}`;if(!(0,_.isEqual)(i,r))return;const a=(0,h.parseExpression)(i).attributePath;e.name&&this._isSelectionStateAttributeBound(e.name,a,t)||delete e.selectionState}crtOnMetaDataChanged(e){return(0,u.getDataGridViewConfigs)(e,["crt.DataGrid"]).forEach(t=>this._cleanupDefaultSelectionOptionsMetadata(t,e)),Promise.resolve(e)}static{this.\u0275fac=function(t){return new(t||Le)}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:Le,factory:Le.\u0275fac})}}class lt{static{this.\u0275fac=function(t){return new(t||lt)}}static{this.\u0275mod=o.\u0275\u0275defineNgModule({type:lt})}static{this.\u0275inj=o.\u0275\u0275defineInjector({providers:[{provide:m.CRT_DESIGN_TIME_METADATA_POSTPROCESSOR,useClass:Le,multi:!0}]})}}class me{constructor(e,t,i){this._featureService=e,this._dcmSchemaManagerService=t,this._entitySchemaRepository=i,this._dcmDataAttributePostfix="_DCMData",this._dcmSchemas=[],this._dataGridToDataSourceMap=[],this._dataSourceSchemas=[]}_getDataGridToDataSourceMap(e,t){return e.map(i=>{const r=i.primaryColumnName?.split("_");r?.pop();const a=r?.join("_")||"",s=t[a];return{dataGridName:i.name,dataSource:s,dataSourceName:a}}).filter(({dataSource:i})=>i!=null)}_getEntitySchemaFromDataSourceSchemas(e){return this._dataSourceSchemas.find(t=>t.name===e?.config?.entitySchemaName)}_getFilterColumnPath(e){const t=e.find(r=>r.filters&&r.isActive&&r.isActiveVersion)?.filters;let i="";if(t){const r=JSON.parse(t);i=`${Object.values(r.items)[0].leftExpression.columnPath}`}return i}_fillDataGridModelConfig(e,t,i,r){var a=this;return(0,l.A)(function*(){const s=a._dcmSchemas.filter(C=>C.entitySchemaUId===e);if(!s?.length)return;const n=a._getFilterColumnPath(s),c=a._dcmSchemaManagerService.getDcmSchemaDataItems(e),d=yield(0,A.firstValueFrom)(c),f=`${t.name}${a._dcmDataAttributePostfix}`;r[f]={value:{schemas:s,schemasData:d,filterColumnAttributePath:`${i?.dataSourceName}_${n}`}};const p=t.items.substring(1),b=r[p].viewModelConfig;n&&p&&!b.attributes[n]&&(b.attributes[`${i?.dataSourceName}_${n}`]={modelConfig:{path:`${i?.dataSourceName}.${n}`}})})()}_initDataGridViewConfigAttributes(e,t){var i=this;return(0,l.A)(function*(){const r=i._dataGridToDataSourceMap.find(s=>s.dataGridName===e.name);if(!r)return;const a=i._getEntitySchemaFromDataSourceSchemas(r.dataSource);a&&(yield i._fillDataGridModelConfig(a?.uId,e,r,t))})()}_getDataSourceSchemas(){var e=this;return(0,l.A)(function*(){const t=e._dataGridToDataSourceMap.map(i=>({name:i?.dataSource?.config?.entitySchemaName,loadLookupColumns:!0}));return yield(0,A.firstValueFrom)(e._entitySchemaRepository.getSchemes(t))})()}get isProcessingDisabled(){return(0,A.lastValueFrom)(this._featureService.getFeatureState("DisableDataGridProgressBarStageCell"))}crtOnMetaDataInit(e){var t=this;return(0,l.A)(function*(){if(yield t.isProcessingDisabled)return e;const i=(0,u.getDataGridViewConfigs)(e);if(!i?.length)return e;const r=e.modelConfig.dataSources||{};t._dcmSchemas=yield(0,A.firstValueFrom)(t._dcmSchemaManagerService.getDcmSchemaDataCollection()),t._dataGridToDataSourceMap=t._getDataGridToDataSourceMap(i,r),t._dataSourceSchemas=yield t._getDataSourceSchemas();const a=e,s=a.viewModelConfig.attributes=a.viewModelConfig.attributes||{};for(const n of i)yield t._initDataGridViewConfigAttributes(n,s);return e})()}static{this.\u0275fac=function(t){return new(t||me)(o.\u0275\u0275inject(S.FeatureService),o.\u0275\u0275inject(S.DcmSchemaManagerService),o.\u0275\u0275inject(g.EntitySchemaRepository))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:me,factory:me.\u0275fac})}}class fe{constructor(e,t){this._featureValues=e,this._licenseOperationValues=t}crtOnMetaDataInit(e){const t=this._licenseOperationValues[u.CAN_MANAGE_LIST_COLUMNS_LICENSE_OPERATION_CODE];if(this._featureValues.DisableDataGridRestrictionsPreprocessing||t)return Promise.resolve(e);const i={columns:{editing:!1,adding:!1}};return(0,u.getDataGridViewConfigs)(e).filter(r=>typeof r.features!="string").forEach(r=>{r.features??={},(0,_.merge)(r.features,i)}),Promise.resolve(e)}static{this.\u0275fac=function(t){return new(t||fe)(o.\u0275\u0275inject(g.FEATURE_VALUES),o.\u0275\u0275inject(S.LICENSE_RESTRICTION_OPERATION_VALUES))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:fe,factory:fe.\u0275fac})}}var F=y(50456),Et=y(8654);const Tt=new o.InjectionToken("Represents a handler to process data grid metadata on metadata init");class je extends Et.HandlerBasedPreprocessor{constructor(e){super(),this._dataGridOnMetadataInitHandler=e}crtOnMetaDataInit(e){var t=this;return(0,l.A)(function*(){const i=e;if(t._dataGridOnMetadataInitHandler)for(const r of F.GRID_VIEW_ELEMENT_TYPES)yield t.processElementsOnMetadataInit(r,t._dataGridOnMetadataInitHandler,i);return Promise.resolve(e)})()}static{this.\u0275fac=function(t){return new(t||je)(o.\u0275\u0275inject(Tt,8))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:je,factory:je.\u0275fac})}}var Vt=y(45447),vt=y.n(Vt);class ge{constructor(e,t){this._userInfo=e,this._entityDataSourceAttributeConfigConverterFactory=t}_applyResources(e,t){(0,_.isEmpty)(e?.localizableStrings)||(t.resources??={strings:{}},t.resources.strings??={},(0,_.merge)(t.resources.strings,e?.localizableStrings),this._fullResourcesForCurrentCulture(t.resources.strings))}_fullResourcesForCurrentCulture(e){const t=this._userInfo.cultureInfo.sysCultureName;Object.values(e).filter(i=>!(t in i)).forEach(i=>{const r=Object.values(i).find(Boolean);r&&(i[t]=r)})}_applyDataGridColumns(e,t,i){if(!t)return;const r=(0,u.getDataGridItemsAttributeConfig)(e,i);if(!r)return;const a=r.modelConfig?.path;if(!a)return;const s=(0,u.getDataGridItemsDataSourceConfig)(a,i);if(!s)return;const n=e.columns=[],c=r.viewModelConfig.attributes??={},d=s.attributes??={};t.forEach(({viewMetadata:f,viewModelMetadata:p,modelMetadata:b})=>{if(f&&n.push(f),!b)return;const C=this._createEntityDataSourceAttribute(b),E=p?.attributeName||f?.code;if(!E||!C)return;const T={modelConfig:{path:`${a}.${C.name}`}},At=c[E]??{},St=d[C.name]??{};c[E]=vt()(T,At),d[C.name]=vt()(C.config,St)})}_createEntityDataSourceAttribute(e){const t=this._entityDataSourceAttributeConfigConverterFactory.create(e?.type).toEntityDataSourceAttribute(e),i=e.name;return!i||!t?null:{name:i,config:t}}_applyDataGridSortingConfig(e,t,i){if(!t)return;const r=(0,u.getDataGridItemsAttributeConfig)(e,i);if(!r)return;const a=r.modelConfig?.sortingConfig;a&&delete a.default;const s=a?.attributeName??(0,u.createDataGridSortingAttributeName)(e),n=i.viewModelConfig.attributes,c=n[s]??={};(0,m.isCalculatedAttributeConfig)(c)||(c.value=(0,u.toSortColumnsOptions)(t,r))}apply(e,t,i){const{resources:r,columns:a,sorting:s}=t;this._applyResources(r,i),this._applyDataGridColumns(e,a,i),this._applyDataGridSortingConfig(e,s,i)}static{this.\u0275fac=function(t){return new(t||ge)(o.\u0275\u0275inject(g.UserInfo),o.\u0275\u0275inject(g.ENTITY_DATA_SOURCE_ATTRIBUTE_CONFIG_CONVERTER_FACTORY))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:ge,factory:ge.\u0275fac,providedIn:"root"})}}class pe extends N.AbstractHandler{constructor(e,t,i,r,a){super(),this._dataGridDesignSettingsApplier=e,this._dataGridFolderTreeRelationsProvider=t,this._folderTreeRelatedElementConfigsProvider=i,this._folderTreeIdResolver=r,this._featureValues=a}_setDataGridActiveFolderSettingsAttribute(e,t,i){const r=i.viewModelConfig.attributes,a=(0,u.createDataGridActiveFolderSettingsAttributeName)(e);r[a]={value:t}}handle(e){var t=()=>super.handle,i=this;return(0,l.A)(function*(){if(i._featureValues.DisableDataGridSettingsByFolders)return t().call(i,e);const{metadata:r,viewConfig:a}=e??{};if(!r?.name||!a?.name)return t().call(i,e);const s=i._dataGridFolderTreeRelationsProvider.getSingleRelatedFolderTreeViewConfig(a,r);if(!s)return t().call(i,e);const n=yield i._folderTreeIdResolver.getActiveFolderFolderTreeId(s,r);if(!n)return i._setDataGridActiveFolderSettingsAttribute(a,null,r),t().call(i,e);const c={folderId:n,schemaName:r.name,elementName:a.name},d=yield(0,A.firstValueFrom)(i._folderTreeRelatedElementConfigsProvider.get(c));return d&&i._dataGridDesignSettingsApplier.apply(a,(0,_.cloneDeep)(d),r),i._setDataGridActiveFolderSettingsAttribute(a,d,r),t().call(i,e)})()}static{this.\u0275fac=function(t){return new(t||pe)(o.\u0275\u0275inject(ge),o.\u0275\u0275inject(u.DataGridFolderTreeRelationsProvider),o.\u0275\u0275inject(S.FolderTreeRelatedElementConfigsProvider),o.\u0275\u0275inject(dt.FolderTreeIdResolver),o.\u0275\u0275inject(g.FEATURE_VALUES))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:pe,factory:pe.\u0275fac})}}class he extends N.AbstractHandler{constructor(e){super(),this._dataGridDesignSettingsApplier=e}handle(e){const{metadata:t,viewConfig:i}=e??{};if(!t?.name||!i?.name)return super.handle(e);const r=i._designOptions?.designSettings;return r&&this._dataGridDesignSettingsApplier.apply(i,(0,_.cloneDeep)(r),t),super.handle(e)}static{this.\u0275fac=function(t){return new(t||he)(o.\u0275\u0275inject(ge))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:he,factory:he.\u0275fac})}}const Bt="DisableDataGridSortingPreprocessing";class _e extends N.AbstractHandler{constructor(e){super(),this._isSortingPreprocessingDisabled=!!e[Bt]}_getSortingAttributeName(e,t){const i=(0,u.getDataGridItemsAttributeName)(e);if(!i)return null;const r=t.viewModelConfig?.attributes?.[i];if(!r||!("modelConfig"in r))return null;let a=r.modelConfig?.sortingConfig?.attributeName;if(a)return a;a=(0,u.createDataGridSortingAttributeName)(e);const s={modelConfig:{sortingConfig:{attributeName:a}}};return(0,_.merge)(r,s),a}_setSorting(e,t,i){if(t.sorting)return;i.viewModelConfig.attributes||={},i.viewModelConfig.attributes[e]||={};const r=(0,u.getDataGridItemsAttributeName)(t);t.sorting=`$${e} | crt.ToDataTableSortingConfig: '${r}'`}_setSortingChange(e){e.sortingChange||(e.sortingChange={request:"crt.DataGridSortDataRequest",params:{itemsAttributeName:(0,u.getDataGridItemsAttributeName)(e),sorting:"@event"}})}handle(e){const{metadata:t,viewConfig:i}=e??{};if(!t||!i||this._isSortingPreprocessingDisabled)return super.handle(e);const r=this._getSortingAttributeName(i,t);return r?(this._setSorting(r,i,t),this._setSortingChange(i),super.handle(e)):super.handle(e)}static{this.\u0275fac=function(t){return new(t||_e)(o.\u0275\u0275inject(g.FEATURE_VALUES,8))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:_e,factory:_e.\u0275fac})}}class Ae{static{this.\u0275fac=function(t){return new(t||Ae)}}static{this.\u0275mod=o.\u0275\u0275defineNgModule({type:Ae})}static{this.\u0275inj=o.\u0275\u0275defineInjector({providers:[{provide:m.CRT_METADATA_PREPROCESSOR,useClass:je,multi:!0},{provide:Tt,useFactory:e=>{const t=e.get(he);return t.setNext(e.get(pe)).setNext(e.get(_e)),t},deps:[o.Injector]},he,pe,_e]})}}class $e{crtOnMetaDataInit(e){return(0,l.A)(function*(){const t=e;return t.name==="Playbooks_FormPage"&&(t.viewModelConfig.attributes.DcmStages={from:"CrtPlaybookDS_DcmCase",converter:"crt.ToDcmStageValue"}),Promise.resolve(e)})()}static{this.\u0275fac=function(t){return new(t||$e)}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:$e,factory:$e.\u0275fac})}}class Gt{_getDetailViewConfigs(e){return g.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.Angular7XDetail",e.viewConfig).map(t=>t?.viewConfig).filter(Boolean)}_processDetail(e){this._processDetailOutputs(e)}_processDetailOutputs(e){this._processDetailChangedOutput(e)}_processDetailChangedOutput(e){e.detailChanged||(e.detailChanged={request:"crt.DetailChangedRequest",params:{detailId:"@event.detail.detailId",saveChanges:"@event.detail.saveChanges",discardChanges:"@event.detail.discardChanges",destroyed:"@event.detail.destroyed"}})}_processSchema(e){this._processViewModelAttributes(e),this._changeViewConfigsBindings(e)}_processViewModelAttributes(e){this._processUnSaveDetailsDataViewModelAttributes(e),this._processHasUnsavedDataAndDetailsViewModelAttributes(e)}_processUnSaveDetailsDataViewModelAttributes(e){const t=this._getSchemaViewModelAttributes(e);t[m.UNSAVED_DETAILS_DATA_ATTRIBUTE_NAME]||(t[m.UNSAVED_DETAILS_DATA_ATTRIBUTE_NAME]={value:[]})}_processHasUnsavedDataAndDetailsViewModelAttributes(e){const t=this._getSchemaViewModelAttributes(e);t[m.HAS_UNSAVED_DATA_AND_DETAILS_ATTRIBUTE_NAME]||(t[m.HAS_UNSAVED_DATA_AND_DETAILS_ATTRIBUTE_NAME]={from:[m.HAS_UNSAVED_DATA_SYSTEM_ATTRIBUTE_NAME,m.UNSAVED_DETAILS_DATA_ATTRIBUTE_NAME],converter:"crt.HasUnsavedDataOr7XDetails"})}_getSchemaViewModelAttributes(e){const t=e.viewModelConfig=e.viewModelConfig||{};return t.attributes=t.attributes||{}}_changeViewConfigsBindings(e){const t=e.viewConfig||[],i=`(^|\\W)(${m.HAS_UNSAVED_DATA_SYSTEM_ATTRIBUTE_NAME})($|\\W)`,r=`$1${m.HAS_UNSAVED_DATA_AND_DETAILS_ATTRIBUTE_NAME}$3`;t.forEach(a=>this._replaceStringsRecursive(a,i,r))}_replaceStringsRecursive(e,t,i){(0,_.forOwn)(e,(r,a)=>{if((0,_.isObject)(r))this._replaceStringsRecursive(r,t,i);else if((0,_.isString)(r)){const s=new RegExp(t,"g");if(!r.match(s))return;e[a]=r.replace(s,i)}})}crtOnMetaDataInit(e){const t=e,i=this._getDetailViewConfigs(t);return i.forEach(r=>this._processDetail(r)),i.length&&this._processSchema(t),Promise.resolve(e)}}class xe{_modifyInputType(e,t,i){const r=e.control.replace("$",""),a=t.attributes[r]?.modelConfig?.path;if(a){const s=this._getDataSchemaAttributeByPath(a,i);I.DataValueType.EMAIL_TEXT&&s?.dataValueType===I.DataValueType.EMAIL_TEXT&&(e.type="crt.EmailInput",e.isFormatValidated=s.isFormatValidated)}}_getDataSchemaAttributeByPath(e,t){const[i,r]=e.split("."),a=t.dataSchemas[i]?.attributes;let s;for(const n in a)if(a[n].path===r){s=a[n];break}return s}crtOnViewModelInit(e,t,i){var r=this;return(0,l.A)(function*(){const a=e,s=g.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.Input",a.viewConfig),n=g.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.EmailInput",a.viewConfig);return s.forEach(c=>{r._modifyInputType(c.viewConfig,a.viewModelConfig,i)}),n.forEach(c=>{r._modifyInputType(c.viewConfig,a.viewModelConfig,i)}),e})()}static{this.\u0275fac=function(t){return new(t||xe)}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:xe,factory:xe.\u0275fac})}}const Lt=32,jt=81;class Se{constructor(e){this._featureValues=e,this._supportDataGridFullSize=!this._featureValues?.["Runtime.DisableDataGridFullSize"]}_getDataGridViewConfigs(e){return g.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.DataGrid",e?.items)}_setDataGridMaxHeight(e){if(!e.layoutConfig?.rowSpan||e?.maxHeight!=null||e?.styles?.["max-height"]!=null)return;const i=e.layoutConfig.rowSpan*Lt,r=Math.max(i,jt);e.layoutConfig.rowSpan=1,this._supportDataGridFullSize?(e.placeholderSize={height:`${r}px`},e.maxHeight=`${r}px`):e.styles=(0,_.merge)(e.styles,{"max-height":`${r}px`})}_replaceLegacyGridContainerRowsConfig(e){const t=g.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.GridContainer",e).shift();t?.viewConfig?.rows?.replace(/\s/g,"")==="minmax(32px,32px)"&&(t.viewConfig.rows="minmax(max-content, 32px)")}setDataGridMaxHeight(e){const t=this._getDataGridViewConfigs(e);t.forEach(i=>{this._setDataGridMaxHeight(i.viewConfig)}),t.length&&this._replaceLegacyGridContainerRowsConfig(e?.items)}static{this.\u0275fac=function(t){return new(t||Se)(o.\u0275\u0275inject(g.FEATURE_VALUES,8))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:Se,factory:Se.\u0275fac})}}class ke{constructor(e,t,i){this._featureService=e,this._expandedListLayoutService=t,this._profileAttributeService=i,this._expPanelActionsProcessingDisableFeature="DisableExpansionPanelPreprocessing"}_filterItemsByGridType(e){if(!e.items||e.items.length===0)return;const t=e?.tools??[],i=e.items.filter(r=>r.gridContainerType===u.ExpansionPanelGridContainerType.TOOLS);t?.length===0&&i?.length>0&&(e.items=e.items.filter(r=>r.gridContainerType!==u.ExpansionPanelGridContainerType.TOOLS),e.tools=i)}_processPaddings(e){e.padding||(e.padding={top:F.SizeEnum.Small,bottom:F.SizeEnum.Small,left:F.SizeEnum.Medium,right:F.SizeEnum.Medium})}get _isProcessingDisabled(){return(0,A.lastValueFrom)(this._featureService.getFeatureState(this._expPanelActionsProcessingDisableFeature))}crtOnMetaDataInit(e){var t=this;return(0,l.A)(function*(){if(yield t._isProcessingDisabled)return e;const i=e;return g.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.ExpansionPanel",i.viewConfig).forEach(function(){var a=(0,l.A)(function*(s){t._expandedListLayoutService.setDataGridMaxHeight(s.viewConfig),t._filterItemsByGridType(s.viewConfig),t._processPaddings(s.viewConfig),yield t._profileAttributeService.prepareAttributeWithFeatureCheck(i,s.viewConfig,"expanded","","DisableSaveToProfileExpPanelExpanded")});return function(s){return a.apply(this,arguments)}}()),e})()}static{this.\u0275fac=function(t){return new(t||ke)(o.\u0275\u0275inject(S.FeatureService),o.\u0275\u0275inject(Se),o.\u0275\u0275inject(u.ProfileAttributeService))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:ke,factory:ke.\u0275fac})}}class Ue{get isProcessingDisabled(){return(0,A.lastValueFrom)(this._featureService.getFeatureState(this._fileInputPreprocessingDisableFeature))}constructor(e){this._featureService=e,this._fileInputPreprocessingDisableFeature="DisableFileInputPreprocessing"}crtOnMetaDataInit(e){var t=this;return(0,l.A)(function*(){if(yield t.isProcessingDisabled)return e;const i=e;return g.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.FileInput",i.viewConfig).forEach(a=>{if(!a.viewConfig.upload){const n=a.viewConfig.control.slice(1);a.viewConfig.upload={request:"crt.UploadDataAttributeFileRequest",params:{fileAttributeName:n,detail:"@event.detail"}}}a.viewConfig.download||(a.viewConfig.download={request:"crt.DownloadEntityFileRequest",params:{detail:"@event.detail"}})}),e})()}static{this.\u0275fac=function(t){return new(t||Ue)(o.\u0275\u0275inject(S.FeatureService))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:Ue,factory:Ue.\u0275fac})}}class qe extends nt{constructor(e){super(),this._translateService=e,this.viewItemTypes=["crt.FileList"]}setRowToolbarMenuItems(e,t){const i=e.items.slice(1),r=t.getBoundDataSourceNameByAttributePath(i);return e.rowToolbarItems=[{type:"crt.MenuItem",caption:this._translateService.instant("DataGrid.RowToolbar.Delete"),icon:"delete-row-action",clicked:{request:"crt.DeleteRecordRequest",params:{itemsAttributeName:i,recordId:`$${i}.${r}_Id`},useRelativeContext:!1}}],Promise.resolve(void 0)}static{this.\u0275fac=function(t){return new(t||qe)(o.\u0275\u0275inject(z.TranslateService))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:qe,factory:qe.\u0275fac})}}class We extends L{constructor(e,t,i,r){super(e,t,i),this.featureService=e,this.metadataModifierService=t,this.dataGridColumnDefinitionService=i,this._cellViewConfigCreatorFactory=r,this._predefinedColumns={},this.viewItemTypes=["crt.FileList"]}_setPredefinedColumnDefinitions(e){for(const t of e){const i=t.viewConfig,r=i.name,a=i.columns,s=[];for(const n of a)n.cellView&&s.push(n.code);this._predefinedColumns[r]=s}}_processFileListColumnDefinitions(e,t,i){var r=this;return(0,l.A)(function*(){const{dataSourceName:a,dataSchema:s,itemsAttributeName:n,viewModel:c}=t,{primaryAttributeName:d,primaryDisplayAttributeName:f}=s??{},p=s.name,b=d&&`${a}_${d}`;for(const C of i){const E=s.attributes.find(Jt=>(0,g.removeSpecialSymbols)(`${a}_${Jt.name}`)===C.code);if(!E)continue;const T=E.name,At={columnName:T,dataValueType:E.dataValueType,primaryDisplayAttributeName:f},St={column:C,context:c,itemsAttributeName:n,primaryAttributeName:b,dataSchemaName:p,columnName:T},Pt=yield r._cellViewConfigCreatorFactory.create(At)?.getViewElementConfig(St);Pt&&!r._predefinedColumns[e]?.includes(C.code)&&r.metadataModifierService.addProperty(C,"cellView",Pt)}})()}crtOnViewModelInit(e,t,i){var r=()=>super.crtOnViewModelInit,a=this;return(0,l.A)(function*(){if(yield(0,A.lastValueFrom)(a.featureService.getFeatureState(a.featureName),{defaultValue:null}))return e;const n=g.MetadataSchemaUtils.getViewConfigInfoByPropertyForValues("type",a.viewItemTypes,e.viewConfig);a._setPredefinedColumnDefinitions(n),e=yield r().call(a,e,t,i);for(const c of n){const d=c.viewConfig.columns,f=c.viewConfig.name,p=yield a.getGenerateCellViewConfig(c.viewConfig,i);p&&(yield a._processFileListColumnDefinitions(f,p,d))}return e})()}static{this.\u0275fac=function(t){return new(t||We)(o.\u0275\u0275inject(S.FeatureService),o.\u0275\u0275inject(m.MetadataModifierService),o.\u0275\u0275inject(R.DataGridColumnDefinitionService),o.\u0275\u0275inject(R.FILE_LIST_CELL_VIEW_CONFIG_CREATOR_FACTORY))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:We,factory:We.\u0275fac})}}class ${get order(){return this.index||0}constructor(e){this.featureService=e,this.componentTypes=[]}getComponentsToProcess(e){return g.MetadataSchemaUtils.getViewConfigInfoByPropertyForValues("type",this.componentTypes,e.viewConfig)}process(e,t){var i=this;return(0,l.A)(function*(){const r=i.getComponentsToProcess(e);return yield i.innerProcess(r,e,t)})()}static{this.\u0275fac=function(t){return new(t||$)(o.\u0275\u0275inject(S.FeatureService))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:$,factory:$.\u0275fac})}}class be extends ${constructor(){super(...arguments),this.componentTypes=["crt.FileList"],this.index=2,this.defaultFilesEntitySchemaName="SysFile",this._galleryColumnNames=["Name","CreatedOn","Size"]}_addDataSourceAttributes(e,t){let i=e[t];i||(i=h.DataSourceUtils.createDataSourceConfig(this.defaultFilesEntitySchemaName),e[t]=i);const r=i.config||{attributes:{}};r.attributes=r.attributes||{},this._galleryColumnNames.forEach(a=>{r?.attributes[a]||(r.attributes[a]={path:a})}),i.config=r}_addViewModelAttributes(e,t,i){if(!e?.attributes)return;const a=e.attributes[t]?.viewModelConfig?.attributes;a&&this._galleryColumnNames.forEach(s=>{const n=`${i}_${s}`;a[n]||(a[n]={modelConfig:{path:`${i}.${s}`}})})}_applyGalleryConfig(e,t){t.viewConfig.galleryItemConfig||(t.viewConfig.galleryItemConfig={templateValuesMapping:{fileId:`${e}_Id`,fileName:`${e}_Name`,fileCreatedOn:`${e}_CreatedOn`,fileSize:`${e}_Size`}}),t.viewConfig.galleryItemConfig.defaultSize=t.viewConfig.tileSize||F.SizeEnum.Medium}_getAttributeDSName(e){return`${e}${m.DATA_SOURCE_PREFIX}`}innerProcess(e,t,i){var r=this;return(0,l.A)(function*(){return e.forEach(a=>{const s=a.viewConfig.items;if(typeof s!="string")return;const n=s.split("$")[1];if(!n)return;const c=r._getAttributeDSName(n);r._addDataSourceAttributes(t.modelConfig?.dataSources||{},c),r._addViewModelAttributes(t.viewModelConfig,n,c),r._applyGalleryConfig(c,a)}),yield Promise.resolve(t)})()}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=o.\u0275\u0275getInheritedFactory(be)))(i||be)}})()}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:be,factory:be.\u0275fac})}}class Ce extends ${constructor(){super(...arguments),this.componentTypes=["crt.FileList"],this.index=1,this.defaultPrimaryColumnName="Id",this.defaultFilesEntitySchemaName="SysFile",this.defaultRecordColumnName="RecordId",this._fileDropDisableFeature="DisableFileListDropPreprocessing"}_getAdditionalFilterName(e){return`${e}_PredefinedFilter`}_createViewModelAttribute(e){return{isCollection:!0,modelConfig:{path:e},viewModelConfig:{attributes:{}}}}_getUploadFileRequest(e){return{request:"crt.UploadFileRequest",params:{viewElementName:e}}}_setFileListDropZoneParameters(e,t){t&&(e.viewConfig.droppable=!1,e.viewConfig.fileDropped=void 0),e.viewConfig.droppable!==!1&&(e.viewConfig.droppable=!0,e.viewConfig.fileDropped||(e.viewConfig.fileDropped=this._getUploadFileRequest(e.viewConfig.name??"")))}_setFileListUploadButtonParameters(e){e.viewConfig.uploadClicked||(e.viewConfig.uploadClicked=this._getUploadFileRequest(e.viewConfig.name??""))}_tryAddFileListProperties(e){if(e.viewConfig.items||(e.viewConfig.items=`$${e.viewConfig.name}`),!e.viewConfig.primaryColumnName){const t=e.viewConfig.name??"",r=`${h.DataSourceUtils.getAttributeDSName(t)}_${this.defaultPrimaryColumnName}`;e.viewConfig.primaryColumnName=r}}_linkFilterToAttribute(e,t){if(e=e??{},!(0,m.isModelAttributeConfig)(e)||!e.modelConfig)return;const i=e.modelConfig.filterAttributes??[];i.find(r=>r.name===t)||i.push({loadOnChange:!0,name:t}),e.modelConfig.filterAttributes=i}tryAddAttributeAndDataSource(e,t,i){var r=this;return(0,l.A)(function*(){const a=i.viewConfig.items;if(typeof a!="string")return;const s=a.split("$")[1];if(!s)return;const n=h.DataSourceUtils.getAttributeDSName(s),c=r._getAdditionalFilterName(s);e.modelConfig||(e.modelConfig={});const d=e.modelConfig.dataSources??{},f=e.viewModelConfig.attributes??{};if(d[n]||(d[n]=h.DataSourceUtils.createDataSourceConfig(r.defaultFilesEntitySchemaName),e.modelConfig.dataSources=d),h.DataSourceUtils.addDependencies(e,i.viewConfig,n),f[s]||(f[s]=r._createViewModelAttribute(n),e.viewModelConfig.attributes=f),!f[c]){const p=i.viewConfig.fileGroups,b=i.viewConfig.tag??"",C=d[n].config?.entitySchemaName,E=yield h.DataSourceUtils.getRecordEntitySchemaName(i.viewConfig.items,i.viewConfig?.masterRecordColumnValue,e,t),T=(0,h.getDataSourceFilterAttribute)(p,b,C,E);T&&(f[c]=T,r._linkFilterToAttribute(f[s],c),e.viewModelConfig.attributes=f)}})()}innerProcess(e,t,i){var r=this;return(0,l.A)(function*(){const a=r.featureService.getFeatureState(r._fileDropDisableFeature),s=yield(0,A.lastValueFrom)(a);for(const n of e)r._tryAddFileListProperties(n),r._setFileListDropZoneParameters(n,s),r._setFileListUploadButtonParameters(n),yield r.tryAddAttributeAndDataSource(t,i,n);return t})()}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=o.\u0275\u0275getInheritedFactory(Ce)))(i||Ce)}})()}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:Ce,factory:Ce.\u0275fac})}}const ut=new o.InjectionToken("FILE_UPLOAD_METADATA_WORKER");class He{constructor(e){this._workers=e??[]}run(e,t){var i=this;return(0,l.A)(function*(){const r=[...i._workers].sort((a,s)=>a.order-s.order);for(const a of r)yield a.process(e,t)})()}static{this.\u0275fac=function(t){return new(t||He)(o.\u0275\u0275inject(ut,8))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:He,factory:He.\u0275fac,providedIn:"root"})}}class ye extends ${constructor(){super(...arguments),this.index=3,this._uploadFileRequestName="crt.UploadFileRequest",this._defaultFilesEntitySchemaName="SysFile",this._defaultRecordColumnName="RecordId"}_getUploadFileRequestConfigs(e){return g.MetadataSchemaUtils.getViewConfigInfoByPropertyForValues("type",["crt.Button","crt.MenuItem"],e.viewConfig).filter(t=>t.viewConfig.clicked?.request===this._uploadFileRequestName).map(t=>t.viewConfig.clicked)}_getFileLists(e){return g.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.FileList",e.viewConfig)}_getFileDropRequestConfigs(e){const t=this._getFileLists(e);return t.filter(i=>i.viewConfig.fileDropped?.request===this._uploadFileRequestName).map(i=>i.viewConfig.fileDropped).concat(t.filter(i=>i.viewConfig.uploadClicked?.request===this._uploadFileRequestName).map(i=>i.viewConfig.uploadClicked))}getFilesEntitySchemaName(e,t,i){const r=h.DataSourceUtils.getDataSourceNameByAttribute(e);return r?h.DataSourceUtils.getDataSchemaName({models:i,schema:t,dataSourceName:r}):Promise.resolve(null)}setRequestParam(e,t,i){!e[t]&&i&&(e[t]=i)}getBaseRequestParams(){return{fileGroup:m.FileGroupEnum.Attachments,tag:"",files:"@event.files"}}getDefaultRequestParams(e){const t=h.DataSourceUtils.getDataSourcePrimaryAttribute(e);return{...this.getBaseRequestParams(),recordId:`$${t}`,fileEntitySchemaName:this._defaultFilesEntitySchemaName,recordColumnName:this._defaultRecordColumnName}}getRequestParams(e,t,i){var r=this;return(0,l.A)(function*(){const a=r.getBaseRequestParams(),s=e.items,n=(yield r.getFilesEntitySchemaName(s,t,i))||r._defaultFilesEntitySchemaName,c=e?.masterRecordColumnValue,d=yield h.DataSourceUtils.getRecordEntitySchemaName(s,c,t,i);return{...a,fileGroup:e?.fileGroups?.[0],tag:e?.tag,recordId:c,itemsAttributeName:e.name,fileEntitySchemaName:n,recordEntitySchemaName:d,recordColumnName:e.recordColumnName||r._defaultRecordColumnName}})()}_setRequestParams(e,t){for(const i in t)t[i]&&this.setRequestParam(e.params,i,t[i])}_extendRequestParams(e,t,i,r){var a=this;return(0,l.A)(function*(){e.params=e.params||{};const s=t.find(c=>c.viewConfig.name===e.params.viewElementName),n=s?yield a.getRequestParams(s.viewConfig,i,r):a.getDefaultRequestParams(i);a._setRequestParams(e,n)})()}getComponentsToProcess(e){return[...this._getUploadFileRequestConfigs(e),...this._getFileDropRequestConfigs(e)]}innerProcess(e,t,i){var r=this;return(0,l.A)(function*(){const a=r._getFileLists(t);for(const s of e)yield r._extendRequestParams(s,a,t,i);return t})()}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=o.\u0275\u0275getInheritedFactory(ye)))(i||ye)}})()}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:ye,factory:ye.\u0275fac})}}class Ie{static{this.\u0275fac=function(t){return new(t||Ie)}}static{this.\u0275mod=o.\u0275\u0275defineNgModule({type:Ie})}static{this.\u0275inj=o.\u0275\u0275defineInjector({providers:[{provide:ut,useClass:be,multi:!0},{provide:ut,useClass:Ce,multi:!0},{provide:ut,useClass:ye,multi:!0}],imports:[st.CommonModule]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&o.\u0275\u0275setNgModuleScope(Ie,{imports:[st.CommonModule]})})();class ze{get isProcessingDisabled(){return(0,A.lastValueFrom)(this._featureService.getFeatureState(this._fileListPreprocessingDisableFeature))}constructor(e,t){this._featureService=e,this._workersService=t,this._fileListPreprocessingDisableFeature="DisableFileListPreprocessing"}crtOnModelInit(e,t){var i=this;return(0,l.A)(function*(){if(yield i.isProcessingDisabled)return e;const r=e;return yield i._workersService.run(r,t),e})()}static{this.\u0275fac=function(t){return new(t||ze)(o.\u0275\u0275inject(S.FeatureService),o.\u0275\u0275inject(He))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:ze,factory:ze.\u0275fac})}}const Xt={fileLists:{A:"FileListA",B:"FileListB",C:"FileListC",D:"FileListD",E:"FileListE",F:"FileListF",G:"FileListG",H:"FileListH",I:"FileListI",WithDeepMasterRecordColumn:"FileListWithDeepMasterRecordColumn",WithAttributeWoPath:"FileListWithAttributeWoPath",WithUploadButton:"FileListWithCustomUploadButton",WoMasterRecordColumn:"FileListWoMasterRecordColumn",WoRecordSchemaName:"FileListWoRecordSchemaName",WithRecordSchemaName:"FileListWithRecordSchemaName",WoDropZone:"FileListWoDropZone"},recordColumnNameA:"ColumnA",testFileEntity:"TestFile",testEntityName:"TestEntity",testTag:"TestTag"};function Kt(){return{viewConfig:[{type:"crt.FlexContainer",direction:"column",items:[{type:"crt.FileList",name:TEST_SCHEMA_DATA.fileLists.WithUploadButton,uploadClicked:{request:"crt.UploadFileRequest",params:{viewElementName:"custom"}}},{type:"crt.FileList",droppable:!1,name:TEST_SCHEMA_DATA.fileLists.WoDropZone},{type:"crt.FileList",items:"$FileListA",masterRecordColumnValue:"$OwnerId",recordColumnName:TEST_SCHEMA_DATA.recordColumnNameA,primaryColumnName:"FileListADS_Id",name:TEST_SCHEMA_DATA.fileLists.A,tag:TEST_SCHEMA_DATA.testTag},{type:"crt.FileList",items:"$FileListRecordSchemaName",masterRecordColumnValue:"$OwnerAccountCreatedBy",name:TEST_SCHEMA_DATA.fileLists.WithRecordSchemaName},{type:"crt.FileList",items:"$FileListA",masterRecordColumnValue:"$OwnerAccountCreatedBy",name:TEST_SCHEMA_DATA.fileLists.WoRecordSchemaName},{type:"crt.FileList",items:"$FileListE",masterRecordColumnValue:"$OwnerId",primaryColumnName:"FileListADS_Id",name:TEST_SCHEMA_DATA.fileLists.E,fileGroups:[FileGroupEnum.Attachments]},{type:"crt.FileList",items:"$FileListF",masterRecordColumnValue:"$OwnerId",primaryColumnName:"FileListADS_Id",name:TEST_SCHEMA_DATA.fileLists.F,fileGroups:[FileGroupEnum.Attachments],tag:TEST_SCHEMA_DATA.testTag},{type:"crt.FileList",items:"$FileListG",masterRecordColumnValue:"$OwnerAccountCreatedBy",primaryColumnName:"FileListADS_Id",name:TEST_SCHEMA_DATA.fileLists.G},{type:"crt.FileList",items:TEST_SCHEMA_DATA.fileLists.H,masterRecordColumnValue:"$OwnerAccountCreatedBy",primaryColumnName:"FileListADS_Id",name:TEST_SCHEMA_DATA.fileLists.H},{type:"crt.FileList",items:"$FileListI",masterRecordColumnValue:"$OwnerAccountCreatedBy",primaryColumnName:"FileListADS_Id",name:TEST_SCHEMA_DATA.fileLists.I},{type:"crt.FlexContainer",direction:"column",items:[{type:"crt.FileList",name:TEST_SCHEMA_DATA.fileLists.B,droppable:!0}],name:"InnerContainer"},{type:"crt.Button",name:"ButtonA",clicked:{request:"crt.UploadFileRequest",params:{maximumAllowedFileSize:null,allowedFileTypes:"",viewElementName:TEST_SCHEMA_DATA.fileLists.A}}},{type:"crt.Button",name:"ButtonB",clicked:{request:"crt.UploadFileRequest",params:{}}},{type:"crt.Button",name:"ButtonTestRecordSchemaName",clicked:{request:"crt.UploadFileRequest",params:{viewElementName:TEST_SCHEMA_DATA.fileLists.WoRecordSchemaName}}},{type:"crt.Button",name:"ButtonTestRecordSchemaName",clicked:{request:"crt.UploadFileRequest",params:{viewElementName:TEST_SCHEMA_DATA.fileLists.WithRecordSchemaName}}},{type:"crt.Button",name:"ButtonC",menuItems:[{type:"crt.MenuItem",name:"MenuItemA",clicked:{request:"crt.UploadFileRequest",params:{viewElementName:TEST_SCHEMA_DATA.fileLists.B}}},{type:"crt.MenuItem",name:"MenuItemB",clicked:{request:"crt.UpdateRecordRequest",params:{}}},{type:"crt.MenuItem",name:"MenuItemC"}]},{type:"crt.Button",name:"ButtonD",clicked:"$onClick"},{type:"crt.Button",name:"ButtonE"},{type:"crt.FileList",masterRecordColumnValue:"$OwnerAccountId",name:TEST_SCHEMA_DATA.fileLists.C,recordColumnName:"RecordId"},{type:"crt.FileList",masterRecordColumnValue:"$AttributeWoColumn",name:TEST_SCHEMA_DATA.fileLists.D,recordColumnName:"RecordId"},{type:"crt.FileList",masterRecordColumnValue:"$AttributeWoPath",name:TEST_SCHEMA_DATA.fileLists.WithAttributeWoPath},{type:"crt.FileList",masterRecordColumnValue:"not a master record attribute",name:TEST_SCHEMA_DATA.fileLists.WoMasterRecordColumn},{type:"crt.FileList",masterRecordColumnValue:"$OwnerAccountCreatedBy",name:TEST_SCHEMA_DATA.fileLists.WithDeepMasterRecordColumn,recordColumnName:"RecordId"},{type:"crt.Button",clicked:{request:"crt.UploadFileRequest",params:{viewElementName:TEST_SCHEMA_DATA.fileLists.WithDeepMasterRecordColumn}}}],name:"MainContainer"}],viewModelConfig:{attributes:{OwnerId:{modelConfig:{path:"PDS.Id"}},OwnerAccountId:{modelConfig:{path:"PDS.OwnerAccountId"}},FileListA:{isCollection:!0,modelConfig:{path:"FileListADS",filterAttributes:[{loadOnChange:!0,name:"FileListA_PredefinedFilter"}]},viewModelConfig:{attributes:{FileListADS_Name:{modelConfig:{path:"FileListADS.NamePredefined"}},FileListADS_CreatedOn:{modelConfig:{path:"FileListADS.CreatedOnPredefined"}},FileListADS_Size:{modelConfig:{path:"FileListADS.SizePredefined"}}}}},FileListRecordSchemaName:{isCollection:!0,modelConfig:{path:"FileListRecordSchemaNameDS"}},FileListE:{isCollection:!0,modelConfig:{path:"FileListADS"},viewModelConfig:{attributes:{}}},FileListF:{isCollection:!0,modelConfig:{path:"FileListADS"},viewModelConfig:{attributes:{}}},FileListG:{isCollection:!0,modelConfig:{path:"FileListADS"},viewModelConfig:{attributes:{}}},FileListI:{isCollection:!0,modelConfig:null,viewModelConfig:{attributes:{}}},AttributeWoColumn:{modelConfig:{path:"AttributeWoColumn"}},AttributeWoPath:{modelConfig:{path:""}},AttributeWoModelConfig:{modelConfig:void 0},OwnerAccountCreatedBy:{modelConfig:{path:"PDS.OwnerAccountCreatedBy"}}}},modelConfig:{dataSources:{PDS:{type:"crt.EntityDataSource",config:{entitySchemaName:TEST_SCHEMA_DATA.testEntityName,attributes:{OwnerAccountId:{path:"Owner.Account.Id"},OwnerAccountCreatedBy:{path:"Owner.Account.CreatedBy"}}}},FileListADS:{type:"crt.EntityDataSource",config:{entitySchemaName:TEST_SCHEMA_DATA.testFileEntity}},FileListRecordSchemaNameDS:{type:"crt.EntityDataSource",config:{entitySchemaName:"ObjectWithoutRecordSchemaName"}}},primaryDataSourceName:"PDS",dependencies:{FileListADS:[{attributePath:"RecordId",relationPath:"PDS.Id"}]}}}}class Je{constructor(e,t){this._filterViewElementOptionsModifierFactory=e,this._exposeAttributeConverterMetadataGenerator=t}_getFilterViewConfigs(e){return g.MetadataSchemaUtils.getViewConfigInfoByFilter(t=>!!t?._filterOptions,e).map(t=>t.viewConfig)}_modifyFilterViewConfig(e){return this._filterViewElementOptionsModifierFactory?.create(e?.type)?.modify(e)||e}_generateFiltersAttributes(e){const{from:t,converters:i,expose:r}=e._filterOptions||{};return(0,_.isEmpty)(t)||(0,_.isEmpty)(r)?{}:r.filter(a=>!!a?.attribute).map(a=>({from:t,converters:i,expose:a})).map(a=>this._generateFilterAttributes(a)).reduce((a,s)=>({...a,...s}),{})}_generateFilterAttributes(e){const{from:t,expose:i}=e,r=i.attribute;if(!r)return{};const a=this._exposeAttributeConverterMetadataGenerator.generate({...i,converters:this._getFilterConverters(i.converters,e.converters)});return a?{[r]:{from:t,converter:a.converterExpression},...a.converterArgsAttributes}:{}}_getFilterConverters(e,t){const i=e?.filter(({converter:a})=>!!a)??[],r=t?.filter(({converter:a})=>!!a)??[];return i.length===0?r:i.map(({converter:a,args:s})=>{const n=r.find(c=>c.converter===a);return{converter:a,args:s??n?.args}})}crtOnMetaDataInit(e){const t=e;return this._getFilterViewConfigs(t.viewConfig).map(i=>this._modifyFilterViewConfig(i)).map(i=>this._generateFiltersAttributes(i)).forEach(i=>{t.viewModelConfig.attributes={...t.viewModelConfig.attributes??{},...i}}),Promise.resolve(e)}static{this.\u0275fac=function(t){return new(t||Je)(o.\u0275\u0275inject(h.FILTER_VIEW_ELEMENT_OPTIONS_MODIFIERS_FACTORY,8),o.\u0275\u0275inject(h.ExposeAttributeConverterMetadataGenerator))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:Je,factory:Je.\u0275fac})}}function $t(v,e){const t=new Map(e.map(([i,r])=>[i,{injectable:r}]));return new N.Factory(v,t)}class O{static withModifiers(e){return{ngModule:O,providers:e.map(t=>({provide:h.FILTER_VIEW_ELEMENT_OPTIONS_MODIFIERS,useValue:t,multi:!0}))}}static{this.\u0275fac=function(t){return new(t||O)}}static{this.\u0275mod=o.\u0275\u0275defineNgModule({type:O})}static{this.\u0275inj=o.\u0275\u0275defineInjector({providers:[h.ExposeAttributeConverterMetadataGenerator,{provide:m.CRT_METADATA_PREPROCESSOR,useClass:Je,multi:!0},{provide:h.FILTER_VIEW_ELEMENT_OPTIONS_MODIFIERS_FACTORY,useFactory:$t,deps:[o.Injector,h.FILTER_VIEW_ELEMENT_OPTIONS_MODIFIERS]}]})}}class xt{constructor(){this._pagingConfigPath="modelConfig.pagingConfig",this._selectionOptionsPreprocessorService=(0,o.inject)(M),this.collectionPropertyName="items",this.paginationChangePropertyName="paginationChange"}_normalizeViewConfigName(e){e.name||(e.name=(0,N.getRandomString)(10))}_getCollectionsViewConfigs(e){return g.MetadataSchemaUtils.getViewConfigInfoByProperty("type",this.viewType,e.viewConfig).map(t=>t?.viewConfig).filter(Boolean)}_allowSetPagingConfig(e,t){return!!e&&e in t&&!(0,_.has)(t[e],this._pagingConfigPath)}_allowSetPaginationChange(e,t){return!!t&&!(0,_.has)(e,this.paginationChangePropertyName)}_getViewModelConfigAttributes(e){return e?.viewModelConfig?.attributes}processElementsOnMetaDataInit(e,t){var i=this;return(0,l.A)(function*(){return Promise.all(e.map(r=>i.processElementOnMetaDataInit(r,t)))})()}processElementOnMetaDataInit(e,t){this._normalizeViewConfigName(e);const i=t.viewModelConfig.attributes,r=this.getCollectionAttributeName(e);return this.setCollectionAttributePagingConfig(r,i),this.setSelectionOptions(e),Promise.resolve()}setCollectionAttributePagingConfig(e,t){this._allowSetPagingConfig(e,t)&&(0,_.set)(t[e],this._pagingConfigPath,this.getPagingConfig())}setSelectionOptions(e){this._selectionOptionsPreprocessorService.setInitialSelectionOptions(e,e.name)}processElementsOnViewModelInit(e,t,i){return Promise.all(e.map(r=>this.processElementOnViewModelInit(r,t,i)))}processElementOnViewModelInit(e,t,i){const r=this.getCollectionAttributeName(e);return this.setCollectionViewConfigPaginationChange(e,i,r,this.paginationChangePropertyName),Promise.resolve()}setCollectionViewConfigPaginationChange(e,t,i,r){if(!this._allowSetPaginationChange(e,i))return;const a=t.getBoundDataSourceNameByAttributePath(i);(0,_.set)(e,r,this.getPaginationChangeRequest(a))}addViewModelConfigAttribute(e,t,i,r=!1){const a=this.getViewModelConfigAttribute(e,t);if(!r&&a)return;const s=this._getViewModelConfigAttributes(e)||{};(0,_.set)(s,t,i)}getViewModelConfigAttribute(e,t){return(this._getViewModelConfigAttributes(e)||{})[t]}getCollectionAttributeName(e){return this.getBoundAttributeName((0,_.get)(e,this.collectionPropertyName))}getBoundAttributeName(e){return e?.startsWith("$")?e.slice(1):e}getPagingConfig(){return{rowCount:30}}getPaginationChangeRequest(e){return{request:"crt.LoadDataRequest",params:{dataSourceName:e,parameters:[]}}}crtOnMetaDataInit(e){var t=this;return(0,l.A)(function*(){const i=e,r=t._getCollectionsViewConfigs(i);return yield t.processElementsOnMetaDataInit(r,i),Promise.resolve(e)})()}crtOnViewModelInit(e,t,i){var r=this;return(0,l.A)(function*(){const a=e,s=r._getCollectionsViewConfigs(a);return yield r.processElementsOnViewModelInit(s,a,i),Promise.resolve(e)})()}}class De extends xt{constructor(){super(...arguments),this.viewType="crt.Gallery"}_setGalleryInputs(e,t){this._setSelectedItemIdAttrValue(e,t)}_setSelectedItemIdAttrValue(e,t){if(e.selectedItemId)return;const i=this._getGallerySelectedItemIdAttributeName(e.name);e.selectedItemId=`$${i}`,this.addViewModelConfigAttribute(t,i,{value:null})}_processOpenPageHandles(e,t){var i=this;return(0,l.A)(function*(){if(!i._isValidGalleryItemConfig(e.itemConfig))return;const r=yield i._getCollectionEntitySchemaName(e,t);if(!(yield i._hasAnyPage(e,r,t)))return;const s=yield i._getOpenPageRequest(e,r);i._processCaptionViewConfig(e,s),i._processItemDblClick(e,s)})()}_isValidGalleryItemConfig(e){return!!(e&&!e.captionViewConfig&&e.templateValuesMapping?.caption&&e.templateValuesMapping?.id)}_getCollectionEntitySchemaName(e,t){var i=this;return(0,l.A)(function*(){const r=i.getCollectionAttributeName(e);return(yield(0,m.getEntitySchemaAttribute)(t,r))?.referenceSchemaName})()}_hasAnyPage(e,t,i){return this._hasSpecificPage(e)?Promise.resolve(!0):this._hasEntityEditPage(t,i)}_hasSpecificPage(e){return!!e.useSpecificPage&&!!e.specificPage}_hasEntityEditPage(e,t){if(!e)return Promise.resolve(!1);const i={type:"crt.7XRequest",action:"HasEntityEditPage",$context:t,payload:{entityName:e}};return I.HandlerChainService.instance.process(i)}_getOpenPageRequest(e,t){return this._hasSpecificPage(e)?Promise.resolve(this._getOpenPageBySpecificPage(e)):Promise.resolve(this._getOpenPageByEntityName(e,t))}_getOpenPageBySpecificPage(e){const{specificPage:t}=e,{itemIdBoundedAttribute:i}=this._getItemAttributes(e);return{request:"crt.OpenPageRequest",params:{schemaName:t,modelInitConfigs:[{recordId:i,action:I.ModelInPageAction.Edit}]}}}_getOpenPageByEntityName(e,t){const{itemIdBoundedAttribute:i}=this._getItemAttributes(e);return{request:"crt.UpdateRecordRequest",params:{entityName:t,recordId:i}}}_processCaptionViewConfig(e,t){e.itemConfig.captionViewConfig=this._getLinkViewConfig(e,t)}_getLinkViewConfig(e,t){return this._hasSpecificPage(e)?this._getLinkViewConfigBySpecificPage(e,t):this._getLinkViewConfigByEntityName(e,t)}_getLinkViewConfigBySpecificPage(e,t){const{specificPage:i}=e,{itemIdBoundedAttribute:r,itemCaptionBoundedAttribute:a}=this._getItemAttributes(e);return{...this._getBaseLinkViewConfig(a),href:`${r} | crt.ToOpenPageLink : '${i}'`,clicked:t}}_getLinkViewConfigByEntityName(e,t){const{itemConfig:i}=e,r=i.templateValuesMapping?.id,{itemIdBoundedAttribute:a,itemCaptionBoundedAttribute:s}=this._getItemAttributes(e);return{...this._getBaseLinkViewConfig(s),href:`${a} | crt.ToRecordLinkAsync : '${r}'`,clicked:t}}_getItemAttributes(e){const{itemConfig:t,items:i}=e,r=t.templateValuesMapping?.caption,a=t.templateValuesMapping?.id,s=this.getBoundAttributeName(i),n=`$${s}.${a}`,c=`$${s}.${r}`;return{itemIdBoundedAttribute:n,itemCaptionBoundedAttribute:c}}_getBaseLinkViewConfig(e){return{type:"crt.Link",mode:"preventDefault",caption:`${e}`}}_processItemDblClick(e,t){e.itemDblClick||(e.itemDblClick={request:"crt.GalleryItemClickRequest",params:{item:"@event",clickRequestConfig:t}})}_getGallerySelectedItemIdAttributeName(e){return`${e}_SelectedItemId`}processElementOnMetaDataInit(e,t){var i=()=>super.processElementOnMetaDataInit,r=this;return(0,l.A)(function*(){yield i().call(r,e,t),r._setGalleryInputs(e,t)})()}processElementOnViewModelInit(e,t,i){var r=()=>super.processElementOnViewModelInit,a=this;return(0,l.A)(function*(){yield r().call(a,e,t,i),yield a._processOpenPageHandles(e,i)})()}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=o.\u0275\u0275getInheritedFactory(De)))(i||De)}})()}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:De,factory:De.\u0275fac})}}class Ye{get isProcessingDisabled(){return(0,A.lastValueFrom)(this._featureService.getFeatureState(this._imageInputPreprocessingDisableFeature))}get isAutobindDisabled(){return(0,A.lastValueFrom)(this._featureService.getFeatureState(this._autoBindToDisabled))}constructor(e,t){this._featureService=e,this._metadataModifierService=t,this._imageInputPreprocessingDisableFeature="DisableImageInputPreprocessing",this._autoBindToDisabled="AutoBindToDisabled"}_addToImageLinkConverter(e,t){const i=t.indexOf("|");if(t.startsWith("$")&&i===-1){const r=t+" | crt.ToImageLink";this._metadataModifierService.updateProperty({source:e,keys:["value"],value:r})}}_addBusinessRulesBinding(e,t,i,r,a){if(r.startsWith("$")&&!e.bindTo&&!a){this._metadataModifierService.addProperty(e,"bindTo",`$${i}`);const s=t.attributes||{};s[i]={...s[i],viewItemName:e.name},t.attributes=s}}_addImageSelectedRequest(e,t){e.imageSelected||this._metadataModifierService.addProperty(e,"imageSelected",{request:"crt.UploadImageRequest",params:{imageAttributeName:t,details:"@event"}})}_addimageClearRequest(e,t){e.imageClear||this._metadataModifierService.addProperty(e,"imageClear",{request:"crt.ChangeViewModelAttributeValueRequest",params:{attributeName:t,attributeValue:null}})}_setReadonlyByType(e,t,i){var r=this;return(0,l.A)(function*(){const a=t.viewModelConfig.attributes,s=r._getBindingAttributeWoConverters(e.value);if((0,h.isBindToViewModelAttribute)(s,a)){const n=s.slice(1).split(".").pop(),c=a[n]??{};let d="";(0,m.isModelAttributeConfig)(c)&&(d=c.modelConfig?.path.split(".")[0]);let f="";(0,m.isModelAttributeConfig)(c)&&(f=c.modelConfig?.path.split(".").pop());const p=i.find(E=>E.name===d),C=(p?yield(0,A.lastValueFrom)(p.getSchema(),{defaultValue:null}):null)?.findAttributeByName(f);C&&C.dataValueType!==I.DataValueType.IMAGELOOKUP&&(e.readonly||r._metadataModifierService.updateProperty({source:e,keys:["readonly"],value:!0}),r._metadataModifierService.removeProperty(e,"bindTo"))}})()}_getBindingAttributeWoConverters(e){const t=e?.indexOf("|");return t&&t!==-1&&(e=e.substring(0,t-1).trimEnd()),e}_getBindAttributeName(e){return this._getBindingAttributeWoConverters(e).replace("$","")}crtOnMetaDataInit(e){var t=this;return(0,l.A)(function*(){if(yield t.isProcessingDisabled)return e;const i=e,r=g.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.ImageInput",i.viewConfig),a=yield t.isAutobindDisabled;return r.forEach(s=>{const n=s.viewConfig.value,c=t._getBindAttributeName(n);t._addToImageLinkConverter(s.viewConfig,n),t._addBusinessRulesBinding(s.viewConfig,i.viewModelConfig,c,n,a),t._addImageSelectedRequest(s.viewConfig,c),t._addimageClearRequest(s.viewConfig,c)}),e})()}crtOnModelInit(e,t){var i=this;return(0,l.A)(function*(){if(yield i.isProcessingDisabled)return e;const r=e;return g.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.ImageInput",r.viewConfig).forEach(function(){var s=(0,l.A)(function*(n){yield i._setReadonlyByType(n.viewConfig,r,t)});return function(n){return s.apply(this,arguments)}}()),e})()}static{this.\u0275fac=function(t){return new(t||Ye)(o.\u0275\u0275inject(S.FeatureService),o.\u0275\u0275inject(m.MetadataModifierService))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:Ye,factory:Ye.\u0275fac})}}class Xe{constructor(e){this._featureService=e,this._labelProcessingDisableFeature="DisableLabelPreprocessing"}_actualizeLabelType(e){const t=u.LABEL_TYPE_MAPPING[e.labelType];t&&(e.labelType=t)}get _isProcessingDisabled(){return(0,A.lastValueFrom)(this._featureService.getFeatureState(this._labelProcessingDisableFeature))}crtOnMetaDataInit(e){var t=this;return(0,l.A)(function*(){if(yield t._isProcessingDisabled)return e;const i=e;return g.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.Label",i.viewConfig).forEach(a=>{t._actualizeLabelType(a.viewConfig)}),e})()}static{this.\u0275fac=function(t){return new(t||Xe)(o.\u0275\u0275inject(S.FeatureService))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:Xe,factory:Xe.\u0275fac})}}class Ke{_getViewConfigs(e,t){return g.MetadataSchemaUtils.getViewConfigInfoByProperty("type",t,e.viewConfig).map(i=>i?.viewConfig).filter(Boolean)}_setAddNextStepBtnAdditionalProperties(e){Object.keys(e).includes("visible")||(e.visible="$CardState | crt.IsEqual : 'edit'")}_setNextStepsComponentAdditionalProperties(e,t){if(e&&(Object.keys(e).includes("cardState")||(e.cardState="$CardState"),!Object.keys(e).includes("nextSteps"))){const i=t.viewModelConfig.attributes;this._createNextStepsAttribute(e,i)}}_createNextStepsAttribute(e,t){const i=`NextSteps_${e.name}`,r=`ReloadNextSteps_${e.name}`;t[i]={from:[this._getOrCreatePropertyAttribute(e.masterSchemaId||"",`MasterSchemaId_${e.name}`,t),this._getOrCreatePropertyAttribute(u.RELOAD_NEXT_STEPS_PREFIX,r,t)],converter:`crt.LoadNextSteps : '${e.masterSchemaName}'`},e.nextSteps=`$${i}`,e.reloadNextSteps=`$${r}`}_getOrCreatePropertyAttribute(e,t,i){return e.startsWith("$")?e.replace("$",""):(i[t]={value:e},t)}_handleNextStepsComponent(e){this._getViewConfigs(e,"crt.NextSteps").forEach(i=>{this._setNextStepsComponentAdditionalProperties(i,e)})}_handleNextStepsAddButtons(e){this._getViewConfigs(e,"crt.Button").forEach(i=>{if(i&&i.clickMode==="menu"){const r=i.menuItems||[];Array.isArray(r)&&r.some(a=>{const s=a.clicked;return s&&(s.request==="crt.AddNextStepRequest"||s.request==="crt.CreateEmailRequest")})&&this._setAddNextStepBtnAdditionalProperties(i)}})}_getNextStepRelatedConfigs(e){const t=g.MetadataSchemaUtils.getViewConfigInfoByFilter(i=>i.type==="crt.NextSteps"&&i.bindingColumns||i.type==="crt.MenuItem"&&i.clicked?.request==="crt.CreateEmailRequest"&&!i.clicked?.params?.bindingColumns,[e]).map(i=>i?.viewConfig).filter(Boolean);return t?.length!==2?null:{nextStep:t.find(i=>i.type==="crt.NextSteps"),addEmailBtn:t.find(i=>i.type==="crt.MenuItem")}}_getConfigsToFix(e){const t=new Array;return g.MetadataSchemaUtils.getViewConfigInfoByFilter(i=>{if(i.type!=="crt.ExpansionPanel")return!1;const r=this._getNextStepRelatedConfigs(i);return r&&t.push(r),!!r},e.viewConfig),t}_fixBindingColumns(e){this._getConfigsToFix(e).forEach(i=>{const r=i.addEmailBtn.clicked;r.params=r.params||{},r.params.bindingColumns=(0,_.cloneDeep)(i.nextStep.bindingColumns)})}crtOnMetaDataInit(e){const t=e;return this._fixBindingColumns(t),this._handleNextStepsAddButtons(t),this._handleNextStepsComponent(t),Promise.resolve(e)}static{this.\u0275fac=function(t){return new(t||Ke)}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:Ke,factory:Ke.\u0275fac})}}class Ze{constructor(e,t,i){this._translateService=e,this._printablesService=t,this._rightsService=i,this._translatePrefix="PrintablesMenuItemsPreprocessor",this._canManageReports=!1}_generateMenuItems(e,t,i){var r=this;return(0,l.A)(function*(){const a=e.viewConfig.clicked.params,s=t.modelConfig?.dataSources;if((0,_.isEmpty)(s))return console.warn("There is no datasources in modelConfig."),[];const n=s?.[a.dataSourceName];if(!n)return console.warn(`Datasource '${a.dataSourceName}' specified in the request is not found in the modelConfig.`),[];const c=n.scope===I.DataSourceScope.Page,d=n.config?.entitySchemaName;return(yield r._printablesService.getPrintablesForEntity(d)).filter(p=>c?p.ShowInCard:p.ShowInSection).map(p=>({type:"crt.MenuItem",caption:p.Caption,clicked:{request:"crt.PrintablesRequest",params:{convertInPDF:p.ConvertInPDF===!0,printableCaption:p.Caption,templateId:p.Id,dataSourceName:a.dataSourceName,filters:a?.filters}}}))})()}_getItemsWithPrintablesRequest(e,t){return g.MetadataSchemaUtils.getViewConfigInfoByProperty("type",e,t.viewConfig).filter(r=>{const{clicked:a,menuItems:s}=r.viewConfig||{};return!s?.length&&a?.request==="crt.PrintablesRequest"&&a.params?.dataSourceName&&!a.params.templateId})}_noAvailablePrintablesMenuItem(){return{type:"crt.MenuLabel",caption:this._translateService.instant(this._translatePrefix+".NoAvailablePrintablesCaption")}}_goToPrintablesSetupMenuItems(){return this._canManageReports?[{type:"crt.MenuDivider"},{type:"crt.MenuItem",caption:this._translateService.instant(this._translatePrefix+".GoToPrintablesSetupCaption"),icon:"open-button-icon",handleItemClick:()=>{this._goToPrintables()}}]:[]}_goToPrintables(){const e=(0,g.getWorkspaceBaseUrl)();window.open(`${e}ClientApp#/Printables`,"_blank")}_generateInfoMenuItems(){return[this._noAvailablePrintablesMenuItem(),...this._goToPrintablesSetupMenuItems()]}_prepareItemMenu(e,t,i,r){var a=this;return(0,l.A)(function*(){const s=a._getItemsWithPrintablesRequest(e,i);for(const n of s){let c=yield a._generateMenuItems(n,i,r);c.length===0?c=a._generateInfoMenuItems():c.push(...a._goToPrintablesSetupMenuItems()),n.viewConfig[t]=c,n.viewConfig.clickMode="menu",delete n.viewConfig.clicked}})()}_initCanManageReports(){var e=this;return(0,l.A)(function*(){e._canManageReports=yield(0,A.firstValueFrom)(e._rightsService.getCanExecuteOperation("CanManageReports"))})()}crtOnViewModelInit(e,t,i){var r=this;return(0,l.A)(function*(){const a=e;return yield r._initCanManageReports(),yield r._prepareItemMenu("crt.MenuItem","items",a,i),yield r._prepareItemMenu("crt.Button","menuItems",a,i),e})()}static{this.\u0275fac=function(t){return new(t||Ze)(o.\u0275\u0275inject(z.TranslateService),o.\u0275\u0275inject(S.PrintablesService),o.\u0275\u0275inject(S.RightsService))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:Ze,factory:Ze.\u0275fac})}}class Qe{constructor(e){this.featureService=e,this.featureName="DisableDataGridMoveSelectedItemsProcessing"}_getMoveItemsButtons(e){return(0,ft.getRequestBindingConfigs)(e.viewConfig,"crt.MoveSelectedItemsRequest")}_generateViewModelAttribute(e,t,i){const r=e?.viewModelConfig?.attributes||{},a=t?.replace(i+"_","");r[t]||(r[t]={modelConfig:{path:`${i}.${a}`}})}_generateDataSourceAttribute(e,t,i){const s=(e?.modelConfig?.dataSources??{})[i]?.config?.attributes,n=t.replace(i+"_","");s[n]||(s[n]={path:n})}_generateMissingAttributes(e,t){const i=e?.params,r=i?.sourceAttribute,a=i?.targetAttribute,s=i?.defaultValues,n=t?.viewModelConfig?.attributes??{},c=n[r],d=n[a],f=c?.modelConfig?.path,p=d?.modelConfig?.path;s?.forEach(b=>{const C=b.attributeName,E=b.value;if(b.type===m.MoveSelectedItemDefaultValueType.Item){const T=typeof b.value=="object"?E.value:E;typeof T=="string"&&this._generateViewModelAttribute(c,T,f),this._generateDataSourceAttribute(t,T,f)}this._generateViewModelAttribute(d,C,p),this._generateDataSourceAttribute(t,C,p)})}crtOnMetaDataInit(e){var t=this;return(0,l.A)(function*(){if(yield(0,A.lastValueFrom)(t.featureService.getFeatureState(t.featureName),{defaultValue:null}))return e;const r=e;if(!r.viewModelConfig?.attributes)return e;const a=t._getMoveItemsButtons(r);for(const s of a)t._generateMissingAttributes(s,r);return e})()}static{this.\u0275fac=function(t){return new(t||Qe)(o.\u0275\u0275inject(S.FeatureService))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:Qe,factory:Qe.\u0275fac})}}class x{constructor(e){this._resourceFinderService=e,this._dataGridType="crt.DataGrid",this._galleryType="crt.Gallery",this._findAttributeInDataSchema=(t,i)=>t?.attributes?.find(r=>r.name===i)}_getBindedViewElementConfigsByAttributeNames(e,t){return g.MetadataSchemaUtils.getViewConfigInfoByFilter(i=>this._isViewConfigInfoBindedByPropertyValues(i,t.map(r=>`$${r}`)),e.viewConfig).map(i=>i.viewConfig)}_isViewConfigInfoBindedByPropertyValues(e,t){const i=Object.values(e);for(const r of i)if(t.includes(r))return!0;return!1}_getColumnByViewType(e,t,i,r){switch(r.type){case this._dataGridType:return this._getColumnsFromDataGridViewConfig(e,t,i,r);case this._galleryType:return Promise.resolve(this._getColumnsFromGalleryViewConfig(e,t,i,r));default:return Promise.resolve(this._getColumnsFromViewModelConfig(e,t,i))}}_getColumnsFromDataGridViewConfig(e,t,i,r){var a=this;return(0,l.A)(function*(){const s=[],n=a._getDataSchema(t,i);if(!n)return Promise.resolve(null);const c=r;if(!c.columns)return a._getColumnsFromViewModelConfig(e,t,i);const d=a._getColumnAttributes(e,i);for(const f of c.columns){const p=f.code,b=d?.[p];yield a._addColumnByResourcesIfNeed(n,t,s,f,b)}return{columns:s,viewName:r.name||i,primaryDisplayName:n.primaryDisplayAttributeName}})()}_addColumnByResourcesIfNeed(e,t,i,r,a){var s=this;return(0,l.A)(function*(){const n=s._getColumnNameFromAttributeConfigPath(a),c=s._findAttributeInDataSchema(e,n);s._isAllowedToAddColumn(c,i,n)&&i.push(yield s._createColumnByResources(t[g.SchemaResourcesSuffix],r.caption,n,c?.path))})()}_getColumnsFromGalleryViewConfig(e,t,i,r){const a=[],s=this._getDataSchema(t,i);if(!s)return null;const n=r?.itemConfig,c=this._getColumnAttributes(e,i);return(0,_.forEach)(n?.templateValuesMapping,(d,f)=>{const p=c?.[d];this._addColumnByDataSchemaIfNeed(s,a,p)}),{columns:a,viewName:r.name||i,primaryDisplayName:s.primaryDisplayAttributeName}}_getColumnsFromViewModelConfig(e,t,i){const r=[],a=this._getDataSchema(t,i);if(!a)return null;const s=this._getColumnAttributes(e,i);return(0,_.forEach)(s,(n,c)=>{this._addColumnByDataSchemaIfNeed(a,r,n)}),{columns:r,viewName:i,primaryDisplayName:a.primaryDisplayAttributeName}}_getDataSchema(e,t){return e.getBoundDataSchemaByAttributePath(t)}_getColumnAttributes(e,t){const i=e.viewModelConfig.attributes;return Object.prototype.hasOwnProperty.call(i,t)?i[t].viewModelConfig?.attributes||{}:{}}_addColumnByDataSchemaIfNeed(e,t,i){const r=this._getColumnNameFromAttributeConfigPath(i),a=this._findAttributeInDataSchema(e,r);this._isAllowedToAddColumn(a,t,r)&&t.push(this._createColumnByDataSchema(a,r))}_getColumnNameFromAttributeConfigPath(e){if(e&&(0,m.isModelAttributeConfig)(e))return e?.modelConfig?.path?.split(".").slice(1).shift()}_isAllowedToAddColumn(e,t,i){return(0,g.isAllowedTypeSearchColumn)(e)&&!!i&&!t.some(r=>r.name===i)}_createColumnByResources(e,t,i,r){var a=this;return(0,l.A)(function*(){return{caption:(yield a._resourceFinderService.findViewModelResourceValue(t,e,t))||i,name:i,path:r||i}})()}_createColumnByDataSchema(e,t){return{caption:e?.caption||t,name:t,path:e?.path||t}}_getUniqueColumns(e){if(!e.length)return null;const t=[];return e.forEach(i=>{i.columns.forEach(r=>{this._isSearchFilterColumnExist(t,r)||t.push(r)})}),{columns:t,viewName:e.slice().shift()?.viewName||"",primaryDisplayName:e.slice().shift()?.primaryDisplayName}}_isSearchFilterColumnExist(e,t){return e.some(i=>i.caption===t.caption&&i.name===t.name)}getColumnsModelByAttributeName(e,t,i){var r=this;return(0,l.A)(function*(){const a=r._getBindedViewElementConfigsByAttributeNames(e,[i]);if(a.length===0)return r._getColumnsFromViewModelConfig(e,t,i);const s=(yield Promise.all(a.map(n=>r._getColumnByViewType(e,t,i,n)))).filter(Boolean);return r._getUniqueColumns(s)})()}static{this.\u0275fac=function(t){return new(t||x)(o.\u0275\u0275inject(g.ResourceFinderService))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:x,factory:x.\u0275fac})}}class Ee extends Et.BaseFilterPreprocessor{constructor(e,t,i,r){super(),this._featureService=e,this._searchFilterPreprocessorService=t,this._searchFilterQueryAnalyzerService=i,this._translateService=r,this._isTargetAttributesExist=(a,s)=>this._getAvailableTargetAttributes(a,s)?.length>0}_getSearchFilterViewConfigs(e){return g.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.SearchFilter",e.viewConfig).map(t=>t?.viewConfig).filter(Boolean)}_getAvailableTargetAttributes(e,t){return this.isNewStructure(t)?this._getAvailableTargetFromFilterOptions(e,t):this._getAvailableTargetFromTargetAttributes(e,t)}_getAvailableTargetFromTargetAttributes(e,t){return t?.targetAttributes?.map(i=>(0,_.get)(e.viewModelConfig?.attributes||{},i)?i:null).filter(Boolean)||[]}_getAvailableTargetFromFilterOptions(e,t){return t?._filterOptions?.expose?.map(i=>this._getTargetAttributeNameFromConverter(i.converters||[])).filter(Boolean)}_getTargetAttributeNameFromConverter(e){return e.find(i=>i?.args?.length>0)?.args?.find(i=>!!i)??""}_getSearchValueViewModelAttributeName(e){return`${e}_SearchValue`}_getSearchFilteredColumnViewModelAttributeName(e){return`${e}_SearchFilteredColumn`}_getSearchFilteredColumnsGroupsAttributeName(e){return`${e}_FilteredColumnsGroups`}_getSearchMinifySearchAttributeName(e){return`${e}_MinifySearch`}_setDisabledAttribute(e,t){this._isTargetAttributesExist(e,t)||(t.disabled=!0)}_setTooltipAttribute(e){e.tooltip||(e.tooltip=this._translateService.instant("Components.SearchFilter.Tooltip"))}_setSearchValueAttribute(e,t){const i=this._getSearchValueViewModelAttributeName(t.name);this._createViewModelAttribute(e,i),t.value=`$${i}`}_setSearchFilteredColumnAttribute(e,t){const i=this._getSearchFilteredColumnViewModelAttributeName(t.name);this._createViewModelAttribute(e,i),t.filteredColumn=`$${i}`}_setSearchMinifySearchAttribute(e,t){const i=this._getSearchMinifySearchAttributeName(t.name);this._createViewModelAttribute(e,i,t.iconOnly||!1),t.minifySearch=`$${i}`}_setSearchFilteredColumnsGroupsAttribute(e,t){const i=this._getSearchFilteredColumnsGroupsAttributeName(t.name);this._createViewModelAttribute(e,i),t.selectedColumnsGroups=`$${i}`}_createViewModelAttribute(e,t,i=""){const r=e.viewModelConfig.attributes;Object.prototype.hasOwnProperty.call(r,t)||(r[t]={value:i})}_setFilterAttribute(e,t){this.isNewStructure(t)||!this._isTargetAttributesExist(e,t)||this._getAvailableTargetAttributes(e,t).forEach(i=>{this._setFilterConverterAttribute(e,t,i),this.setFilterAttribute(e,t.name,i)})}_setFilterConverterAttribute(e,t,i){const r=e.viewModelConfig.attributes,a=this.getFilterAttributeName(t.name,i),s=this._getSearchFilteredColumnsGroupsAttributeName(t.name),n={from:[this._getSearchValueViewModelAttributeName(t.name),s],converter:`crt.SearchFilterAttributeConverter: '${i}'`};this.createAttributeIfNeed(r,s,{value:[]}),this.createAttributeIfNeed(r,a,n)}_setSearchFilterColumnsGroupsRequest(e,t,i){var r=this;return(0,l.A)(function*(){if(i.valueChange||!r._isTargetAttributesExist(e,i))return;const a=(yield r._createSearchFilterTargets(e,t,i)).filter(Boolean);if((0,_.isEmpty)(a))return;const n=(yield r._getIsSearchFilterQueryAnalyzerEnabled())?yield r._getIsNeedShowAllOptionForTargets(e,t,a):!0;r._setSearchFilterConfigIntoView(i,a,n),i.valueChange={request:"crt.SearchFilterColumnsGroupsRequest",params:{value:"@event.value",searchFilterColumnsGroups:"@event.columnsGroups",searchFilterGroups:a.map(c=>({filterAttributeName:c.filterAttributeName,viewAttributeName:c.viewAttribute.name})),searchValueAttributeName:r._getSearchValueViewModelAttributeName(i.name),searchFilteredColumnAttributeName:r._getSearchFilteredColumnViewModelAttributeName(i.name),searchFilteredColumnsGroupsAttributeName:r._getSearchFilteredColumnsGroupsAttributeName(i.name)}}})()}_getIsSearchFilterQueryAnalyzerEnabled(){return this._featureService.getFeatureState("SearchFilterQueryAnalyzerEnabled")}_getIsNeedShowAllOptionForTargets(e,t,i){var r=this;return(0,l.A)(function*(){for(const a of i)if(yield r._getIsNeedOptimization(e,t,a.viewAttribute.name,a.columnsModel.columns))return!1;return!0})()}_getIsNeedOptimization(e,t,i,r){var a=this;return(0,l.A)(function*(){if(a._isCollectionAttributeHasFixedFilter(e,t,i))return!1;const s=t.getBoundDataSchemaByAttributePath(i)?.name,n=r.map(d=>d.path);return(0,_.isEmpty)(s)||r.length===0?!1:(yield(0,A.firstValueFrom)(a._searchFilterQueryAnalyzerService.analyze(s,n))).isNeedOptimization})()}_isCollectionAttributeHasFixedFilter(e,t,i){let r=!1;const a=e.viewModelConfig.attributes;if(this._isDataSourceHasDependencies(e,t,i))return!0;const s=this.getAttributeModelFilters(a,i);return(0,_.each)(s,n=>(r=this._isPredefineFilterAttribute(a,n.name),!r)),r}_isPredefineFilterAttribute(e,t){const r=e[t]?.value?.filterType;return!!r||r===0}_isDataSourceHasDependencies(e,t,i){const r=t.getBoundDataSourceNameByAttributePath(i);return((e.modelConfig?.dependencies||{})[r]||[]).length>0}_createSearchFilterTargets(e,t,i){return Promise.all(this._getAvailableTargetAttributes(e,i).map(r=>this._createSearchFilterTarget(e,t,i.name,r)))}_createSearchFilterTarget(e,t,i,r){var a=this;return(0,l.A)(function*(){const s=yield a._getColumnsModel(e,t,r);if(!s)return Promise.resolve(null);const n=`${i}_${r}`,c=a._getDisplayValueForViewAttributeName(t,r,s.viewName);return{columnsModel:s,filterAttributeName:n,viewAttribute:{caption:c,name:r}}})()}_getColumnsModel(e,t,i){return this._searchFilterPreprocessorService.getColumnsModelByAttributeName(e,t,i)}_getDisplayValueForViewAttributeName(e,t,i){const r=e.getBoundDataSchemaByAttributePath(t);return r?`${r.name}${(0,_.isEmpty)(i)?"":" | "+i}`:i}_setSearchFilterConfigIntoView(e,t,i){e.columnsGroupsConfig={showAllOption:i,columnsGroups:t.map(r=>({group:r.viewAttribute,columns:r.columnsModel.columns})),primaryColumnName:t.slice().shift()?.columnsModel.primaryDisplayName}}crtOnMetaDataInit(e){const t=e;return this._getSearchFilterViewConfigs(t).forEach(r=>{this._setDisabledAttribute(t,r),this._setTooltipAttribute(r),this._setSearchValueAttribute(t,r),this._setSearchFilteredColumnAttribute(t,r),this._setFilterAttribute(t,r),this._setSearchMinifySearchAttribute(t,r),this._setSearchFilteredColumnsGroupsAttribute(t,r)}),Promise.resolve(e)}crtOnViewModelInit(e,t,i){var r=this;return(0,l.A)(function*(){const a=e,s=i,n=r._getSearchFilterViewConfigs(a);for(const c of n)yield r._setSearchFilterColumnsGroupsRequest(a,s,c);return e})()}static{this.\u0275fac=function(t){return new(t||Ee)(o.\u0275\u0275inject(I.FeatureService),o.\u0275\u0275inject(x),o.\u0275\u0275inject(u.SearchFilterQueryAnalyzerService),o.\u0275\u0275inject(z.TranslateService))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:Ee,factory:Ee.\u0275fac})}}class et extends nt{constructor(e){super(),this._translateService=e,this.viewItemTypes=["crt.DataGrid"]}setRowToolbarMenuItems(e,t){var i=this;return(0,l.A)(function*(){const r=e.items.slice(1),a=t.getBoundDataSchemaByAttributePath(r)?.name;if(a!=="SimilarLead")return;const s=t.getBoundDataSourceNameByAttributePath(r),n=yield i.hasEntityEditPage(t,a),c=`$${r}.PrimaryModelMode | crt.IsEqual : 'create'`;e.rowToolbarItems=[{type:"crt.MenuItem",caption:i._translateService.instant("DataGrid.RowToolbar.Open"),icon:"edit-row-action",visible:n,disabled:c,clicked:{request:"crt.UpdateRecordRequest",params:{itemsAttributeName:r,recordId:`$${r}.${s}_Id`},useRelativeContext:!0}}]})()}static{this.\u0275fac=function(t){return new(t||et)(o.\u0275\u0275inject(z.TranslateService))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:et,factory:et.\u0275fac})}}class tt{constructor(e,t){this._featureService=e,this._profileAttributeService=t,this._tabPanelActionsProcessingDisableFeature="DisableTabPanelPreprocessing"}_updateIconPosition(e){if(e.iconPosition)return;const t=!!e.icon;e.iconPosition=t?F.IconPositionEnum.LeftIcon:F.IconPositionEnum.OnlyText}_updateTabIconSource(e){u.TabItem.updateTabIconSource(e)}_updateTabHint(e){e.hint=e.caption}_getTabContainerHeader(e){const t=this._getTabPanelHeaderItemInputs();return{type:"crt.TabPanelHeader",tabs:e.items?.map(i=>({...Object.fromEntries(t.filter(r=>typeof i[r]<"u").map(r=>[r,i[r]])),type:"crt.TabPanelHeaderItem",name:i.name,titleColor:e.tabTitleColor,selectedTitleColor:e.selectedTabTitleColor,styleType:e.styleType}))}}_getTabContainerBody(e){const t=e.allowToggleClose??!0,i=e.mode==="toggle"?t:!1;return{type:"crt.ToggleContainer",preserveContent:e.preserveContent??!0,slidingAnimation:e.slidingAnimation??!1,items:e.items?.map(r=>({...r,type:"crt.ToggleContainerItem",backgroundColor:e.bodyBackgroundColor,isToggleTabHeaderVisible:r.isToggleTabHeaderVisible??!1,allowToggleClose:i})),visibilityStrategyMode:e.visibilityStrategyMode}}_getTabPanelHeaderItemInputs(){return Object.keys(I.ViewElementRegistry.viewElements.get("crt.TabPanelHeaderItem")?.inputs??{})}get isProcessingDisabled(){return(0,A.lastValueFrom)(this._featureService.getFeatureState(this._tabPanelActionsProcessingDisableFeature))}crtOnMetaDataInit(e){var t=this;return(0,l.A)(function*(){const i=e;if(!(yield t.isProcessingDisabled)){g.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.TabContainer",i.viewConfig).forEach(s=>{t._updateIconPosition(s.viewConfig),t._updateTabIconSource(s.viewConfig),t._updateTabHint(s.viewConfig)});const a=g.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.TabPanel",i.viewConfig);for(const s of a){const n=s.viewConfig;yield t._profileAttributeService.prepareAttributeWithFeatureCheck(i,n,"selectedTabIndex","","DisableSaveToProfileSelectedTabIndex");const c=t._getTabContainerBody(n),d=t._getTabContainerHeader(n);if(n.mode==="toggle"){const f={...c,name:n.name,visible:n.visible,selectedTab:n.selectedTab,layoutConfig:n.layoutConfig||{},stretch:n.stretch,classes:n.classes,fitContent:n.fitContent},p=n.isToggleTabHeaderVisible??!0;f.items?.forEach(b=>{b.isToggleTabHeaderVisible=p}),Object.keys(n).forEach(b=>delete n[b]),Object.assign(n,f)}else n.items=[d,c]}}return e})()}static{this.\u0275fac=function(t){return new(t||tt)(o.\u0275\u0275inject(S.FeatureService),o.\u0275\u0275inject(u.ProfileAttributeService))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:tt,factory:tt.\u0275fac})}}class kt{constructor(){this._dataSchemaRepository=(0,o.inject)(m.DataSchemaRepositoryService)}setupSelect(e,t){var i=this;return(0,l.A)(function*(){i.isCanSetupSelect(e,t)&&(yield i.initializeSchemasNames(t),i.isCanRunSetupSelectData(t)&&(yield i.setupDataViewModel(e,t),yield i.setupInputs(t),yield i.setupRequests(t)))})()}isCanSetupSelect(e,t){return!!t.selectSchemaName&&!!t.selectColumnName&&this.isViewModelAttributeExist(e,t.recordId)}isViewModelAttributeExist(e,t){if(!t)return!1;const i=Object.keys(e.viewModelConfig?.attributes||{}),r=this.getAttributeName(t);return i.includes(r)}getAttributeName(e){return(0,h.isBindingExpression)(e)?e.slice(1):e}initializeSchemasNames(e){var t=this;return(0,l.A)(function*(){yield t.initializeSelectSchemaName(e),yield t.initializeListSchemaName(e)})()}initializeSelectSchemaName(e){}initializeListSchemaName(e){var t=this;return(0,l.A)(function*(){if(!e.selectColumnName)return;const r=(yield t.getSelectDataSchema(e)).findAttributeByName(e.selectColumnName);e.listSchemaName=r?.referenceSchemaName})()}isCanRunSetupSelectData(e){return!!e.selectSchemaName&&!!e.listSchemaName}setupDataViewModel(e,t){var i=this;return(0,l.A)(function*(){yield i.createAndAddItemsViewModelAttributeData(e,t),yield i.createAndAddListItemsViewModelAttributeData(e,t)})()}createAndAddItemsViewModelAttributeData(e,t){var i=this;return(0,l.A)(function*(){yield i.createAndAddItemsViewModelAttribute(e,t),i.createAndAddItemsViewModelSortingAttribute(e,t),i.createAndAddItemsViewModelFilterAttribute(e,t),i.createAndAddItemsViewModelFilterConfigAttribute(e,t)})()}createAndAddItemsViewModelAttribute(e,t){var i=this;return(0,l.A)(function*(){const r=yield i.getSelectDataSchema(t),a=yield i.getListDataSchema(t),s=i.createItemsAttribute(t,r);i.addItemsAttributeViewModelConfig(s,t,r,a),i.addItemsEmbeddedDataSource(s,t),i.addItemsAttributeToViewModelConfig(e,t,s)})()}createItemsAttribute(e,t){const i=this.getItemsDataSourceName(e),r=this.getItemsFilterAttributeName(e);return(0,_.merge)(this.createCollectionAttribute(i),{modelConfig:{sortingConfig:this.getItemsSortingConfig(e,t),filterAttributes:[{name:r,loadOnChange:!0}]}})}createCollectionAttribute(e){return{isCollection:!0,modelConfig:{path:e}}}getItemsSortingConfig(e,t){return{default:[{columnName:"CreatedOn",direction:"desc"}],attributeName:this.getItemsSortingAttributeName(e)}}addItemsAttributeViewModelConfig(e,t,i,r){const a=this.getItemsDataSourceName(t),s=t.selectColumnName,n=r.primaryAttributeName,c=r.primaryDisplayAttributeName,d=r.primaryColorAttributeName,f={RelationRecordId:{modelConfig:{path:`${a}.${i.primaryAttributeName}`}},[n]:{modelConfig:{path:`${a}.${s}.${n}`}},[c]:{modelConfig:{path:`${a}.${s}.${c}`}}};d&&(f[d]={modelConfig:{path:`${a}.${s}.${d}`}}),e.viewModelConfig={attributes:f}}addItemsEmbeddedDataSource(e,t){const i=this.getItemsDataSourceName(t),r=t.selectSchemaName;e.embeddedModel=this.createEmbeddedDataSource(i,r)}createEmbeddedDataSource(e,t){return{name:e,config:{type:"crt.EntityDataSource",config:{entitySchemaName:t},hiddenInPageDesigner:!1}}}addItemsAttributeToViewModelConfig(e,t,i){this.addViewModelConfigAttribute(e,this.getItemsAttributeName(t),i)}addViewModelConfigAttribute(e,t,i){!e?.viewModelConfig?.attributes||e.viewModelConfig.attributes[t]||(e.viewModelConfig.attributes[t]=i)}createAndAddItemsViewModelSortingAttribute(e,t){const i=this.createSortingAttributeConfig(),r=this.getItemsSortingAttributeName(t);this.addViewModelConfigAttribute(e,r,i)}createAndAddItemsViewModelFilterAttribute(e,t){const i=this.createItemsViewModelFilterAttribute(t),r=this.getItemsFilterAttributeName(t);this.addViewModelConfigAttribute(e,r,i)}createItemsViewModelFilterAttribute(e){const t=this.getAttributeName(e.recordId),i=this.getItemsFilterConfigAttributeName(e);return{from:t,converter:`crt.BaseSelectFilterAttributeConverter: $${i}`}}createAndAddItemsViewModelFilterConfigAttribute(e,t){const i={value:{selectSchemaName:t.selectSchemaName,selectColumnName:t.selectColumnName,recordRelationColumnName:t.recordRelationColumnName}},r=this.getItemsFilterConfigAttributeName(t);this.addViewModelConfigAttribute(e,r,i)}createAndAddListItemsViewModelAttributeData(e,t){var i=this;return(0,l.A)(function*(){yield i.createAndAddListItemsViewModelAttribute(e,t),i.createAndAddListItemsViewModelSortingAttribute(e,t),i.createAndAddListItemsViewModelFilterAttribute(e,t)})()}createAndAddListItemsViewModelAttribute(e,t){var i=this;return(0,l.A)(function*(){const r=yield i.getListDataSchema(t),a=i.createListItemsAttribute(t,r);i.addListItemsAttributeViewModelConfig(a,t,r),i.addListItemsEmbeddedDataSource(a,t),i.addListItemsAttributeToViewModelConfig(e,t,a)})()}getSelectDataSchema(e){const t=e.selectSchemaName;return this.getDataSchema(t)}getListDataSchema(e){const t=e.listSchemaName;return this.getDataSchema(t)}getDataSchema(e){return(0,A.lastValueFrom)(this._dataSchemaRepository.get(e))}createListItemsAttribute(e,t){const i=this.getListItemsDataSourceName(e),r=this.getListItemsFilterAttributeName(e),a={sortingConfig:this.getListItemsSortingConfig(e,t),filterAttributes:[{name:r,loadOnChange:!0}],pagingConfig:{rowCount:30}};return(0,_.merge)(this.createCollectionAttribute(i),{isLookup:!0,modelConfig:a})}getListItemsSortingConfig(e,t){return{default:[this.getDefaultSortingColumn(t)],attributeName:this.getListItemsSortingAttributeName(e)}}getDefaultSortingColumn(e){return{columnName:e.primaryDisplayAttributeName,direction:"asc"}}addListItemsAttributeViewModelConfig(e,t,i){const r=this.getListItemsDataSourceName(t),a={value:{modelConfig:{path:`${r}.${i.primaryAttributeName}`}},displayValue:{modelConfig:{path:`${r}.${i.primaryDisplayAttributeName}`}}};i.primaryColorAttributeName&&(a.primaryColorValue={modelConfig:{path:`${r}.${i.primaryColorAttributeName}`}}),e.viewModelConfig={attributes:a}}addListItemsEmbeddedDataSource(e,t){const i=this.getListItemsDataSourceName(t),r=t.listSchemaName;e.embeddedModel=this.createEmbeddedDataSource(i,r)}addListItemsAttributeToViewModelConfig(e,t,i){this.addViewModelConfigAttribute(e,this.getListItemsAttributeName(t),i)}createAndAddListItemsViewModelSortingAttribute(e,t){const i=this.createSortingAttributeConfig(),r=this.getListItemsSortingAttributeName(t);this.addViewModelConfigAttribute(e,r,i)}createSortingAttributeConfig(){return{isCollection:!0,viewModelConfig:{attributes:{columnName:{},direction:{}}}}}createAndAddListItemsViewModelFilterAttribute(e,t){const i=this.createListItemsViewModelFilterAttribute(t),r=this.getListItemsFilterAttributeName(t);this.addViewModelConfigAttribute(e,r,i)}createListItemsViewModelFilterAttribute(e){return{value:null}}setupInputs(e){this.setItemsAttributeValue(e),this.setListItemsAttributeValue(e)}setItemsAttributeValue(e){if(e.items)return;const t=this.getItemsAttributeName(e);e.items=`$${t}`}setListItemsAttributeValue(e){if(e.listItems)return;const t=this.getListItemsAttributeName(e);e.listItems=`$${t}`}setupRequests(e){this.setShowListRequest(e),this.setPaginationChangeRequest(e)}setShowListRequest(e){if(e.showList)return;const t=this.getListItemsDataSourceName(e),i=this.createLoadDataRequestConfig(t);i.params={...i.params,config:{loadType:I.DataSourceLoadType.Reload}},e.showList=i}setPaginationChangeRequest(e){if(e.paginationChange)return;const t=this.getListItemsDataSourceName(e);e.paginationChange=this.createLoadDataRequestConfig(t)}createLoadDataRequestConfig(e){return{request:"crt.LoadDataRequest",params:{dataSourceName:e,primaryDisplayFilterValue:"@event.primaryDisplayFilterValue",parameters:[]},useRelativeContext:!0}}getItemsAttributeName(e){return`${e.name}_Items`}getItemsSortingAttributeName(e){return`${this.getItemsAttributeName(e)}_Sorting`}getItemsFilterAttributeName(e){return`${this.getItemsAttributeName(e)}_Filter`}getItemsFilterConfigAttributeName(e){return`${this.getItemsAttributeName(e)}_Filter_Config`}getItemsDataSourceName(e){return`${this.getItemsAttributeName(e)}_DS`}getListItemsAttributeName(e){return`${e.name}_List_Items`}getListItemsSortingAttributeName(e){return`${this.getListItemsAttributeName(e)}_Sorting`}getListItemsFilterAttributeName(e){return`${this.getListItemsAttributeName(e)}_Filter`}getListItemsDataSourceName(e){return`${this.getListItemsAttributeName(e)}_DS`}}class Te extends kt{constructor(){super(...arguments),this._userInfo=(0,o.inject)(g.UserInfo),this._tagRightsService=(0,o.inject)(u.TagRightsService),this._allowedTagAccessesForTaggingIds=[]}_getTagSelectViewConfigs(e){return g.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.TagSelect",e.viewConfig).map(t=>t?.viewConfig).filter(Boolean)}_prepareDataForTagSelects(e){var t=this;return(0,l.A)(function*(){let i=!1;e.forEach(r=>(0,u.isOldStructure)(r)?null:i=!0),i&&(yield t._prepareAllowedTagAccessesForTagging())})()}_processTagSelect(e,t,i){var r=this;return(0,l.A)(function*(){if(!r._isRecordIdViewModelAttributeExist(e,t)){r._setTagSelectDisabled(t);return}yield r._setTagSelectRecordSchemaName(e,t,i),r._setTagSelectDisabledAttribute(e,t),yield r.setupSelect(e,t)})()}_setTagSelectDisabledAttribute(e,t){if(!this._isTagSelectDisabledAttributeFilled(t)){if(!this._isTagSelectRecordSchemaNameFilled(t)){this._setTagSelectDisabled(t);return}this._createAndAddTagSelectViewModelDisabledAttribute(e,t),t.disabled=`$${this._getTagSelectDisabledAttributeName(t)}`}}_setTagSelectDisabled(e){e.disabled=!0}_isTagSelectDisabledAttributeFilled(e){return"disabled"in e}_createAndAddTagSelectViewModelDisabledAttribute(e,t){const i=this.getAttributeName(t.recordId),r={from:i,converter:`crt.TagSelectDisabledAttributeConverter: '${i}'`},a=this._getTagSelectDisabledAttributeName(t);this.addViewModelConfigAttribute(e,a,r)}_isRecordIdViewModelAttributeExist(e,t){return this.isViewModelAttributeExist(e,t.recordId)}_setCreateTagRequest(e){var t=this;return(0,l.A)(function*(){if(e.createTag)return;const i=yield t.getListDataSchema(e),r=t.getListItemsAttributeName(e);e.createTag=(0,u.isOldStructure)(e)?t._getCreateTagRequestForOldtructure(e,i):t._getCreateTagRequestForNewStructure(e,i,r)})()}_getCreateTagRequestForOldtructure(e,t){return{request:"crt.OpenOldTagMiniPageRequest",params:{entitySchemaName:e.listSchemaName,action:I.ModelInPageAction.Add,defaultValues:[{attributeName:t.primaryDisplayAttributeName,value:"@event.primaryDisplayFilterValue"}]}}}_getCreateTagRequestForNewStructure(e,t,i){return{request:"crt.CreateRecordRequest",params:{itemsAttributeName:i,defaultValues:[{attributeName:t.primaryDisplayAttributeName,value:"@event.primaryDisplayFilterValue"},{attributeName:u.TAG_ENTITY_SCHEMA_NAME_PAGE_ATTRIBUTE_NAME,value:e.recordSchemaName}],skipUnsavedData:!0}}}_setEditTagRequest(e){e.editTag||(e.editTag=(0,u.isOldStructure)(e)?this._getEditTagRequestForOldStructure(e):this._getEditTagRequestForNewStructure(e))}_getEditTagRequestForOldStructure(e){return{request:"crt.OpenOldTagMiniPageRequest",params:{entitySchemaName:e.listSchemaName,action:I.ModelInPageAction.Edit,recordId:"@event.id"}}}_getEditTagRequestForNewStructure(e){return{request:"crt.UpdateRecordRequest",params:{recordId:"@event.id",itemsAttributeName:this.getListItemsAttributeName(e),trackUnsavedData:!1}}}_setDeleteTagRequest(e){e.deleteTag||(e.deleteTag={request:(0,u.isOldStructure)(e)?"crt.DeleteOldTagRecordRequest":"crt.DeleteRecordRequest",params:{recordId:"@event.id",itemsAttributeName:this.getListItemsAttributeName(e)}})}_setAddTagsInRecordRequest(e){if(e.addTagsInRecord)return;const t=this.getItemsDataSourceName(e);e.addTagsInRecord={request:"crt.AddTagsInRecordRequest",params:{dataSourceName:t,tagIds:"@event.tagIds",recordId:e.recordId,recordSchemaName:e.recordSchemaName,tagInRecordSourceSchemaName:e.tagInRecordSourceSchemaName}}}_setDeleteTagInRecordRequest(e){if(e.deleteTagInRecord)return;const t=this.getItemsDataSourceName(e);e.deleteTagInRecord={request:"crt.DeleteTagInRecordRequest",params:{dataSourceName:t,id:"@event.id"}}}_setTagSelectRecordSchemaName(e,t,i){var r=this;return(0,l.A)(function*(){if(r._isTagSelectRecordSchemaNameFilled(t))return;const a=yield r._getRecordSchemaName(e,t,i);a&&(t.recordSchemaName=a)})()}_isTagSelectRecordSchemaNameFilled(e){return!!e.recordSchemaName}_getRecordSchemaName(e,t,i){if(!e?.viewModelConfig?.attributes||!i?.length)return Promise.resolve(null);const[r,a]=this._getRecordIdAttributeModelPaths(e.viewModelConfig.attributes,t.recordId);return this._getRecordSchemaNameFromModel(r,a,i)}_getRecordIdAttributeModelPaths(e,t){const i=this.getAttributeName(t),s=e[i]?.modelConfig?.path?.split(".");return!s||s.length<2?["",""]:[s[0],s[1]]}_getRecordSchemaNameFromModel(e,t,i){var r=this;return(0,l.A)(function*(){if(!e||!t)return null;const a=i.find(f=>f.name===e);if(!a)return null;const s=yield(0,A.lastValueFrom)(a.getSchema()),n=s.findAttributeByName(t);if(!n)return null;const c=n.referenceSchemaName??null,d=s.dataSourceConfig?.config?.entitySchemaName;return c||r._getEntitySchemaNameFromDataSchema(d,n)})()}_getEntitySchemaNameFromDataSchema(e,t){if(t.attributeType===I.DataSchemaAttributeType.OwnAttribute)return Promise.resolve(e);const i=t.path.split(".");return this._findEntitySchemaNameByColumnPath(e,i)}_findEntitySchemaNameByColumnPath(e,t){var i=this;return(0,l.A)(function*(){if(!e)return null;const r=t.shift();if(!r)return e;const s=(yield i.getDataSchema(e)).attributes.find(n=>n.name===r);return s?.referenceSchemaName?i._findEntitySchemaNameByColumnPath(s.referenceSchemaName,t):e})()}_getTagSelectDisabledAttributeName(e){return`${e.name}_Disabled`}_prepareViewConfig(e){e.selectSchemaName=this._getSelectSchemaName(e),e.selectColumnName=u.DEFAULT_TAG_COLUMN_NAME_TAG_IN_RECORD_SCHEMA,e.recordRelationColumnName=this._getRecordRelationColumnName(e)}_getSelectSchemaName(e){return(0,u.isOldStructure)(e)?e.tagInRecordSourceSchemaName:u.DEFAULT_TAG_IN_RECORD_SOURCE_SCHEMA_NAME}_getRecordRelationColumnName(e){return(0,u.isOldStructure)(e)?u.OLD_RECORD_COLUMN_NAME_TAG_IN_RECORD_SCHEMA:u.DEFAULT_RECORD_COLUMN_NAME_TAG_IN_RECORD_SCHEMA}_prepareAllowedTagAccessesForTagging(){var e=this;return(0,l.A)(function*(){e._allowedTagAccessesForTaggingIds=yield(0,u.getAllowedTagAccessesForTagging)(e._tagRightsService)})()}setupSelect(e,t){var i=()=>super.setupSelect,r=this;return(0,l.A)(function*(){r._isTagSelectRecordSchemaNameFilled(t)&&(r._prepareViewConfig(t),yield i().call(r,e,t))})()}setupRequests(e){var t=()=>super.setupRequests,i=this;return(0,l.A)(function*(){yield t().call(i,e),yield i._setCreateTagRequest(e),i._setEditTagRequest(e),i._setDeleteTagRequest(e),i._setAddTagsInRecordRequest(e),i._setDeleteTagInRecordRequest(e)})()}createItemsViewModelFilterAttribute(e){return{from:this.getAttributeName(e.recordId),converter:`crt.TagSelectFilterAttributeConverter: '${e.recordSchemaName}' : ${(0,u.isOldStructure)(e)}`}}createListItemsViewModelFilterAttribute(e){return{value:(0,u.isOldStructure)(e)?(0,u.createOldTagListFilter)(this._userInfo):(0,u.createTagListFilter)([e.recordSchemaName],this._allowedTagAccessesForTaggingIds)}}crtOnModelInit(e,t){var i=this;return(0,l.A)(function*(){const r=e,a=i._getTagSelectViewConfigs(r);return yield i._prepareDataForTagSelects(a),yield Promise.all(a.map(s=>i._processTagSelect(r,s,t))),e})()}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=o.\u0275\u0275getInheritedFactory(Te)))(i||Te)}})()}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:Te,factory:Te.\u0275fac})}}class it{_modifyInputType(e,t,i){const r=e.control.replace("$",""),a=t.attributes[r]?.modelConfig?.path;if(a){const s=this._getDataSchemaAttributeByPath(a,i);I.DataValueType.WEB_TEXT&&s?.dataValueType===I.DataValueType.WEB_TEXT&&(e.type="crt.WebInput")}}_getDataSchemaAttributeByPath(e,t){const[i,r]=e.split("."),a=t.dataSchemas[i]?.attributes;let s;for(const n in a)if(a[n].path===r){s=a[n];break}return s}crtOnViewModelInit(e,t,i){var r=this;return(0,l.A)(function*(){const a=e,s=g.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.Input",a.viewConfig),n=g.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.WebInput",a.viewConfig);return s.forEach(c=>{r._modifyInputType(c.viewConfig,a.viewModelConfig,i)}),n.forEach(c=>{r._modifyInputType(c.viewConfig,a.viewModelConfig,i)}),e})()}static{this.\u0275fac=function(t){return new(t||it)}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:it,factory:it.\u0275fac})}}var D=y(10534);const Ut={type:"string",maxLinesCount:2,maxLineLength:10},qt={type:"number",thousandAbbreviation:{enabled:!0}},Nt="DISABLE_CHART_WIDGET_AXES_FORMATTING_ADAPTATION";class ve{constructor(e,t,i){this._entitySchemaService=t,this._entitySchemaProvider=i,this._isAdaptionDisabled=!!e[Nt]}_getWidgetViewConfigs(e){return g.MetadataSchemaUtils.getViewConfigInfoByPropertyForValues("type",["crt.ChartWidget"],e).map(t=>t?.viewConfig)}_adaptAxesFormatting(e){var t=this;return(0,l.A)(function*(){const{scales:i,series:r}=e?.config??{},a=i?.xAxis??{};!t._isDefaultXAxisFormat(a)||!(yield t._isAllSeriesGroupingByNumericColumn(r))||(a.formatting=qt)})()}_isDefaultXAxisFormat(e){return(0,_.isEqual)(e?.formatting,Ut)}_isAllSeriesGroupingByNumericColumn(e){var t=this;return(0,l.A)(function*(){if(!e?.length)return!1;for(const i of e)if(!(yield t._isSeriesGroupingByNumericColumn(i)))return!1;return!0})()}_isSeriesGroupingByNumericColumn(e){var t=this;return(0,l.A)(function*(){const{schemaName:i,grouping:r}=e?.data?.providing??{};if(r?.type!==D.ChartGroupingType.ByValue)return!1;const a=r.column?.expression?.columnPath;if(!i||!a)return!1;const s=yield(0,A.firstValueFrom)(t._entitySchemaProvider.getSchemaByName(i)),n=yield(0,A.firstValueFrom)(t._entitySchemaService.getEntitySchemaColumnsInformationByPath(s.uId,a));return g.NUMERIC_DATA_VALUE_TYPES.includes(n?.dataValueType)})()}crtOnMetaDataInit(e){var t=this;return(0,l.A)(function*(){if(t._isAdaptionDisabled)return e;const i=e,r=t._getWidgetViewConfigs(i.viewConfig).map(a=>t._adaptAxesFormatting(a));return yield Promise.all(r),e})()}static{this.\u0275fac=function(t){return new(t||ve)(o.\u0275\u0275inject(g.FEATURE_VALUES),o.\u0275\u0275inject(g.EntitySchemaService),o.\u0275\u0275inject(g.EntitySchemaProvider))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:ve,factory:ve.\u0275fac})}}const ht=new o.InjectionToken("Represents a factory of widget data providing metadata compressors"),Rt=new o.InjectionToken("Represents a list of widget element types that support data source");class Ne{constructor(e,t,i){this._featureService=e,this._widgetDataProvidingMetadataCompressorFactory=i,this._supportedDataSourceWidgetElementTypes=t??[]}_isWidgetDataSourceSupported(){const e=this._featureService.getFeatureState(D.DISABLE_SUPPORT_WIDGET_DATA_SOURCE_FEATURE_NAME).pipe((0,P.first)(),(0,P.map)(Boolean),(0,P.map)(t=>!t));return(0,A.lastValueFrom)(e)}_getWidgetViewConfigs(e){return g.MetadataSchemaUtils.getViewConfigInfoByPropertyForValues("type",this._supportedDataSourceWidgetElementTypes,e).map(t=>t?.viewConfig).filter(t=>!!t?.name&&!!t?.config)}_compressWidgetDataProvidingMetadata(e,t){this._widgetDataProvidingMetadataCompressorFactory.create(e.type)?.compress(e.name,t)}crtOnMetaDataChanged(e){var t=this;return(0,l.A)(function*(){if(!(yield t._isWidgetDataSourceSupported()))return e;const i=e;return t._getWidgetViewConfigs(i.viewConfig).forEach(r=>t._compressWidgetDataProvidingMetadata(r,i)),e})()}static{this.\u0275fac=function(t){return new(t||Ne)(o.\u0275\u0275inject(S.FeatureService),o.\u0275\u0275inject(Rt,8),o.\u0275\u0275inject(ht))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:Ne,factory:Ne.\u0275fac})}}function Wt(){return N.FactoryProvider.create({token:ht,mappings:[{predicate:D.CHART_WIDGET_VIEW_ELEMENT_TYPE,injectable:D.ChartWidgetDataProvidingMetadataCompressor},{predicate:D.INDICATOR_WIDGET_VIEW_ELEMENT_TYPE,injectable:D.IndicatorWidgetDataProvidingMetadataCompressor},{predicate:D.GAUGE_WIDGET_VIEW_ELEMENT_TYPE,injectable:D.IndicatorWidgetDataProvidingMetadataCompressor}]})}class Re{static for(...e){return{ngModule:Re,providers:[{provide:m.CRT_DESIGN_TIME_METADATA_POSTPROCESSOR,useFactory:(t,i)=>new Ne(t,e,i),deps:[S.FeatureService,ht],multi:!0}]}}static{this.\u0275fac=function(t){return new(t||Re)}}static{this.\u0275mod=o.\u0275\u0275defineNgModule({type:Re})}static{this.\u0275inj=o.\u0275\u0275defineInjector({providers:[Wt()],imports:[D.ChartWidgetDataProvidingMetadataCompressorModule,D.IndicatorWidgetDataProvidingMetadataCompressorModule]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&o.\u0275\u0275setNgModuleScope(Re,{imports:[D.ChartWidgetDataProvidingMetadataCompressorModule,D.IndicatorWidgetDataProvidingMetadataCompressorModule]})})();const _t=new o.InjectionToken("Represents a factory of widget data providing metadata generators");class Pe{constructor(e,t,i){this._featureService=e,this._widgetDataProvidingMetadataGeneratorFactory=i,this._supportedDataSourceWidgetElementTypes=t??[]}_isWidgetDataSourceSupported(){const e=this._featureService.getFeatureState(D.DISABLE_SUPPORT_WIDGET_DATA_SOURCE_FEATURE_NAME).pipe((0,P.first)(),(0,P.map)(Boolean),(0,P.map)(t=>!t));return(0,A.lastValueFrom)(e)}_getWidgetViewConfigs(e){return g.MetadataSchemaUtils.getViewConfigInfoByPropertyForValues("type",this._supportedDataSourceWidgetElementTypes,e).map(t=>t?.viewConfig).filter(t=>!!t?.name&&!!t?.config)}_generateWidgetDataProvidingMetadata(e,t){return this._widgetDataProvidingMetadataGeneratorFactory.create(e.type).generate(e,t)}crtOnMetaDataInit(e){var t=this;return(0,l.A)(function*(){if(!(yield t._isWidgetDataSourceSupported()))return e;const i=e;return t._getWidgetViewConfigs(i.viewConfig).map(r=>t._generateWidgetDataProvidingMetadata(r,i)).forEach(r=>(0,_.defaultsDeep)(i,r)),e})()}static{this.\u0275fac=function(t){return new(t||Pe)(o.\u0275\u0275inject(S.FeatureService),o.\u0275\u0275inject(Rt,8),o.\u0275\u0275inject(_t))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:Pe,factory:Pe.\u0275fac})}}function Ht(){return N.FactoryProvider.create({token:_t,mappings:[{predicate:D.CHART_WIDGET_VIEW_ELEMENT_TYPE,injectable:D.ChartWidgetDataProvidingMetadataGenerator},{predicate:D.GAUGE_WIDGET_VIEW_ELEMENT_TYPE,injectable:D.IndicatorWidgetDataProvidingMetadataGenerator},{predicate:D.INDICATOR_WIDGET_VIEW_ELEMENT_TYPE,injectable:D.IndicatorWidgetDataProvidingMetadataGenerator}]})}class w{static for(...e){const t=(r,a)=>new Pe(r,e,a),i=[S.FeatureService,_t];return{ngModule:w,providers:[{provide:m.CRT_METADATA_PREPROCESSOR,useFactory:t,deps:i,multi:!0},{provide:m.CRT_DESIGN_TIME_METADATA_PREPROCESSOR,useFactory:t,deps:i,multi:!0}]}}static{this.\u0275fac=function(t){return new(t||w)}}static{this.\u0275mod=o.\u0275\u0275defineNgModule({type:w})}static{this.\u0275inj=o.\u0275\u0275defineInjector({providers:[Ht()],imports:[D.ChartWidgetDataProvidingMetadataGeneratorModule,D.IndicatorWidgetDataProvidingMetadataGeneratorModule]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&o.\u0275\u0275setNgModuleScope(w,{imports:[D.ChartWidgetDataProvidingMetadataGeneratorModule,D.IndicatorWidgetDataProvidingMetadataGeneratorModule]})})();class Me{constructor(e){this._featureService=e,this._chartWidgetName="crt.ChartWidget",this._indicatorWidgetName="crt.IndicatorWidget",this._gaugeWidgetName="crt.GaugeWidget"}_getWidgetsArray(e){const t=g.MetadataSchemaUtils.getViewConfigInfoByProperty("type",this._chartWidgetName,e.viewConfig),i=g.MetadataSchemaUtils.getViewConfigInfoByProperty("type",this._indicatorWidgetName,e.viewConfig),r=g.MetadataSchemaUtils.getViewConfigInfoByProperty("type",this._gaugeWidgetName,e.viewConfig);return[...t,...i,...r]}_getWidgetName(e){return e.name.replace(/\./g,"_")}_getDataSetSortinAttributeName(e){return`${e.split(" ").join("").replace(/\./g,"_")}_ListDataDSSorting`}get _isDrillDownFeatureEnabled(){return(0,A.lastValueFrom)(this._featureService.getFeatureState(D.CHART_WIDGET_DRILLDOWN_FEATURE_NAME))}crtOnModelInit(e,t){var i=this;return(0,l.A)(function*(){const r=e,a=i._getWidgetsArray(r);for(const s of a){const n=s?.viewConfig;let c=r.viewModelConfig.attributes;c||(c=r.viewModelConfig.attributes={});const d=i._getWidgetName(n),f=`${m.DYNAMIC_DATA_SOURCE_PREFIX}_${d}`,p=i._getDataSetSortinAttributeName(f),b=`${f}_ListConfig`,C=`${f}_ListData`,E=`${C}_SearchValue`,T=`${C}_SearchFilter`;c[b]={value:[]},c[`${f}_UserProfileData`]={value:[]},c[C]={isCollection:!0,modelConfig:{path:`${f}_ListDataDS`,sortingConfig:{attributeName:p},filterAttributes:[{name:T,loadOnChange:!0}]},viewModelConfig:{attributes:{}}},p&&(c[p]={value:[]}),c[E]={value:""},c[T]={from:E,converter:`crt.WidgetSearchFilterAttributeConverter: '${C}' : '${b}'`}}return e})()}crtOnViewModelInit(e,t,i){var r=this;return(0,l.A)(function*(){const a=e,s=r._getWidgetsArray(a);for(const n of s){const c=n?.viewConfig,d=r._getWidgetName(c),f=`${m.DYNAMIC_DATA_SOURCE_PREFIX}_${d}`,p=`${f}_ListDataDS`,b=`${f}_ListConfig`,C=`${f}_ListData`,E=`${f}_UserProfileData`,T=`${C}_SearchValue`;c.listData=`$${C}`,c.listConfig=`$${b}`,c.userProfileData=`$${E}`,c.searchValue=`$${T}`,c.drillDown={request:"crt.WidgetDrilldownRequest",params:{dataSourceName:p,listConfigAttributeName:b,listDataAttributeName:C,parameters:[],config:{schemaName:"@event.schemaName",groupByValue:"@event.groupByValue",pagingConfig:"@event.pagingConfig",sortingConfig:"@event.sortingConfig",groupBy:"@event.groupBy",aggregateBy:"@event.aggregateBy",columns:"@event.columns",filters:"@event.filters",dependencies:"@event.dependencies"}}},c.paginationChange=gt(p),c.getProfileColumns={request:"crt.AnalyticsDataGridGetColumnsRequest",params:{userProfileDataAttributeName:E,widgetAttributePrefix:f,drilldownConfig:"@event.drilldownConfig",schemaName:"@event.schemaName",isDefault:!1}},c.columnsChange={request:"crt.AnalyticsDataGridSaveToProfileRequest",params:{schemaName:"@event.schemaName",isDefault:!1,dataTableData:"@event.dataTableData",listConfigAttributeName:b}},c.searchFilterChange={request:"crt.SearchFilterRequest",params:{value:"@event.value",searchValueAttributeName:T}}}return e})()}crtOnMetaDataInit(e){var t=this;return(0,l.A)(function*(){if(!(yield t._isDrillDownFeatureEnabled))return e;const i=e,r=t._getWidgetsArray(i);for(const a of r)!a.viewConfig||a.viewConfig?.pagingConfig||(a.viewConfig.pagingConfig=pt(),a.viewConfig.fullScreenStateChanged??={request:"crt.WidgetFullScreenStateChangesRequest",params:{widgetName:a.viewConfig.name,fullScreenState:"@event"}});return e})()}static{this.\u0275fac=function(t){return new(t||Me)(o.\u0275\u0275inject(S.FeatureService))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:Me,factory:Me.\u0275fac})}}class k{static{this.\u0275fac=function(t){return new(t||k)}}static{this.\u0275mod=o.\u0275\u0275defineNgModule({type:k})}static{this.\u0275inj=o.\u0275\u0275defineInjector({providers:[{provide:m.CRT_METADATA_PREPROCESSOR,useClass:Me,multi:!0},{provide:m.CRT_METADATA_PREPROCESSOR,useClass:ve,multi:!0}],imports:[w.for(D.CHART_WIDGET_VIEW_ELEMENT_TYPE,D.INDICATOR_WIDGET_VIEW_ELEMENT_TYPE,D.GAUGE_WIDGET_VIEW_ELEMENT_TYPE)]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&o.\u0275\u0275setNgModuleScope(k,{imports:[w]})})();const zt={"zh-TW":JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"\u6C92\u6709\u53EF\u53D6\u7528\u7684\u5831\u544A","GoToPrintablesSetupCaption":"\u524D\u5F80\u5831\u544A\u8A2D\u5B9A"}}'),"hr-HR":JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"Nema dostupnih izvje\u0161taja","GoToPrintablesSetupCaption":"Idi na postavke izvje\u0161taja"}}'),"bg-BG":JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"\u041D\u044F\u043C\u0430 \u043D\u0430\u043B\u0438\u0447\u043D\u0438 \u043E\u0442\u0447\u0435\u0442\u0438","GoToPrintablesSetupCaption":"\u041E\u0442\u0438\u0434\u0438 \u0432 \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0430 \u043D\u0430 \u043E\u0442\u0447\u0435\u0442\u0430"}}'),"zh-CN":JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"There are no available reports","GoToPrintablesSetupCaption":"Go to report setup"}}'),"vi-VN":JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"There are no available reports","GoToPrintablesSetupCaption":"Go to report setup"}}'),"uk-UA":JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"\u041D\u0435\u043C\u0430\u0454 \u0434\u043E\u0441\u0442\u0443\u043F\u043D\u0438\u0445 \u0437\u0432\u0456\u0442\u0456\u0432","GoToPrintablesSetupCaption":"\u041F\u0435\u0440\u0435\u0439\u0442\u0438 \u0434\u043E \u043D\u0430\u043B\u0430\u0448\u0442\u0443\u0432\u0430\u043D\u043D\u044F \u0437\u0432\u0456\u0442\u0443"}}'),"tr-TR":JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"There are no available reports","GoToPrintablesSetupCaption":"Go to report setup"}}'),"th-TH":JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"There are no available reports","GoToPrintablesSetupCaption":"Go to report setup"}}'),"sv-SE":JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"There are no available reports","GoToPrintablesSetupCaption":"Go to report setup"}}'),"sq-AL":JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"Nuk ka raporte t\xEB disponueshme","GoToPrintablesSetupCaption":"Shko te krijimi i raportit"}}'),"ro-RO":JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"Nu exist\u0103 rapoarte disponibile","GoToPrintablesSetupCaption":"Merge\u021Bi la configurarea raportului"}}'),"pt-PT":JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"There are no available reports","GoToPrintablesSetupCaption":"Go to report setup"}}'),"pt-BR":JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"N\xE3o existem relat\xF3rios dispon\xEDveis","GoToPrintablesSetupCaption":"Ir para as configura\xE7\xF5es de relat\xF3rios"}}'),"pl-PL":JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"Brak dost\u0119pnych raport\xF3w","GoToPrintablesSetupCaption":"Przejd\u017A do konfiguracji raportu"}}'),"nl-NL":JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"There are no available reports","GoToPrintablesSetupCaption":"Go to report setup"}}'),"lv-LV":JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"There are no available reports","GoToPrintablesSetupCaption":"Go to report setup"}}'),"ko-KR":JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"\uC0AC\uC6A9 \uAC00\uB2A5\uD55C \uBCF4\uACE0\uC11C\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4","GoToPrintablesSetupCaption":"\uBCF4\uACE0\uC11C \uC124\uC815\uC73C\uB85C \uC774\uB3D9"}}'),"ja-JP":JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"\u5229\u7528\u53EF\u80FD\u306A\u30EC\u30DD\u30FC\u30C8\u306F\u3042\u308A\u307E\u305B\u3093","GoToPrintablesSetupCaption":"\u30EC\u30DD\u30FC\u30C8\u306E\u8A2D\u5B9A\u306B\u79FB\u52D5"}}'),"it-IT":JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"Non ci sono report disponibili","GoToPrintablesSetupCaption":"Vai alla configurazione del report"}}'),"id-ID":JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"Tidak ada laporan yang tersedia","GoToPrintablesSetupCaption":"Pergi ke pengaturan laporan"}}'),"hu-HU":JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"Nincsenek el\xE9rhet\u0151 jelent\xE9sek","GoToPrintablesSetupCaption":"L\xE9pjen a jelent\xE9s be\xE1ll\xEDt\xE1s\xE1hoz"}}'),"he-IL":JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"There are no available reports","GoToPrintablesSetupCaption":"Go to report setup"}}'),"fr-FR":JSON.parse(`{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"Il n'y a aucun rapport disponible","GoToPrintablesSetupCaption":"Aller \xE0 la configuration du rapport"}}`),"es-ES":JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"No hay informes disponibles","GoToPrintablesSetupCaption":"Ir a la configuraci\xF3n de reportes"}}'),"de-DE":JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"Es gibt keine verf\xFCgbaren Berichte","GoToPrintablesSetupCaption":"Zum Berichts-Setup"}}'),"cs-CZ":JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"There are no available reports","GoToPrintablesSetupCaption":"Go to report setup"}}'),"ar-SA":JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"\u0644\u0627 \u062A\u0648\u062C\u062F \u062A\u0642\u0627\u0631\u064A\u0631 \u0645\u062A\u0627\u062D\u0629","GoToPrintablesSetupCaption":"\u0627\u0630\u0647\u0628 \u0644\u0644\u0625\u0628\u0644\u0627\u063A \u0639\u0646 \u0625\u0639\u062F\u0627\u062F"}}'),"en-US":JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"There are no available reports","GoToPrintablesSetupCaption":"Go to report setup"}}'),"ru-RU":JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"\u041E\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u044E\u0442 \u043E\u0442\u0447\u0435\u0442\u044B \u0434\u043E\u0441\u0442\u0443\u043F\u043D\u044B\u0435 \u0434\u043B\u044F \u043F\u0435\u0447\u0430\u0442\u0438","GoToPrintablesSetupCaption":"\u041F\u0435\u0440\u0435\u0439\u0442\u0438 \u043A \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0435 \u043E\u0442\u0447\u0435\u0442\u043E\u0432"}}')};class rt{static{this.\u0275fac=function(t){return new(t||rt)}}static{this.\u0275mod=o.\u0275\u0275defineNgModule({type:rt})}static{this.\u0275inj=o.\u0275\u0275defineInjector({providers:[u.DataGridFilterOptionsBackwardCompatibilityModifier,dt.FolderTreeFilterOptionsBackwardCompatibilityModifier,u.DataGridDefaultBulkActionsCreator,u.GalleryDefaultBulkActionsCreator,R.DATA_GRID_CELL_VIEW_CONFIG_CREATOR_FACTORY_PROVIDER,R.DATA_GRID_EDITING_CELL_VIEW_CONFIG_CREATOR_FACTORY_PROVIDER,R.FILE_LIST_CELL_VIEW_CONFIG_CREATOR_FACTORY_PROVIDER,{provide:m.CRT_METADATA_PREPROCESSOR,useClass:L,multi:!0},{provide:m.CRT_METADATA_PREPROCESSOR,useClass:ee,multi:!0},{provide:m.CRT_METADATA_PREPROCESSOR,useClass:te,multi:!0},{provide:m.CRT_METADATA_PREPROCESSOR,useClass:ae,multi:!0},{provide:m.CRT_METADATA_PREPROCESSOR,useClass:se,multi:!0},{provide:m.CRT_METADATA_PREPROCESSOR,useClass:Z,multi:!0},{provide:m.CRT_METADATA_PREPROCESSOR,useClass:ie,multi:!0},{provide:m.CRT_METADATA_PREPROCESSOR,useClass:re,multi:!0},{provide:m.CRT_METADATA_PREPROCESSOR,useClass:Q,multi:!0},{provide:m.CRT_METADATA_PREPROCESSOR,useClass:De,multi:!0},{provide:m.CRT_METADATA_PREPROCESSOR,useClass:ce,multi:!0},{provide:m.CRT_METADATA_PREPROCESSOR,useClass:ne,multi:!0},{provide:m.CRT_METADATA_PREPROCESSOR,useClass:H,multi:!0},{provide:m.CRT_METADATA_PREPROCESSOR,useClass:ke,multi:!0},{provide:m.CRT_METADATA_PREPROCESSOR,useClass:tt,multi:!0},{provide:m.CRT_METADATA_PREPROCESSOR,useClass:Fe,multi:!0},{provide:m.CRT_METADATA_PREPROCESSOR,useClass:Y,multi:!0},{provide:m.CRT_METADATA_PREPROCESSOR,useClass:me,multi:!0},S.DcmSettingsService,Se,G,x,M,S.PrintablesService,g.FileDownloaderService,{provide:m.CRT_METADATA_PREPROCESSOR,useClass:Oe,multi:!0},{provide:m.CRT_METADATA_PREPROCESSOR,useClass:oe,multi:!0},{provide:m.CRT_METADATA_PREPROCESSOR,useClass:Xe,multi:!0},{provide:m.CRT_METADATA_PREPROCESSOR,useClass:Ue,multi:!0},{provide:m.CRT_METADATA_PREPROCESSOR,useClass:ze,multi:!0},{provide:m.CRT_METADATA_PREPROCESSOR,useClass:Ye,multi:!0},{provide:m.CRT_METADATA_PREPROCESSOR,useClass:it,multi:!0},{provide:m.CRT_METADATA_PREPROCESSOR,useClass:Be,multi:!0},{provide:m.CRT_METADATA_PREPROCESSOR,useClass:xe,multi:!0},{provide:m.CRT_METADATA_PREPROCESSOR,useClass:et,multi:!0},{provide:m.CRT_METADATA_PREPROCESSOR,useClass:J,multi:!0},{provide:m.CRT_METADATA_PREPROCESSOR,useClass:qe,multi:!0},{provide:m.CRT_METADATA_PREPROCESSOR,useClass:We,multi:!0},{provide:m.CRT_METADATA_PREPROCESSOR,useClass:Ve,multi:!0},{provide:m.CRT_METADATA_PREPROCESSOR,useClass:we,multi:!0},{provide:m.CRT_METADATA_PREPROCESSOR,useClass:Ee,multi:!0},{provide:m.CRT_METADATA_PREPROCESSOR,useClass:Te,multi:!0},{provide:m.CRT_METADATA_PREPROCESSOR,useClass:Ke,multi:!0},{provide:m.CRT_METADATA_PREPROCESSOR,useClass:Ze,multi:!0},{provide:m.CRT_METADATA_PREPROCESSOR,useClass:Gt,multi:!0},{provide:m.CRT_METADATA_PREPROCESSOR,useClass:fe,multi:!0},{provide:S.LICENSE_RESTRICTION_OPERATION_CODES,useValue:Mt.CAN_MANAGE_SUMMARIES_LICENSE_OPERATION_CODE,multi:!0},{provide:S.LICENSE_RESTRICTION_OPERATION_CODES,useValue:Ct,multi:!0},{provide:S.LICENSE_RESTRICTION_OPERATION_CODES,useValue:yt,multi:!0},{provide:S.LICENSE_RESTRICTION_OPERATION_CODES,useValue:It,multi:!0},{provide:m.CRT_METADATA_PREPROCESSOR,useClass:$e,multi:!0},{provide:m.CRT_METADATA_PREPROCESSOR,useClass:Qe,multi:!0}],imports:[st.CommonModule,Ie,O.withModifiers([["crt.DataGrid",u.DataGridFilterOptionsBackwardCompatibilityModifier]]),O.withModifiers([["crt.FolderTree",dt.FolderTreeFilterOptionsBackwardCompatibilityModifier]]),k,Ae,de,ue,B.withCreators([["crt.DataGrid",u.DataGridDefaultBulkActionsCreator],["crt.Gallery",u.GalleryDefaultBulkActionsCreator]]),N.CrtLibTranslateModule.forRoot({i18n:zt}),U.ComboboxUtilsModule]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&o.\u0275\u0275setNgModuleScope(rt,{imports:[st.CommonModule,Ie,O,O,k,Ae,de,ue,B,N.CrtLibTranslateModule,U.ComboboxUtilsModule]})})();class at{_getHeaders(e){return g.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.HeaderContainer",e.viewConfig)}crtOnModelInit(e,t){const i=e,r=i?.viewModelConfig?.attributes,a=this._getHeaders(i)[0];if(a){const s="HeaderCaption";r[s]={value:""},a.viewConfig.title=`$${s}`,a.viewConfig.styles={"border-top-left-radius":"8px","border-top-right-radius":"8px"},i.tag?.includes("BaseGridSectionTemplate")&&(a.viewConfig.styles["margin-bottom"]="0px")}return Promise.resolve(e)}static{this.\u0275fac=function(t){return new(t||at)}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:at,factory:at.\u0275fac})}}}}]);
