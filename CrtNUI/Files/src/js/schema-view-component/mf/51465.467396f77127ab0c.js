(self.webpackChunkapp_studio_enterprise_schema_view=self.webpackChunkapp_studio_enterprise_schema_view||[]).push([[51465],{51465:(Z,x,h)=>{h.r(x),h.d(x,{TechnicalUserModule:()=>D});var c=h(5960),r=h(38495),S=h(96590),U=h(85638),T=h(21018);const G={"en-US":JSON.parse('{"Dialog":{"CanCompleteSession":"User session will be terminated within several minutes. Do you want to proceed?","CanCompleteUserSessions":"All user sessions will be complete. Do you want to proceed?","SelectFunctionalRolesPageCaption":"Select functional roles","SelectOrganizationalRolesPageCaption":"Select organizational roles","DeleteRoleCaption":"Do you want to exclude the user from the role?"},"Messages":{"SessionComplete":"Request to end the session was completed successfully","SessionNotComplete":"Request to end the session was completed with errors","SessionsComplete":"Request to end all sessions was completed successfully","SessionsNotComplete":"Request to end all sessions was completed with errors","UserIsNotSaved":"Save the user record before adding it to the roles","OAuthHealthCheckFailed":"OAuth health check failed","CreateDefaultResourceFailed":"Failed to create default resource","TechnicalUserCreationFailed":"User that has such a name already exist. Choose another name for your integration or use the existing user for this integration.","FetchingClientSecretFailed":"Fetching client secret failed","OAuthIntegrationCreationFailed":"Unable to save OAuth integration"},"Captions":{"TechnicalUserLimitState":"Active technical users:"}}'),"ru-RU":JSON.parse('{"Dialog":{"CanCompleteSession":"\u0421\u0435\u0441\u0441\u0438\u044F \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F \u0431\u0443\u0434\u0435\u0442 \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043D\u0430 \u0432 \u0442\u0435\u0447\u0435\u043D\u0438\u0435 \u043D\u0435\u0441\u043A\u043E\u043B\u044C\u043A\u0438\u0445 \u043C\u0438\u043D\u0443\u0442. \u0425\u043E\u0442\u0438\u0442\u0435 \u043F\u0440\u043E\u0434\u043E\u043B\u0436\u0438\u0442\u044C?","CanCompleteUserSessions":"\u0412\u0441\u0435 \u0441\u0435\u0441\u0441\u0438\u0438 \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F \u0431\u0443\u0434\u0443\u0442 \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043D\u044B. \u041F\u0440\u043E\u0434\u043E\u043B\u0436\u0438\u0442\u044C?","SelectFunctionalRolesPageCaption":"\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0444\u0443\u043D\u043A\u0446\u0438\u043E\u043D\u0430\u043B\u044C\u043D\u044B\u0435 \u0440\u043E\u043B\u0438","SelectOrganizationalRolesPageCaption":"\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u043E\u0440\u0433\u0430\u043D\u0438\u0437\u0430\u0446\u0438\u043E\u043D\u043D\u044B\u0435 \u0440\u043E\u043B\u0438","DeleteRoleCaption":"\u0412\u044B \u0445\u043E\u0442\u0438\u0442\u0435 \u0438\u0441\u043A\u043B\u044E\u0447\u0438\u0442\u044C \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F \u0438\u0437 \u0440\u043E\u043B\u0438?"},"Messages":{"SessionComplete":"\u0417\u0430\u043F\u0440\u043E\u0441 \u043D\u0430 \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043D\u0438\u0435 \u0441\u0435\u0441\u0441\u0438\u0438 \u0432\u044B\u043F\u043E\u043B\u043D\u0435\u043D \u0443\u0441\u043F\u0435\u0448\u043D\u043E","SessionNotComplete":"\u0417\u0430\u043F\u0440\u043E\u0441 \u043D\u0430 \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043D\u0438\u0435 \u0441\u0435\u0441\u0441\u0438\u0438 \u0432\u044B\u043F\u043E\u043B\u043D\u0435\u043D c \u043E\u0448\u0438\u0431\u043A\u043E\u0439","SessionsComplete":"\u0417\u0430\u043F\u0440\u043E\u0441 \u043D\u0430 \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043D\u0438\u0435 \u0432\u0441\u0435\u0445 \u0441\u0435\u0441\u0441\u0438\u0439 \u0432\u044B\u043F\u043E\u043B\u043D\u0435\u043D \u0443\u0441\u043F\u0435\u0448\u043D\u043E","SessionsNotComplete":"\u0417\u0430\u043F\u0440\u043E\u0441 \u043D\u0430 \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043D\u0438\u0435 \u0432\u0441\u0435\u0445 \u0441\u0435\u0441\u0441\u0438\u0439 \u0432\u044B\u043F\u043E\u043B\u043D\u0435\u043D c \u043E\u0448\u0438\u0431\u043A\u043E\u0439","UserIsNotSaved":"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u0435 \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F, \u043F\u0440\u0435\u0436\u0434\u0435 \u0447\u0435\u043C \u043D\u0430\u0437\u043D\u0430\u0447\u0430\u0442\u044C \u0435\u043C\u0443 \u0440\u043E\u043B\u0438","OAuthHealthCheckFailed":"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u043E\u0432\u0435\u0440\u043A\u0438 \u0441\u0442\u0430\u0442\u0443\u0441\u0430 OAuth","CreateDefaultResourceFailed":"\u041E\u0448\u0438\u0431\u043A\u0430 \u0441\u043E\u0437\u0434\u0430\u043D\u0438\u044F \u0440\u0435\u0441\u0443\u0440\u0441\u0430 \u043F\u043E \u0443\u043C\u043E\u043B\u0447\u0430\u043D\u0438\u044E","TechnicalUserCreationFailed":"\u041F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044C \u0441 \u0442\u0430\u043A\u0438\u043C \u0438\u043C\u0435\u043D\u0435\u043C \u0443\u0436\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442. \u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0434\u0440\u0443\u0433\u043E\u0435 \u0438\u043C\u044F \u0434\u043B\u044F \u0432\u0430\u0448\u0435\u0439 \u0438\u043D\u0442\u0435\u0433\u0440\u0430\u0446\u0438\u0438 \u0438\u043B\u0438 \u0438\u0441\u043F\u043E\u043B\u044C\u0437\u0443\u0439\u0442\u0435 \u0434\u043B\u044F \u043D\u0435\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u044E\u0449\u0435\u0433\u043E \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F","FetchingClientSecretFailed":"\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u043F\u043E\u043B\u0443\u0447\u0438\u0442\u044C \u0441\u0435\u043A\u0440\u0435\u0442 OAuth \u043A\u043B\u0438\u0435\u043D\u0442\u0430","OAuthIntegrationCreationFailed":"\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0441\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C \u0438\u043D\u0442\u0435\u0433\u0440\u0430\u0446\u0438\u044E OAuth"},"Captions":{"TechnicalUserLimitState":"\u0410\u043A\u0442\u0438\u0432\u043D\u044B\u0445 \u0442\u0435\u0445\u043D\u0438\u0447\u0435\u0441\u043A\u0438\u0445 \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u0435\u0439:"}}')};var o=h(73308),C=h(79772),f=h(59564),i=h(62278),l=h(63721),R=h(35266),v=h(35293),m=h(59131);class g{constructor(t,e){this._httpClient=t,this._queryExecutor=e,this.serviceEndpoint="rest/AdministrationService/"}_getUserSysAdminUnitType(t){var e=this;return(0,o.A)(function*(){const s=new r.EntitySchemaQuery("SysAdminUnit");s.addSchemaColumn("SysAdminUnitTypeValue","SysAdminUnitTypeValue"),s.filters.addSchemaColumnFilterWithParameter(r.ComparisonType.Equal,"Id",t);const n=e._queryExecutor.executeSelectQuery(s).pipe((0,i.map)(d=>d[0].SysAdminUnitTypeValue)),a=yield(0,i.lastValueFrom)(n);return Promise.resolve(a)})()}getCompleteSessionById(t){const e=this.serviceEndpoint+"TerminateSession";return this._httpClient.post(e,{recordId:t})}getCompleteAllSessionsByUserId(t){const e=this.serviceEndpoint+"TerminateUserSessions";return this._httpClient.post(e,{recordId:t})}getAddUserRoles(t,e){const s=this.serviceEndpoint+"AddUserRoles";return this._httpClient.post(s,{roleIds:JSON.stringify(e),userId:t})}getRemoveUserRole(t){const e=this.serviceEndpoint+"RemoveUsersInRoles";return this._httpClient.post(e,{recordIds:JSON.stringify(t),roleIds:"",userIds:""}).pipe((0,i.map)(n=>{const a=JSON.parse(n.RemoveUsersInRolesResult);return{Success:a.Success,DeletedItems:a.DeletedItems,ExceptionMessage:a.ExceptionMessage}}))}createTechnicalUser(t){const e=this.serviceEndpoint+"UpdateOrCreateTechnicalUser",s=(0,v.A)();return this._httpClient.post(e,{Name:t,Id:s,Active:!0}).pipe((0,i.map)(a=>({TechnicalUserId:s,ExceptionMessage:a})),(0,i.catchError)(a=>(0,i.throwError)(()=>new Error(a))))}deleteUser(t){const e=this.serviceEndpoint+"DeleteUser";return this._httpClient.post(e,{userId:t})}getUserSysAdminUnitType(t){var e=this;return(0,o.A)(function*(){return yield e._getUserSysAdminUnitType(t)})()}getUserLink(t,e){return t===4?window.location.origin+window.location.pathname+`#CardModuleV2/UserPageV2/edit/${e}`:t===7?window.location.origin+window.location.pathname+`#Card/TechnicalUsers_FormPage/edit/${e}`:""}static{this.\u0275fac=function(e){return new(e||g)(m.\u0275\u0275inject(l.HttpClient),m.\u0275\u0275inject(R.QueryExecutor))}}static{this.\u0275prov=m.\u0275\u0275defineInjectable({token:g,factory:g.\u0275fac,providedIn:"root"})}}class A{constructor(t){this._httpClient=t,this.serviceEndpoint="rest/OAuthConfigService/"}isOAuthHealthCheckResult(t){return t&&typeof t.HasProblem=="boolean"&&typeof t.IsSystemSettingsFilledIn=="boolean"&&typeof t.IsIdentityServiceAvailable=="boolean"&&typeof t.IsAccessTokenRetrievableForSystemActions=="boolean"&&typeof t.IsDefaultResourceRegistered=="boolean"}getAddDefaultOAuthResource(){const t=this.serviceEndpoint+"AddDefaultResource";return this._httpClient.post(t,{}).pipe((0,i.map)(s=>({success:s.AddDefaultResourceResult.success,errorInfo:s.AddDefaultResourceResult.errorInfo})))}getOAuthHealthCheck(){return this._httpClient.get("api/OAuthHealthCheck").pipe((0,i.catchError)(e=>e.status===500&&e.error&&this.isOAuthHealthCheckResult(e.error)?(0,i.of)(e.error):(0,i.throwError)(()=>new Error(e.message))))}getClientSecret(t){const e=this.serviceEndpoint+"GetClientSecret";return this._httpClient.post(e,{clientAppId:t}).pipe((0,i.map)(n=>n.GetClientSecretResult),(0,i.catchError)(n=>(0,i.throwError)(()=>new Error(n))))}static{this.\u0275fac=function(e){return new(e||A)(m.\u0275\u0275inject(l.HttpClient))}}static{this.\u0275prov=m.\u0275\u0275defineInjectable({token:A,factory:A.\u0275fac,providedIn:"root"})}}let B=class extends r.BaseRequest{};B=(0,c.__decorate)([(0,r.CrtRequest)({type:"crt.AddOAuthIntegrationRequest"})],B);let L=class extends r.BaseRequestHandler{constructor(t,e,s,n){super(),this._administrationService=t,this._oauthService=e,this._notifyService=s,this._translateService=n}_showErrorMessage(t){var e=this;return(0,o.A)(function*(){t&&(yield e._notifyService.show({message:t}))})()}_saveRecord(t){return(0,o.A)(function*(){const e={type:"crt.SaveRecordRequest",preventCardClose:!0,$context:t};return yield t.executeRequest(e)})()}_refreshGrid(t,e,s){return(0,o.A)(function*(){const n={type:"crt.LoadDataRequest",config:{loadType:r.DataSourceLoadType.Reload},$context:s,parameters:[{type:"primaryColumnValue",value:e.primaryAttributeName}],dataSourceName:t};yield r.HandlerChainService.instance.process(n)})()}_handleError(t,e){var s=this;return(0,o.A)(function*(){try{return yield t()}catch{throw new Error(s._translateService.instant(e))}})()}_createTechnicalUser(t){var e=this;return(0,o.A)(function*(){const s=yield e._handleError(()=>(0,i.lastValueFrom)(e._administrationService.createTechnicalUser(t.integrationName)),"Messages.TechnicalUserCreationFailed");if(s?.ExceptionMessage===""){const n="formApiModel";t.$context[n].controls.OAuthClientAppSystemUser.value=s.TechnicalUserId}else throw new Error(e._translateService.instant("Messages.TechnicalUserCreationFailed"))})()}_deleteTechnicalUser(t){var e=this;return(0,o.A)(function*(){const n=yield t.$context["formApiModel"].controls.OAuthClientAppSystemUser.value;yield e._handleError(()=>(0,i.lastValueFrom)(e._administrationService.deleteUser(n)),"Messages.TechnicalUserCreationFailed")})()}_setClientSecret(t){var e=this;return(0,o.A)(function*(){const s="attributes",n="OAuthClientSecretKey",a=t.$context[s].Id,d=yield e._handleError(()=>(0,i.lastValueFrom)(e._oauthService.getClientSecret(a)),"Messages.FetchingClientSecretFailed");if(d?.success)t.$context[n]=d.clientSecret,t.$context[s].IsChanged=!1;else throw new Error(e._translateService.instant("Messages.FetchingClientSecretFailed"))})()}handle(t){var e=this;return(0,o.A)(function*(){try{t.createTechnicalUser&&(yield e._createTechnicalUser(t));const s=t.$context;if(!(yield e._saveRecord(s)))return t.createTechnicalUser&&(yield e._deleteTechnicalUser(t)),yield e._showErrorMessage(e._translateService.instant("Messages.OAuthIntegrationCreationFailed")),!1;const a=yield s.getPrimaryModelName(),d=yield s.getPrimaryDataSchema();yield e._refreshGrid(a,d,s),yield e._setClientSecret(t);const _="IsAppRegistrationStagePassed";return t.$context[_]=!0,!0}catch(s){const n=s;return yield e._showErrorMessage(n.message),!1}})()}};L=(0,c.__decorate)([(0,r.CrtRequestHandler)({type:"crt.AddOAuthIntegrationHandler",requestType:"crt.AddOAuthIntegrationRequest"}),(0,c.__metadata)("design:paramtypes",[g,A,f.NotifyService,C.TranslateService])],L);var E;(function(u){u[u.Organizational=0]="Organizational",u[u.Functional=1]="Functional"})(E||(E={}));let j=class extends r.BaseRequest{};j=(0,c.__decorate)([(0,r.CrtRequest)({type:"crt.AddRolesToTechnicalUserRequest"})],j);let b=class extends r.BaseRequestHandler{constructor(t,e,s){super(),this._administrationService=t,this._translateService=e,this._notifyService=s}_showErrorMessage(t){var e=this;return(0,o.A)(function*(){yield e._notifyService.show({message:t})})()}_refreshGrid(t,e){var s=this;return(0,o.A)(function*(){const n=t.$context,d={type:"crt.LoadDataRequest",scopes:t.scopes,config:{loadType:r.DataSourceLoadType.Reload},$context:n,dataSourceName:e};yield s.handlerChain.process(d)})()}_refreshGrids(t){var e=this;return(0,o.A)(function*(){const s=t.dataSourceNames;for(const n of s)yield e._refreshGrid(t,n)})()}_getLookupPageFeatures(){return{create:{enabled:!1},select:{multiple:!0,selectAll:!0}}}_getCaptionKey(t){return t.rolesType===E.Functional?"Dialog.SelectFunctionalRolesPageCaption":"Dialog.SelectOrganizationalRolesPageCaption"}_getOpenLookupPageRequestConfig(t){const e=t.$context,s=t.scopes;return{type:"crt.OpenSelectionWindowRequest",$context:e,scopes:s,entitySchemaName:"SysAdminUnit",schemaName:"AddRolesSelectionPage",caption:this._translateService.instant(this._getCaptionKey(t)),features:this._getLookupPageFeatures(),afterClosed:n=>this._processLookupPageResult(t,n),filtersConfig:this._getLookupPageFiltersConfig(t)}}_getRoleTypedFilter(t){const e=[];t===E.Functional?e.push(6):e.push(0,1,2,3);const s=new r.ColumnExpression({columnPath:"SysAdminUnitTypeValue"}),n=e.map(a=>new r.ParameterExpression({value:a}));return new r.InFilter(r.ComparisonType.Equal,s,n)}_getLookupPageFiltersConfig(t){const e=t.userId,s=t.rolesType,n="lookupObjectFilter",a=new r.FilterGroup(r.LogicalOperatorType.And),d=new r.CompareFilter(r.ComparisonType.Equal,new r.ColumnExpression({columnPath:"SysUser"}),new r.ParameterExpression({value:e}));a.add(d);const _=new r.FilterGroup(r.LogicalOperatorType.And),O=new r.ColumnExpression({columnPath:"[SysUserInRole:SysRole:Id].Id"}),F=new r.ExistsFilter(O,a,r.ComparisonType.Not_exists);_.add(F),_.add(this._getRoleTypedFilter(s));const te=new r.IsNullFilter(r.ComparisonType.Is_not_null,new r.ColumnExpression({columnPath:"ParentRole"}));_.add(te);const se=new r.CompareFilter(r.ComparisonType.Equal,new r.ColumnExpression({columnPath:"ConnectionType"}),new r.ParameterExpression({value:0}));return _.add(se),{filterAttributes:[{name:n,loadOnChange:!1}],attributesConfig:{[n]:{value:_}}}}_processLookupPageResult(t,e){var s=this;return(0,o.A)(function*(){if(e.canceled)return;const a=t.userId,d=yield e.getLookupValues();if(d.length===0)return;const _=[];d.forEach(O=>{_.push(O.value)}),s._administrationService.getAddUserRoles(a,_).pipe((0,i.map)(function(){var O=(0,o.A)(function*(F){if(F?.AddUserRolesResult){yield s._showErrorMessage(F.AddUserRolesResult);return}yield s._refreshGrids(t)});return function(F){return O.apply(this,arguments)}}())).subscribe()})()}handle(t){var e=this;return(0,o.A)(function*(){if((yield t.$context.PrimaryModelMode)===T.ModelMode.Create){yield e._showErrorMessage(e._translateService.instant("Messages.UserIsNotSaved"));return}const n=e._getOpenLookupPageRequestConfig(t);yield e.handlerChain.process(n),yield e.next?.handle(t)})()}};b=(0,c.__decorate)([(0,r.CrtRequestHandler)({type:"crt.AddRolesToTechnicalUserHandler",requestType:"crt.AddRolesToTechnicalUserRequest"}),(0,c.__metadata)("design:paramtypes",[g,C.TranslateService,f.NotifyService])],b);var y=h(20822);let W=class extends r.BaseRequest{};W=(0,c.__decorate)([(0,r.CrtRequest)({type:"crt.CompleteUserSessionRequest"})],W);let M=class extends r.BaseRequestHandler{constructor(t,e,s,n){super(),this._messageDialogProvider=t,this._administrationService=e,this._translateService=s,this._notifyService=n}_canCompleteSession(){var t=this;return(0,o.A)(function*(){const e=t._messageDialogProvider.open({data:{message:"Dialog.CanCompleteSession",actions:[y.DEFAULT_DIALOG_ACTIONS.NO,y.DEFAULT_DIALOG_ACTIONS.YES]}});return(yield(0,i.lastValueFrom)(e))===y.DEFAULT_DIALOG_ACTIONS.YES.key})()}_refreshGrid(t){var e=this;return(0,o.A)(function*(){const s=t.$context,n=t.scopes,a=t.dataSourceName,d={type:"crt.LoadDataRequest",scopes:n,config:{loadType:r.DataSourceLoadType.Reload},$context:s,dataSourceName:a};yield e.handlerChain.process(d)})()}handle(t){var e=this;return(0,o.A)(function*(){if(!(yield e._canCompleteSession()))return;const s=t.sessionId;e._administrationService.getCompleteSessionById(s).pipe((0,i.map)(function(){var n=(0,o.A)(function*(a){const d=a.TerminateSessionResult===1?"Messages.SessionComplete":"Messages.SessionNotComplete",_=e._translateService.instant(d);yield e._notifyService.show({message:_}),a.TerminateSessionResult===1&&(yield e._refreshGrid(t))});return function(a){return n.apply(this,arguments)}}())).subscribe(),yield e.next?.handle(t)})()}};M=(0,c.__decorate)([(0,r.CrtRequestHandler)({type:"crt.CompleteUserSessionHandler",requestType:"crt.CompleteUserSessionRequest"}),(0,c.__metadata)("design:paramtypes",[y.MessageDialogProvider,g,C.TranslateService,f.NotifyService])],M);let K=class extends r.BaseRequest{};K=(0,c.__decorate)([(0,r.CrtRequest)({type:"crt.CompleteAllUserSessionsRequest"})],K);let P=class extends r.BaseRequestHandler{constructor(t,e,s,n){super(),this._messageDialogProvider=t,this._administrationService=e,this._translateService=s,this._notifyService=n}_canCompleteSession(){var t=this;return(0,o.A)(function*(){const e=t._messageDialogProvider.open({data:{message:"Dialog.CanCompleteUserSessions",actions:[y.DEFAULT_DIALOG_ACTIONS.NO,y.DEFAULT_DIALOG_ACTIONS.YES]}});return(yield(0,i.lastValueFrom)(e))===y.DEFAULT_DIALOG_ACTIONS.YES.key})()}_refreshGrid(t){var e=this;return(0,o.A)(function*(){const s=t.$context,n=t.scopes,a=t.dataSourceName,d={type:"crt.LoadDataRequest",scopes:n,config:{loadType:r.DataSourceLoadType.Reload},$context:s,dataSourceName:a};yield e.handlerChain.process(d)})()}handle(t){var e=this;return(0,o.A)(function*(){if(!(yield e._canCompleteSession()))return;const s=t.userId;e._administrationService.getCompleteAllSessionsByUserId(s).pipe((0,i.map)(function(){var n=(0,o.A)(function*(a){const d=a.TerminateUserSessionsResult===1?"Messages.SessionsComplete":"Messages.SessionsNotComplete",_=e._translateService.instant(d);yield e._notifyService.show({message:_}),a.TerminateUserSessionsResult===1&&(yield e._refreshGrid(t))});return function(a){return n.apply(this,arguments)}}())).subscribe(),yield e.next?.handle(t)})()}};P=(0,c.__decorate)([(0,r.CrtRequestHandler)({type:"crt.CompleteAllUserSessionsHandler",requestType:"crt.CompleteAllUserSessionsRequest"}),(0,c.__metadata)("design:paramtypes",[y.MessageDialogProvider,g,C.TranslateService,f.NotifyService])],P);let J=class extends r.BaseRequest{};J=(0,c.__decorate)([(0,r.CrtRequest)({type:"crt.CreateDefaultOAuthResourceRequest"})],J);let H=class extends r.BaseRequestHandler{constructor(t,e,s,n){super(),this._maskService=t,this._notifyService=e,this._oauthService=s,this._translateService=n,this._hasProblem=!0,this._isSystemSettingsFilledIn=!1,this._isIdentityServiceAvailable=!1,this._isAccessTokenRetrievableForSystemActions=!1,this._isDefaultResourceRegistered=!1,this._oauthHealthCheckMessage=""}_getCanCreateResource(){return this._hasProblem&&this._isSystemSettingsFilledIn&&this._isIdentityServiceAvailable&&this._isAccessTokenRetrievableForSystemActions&&!this._isDefaultResourceRegistered}_getCreateDefaultResource(t){var e=this;return(0,o.A)(function*(){try{const s=yield(0,i.firstValueFrom)(e._oauthService.getOAuthHealthCheck());e._hasProblem=s.HasProblem,e._isSystemSettingsFilledIn=s.IsSystemSettingsFilledIn,e._isIdentityServiceAvailable=s.IsIdentityServiceAvailable,e._isAccessTokenRetrievableForSystemActions=s.IsAccessTokenRetrievableForSystemActions,e._isDefaultResourceRegistered=s.IsDefaultResourceRegistered,e._oauthHealthCheckMessage=s.Message,yield e._tryCreateResource(s,t)}catch{t&&(yield e._showErrorMessage(e._translateService.instant("Messages.OAuthHealthCheckFailed")))}})()}_tryCreateResource(t,e){var s=this;return(0,o.A)(function*(){try{if(!s._hasProblem)return;if(s._getCanCreateResource()){const n=yield(0,i.firstValueFrom)(s._oauthService.getAddDefaultOAuthResource());if(!n.success&&e){const a=n?.errorInfo?.message??s._translateService.instant("Messages.CreateDefaultResourceFailed");yield s._showErrorMessage(a)}else s._hasProblem=!1,s._isDefaultResourceRegistered=!0}else e&&t.Message&&(yield s._showErrorMessage(t.Message))}catch{e&&(yield s._showErrorMessage(s._translateService.instant("Messages.CreateDefaultResourceFailed")))}})()}_showErrorMessage(t){var e=this;return(0,o.A)(function*(){yield e._notifyService.show({message:t})})()}handle(t){var e=this;return(0,o.A)(function*(){const s=t?.showErrorNotification??!1;s&&e._maskService.showBodyMask(),yield e._getCreateDefaultResource(s),t.$context.HasProblem=e._hasProblem,t.$context.IsSystemSettingsFilledIn=e._isSystemSettingsFilledIn,t.$context.IsIdentityServiceAvailable=e._isIdentityServiceAvailable,t.$context.IsAccessTokenRetrievableForSystemActions=e._isAccessTokenRetrievableForSystemActions,t.$context.IsDefaultResourceRegistered=e._isDefaultResourceRegistered,t.$context.HealthCheckMessage=e._oauthHealthCheckMessage,e._maskService.hideBodyMask()})()}};H=(0,c.__decorate)([(0,r.CrtRequestHandler)({type:"crt.CreateDefaultOAuthResourceHandler",requestType:"crt.CreateDefaultOAuthResourceRequest"}),(0,c.__metadata)("design:paramtypes",[f.MaskService,f.NotifyService,A,C.TranslateService])],H);let z=class extends r.BaseRequest{};z=(0,c.__decorate)([(0,r.CrtRequest)({type:"crt.OpenUserCardRequest"})],z);let N=class extends r.BaseRequestHandler{constructor(t,e){super(),this._window=t,this._administrationService=e}handle(t){var e=this;return(0,o.A)(function*(){const s=t.systemUserId,n=yield e._administrationService.getUserSysAdminUnitType(s),a=e._administrationService.getUserLink(n,s);if(a){const d=t.openInNewWindow?"_blank":"_self";e._window.open(a,d)}})()}};N=(0,c.__decorate)([(0,r.CrtRequestHandler)({requestType:"crt.OpenUserCardRequest",type:"crt.OpenUserCardHandler"}),(0,c.__param)(0,(0,r.CrtInject)(S.WINDOW_TOKEN)),(0,c.__metadata)("design:paramtypes",[Window,g])],N);let Y=class extends r.BaseRequest{};Y=(0,c.__decorate)([(0,r.CrtRequest)({type:"crt.OpenOAuthClientPageRequest"})],Y);let q=class extends r.BaseRequestHandler{constructor(t,e,s){super(),this._window=t,this._featureService=e,this._oauthService=s}_redirectTo7xPage(t,e){const s=this._window.location.origin+this._window.location.pathname+`#CardModuleV2/OAuthClientAppPage/${t}/${e}`;this._window.location.replace(s),this._window.location.reload()}_fillClientSecret(t,e){var s=this;return(0,o.A)(function*(){const n=yield(0,i.lastValueFrom)(s._oauthService.getClientSecret(e));t.OAuthClientAppDS_ClientSecretText_Control=n.clientSecret})()}handle(t){var e=this;return(0,o.A)(function*(){const s=t.$context,n=yield s.attributes.CardState;let a="";if(n==="edit"&&(a=s.attributes.Id),!(yield(0,i.lastValueFrom)(e._featureService.getFeatureState("EnableFreedomUIOAuthSection")))){e._redirectTo7xPage(n,a);return}n==="edit"&&(yield e._fillClientSecret(s,a),s.attributes.IsChanged=!1)})()}};q=(0,c.__decorate)([(0,r.CrtRequestHandler)({requestType:"crt.OpenOAuthClientPageRequest",type:"crt.OpenOAuthClientPageHandler"}),(0,c.__param)(0,(0,r.CrtInject)(S.WINDOW_TOKEN)),(0,c.__metadata)("design:paramtypes",[Window,U.FeatureService,A])],q);let Q=class extends r.BaseRequest{};Q=(0,c.__decorate)([(0,r.CrtRequest)({type:"crt.RemoveRoleFromTechnicalUserRequest"})],Q);let k=class extends r.BaseRequestHandler{constructor(t,e,s){super(),this._messageDialogProvider=t,this._administrationService=e,this._notifyService=s}_showErrorMessage(t){var e=this;return(0,o.A)(function*(){t&&(yield e._notifyService.show({message:t}))})()}_refreshGrid(t,e){var s=this;return(0,o.A)(function*(){const n=t.$context,d={type:"crt.LoadDataRequest",scopes:t.scopes,config:{loadType:r.DataSourceLoadType.Reload,useLastLoadParameters:!0},$context:n,dataSourceName:e};yield s.handlerChain.process(d)})()}_refreshGrids(t){var e=this;return(0,o.A)(function*(){const s=t.dataSourceNames;for(const n of s)yield e._refreshGrid(t,n)})()}_canRemoveUserRole(){var t=this;return(0,o.A)(function*(){const e=t._messageDialogProvider.open({data:{message:"Dialog.DeleteRoleCaption",actions:[y.DEFAULT_DIALOG_ACTIONS.NO,y.DEFAULT_DIALOG_ACTIONS.YES]}});return(yield(0,i.lastValueFrom)(e))===y.DEFAULT_DIALOG_ACTIONS.YES.key})()}handle(t){var e=this;return(0,o.A)(function*(){if(!(yield e._canRemoveUserRole()))return;const s=[t.recordId];e._administrationService.getRemoveUserRole(s).pipe((0,i.map)(function(){var n=(0,o.A)(function*(a){a?.Success?yield e._refreshGrids(t):yield e._showErrorMessage(a?.ExceptionMessage)});return function(a){return n.apply(this,arguments)}}()),(0,i.catchError)(function(){var n=(0,o.A)(function*(a){yield e._showErrorMessage(a.message)});return function(a){return n.apply(this,arguments)}}())).subscribe(),yield e.next?.handle(t)})()}};k=(0,c.__decorate)([(0,r.CrtRequestHandler)({type:"crt.RemoveRoleFromTechnicalUserHandler",requestType:"crt.RemoveRoleFromTechnicalUserRequest"}),(0,c.__metadata)("design:paramtypes",[y.MessageDialogProvider,g,f.NotifyService])],k);var ee=h(29957);class I{constructor(t){this._httpClient=t,this.serviceEndpoint="rest/TechnicalUserLimitService/"}getLimitState(){const t=this.serviceEndpoint+"GetLimitState";return this._httpClient.get(t)}static{this.\u0275fac=function(e){return new(e||I)(m.\u0275\u0275inject(l.HttpClient))}}static{this.\u0275prov=m.\u0275\u0275defineInjectable({token:I,factory:I.\u0275fac,providedIn:"root"})}}let X=class extends r.BaseRequest{};X=(0,c.__decorate)([(0,r.CrtRequest)({type:"crt.UpdateTechnicalUserLimitStateRequest"})],X);let $=class extends r.BaseRequestHandler{constructor(t,e){super(),this._technicalUserLimitService=t,this._translateService=e,this._currentLimitLabelCaption="",this._currentLimitLabelValue=""}_getCurrentLimit(){var t=this;return(0,o.A)(function*(){try{const e=yield(0,i.firstValueFrom)(t._technicalUserLimitService.getLimitState());if(e.limit===0&&e.count===0){t._currentLimitLabelValue="",t._currentLimitLabelCaption="";return}t._currentLimitLabelCaption=yield t._translateService.instant("Captions.TechnicalUserLimitState");const s="{0}/{1}";t._currentLimitLabelValue=ee.String.format(s,e.count,e.limit)}catch{t._currentLimitLabelValue=""}})()}handle(t){var e=this;return(0,o.A)(function*(){yield e._getCurrentLimit(),t.$context.CurrentLimitStateLabelCaption=e._currentLimitLabelCaption,t.$context.CurrentLimitStateLabelValue=e._currentLimitLabelValue})()}};$=(0,c.__decorate)([(0,r.CrtRequestHandler)({type:"crt.UpdateTechnicalUserLimitStateHandler",requestType:"crt.UpdateTechnicalUserLimitStateRequest"}),(0,c.__metadata)("design:paramtypes",[I,C.TranslateService])],$);let D=class V{static{this.\u0275fac=function(e){return new(e||V)}}static{this.\u0275mod=m.\u0275\u0275defineNgModule({type:V})}static{this.\u0275inj=m.\u0275\u0275defineInjector({providers:[S.WINDOW_PROVIDER,{provide:U.UrlService,useClass:U.CommonUrlService}],imports:[T.CommonModule,S.CrtLibTranslateModule.forRoot({i18n:G})]})}};D=(0,c.__decorate)([(0,r.CrtModule)({includes:[],converters:[],requestHandlers:[L,b,P,M,H,q,N,k,$],handlerChainServices:[]})],D),function(){(typeof ngJitMode>"u"||ngJitMode)&&m.\u0275\u0275setNgModuleScope(D,{imports:[T.CommonModule,S.CrtLibTranslateModule]})}()},35293:(Z,x,h)=>{h.d(x,{A:()=>f});const r={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let S;const U=new Uint8Array(16);function T(){if(!S&&(S=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!S))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return S(U)}const p=[];for(let i=0;i<256;++i)p.push((i+256).toString(16).slice(1));function w(i,l=0){return p[i[l+0]]+p[i[l+1]]+p[i[l+2]]+p[i[l+3]]+"-"+p[i[l+4]]+p[i[l+5]]+"-"+p[i[l+6]]+p[i[l+7]]+"-"+p[i[l+8]]+p[i[l+9]]+"-"+p[i[l+10]]+p[i[l+11]]+p[i[l+12]]+p[i[l+13]]+p[i[l+14]]+p[i[l+15]]}function G(i,l=0){const R=w(i,l);if(!validate(R))throw TypeError("Stringified UUID is invalid");return R}const o=null;function C(i,l,R){if(r.randomUUID&&!l&&!i)return r.randomUUID();i=i||{};const v=i.random||(i.rng||T)();if(v[6]=v[6]&15|64,v[8]=v[8]&63|128,l){R=R||0;for(let m=0;m<16;++m)l[R+m]=v[m];return l}return w(v)}const f=C}}]);
