(self.webpackChunkapp_studio_enterprise_schema_view=self.webpackChunkapp_studio_enterprise_schema_view||[]).push([[35901],{30268:(W,D,g)=>{g.d(D,{$:()=>P});/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md.
 */function l(s,u,k){var y=document.head||document.getElementsByTagName("head")[0],C=document.createElement("script");typeof u=="function"&&(k=u,u={}),u=u||{},k=k||function(){},C.type=u.type||"text/javascript",C.charset=u.charset||"utf8",C.async="async"in u?!!u.async:!0,C.src=s,u.attrs&&L(C,u.attrs),u.text&&(C.text=String(u.text));var h="onload"in C?S:A;h(C,k),C.onload||S(C,k),y.appendChild(C)}function L(s,u){for(var k in u)s.setAttribute(k,u[k])}function S(s,u){s.onload=function(){this.onerror=this.onload=null,u(null,s)},s.onerror=function(){this.onerror=this.onload=null,u(new Error("Failed to load "+this.src),s)}}function A(s,u){s.onreadystatechange=function(){this.readyState!="complete"&&this.readyState!="loaded"||(this.onreadystatechange=null,u(null,s))}}var O;function P(s,u){return"CKEDITOR"in window?Promise.resolve(CKEDITOR):typeof s!="string"||s.length<1?Promise.reject(new TypeError("CKEditor URL must be a non-empty string.")):(O||(O=P.scriptLoader(s).then(function(k){return u&&u(k),k})),O)}P.scriptLoader=function(s){return new Promise(function(u,k){l(s,function(y){if(O=void 0,y)return k(y);if(!window.CKEDITOR)return k(new Error("Script loaded from editorUrl doesn't provide CKEDITOR namespace."));u(CKEDITOR)})})};function J(s,u){var k=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},y;return function(){clearTimeout(y);for(var C=arguments.length,h=new Array(C),R=0;R<C;R++)h[R]=arguments[R];y=setTimeout(s.bind.apply(s,[k].concat(h)),u)}}},35901:(W,D,g)=>{g.r(D),g.d(D,{CKEDITOR_THEME_STYLE_URL:()=>q,CKEDITOR_URL:()=>G,CrtRichTextEditorComponent:()=>_,CrtRichTextEditorModule:()=>H,CrtRichTextLinkComponent:()=>w,RichTextEditorPreprocessor:()=>F,RichTextEditorSaveHandler:()=>V,RichTextEditorUploadService:()=>v,SelectionActionRequest:()=>Q,SelectionActionsMetadataService:()=>M,SelectionActionsPositionService:()=>B});var l=g(5960),L=g(40297),S=g(56711),A=g(52989),O=g(26472),P=g(70987),J=g(62521),s=g(38495),u=g(59564),k=g(96590),y=g(50456),C=g(20822),h=g(21018),R=g(10990);const oe={"hu-HU":JSON.parse('{"RichTextEditor":{"ToggleToolbar":"Form\xE1z\xE1si lehet\u0151s\xE9gek","UploadAttachments":"V\xE1lassza ki a mell\xE9kleteket","SelectTemplate":"Sablon besz\xFAr\xE1sa"},"RichTextEditorLink":{"SaveLinkButtonCaption":"Ment\xE9s","OpenLinkButtonCaption":"Megnyit\xE1s \xFAj lapon","CloseLinkButtonCaption":"Bez\xE1r","UnlinkLinkButtonCaption":"Link T\xF6rl\xE9se","LinkLabelCaption":"Link c\xEDme","TextLabelCaption":"Megjelen\xEDtend\u0151 sz\xF6veg"}}'),"zh-CN":JSON.parse('{"RichTextEditor":{"ToggleToolbar":"Formatting options","UploadAttachments":"\u9009\u62E9\u9644\u4EF6","SelectTemplate":"\u63D2\u5165\u6A21\u677F"},"RichTextEditorLink":{"SaveLinkButtonCaption":"\u4FDD\u5B58","OpenLinkButtonCaption":"\u5728\u65B0\u6807\u7B7E\u4E2D\u6253\u5F00","CloseLinkButtonCaption":"\u5173\u95ED","UnlinkLinkButtonCaption":"\u53D6\u6D88\u94FE\u63A5","LinkLabelCaption":"\u94FE\u63A5\u5730\u5740","TextLabelCaption":"\u663E\u793A\u5185\u5BB9"}}'),"sq-AL":JSON.parse('{"RichTextEditor":{"ToggleToolbar":"Opsionet e formatimit","UploadAttachments":"P\xEBrzgjidh bashk\xEBngjitjet","SelectTemplate":"Nd\xEBrfut modelin"},"RichTextEditorLink":{"SaveLinkButtonCaption":"Ruaj","OpenLinkButtonCaption":"Hap n\xEB faqe t\xEB re","CloseLinkButtonCaption":"Mbyll","UnlinkLinkButtonCaption":"Shk\xEBput","LinkLabelCaption":"Adresa e linkut","TextLabelCaption":"Teksti i shfaqur"}}'),"en-GB":JSON.parse('{"RichTextEditor":{"ToggleToolbar":"Display toolbar","UploadAttachments":"Select attachments"},"RichTextEditorLink":{"SaveLinkButtonCaption":"Save","OpenLinkButtonCaption":"Open in new tab","CloseLinkButtonCaption":"Close","UnlinkLinkButtonCaption":"Unlink","LinkLabelCaption":"Link address","TextLabelCaption":"Text to display"}}'),"bg-BG":JSON.parse('{"RichTextEditor":{"ToggleToolbar":"\u041E\u043F\u0446\u0438\u0438 \u0437\u0430 \u0444\u043E\u0440\u043C\u0430\u0442\u0438\u0440\u0430\u043D\u0435","UploadAttachments":"\u0418\u0437\u0431\u0435\u0440\u0438 \u043F\u0440\u0438\u043A\u0430\u0447\u0435\u043D\u0438 \u0444\u0430\u0439\u043B\u043E\u0432\u0435","SelectTemplate":"\u0412\u043C\u044A\u043A\u043D\u0438 \u0448\u0430\u0431\u043B\u043E\u043D\u0430"},"RichTextEditorLink":{"SaveLinkButtonCaption":"\u0417\u0430\u043F\u0430\u0437\u0438","OpenLinkButtonCaption":"\u041E\u0442\u0432\u043E\u0440\u0438 \u0432 \u043D\u043E\u0432 \u0440\u0430\u0437\u0434\u0435\u043B","CloseLinkButtonCaption":"\u0417\u0430\u0442\u0432\u043E\u0440\u0438","UnlinkLinkButtonCaption":"\u041F\u0440\u0435\u043A\u0440\u0430\u0442\u0438 \u0432\u0440\u044A\u0437\u043A\u0430\u0442\u0430","LinkLabelCaption":"\u0410\u0434\u0440\u0435\u0441 \u043D\u0430 \u043B\u0438\u043D\u043A\u0430","TextLabelCaption":"\u0422\u0435\u043A\u0441\u0442 \u0437\u0430 \u043F\u043E\u043A\u0430\u0437\u0432\u0430\u043D\u0435"}}'),"zh-TW":JSON.parse('{"RichTextEditor":{"ToggleToolbar":"\u683C\u5F0F\u9078\u9805","UploadAttachments":"\u9009\u62E9\u9644\u4EF6","SelectTemplate":"\u63D2\u5165\u6A21\u677F"},"RichTextEditorLink":{"SaveLinkButtonCaption":"\u5132\u5B58","OpenLinkButtonCaption":"\u5728\u65B0\u6807\u7B7E\u4E2D\u6253\u5F00","CloseLinkButtonCaption":"\u5173\u95ED","UnlinkLinkButtonCaption":"\u53D6\u6D88\u94FE\u63A5","LinkLabelCaption":"\u94FE\u63A5\u5730\u5740","TextLabelCaption":"\u663E\u793A\u5185\u5BB9"}}'),"no-NO":JSON.parse('{"RichTextEditor":{"ToggleToolbar":"Vis verkt\xF8ylinje","UploadAttachments":"Velg vedlegg"},"RichTextEditorLink":{"SaveLinkButtonCaption":"Lagre","OpenLinkButtonCaption":"\xC5pne i ny fane","CloseLinkButtonCaption":"Lukk","UnlinkLinkButtonCaption":"Frakoble","LinkLabelCaption":"Lenke adresse","TextLabelCaption":"Tekst som skal vises"}}'),"ko-KR":JSON.parse('{"RichTextEditor":{"ToggleToolbar":"\uD3EC\uB9F7 \uC635\uC158","UploadAttachments":"\uCCA8\uBD80\uD30C\uC77C \uC120\uD0DD","SelectTemplate":"\uD15C\uD50C\uB9BF \uC0BD\uC785"},"RichTextEditorLink":{"SaveLinkButtonCaption":"\uC644\uB8CC","OpenLinkButtonCaption":"\uC0C8 \uD0ED\uC5D0\uC11C \uC5F4\uAE30","CloseLinkButtonCaption":"\uC885\uACB0","UnlinkLinkButtonCaption":"\uC5F0\uACB0 \uD574\uC81C","LinkLabelCaption":"\uB9C1\uD06C \uC8FC\uC18C","TextLabelCaption":"\uD45C\uC2DC\uD560 \uD14D\uC2A4\uD2B8"}}'),"ja-JP":JSON.parse('{"RichTextEditor":{"ToggleToolbar":"\u66F8\u5F0F\u8A2D\u5B9A","UploadAttachments":"\u6DFB\u4ED8\u30D5\u30A1\u30A4\u30EB\u306E\u9078\u629E","SelectTemplate":"\u30C6\u30F3\u30D7\u30EC\u30FC\u30C8\u306E\u633F\u5165"},"RichTextEditorLink":{"SaveLinkButtonCaption":"\u4FDD\u5B58","OpenLinkButtonCaption":"\u65B0\u3057\u3044\u30BF\u30D6\u3067\u958B\u304F","CloseLinkButtonCaption":"Close","UnlinkLinkButtonCaption":"\u30EA\u30F3\u30AF\u306E\u89E3\u9664","LinkLabelCaption":"\u30EA\u30F3\u30AF\u306E\u30A2\u30C9\u30EC\u30B9","TextLabelCaption":"\u8868\u793A\u3059\u308B\u30C6\u30AD\u30B9\u30C8"}}'),"fr-CA":JSON.parse('{"RichTextEditor":{"ToggleToolbar":"Display toolbar"},"RichTextEditorLink":{"SaveLinkButtonCaption":"Save","OpenLinkButtonCaption":"Open in new tab","CloseLinkButtonCaption":"Close","UnlinkLinkButtonCaption":"Unlink","LinkLabelCaption":"Link address","TextLabelCaption":"Text to display"}}'),zh:JSON.parse('{"RichTextEditor":{"ToggleToolbar":"Display toolbar"},"RichTextEditorLink":{"SaveLinkButtonCaption":"Save","OpenLinkButtonCaption":"Open in new tab","CloseLinkButtonCaption":"Close","UnlinkLinkButtonCaption":"Unlink","LinkLabelCaption":"Link address","TextLabelCaption":"Text to display"}}'),"vi-VN":JSON.parse('{"RichTextEditor":{"ToggleToolbar":"Formatting options","UploadAttachments":"Select attachments","SelectTemplate":"Insert template"},"RichTextEditorLink":{"SaveLinkButtonCaption":"L\u01B0u","OpenLinkButtonCaption":"Open in new tab","CloseLinkButtonCaption":"\u0110\xF3ng","UnlinkLinkButtonCaption":"Unlink","LinkLabelCaption":"Link address","TextLabelCaption":"Text to display"}}'),"tr-TR":JSON.parse('{"RichTextEditor":{"ToggleToolbar":"Formatting options","UploadAttachments":"Select attachments","SelectTemplate":"Insert template"},"RichTextEditorLink":{"SaveLinkButtonCaption":"Kay\u0131t etmek","OpenLinkButtonCaption":"Open in new tab","CloseLinkButtonCaption":"Kapat","UnlinkLinkButtonCaption":"Unlink","LinkLabelCaption":"Link address","TextLabelCaption":"Text to display"}}'),"th-TH":JSON.parse('{"RichTextEditor":{"ToggleToolbar":"Formatting options","UploadAttachments":"Select attachments","SelectTemplate":"Insert template"},"RichTextEditorLink":{"SaveLinkButtonCaption":"\u0E1A\u0E31\u0E19\u0E17\u0E36\u0E01","OpenLinkButtonCaption":"Open in new tab","CloseLinkButtonCaption":"\u0E1B\u0E34\u0E14","UnlinkLinkButtonCaption":"Unlink","LinkLabelCaption":"Link address","TextLabelCaption":"Text to display"}}'),"sv-SE":JSON.parse('{"RichTextEditor":{"ToggleToolbar":"Formatting options","UploadAttachments":"Select attachments","SelectTemplate":"Insert template"},"RichTextEditorLink":{"SaveLinkButtonCaption":"Spara","OpenLinkButtonCaption":"Open in new tab","CloseLinkButtonCaption":"St\xE4ng","UnlinkLinkButtonCaption":"Unlink","LinkLabelCaption":"Link address","TextLabelCaption":"Text to display"}}'),"ro-RO":JSON.parse('{"RichTextEditor":{"ToggleToolbar":"Op\u021Biuni de formatare","UploadAttachments":"Selecta\u021Bi ata\u0219amentele","SelectTemplate":"Inserare template"},"RichTextEditorLink":{"SaveLinkButtonCaption":"Salveaza","OpenLinkButtonCaption":"Deschide \xEEntr-un tab nou","CloseLinkButtonCaption":"Inchideti","UnlinkLinkButtonCaption":"Deconectare","LinkLabelCaption":"Adresa link-ului","TextLabelCaption":"Text de afi\u0219at"}}'),"pt-PT":JSON.parse('{"RichTextEditor":{"ToggleToolbar":"Formatting options","UploadAttachments":"Selecionar anexos","SelectTemplate":"Insert template"},"RichTextEditorLink":{"SaveLinkButtonCaption":"Gravar","OpenLinkButtonCaption":"Abrir novo tabulador","CloseLinkButtonCaption":"Fechar","UnlinkLinkButtonCaption":"Desvincular","LinkLabelCaption":"Link de endere\xE7o","TextLabelCaption":"Texto a ser exibido"}}'),"pt-BR":JSON.parse('{"RichTextEditor":{"ToggleToolbar":"Op\xE7\xF5es de formata\xE7\xE3o","UploadAttachments":"Selecionar anexos","SelectTemplate":"Inserir o modelo"},"RichTextEditorLink":{"SaveLinkButtonCaption":"Salvar","OpenLinkButtonCaption":"Abrir em uma nova aba","CloseLinkButtonCaption":"Fechar","UnlinkLinkButtonCaption":"Desvincular","LinkLabelCaption":"Endere\xE7o do link","TextLabelCaption":"Texto para exibi\xE7\xE3o"}}'),"pl-PL":JSON.parse('{"RichTextEditor":{"ToggleToolbar":"Opcje formatowania","UploadAttachments":"Wybierz za\u0142\u0105czniki","SelectTemplate":"Wstaw szablon"},"RichTextEditorLink":{"SaveLinkButtonCaption":"Zapisz","OpenLinkButtonCaption":"Otw\xF3rz w nowej karcie","CloseLinkButtonCaption":"Zamknij","UnlinkLinkButtonCaption":"Od\u0142\u0105cz","LinkLabelCaption":"Adres linku","TextLabelCaption":"Tekst do wy\u015Bwietlenia"}}'),no:JSON.parse('{"RichTextEditor":{"ToggleToolbar":"Display toolbar"},"RichTextEditorLink":{"SaveLinkButtonCaption":"Save","OpenLinkButtonCaption":"Open in new tab","CloseLinkButtonCaption":"Close","UnlinkLinkButtonCaption":"Unlink","LinkLabelCaption":"Link address","TextLabelCaption":"Text to display"}}'),"nl-NL":JSON.parse('{"RichTextEditor":{"ToggleToolbar":"Formatting options","UploadAttachments":"Select attachments","SelectTemplate":"Insert template"},"RichTextEditorLink":{"SaveLinkButtonCaption":"Opslaan","OpenLinkButtonCaption":"Open in new tab","CloseLinkButtonCaption":"Sluiten","UnlinkLinkButtonCaption":"Unlink","LinkLabelCaption":"Link address","TextLabelCaption":"Text to display"}}'),"lv-LV":JSON.parse('{"RichTextEditor":{"ToggleToolbar":"Formatting options","UploadAttachments":"Select attachments","SelectTemplate":"Insert template"},"RichTextEditorLink":{"SaveLinkButtonCaption":"Save","OpenLinkButtonCaption":"Open in new tab","CloseLinkButtonCaption":"Close","UnlinkLinkButtonCaption":"Unlink","LinkLabelCaption":"Link address","TextLabelCaption":"Text to display"}}'),"kk-KZ":JSON.parse('{"RichTextEditor":{"ToggleToolbar":"Display toolbar","UploadAttachments":"Select attachments"},"RichTextEditorLink":{"SaveLinkButtonCaption":"Save","OpenLinkButtonCaption":"Open in new tab","CloseLinkButtonCaption":"Close","UnlinkLinkButtonCaption":"Unlink","LinkLabelCaption":"Link address","TextLabelCaption":"Text to display"}}'),"it-IT":JSON.parse('{"RichTextEditor":{"ToggleToolbar":"Opzioni di formattazione","UploadAttachments":"Seleziona allegati","SelectTemplate":"Inserisci modello"},"RichTextEditorLink":{"SaveLinkButtonCaption":"Salva","OpenLinkButtonCaption":"Apri in una nuova tab","CloseLinkButtonCaption":"Chiudi","UnlinkLinkButtonCaption":"Scollega","LinkLabelCaption":"Indirizzo del link","TextLabelCaption":"Testo da mostrare"}}'),"id-ID":JSON.parse('{"RichTextEditor":{"ToggleToolbar":"Opsi pemformatan","UploadAttachments":"Pilih lampiran","SelectTemplate":"Sisipkan templat"},"RichTextEditorLink":{"SaveLinkButtonCaption":"Simpan","OpenLinkButtonCaption":"Buka di tab baru","CloseLinkButtonCaption":"Tutup","UnlinkLinkButtonCaption":"Putuskan tautan","LinkLabelCaption":"Alamat tautan","TextLabelCaption":"Teks untuk ditampilkan"}}'),"he-IL":JSON.parse('{"RichTextEditor":{"ToggleToolbar":"Formatting options","UploadAttachments":"\u05D1\u05D7\u05E8 \u05E7\u05D5\u05D1\u05E5 \u05DE\u05E6\u05D5\u05E8\u05E3","SelectTemplate":"Insert template"},"RichTextEditorLink":{"SaveLinkButtonCaption":"\u05E9\u05DE\u05D5\u05E8","OpenLinkButtonCaption":"\u05E4\u05EA\u05D7 \u05D1\u05DB\u05E8\u05D8\u05D9\u05E1\u05D9\u05D9\u05D4 \u05D7\u05D3\u05E9\u05D4","CloseLinkButtonCaption":"\u05E1\u05D2\u05D5\u05E8","UnlinkLinkButtonCaption":"\u05D1\u05D8\u05DC \u05D0\u05EA \u05D4\u05E7\u05D9\u05E9\u05D5\u05E8","LinkLabelCaption":"Link address","TextLabelCaption":"\u05D8\u05E7\u05E1\u05D8 \u05DC\u05EA\u05E6\u05D5\u05D2\u05D4"}}'),"fr-FR":JSON.parse(`{"RichTextEditor":{"ToggleToolbar":"Options de mise en forme","UploadAttachments":"S\xE9lectionner les pi\xE8ces jointes","SelectTemplate":"Ins\xE9rer un template"},"RichTextEditorLink":{"SaveLinkButtonCaption":"Enregistrer","OpenLinkButtonCaption":"Ouvrir dans un nouvel onglet","CloseLinkButtonCaption":"Fermer","UnlinkLinkButtonCaption":"Dissocier","LinkLabelCaption":"Associer l'adresse","TextLabelCaption":"Texte \xE0 afficher"}}`),"fa-IR":JSON.parse('{"RichTextEditor":{"ToggleToolbar":"Display toolbar","UploadAttachments":"Select attachments"},"RichTextEditorLink":{"SaveLinkButtonCaption":"\u0630\u062E\u06CC\u0631\u0647","OpenLinkButtonCaption":"Open in new tab","CloseLinkButtonCaption":"\u0628\u0633\u062A\u0646","UnlinkLinkButtonCaption":"Unlink","LinkLabelCaption":"Link address","TextLabelCaption":"Text to display"}}'),"es-ES":JSON.parse('{"RichTextEditor":{"ToggleToolbar":"Opciones de formato","UploadAttachments":"Seleccionar archivos adjuntos","SelectTemplate":"Insertar plantilla"},"RichTextEditorLink":{"SaveLinkButtonCaption":"Guardar","OpenLinkButtonCaption":"Abrir en una nueva pesta\xF1a","CloseLinkButtonCaption":"Cerrar","UnlinkLinkButtonCaption":"Desvincular","LinkLabelCaption":"Direcci\xF3n del enlace","TextLabelCaption":"Texto a mostrar"}}'),"de-DE":JSON.parse('{"RichTextEditor":{"ToggleToolbar":"Formatierungsoptionen","UploadAttachments":"Anh\xE4nge ausw\xE4hlen","SelectTemplate":"Vorlage einf\xFCgen"},"RichTextEditorLink":{"SaveLinkButtonCaption":"Speichern","OpenLinkButtonCaption":"In neuem Tab \xF6ffnen","CloseLinkButtonCaption":"Schlie\xDFen","UnlinkLinkButtonCaption":"Link entfernen","LinkLabelCaption":"Linkadresse","TextLabelCaption":"anzuzeigender Text"}}'),"cs-CZ":JSON.parse('{"RichTextEditor":{"ToggleToolbar":"Formatting options","UploadAttachments":"Select attachments","SelectTemplate":"Insert template"},"RichTextEditorLink":{"SaveLinkButtonCaption":"Ulo\u017Eit","OpenLinkButtonCaption":"Open in new tab","CloseLinkButtonCaption":"Zav\u0159\xEDt","UnlinkLinkButtonCaption":"Unlink","LinkLabelCaption":"Link address","TextLabelCaption":"Text to display"}}'),"ar-SA":JSON.parse('{"RichTextEditor":{"ToggleToolbar":"\u062E\u064A\u0627\u0631\u0627\u062A \u0627\u0644\u062A\u0646\u0633\u064A\u0642","UploadAttachments":"\u062D\u062F\u062F \u0627\u0644\u0645\u0631\u0641\u0642\u0627\u062A","SelectTemplate":"\u0625\u062F\u062E\u0627\u0644 \u0642\u0627\u0644\u0628"},"RichTextEditorLink":{"SaveLinkButtonCaption":"\u062D\u0641\u0638","OpenLinkButtonCaption":"\u0641\u062A\u062D \u0641\u064A \u0639\u0644\u0627\u0645\u0629 \u062A\u0628\u0648\u064A\u0628 \u062C\u062F\u064A\u062F\u0629","CloseLinkButtonCaption":"\u0623\u063A\u0644\u0642","UnlinkLinkButtonCaption":"\u0625\u0644\u063A\u0627\u0621 \u0627\u0644\u0631\u0628\u0637","LinkLabelCaption":"\u0639\u0646\u0648\u0627\u0646 \u0627\u0644\u0631\u0627\u0628\u0637","TextLabelCaption":"\u0627\u0644\u0646\u0635 \u0627\u0644\u0645\u0631\u0627\u062F \u0639\u0631\u0636\u0647"}}'),"en-US":JSON.parse('{"RichTextEditor":{"ToggleToolbar":"Formatting options","UploadAttachments":"Select attachments","SelectTemplate":"Insert template","SelectionActions":{"AskCopilot":"Ask Copilot","Friendly":"Friendly","Formal":"Formal","Shorten":"Shorten","Extend":"Extend","Rephrase":"Rephrase","RewriteCaption":"Rewrite text"}},"RichTextEditorLink":{"SaveLinkButtonCaption":"Save","OpenLinkButtonCaption":"Open in new tab","CloseLinkButtonCaption":"Close","UnlinkLinkButtonCaption":"Unlink","LinkLabelCaption":"Link address","TextLabelCaption":"Text to display"}}'),"ru-RU":JSON.parse('{"RichTextEditor":{"ToggleToolbar":"\u0424\u043E\u0440\u043C\u0430\u0442\u0438\u0440\u043E\u0432\u0430\u043D\u0438\u0435","UploadAttachments":"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0432\u043B\u043E\u0436\u0435\u043D\u0438\u0435","SelectTemplate":"\u0412\u0441\u0442\u0430\u0432\u0438\u0442\u044C \u0448\u0430\u0431\u043B\u043E\u043D","SelectionActions":{"AskCopilot":"\u0421\u043F\u0440\u043E\u0441\u0438\u0442\u044C Copilot","Friendly":"\u0414\u0440\u0443\u0436\u0435\u043B\u044E\u0431\u043D\u044B\u0439","Formal":"\u0424\u043E\u0440\u043C\u0430\u043B\u044C\u043D\u044B\u0439","Shorten":"\u0421\u043E\u043A\u0440\u0430\u0442\u0438","Extend":"\u0420\u0430\u0441\u0448\u0438\u0440\u044C","Rephrase":"\u041F\u0435\u0440\u0435\u0444\u0440\u0430\u0437\u0438\u0440\u0443\u0439","RewriteCaption":"\u041F\u0435\u0440\u0435\u043F\u0438\u0441\u0430\u0442\u044C \u0442\u0435\u043A\u0441\u0442"}},"RichTextEditorLink":{"SaveLinkButtonCaption":"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C","OpenLinkButtonCaption":"\u041E\u0442\u043A\u0440\u044B\u0442\u044C \u0432 \u043D\u043E\u0432\u043E\u0439 \u0432\u043A\u043B\u0430\u0434\u043A\u0435","CloseLinkButtonCaption":"\u0417\u0430\u043A\u0440\u044B\u0442\u044C","UnlinkLinkButtonCaption":"\u041E\u0442\u043A\u0440\u0435\u043F\u0438\u0442\u044C","LinkLabelCaption":"\u0410\u0434\u0440\u0435\u0441 \u0441\u0441\u044B\u043B\u043A\u0438","TextLabelCaption":"\u0422\u0435\u043A\u0441\u0442 \u0434\u043B\u044F \u043E\u0442\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u044F"}}'),"uk-UA":JSON.parse(`{"RichTextEditor":{"ToggleToolbar":"\u041F\u0430\u0440\u0430\u043C\u0435\u0442\u0440\u0438 \u0444\u043E\u0440\u043C\u0430\u0442\u0443\u0432\u0430\u043D\u043D\u044F","UploadAttachments":"\u0412\u0438\u0431\u0440\u0430\u0442\u0438 \u0432\u043A\u043B\u0430\u0434\u0435\u043D\u043D\u044F","SelectTemplate":"\u0412\u0441\u0442\u0430\u0432\u0438\u0442\u0438 \u0448\u0430\u0431\u043B\u043E\u043D"},"RichTextEditorLink":{"SaveLinkButtonCaption":"\u0417\u0431\u0435\u0440\u0435\u0433\u0442\u0438","OpenLinkButtonCaption":"\u0412\u0456\u0434\u043A\u0440\u0438\u0442\u0438 \u0432 \u043D\u043E\u0432\u0456\u0439 \u0432\u043A\u043B\u0430\u0434\u0446\u0456","CloseLinkButtonCaption":"\u0417\u0430\u043A\u0440\u0438\u0442\u0438","UnlinkLinkButtonCaption":"\u0412\u0456\u0434'\u0454\u0434\u043D\u0430\u0442\u0438","LinkLabelCaption":"\u0410\u0434\u0440\u0435\u0441\u0430 \u043F\u043E\u0441\u0438\u043B\u0430\u043D\u043D\u044F","TextLabelCaption":"\u0422\u0435\u043A\u0441\u0442 \u0434\u043B\u044F \u0432\u0456\u0434\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u043D\u044F"}}`)};var n=g(59131);const q=new n.InjectionToken("CkeditorThemeStyleUrl"),G=new n.InjectionToken("CkeditorUrl");var E=g(73308),te=g(18081),ae=g(59445),ne=g(85638),re=g(87368),se=g(30268),x=g(28399),m=g(62278),X=g(36486),j=g(79772),N=g(10850);function le(d,e){if(d&1){const t=n.\u0275\u0275getCurrentView();n.\u0275\u0275elementStart(0,"crt-button",9),n.\u0275\u0275pipe(1,"translate"),n.\u0275\u0275listener("clicked",function(){n.\u0275\u0275restoreView(t);const o=n.\u0275\u0275nextContext();return n.\u0275\u0275resetView(o.unlink())}),n.\u0275\u0275elementEnd()}d&2&&n.\u0275\u0275property("caption",n.\u0275\u0275pipeBind1(1,1,"RichTextEditorLink.UnlinkLinkButtonCaption"))}let w=class Z{get linkControl(){return this.richTextLinkForm.get("linkControl")}get displayTextControl(){return this.richTextLinkForm.get("displayTextControl")}get editor(){return this._editor}set editor(e){!this._isEditorInitialize&&e&&(this._editor=e,this._isEditorInitialize=!0)}set tooltipConfig(e){this.editor=e.value.editor,this._tooltipConfig=e}constructor(e,t,i,o,a,r){this._translate=e,this.window=t,this._changeDetector=i,this._injector=o,this._crtControlStateAdapter=a,this._element=r,this._isEditorInitialize=!1,this.isUnlinkButtonVisible=!1,this.richTextLinkForm=new S.FormGroup({linkControl:new S.FormControl("",{validators:[this._crtControlStateAdapter.transform({instance:new N.RequiredValidator(this._injector)}),this._createLinkPatternValidatorFn.bind(this)]}),displayTextControl:new S.FormControl("",{})})}_clearFields(){this.linkControl.reset(),this.linkControl.setErrors(null),this.linkControl.updateValueAndValidity(),this.displayTextControl.setValue(""),this.displayTextControl.updateValueAndValidity()}_createLinkPatternValidatorFn(e){return h.CustomValidators.linkValidator()(e)!==null?this._createValidatorErrorsMessage("InvalidLink","Validators.Link.Message"):null}_createValidatorErrorsMessage(e,t){return{[e]:{message:this._translate.instant(`${t}`)}}}_initialize(){if(!this.editor)return;const e=this.editor.getSelection()?.getSelectedText(),t=CKEDITOR.plugins.link.getSelectedLink(this.editor,!0),i=t?.[0]||null;i?.is("a")?(this.displayTextControl.setValue(i.$.innerText),this.linkControl.setValue(i.getAttribute("href"))):e&&this.displayTextControl.setValue(e),this.isUnlinkButtonVisible=t?.length>0,this._changeDetector.detectChanges(),this.focusLink()}focusLink(){setTimeout(()=>this._element.nativeElement.querySelector(".rich-text-link-container .rich-text-link-field input").focus(),0)}closeLink(){this._clearFields(),this._tooltipConfig?.onClose?.()}openLink(){this.window.open(this.linkControl.value,"_blank")}unlink(){this.editor.execCommand("unlink"),this._tooltipConfig?.onUnlink?.()}save(){if(this.richTextLinkForm.updateValueAndValidity(),this.richTextLinkForm.valid){const e={url:this.linkControl.value,linkText:this.displayTextControl.value};CKEDITOR.plugins.creatiolink.insertOrUpdateLink(e,this.editor),this._clearFields(),this._tooltipConfig?.onSave?.()}}ngOnInit(){this._initialize()}static{this.\u0275fac=function(t){return new(t||Z)(n.\u0275\u0275directiveInject(j.TranslateService),n.\u0275\u0275directiveInject(k.WINDOW_TOKEN),n.\u0275\u0275directiveInject(n.ChangeDetectorRef),n.\u0275\u0275directiveInject(n.Injector),n.\u0275\u0275directiveInject(N.CrtControlStateAdapter),n.\u0275\u0275directiveInject(n.ElementRef))}}static{this.\u0275cmp=n.\u0275\u0275defineComponent({type:Z,selectors:[["crt-rich-text-link"]],inputs:{editor:"editor"},decls:14,vars:25,consts:[[1,"rich-text-link-page"],[1,"rich-text-link-container"],["data-qa","input-link",1,"rich-text-link-field",3,"keyup.enter","control","labelPosition","appearance","label"],["data-qa","input-displayText",3,"keyup.enter","control","labelPosition","appearance","label"],[1,"link-button-container"],["iconPosition","left-icon","icon","open-link","size","small","displayType","text","color","default",1,"open-link-button","link-button",3,"clicked","disabled","caption"],["class","unlink-link-button link-button","iconPosition","left-icon","icon","unlink-link","size","small","displayType","text","color","default",3,"caption","clicked",4,"ngIf"],["iconPosition","left-icon","icon","close-link","size","small","displayType","text","color","default",1,"close-link-button","link-button",3,"clicked","caption"],["icon","save-link","size","small","displayType","text","color","default",1,"save-link-button","link-button",3,"clicked","disabled","iconPosition","caption"],["iconPosition","left-icon","icon","unlink-link","size","small","displayType","text","color","default",1,"unlink-link-button","link-button",3,"clicked","caption"]],template:function(t,i){t&1&&(n.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"crt-input",2),n.\u0275\u0275pipe(3,"translate"),n.\u0275\u0275listener("keyup.enter",function(){return i.save()}),n.\u0275\u0275elementEnd(),n.\u0275\u0275elementStart(4,"crt-input",3),n.\u0275\u0275pipe(5,"translate"),n.\u0275\u0275listener("keyup.enter",function(){return i.save()}),n.\u0275\u0275elementEnd(),n.\u0275\u0275elementStart(6,"div",4)(7,"crt-button",5),n.\u0275\u0275pipe(8,"translate"),n.\u0275\u0275listener("clicked",function(){return i.openLink()}),n.\u0275\u0275elementEnd(),n.\u0275\u0275template(9,le,2,3,"crt-button",6),n.\u0275\u0275elementStart(10,"crt-button",7),n.\u0275\u0275pipe(11,"translate"),n.\u0275\u0275listener("clicked",function(){return i.closeLink()}),n.\u0275\u0275elementEnd(),n.\u0275\u0275elementStart(12,"crt-button",8),n.\u0275\u0275pipe(13,"translate"),n.\u0275\u0275listener("clicked",function(){return i.save()}),n.\u0275\u0275elementEnd()()()()),t&2&&(n.\u0275\u0275advance(2),n.\u0275\u0275property("control",i.richTextLinkForm.controls.linkControl)("labelPosition","above")("appearance","legacy")("label",n.\u0275\u0275pipeBind1(3,15,"RichTextEditorLink.LinkLabelCaption")),n.\u0275\u0275advance(2),n.\u0275\u0275property("control",i.richTextLinkForm.controls.displayTextControl)("labelPosition","above")("appearance","legacy")("label",n.\u0275\u0275pipeBind1(5,17,"RichTextEditorLink.TextLabelCaption")),n.\u0275\u0275advance(3),n.\u0275\u0275property("disabled",i.linkControl.invalid)("caption",n.\u0275\u0275pipeBind1(8,19,"RichTextEditorLink.OpenLinkButtonCaption")),n.\u0275\u0275advance(2),n.\u0275\u0275property("ngIf",i.isUnlinkButtonVisible),n.\u0275\u0275advance(),n.\u0275\u0275property("caption",n.\u0275\u0275pipeBind1(11,21,"RichTextEditorLink.CloseLinkButtonCaption")),n.\u0275\u0275advance(2),n.\u0275\u0275property("disabled",i.richTextLinkForm.invalid)("iconPosition","left-icon")("caption",n.\u0275\u0275pipeBind1(13,23,"RichTextEditorLink.SaveLinkButtonCaption")))},dependencies:[L.NgIf,C.CrtButtonComponent,C.CrtInputComponent,j.TranslatePipe],styles:[".rich-text-link-page[_ngcontent-%COMP%]{width:500px;box-shadow:0 2px 4px #0003;border-radius:4px;padding:16px 16px 0}.link-button-container[_ngcontent-%COMP%]{display:flex;gap:16px;align-items:center;justify-content:right;margin:12px 0}"]})}};w=(0,l.__decorate)([(0,s.CrtViewElement)({type:"crt.RichTextLinkComponent"}),(0,l.__metadata)("design:paramtypes",[j.TranslateService,Window,n.ChangeDetectorRef,n.Injector,N.CrtControlStateAdapter,n.ElementRef])],w);var ce=g(35266);class I{static{this.fileIconImageCssClass="file-icon-system-image"}static getLastSnapshotContent(e){const t=e.undoManager.snapshots;return t[t.length-1].contents}static getEditorImages(e){const t=e.editable().$.getElementsByTagName("img");return Array.from(t).filter(i=>!i.classList.contains(this.fileIconImageCssClass))}static getThemeCssLink(e,t){const i=e.styleSheets;let o;for(let a=0;a<i.length;a++)if(i[a].href&&(o=o??i[a].href,i[a].href?.toLowerCase().indexOf(t)>-1))return i[a].href;return o}static appendLink(e,t){function i(a){const r=document.createElement("link");return r.rel="stylesheet",r.type="text/css",r.href=a,r.media="all",r}function o(a,r){function p(T){const b=T.indexOf("?");return b>=0?T.substr(0,b):T}const c=p(r),f=a.getElementsByTagName("link");for(let T=0;T<f.length;T++)if(p(f[T].href).endsWith(c.replace("./","")))return!0;return!1}t&&!o(e,t)&&e.appendChild(i(t))}}class v{constructor(e,t,i){this._fileApiService=e,this._fileService=t,this.queryExecutor=i,this._sysDownloadMethod="/rest/FileService/Download"}_replaceSrc(e,t,i){e.removeAttribute("data-cke-saved-src"),e.setAttribute("src",t),e.setAttribute("data-uploaded-image-id",i)}_getFileType(e){const t=e.match(/data:(.*);base64/);return t?t[1]:null}_mapFileDto(e,t){return{...e,id:(0,s.generateGuid)(),fileEntitySchemaName:t.fileSchemaName||"SysFile",recordColumnName:t.recordColumnName||"RecordId",recordEntitySchemaName:t.schemaName,recordId:t.recordId,tag:"inline"}}_getFile(e,t,i){const o=this._getFileData(e,t);return new File([o],i,{type:t})}_getFileData(e,t){const i=e.split(";base64,"),o=window.atob(i[1]),a=new Array(o.length);for(let c=0;c<o.length;c++)a[c]=o.charCodeAt(c);const r=new Uint8Array(a);return new Blob([r],{type:t})}_getImageIdentifiers(e){const t=/data-uploaded-image-id="([^"]*)"/gim,i=[];let o=t.exec(e);for(;o!=null;)i.push(o[1]),o=t.exec(e);return i}_catchErrorResponse(e){return console.error(e),(0,m.of)({success:!1,errorInfo:{errorCode:null,message:e.message,stackTrace:e.stack},result:null})}_getDeleteQuery(e){const t=new s.DeleteQuery("SysFile");return t.filters.addSchemaColumnInFilterWithParameters(s.ComparisonType.Equal,"Id",e),t}getUploadUrl(e){return(0,h.joinPath)((0,h.getWorkspaceBaseUrl)(),this._sysDownloadMethod,e.fileEntitySchemaName||"SysFile",e.id)}uploadImages(e,t){const i=e.map(o=>{const a=I.getEditorImages(o),r=[];t.fileSchemaName=t.fileSchemaName||o.config.fileStorageName,t.recordColumnName=t.recordColumnName||o.config.recordColumnName;for(let p=0;p<a?.length;p++){const c=a[p],f=c.getAttribute("src"),T=c.getAttribute("crt-file-name"),b=this._getFileType(f);if(b){const z=b.match(/\/(\w+)/)?.[1],K=(0,s.generateGuid)();let $=T||`${t.schemaName}_${t.recordId}_${K}`;z&&!T&&($+=`.${z}`),r.push({element:c,file:this._getFile(f,b,$),fileId:K})}}return{editor:o,imageFiles:r}}).filter(o=>o.imageFiles.length>0);return i.length===0?(0,m.of)({}):(0,m.from)(i).pipe((0,m.concatMap)(o=>(0,m.from)(o.imageFiles).pipe((0,m.concatMap)(a=>(0,m.zip)(this._fileService.read(a.file),(0,m.of)(a))),(0,m.map)(a=>({dto:this._mapFileDto(a[0],t),image:a[1]})),(0,m.concatMap)(a=>this._fileApiService.upload(a.dto).pipe((0,m.map)(()=>{this._replaceSrc(a.image.element,this.getUploadUrl(a.dto),a.dto.id),o.editor.fire("change")}),(0,m.catchError)(r=>this._catchErrorResponse(r)))),(0,m.toArray)())),(0,m.toArray)())}removeImages(e){e.forEach(t=>{const i=this._getImageIdentifiers(I.getLastSnapshotContent(t)),o=this._getImageIdentifiers(t.getData()),a=i.filter(r=>!o.includes(r));if(a.length>0){const r=this._getDeleteQuery(a);this.queryExecutor.execute(r).pipe((0,m.map)(()=>({success:!0,errorInfo:null,result:[]})),(0,m.catchError)(p=>this._catchErrorResponse(p))).subscribe()}})}uploadFile(e,t,i){const o=e.filter(a=>a.uploadFilesData);return(0,m.from)(o).pipe((0,m.concatMap)(a=>{const{readyToUploadFiles:r,uploadEvent:p}=a.uploadFilesData,c=a.uploadFilesData.filesStorage;return p.stop(),(0,m.from)(r).pipe((0,m.concatMap)(f=>this._fileService.read(f.file).pipe((0,m.map)(T=>{let b=c.masterRecordColumnValue?i[c.masterRecordColumnValue.replace("$","")]:t.recordId;return b=b?.value?b.value:b,{...T,id:f.fileId,fileEntitySchemaName:c.entitySchemaName,recordColumnName:c.recordColumnName,recordEntitySchemaName:c.recordEntitySchemaName||t.schemaName,recordId:b}}),(0,m.concatMap)(T=>this._fileApiService.upload(T).pipe((0,m.catchError)(b=>(b?.status!==200&&a.fire("CreatioFileUploadFailed",{fileName:T.file.name}),this._catchErrorResponse(b))))))),(0,m.toArray)())}),(0,m.toArray)())}static{this.\u0275fac=function(t){return new(t||v)(n.\u0275\u0275inject(h.FileApiService),n.\u0275\u0275inject(h.FileReaderService),n.\u0275\u0275inject(ce.QueryExecutor))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:v,factory:v.\u0275fac,providedIn:"any"})}}var pe=g(22438);const de=["EmailMiniPage","CommunicationsPanel_FeedsTab"];class M{constructor(e,t,i){this._translateService=e,this._sysSettingsService=t,this._featureValues=i}_createAttribute(e,t,i){const o=e.viewModelConfig.attributes;return o[t]={value:i},t}_rewriteOptionsAvailable(e,t){var i=this;return(0,E.A)(function*(){return i._featureValues.SelectionRewriteActions&&i._featureValues["GenAIFeatures.Copilot"]&&i._featureValues.SidebarExtensions&&!t.disableSelectionOptions&&(yield i._useNewShell())&&!de.includes(e)})()}_useNewShell(){var e=this;return(0,E.A)(function*(){return(yield e._sysSettingsService.getByCode("UseNewShell"))?.value})()}setRewriteOptions(e,t){var i=this;return(0,E.A)(function*(){if(!(yield i._rewriteOptionsAvailable(e.name,t))){t.disableSelectionOptions=!0;return}const o=(0,x.isEmpty)(t.selection)?i._createAttribute(e,`${t.name}_Selection`,""):t.selection.replace("$","");t.selection=`$${o}`,(0,x.isEmpty)(t.selectionActions)&&(t.selectionActions=[{type:"crt.Button",icon:"copilot-rewrite-btn-icon",color:"outline",iconPosition:pe.IconPositionEnum.OnlyIcon,clickMode:"menu",menuItems:[{type:"crt.MenuLabel",caption:i._translateService.instant("RichTextEditor.SelectionActions.RewriteCaption")},{type:"crt.MenuItem",caption:i._translateService.instant("RichTextEditor.SelectionActions.Friendly"),icon:"copilot-rewrite-friendly-icon",clicked:{request:"crt.SelectionActionRequest",params:{selectionAttributeName:o,rewriteAction:"Friendly"}}},{type:"crt.MenuItem",caption:i._translateService.instant("RichTextEditor.SelectionActions.Formal"),icon:"copilot-rewrite-formal-icon",clicked:{request:"crt.SelectionActionRequest",params:{selectionAttributeName:o,rewriteAction:"Formal"}}},{type:"crt.MenuItem",caption:i._translateService.instant("RichTextEditor.SelectionActions.Shorten"),icon:"copilot-rewrite-shorten-icon",clicked:{request:"crt.SelectionActionRequest",params:{selectionAttributeName:o,rewriteAction:"Shorten"}}},{type:"crt.MenuItem",caption:i._translateService.instant("RichTextEditor.SelectionActions.Extend"),icon:"copilot-rewrite-extend-icon",clicked:{request:"crt.SelectionActionRequest",params:{selectionAttributeName:o,rewriteAction:"Extend"}}},{type:"crt.MenuItem",caption:i._translateService.instant("RichTextEditor.SelectionActions.Rephrase"),icon:"copilot-rewrite-rephrase-icon",clicked:{request:"crt.SelectionActionRequest",params:{selectionAttributeName:o,rewriteAction:"Rephrase"}}},{type:"crt.MenuDivider"},{type:"crt.MenuItem",caption:i._translateService.instant("RichTextEditor.SelectionActions.AskCopilot"),icon:"copilot-action-button-icon",clicked:{request:"crt.SelectionActionRequest",params:{selectionAttributeName:o,rewriteAction:"AskCopilot"}}}]}])})()}static{this.\u0275fac=function(t){return new(t||M)(n.\u0275\u0275inject(j.TranslateService),n.\u0275\u0275inject(s.SysSettingsService),n.\u0275\u0275inject(h.FEATURE_VALUES))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:M,factory:M.\u0275fac,providedIn:"any"})}}class B{constructor(){this._editorClassName=".cke_editable"}_setSelectionActionsVisibility(e,t){if(e){const i=this._getSelectionActionsPanelPosition();t.nativeElement.style.display="unset",t.nativeElement.style.top=i.clientY,t.nativeElement.style.left=i.clientX}else t.nativeElement.style.display="none"}_getSelectionActionsPanelPosition(){return this._getPositionFromSelection()||{clientX:"50%",clientY:"50%"}}_getPositionFromSelection(){const e=getSelection()?.getRangeAt(0)?.getClientRects(),t=Array.from(e||[]);if(t.length===0)return null;let i=t[0];const o=getSelection()?.getRangeAt(0)?.getBoundingClientRect();return t.forEach(a=>{(a.top>i.top||a.top===i.top&&a.right>i.right)&&(i=a)}),{clientX:`${Math.min(i.right,o.right)}px`,clientY:`${i.bottom}px`}}updatePosition(e,t){if(!e)return!1;const i=getSelection(),o=i?.type==="Range",a=t?.contains(i?.focusNode),p=!!(i.focusNode?.nodeType===Node.ELEMENT_NODE?i.focusNode:i.focusNode?.parentElement)?.closest(this._editorClassName),c=o&&a&&p;return this._setSelectionActionsVisibility(c,e),c}static{this.\u0275fac=function(t){return new(t||B)}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:B,factory:B.\u0275fac,providedIn:"any"})}}class ue{constructor(e,t,i){this._contactColorService=e,this._initialsService=t,this._matIconRegistry=i,this._getMentionsWithDebounce=(0,x.debounce)(this._getMentions,500),this._mentionStyles="padding-inline-start: 5px;padding-inline-end: 10px;margin-top: 2px;margin-inline-start: 2px;border-radius: 16px;text-decoration: none;max-width: calc(100% - 10px);display: inline-flex;max-height: 1.23em;overflow: hidden;text-overflow: ellipsis;white-space: nowrap;line-height: 1.23em;vertical-align: text-bottom;",this._mentionUserIconStyles="display: inline-flex;height: 2em;line-height: 1.9em;margin-inline-end: 5px;border-radius: 50%;width: 2em;align-self: center;color: white;font-size: 0.6em;justify-content: space-evenly;box-sizing: border-box;font-weight: 400;",this._generalUserMentionStyles="color: var(--crt-palette-primary-500);background-color: var(--crt-palette-interaction-900);",this._externalUserMentionStyles="color: var(--crt-palette-success-700);background-color: var(--crt-palette-success-100);",this._initialsBorderStyle="border: 1px solid var(--crt-palette-border-400)",this._loadExternalUserIcon()}_loadExternalUserIcon(){this._matIconRegistry.getNamedSvgIcon("external-user-type-icon").pipe((0,m.catchError)(()=>(0,m.of)(null))).subscribe(e=>{if(e){const t=(0,h.convertImageToBase64String)(e.outerHTML);this._userIcon=`data:image/svg+xml;base64,${t}`}})}_getPhotoUrl(e){return!e||(0,s.isEmptyGuid)(e)?"":(0,h.getImageFullUrlById)(e)}_mapMention(e){const t=e.connectionType===`${h.UserConnectionType.External}`,i=this._getPhotoUrl(e.primaryImageValue),o=!(0,x.isEmpty)(i),a=o?"":this._contactColorService.getNextColor(e.value),r=this._mentionStyles+(t?this._externalUserMentionStyles:this._generalUserMentionStyles),p=o?this._mentionUserIconStyles:"display:none;";let c="display:none;";o||(c=this._mentionUserIconStyles+`background: ${a};`+this._initialsBorderStyle);const f=this._initialsService.getInitials(e.displayValue),T=t?this._userIcon:"",b=JSON.stringify(e);return{id:e.value,name:e.displayValue,icon:i,typeIcon:T,pageUrl:(0,h.getEntityUrl)("Contact",e.value),styles:r,iconStyles:p,initialsStyles:c,initials:f,shortInitials:(0,x.isEmpty)(f)?"":f[0],color:a,contactDto:encodeURIComponent(b)}}_getMentions(e){this._mentionRequestOptions=e;const{mentionsService:t,queryString:i,callback:o}=e;t.getContacts(i).pipe((0,m.catchError)(()=>(0,m.of)(null))).subscribe(a=>{o&&o(a?.map(r=>this._mapMention(r))),this._processQueuedRequest(i)})}_processQueuedRequest(e){this._mentionRequestOptions&&this._mentionRequestOptions.queryString!==e?this._getMentions(this._mentionRequestOptions):this._mentionRequestOptions=null}getMentionsWithDebounce(e,t,i){if(!e)return i([]);if(this._mentionRequestOptions){this._mentionRequestOptions={mentionsService:e,queryString:t,callback:i};return}t===""?this._getMentions({mentionsService:e,queryString:t,callback:i}):this._getMentionsWithDebounce({mentionsService:e,queryString:t,callback:i})}getMentionsFromHtml(e){if((0,x.isEmpty)(e))return[];const t=new RegExp(/mention-info="(.+?)"/gi);return[...e.matchAll(t)].map(i=>{try{const o=decodeURIComponent(i[1]),a=JSON.parse(o);return a.value?a:null}catch{return null}}).filter(i=>!!i)}}class U{constructor(){this._highlightClass="rich-editor-highlight",this._wrapperClass="rich-editor-highlight-wrapper"}_deleteElementsInRange(e,t,i){const o=e.createRange();o.setStartBefore(t),o.setEndAfter(i);let a=[],r;if(t.getUniqueId()===i.getUniqueId()){let p=!1;a=i.getParent().getChildren().toArray().filter(c=>p||(p=c.getUniqueId()===i.getUniqueId()))}else{const p=new CKEDITOR.dom.walker(o);for(;r=p.next();)a.push(r)}a.forEach(p=>p.remove())}_highlightElements(e){const t=[],i=new CKEDITOR.dom.walker(e);let o;for(;o=i.next();)if(o.type===CKEDITOR.NODE_TEXT)t.push(o);else if(o.contains(e.endContainer)){t.push(o);break}t.forEach(a=>{this._wrapElements(a,e)})}_wrapElements(e,t){if(e.type===CKEDITOR.NODE_TEXT){const i=e.getUniqueId()===t.startContainer.getUniqueId()?t.startOffset:0,o=e.getUniqueId()===t.endContainer.getUniqueId()?t.endOffset:0;this._wrapTextElement(e,i,o)}else{const i=e.getChildren();for(let o=0;o<i.count();o++)this._wrapElements(i.getItem(o),t)}}_wrapTextElement(e,t=0,i=0){const o=this._createWrapElement(this._wrapperClass),a=e.getText();if(t>0&&i===0){const r=a.slice(0,t),p=new CKEDITOR.dom.text(r);o.append(p);const c=a.slice(t),f=this._createWrapElement();f.setHtml(c),o.append(f)}else if(t===0&&i>0){const r=a.slice(0,i),p=this._createWrapElement();p.setHtml(r),o.append(p);const c=a.slice(i),f=new CKEDITOR.dom.text(c);o.append(f)}else if(t>0&&i>0){const r=a.slice(0,t),p=new CKEDITOR.dom.text(r);o.append(p);const c=a.slice(t,i),f=this._createWrapElement();f.setHtml(c),o.append(f);const T=a.slice(i),b=new CKEDITOR.dom.text(T);o.append(b)}else if(t===0||i===0){const r=this._createWrapElement();r.setHtml(a),o.append(r)}o.replace(e)}_createWrapElement(e=this._highlightClass){const t=new CKEDITOR.dom.element("span");return(0,x.isEmpty)(e)||t.setAttribute("class",e),t}_removeHighlighting(e){this._getElementsBySelector(e,this._highlightClass).toArray().forEach(o=>{o.remove(!0)}),this._getElementsBySelector(e,this._wrapperClass).toArray().forEach(o=>{o.remove(!0)})}_removeSelection(e){if(!this.isEditorContainingSelection(e))return;e.getSelection()?.removeAllRanges(),getSelection()?.empty()}_getElementsBySelector(e,t){return e.editable().find("."+t)}_createRange(e,t,i){const o=e.createRange();return o.setStartBefore(t),o.setEndAfter(i),o}highlightSelection(e){if(!e||e.readOnly)return;this._removeHighlighting(e),e.getSelection().getRanges().forEach(o=>{e.fire("saveSnapshot"),this._highlightElements(o)}),this.clearSelection(e),e.fire("saveSnapshot")}removeHighlight(e){!e||e.readOnly||(this._removeHighlighting(e),this._removeSelection(e))}isEditorContainingSelection(e){const t=getSelection();return!t||!e?!1:!!e?.container?.$?.contains(t?.focusNode)}clearSelection(e){!e||e.readOnly||this._removeSelection(e)}replaceSelection(e,t){if(!e||e.readOnly)return;const i=this._getElementsBySelector(e,this._highlightClass);if(i.count()===0)return;const o=i.getItem(0),a=i.getItem(i.count()-1);switch(t.editorAction){case h.ChatMessageActionType.Replace:{const r=o.getParent();let p=!1;const c=a.getParent().getChildren().toArray().filter(f=>p||(p=f.getUniqueId()===a.getUniqueId()));c.shift(),this._deleteElementsInRange(e,o,a),r.appendText(t.selection),c.forEach(f=>r.append(f));break}case h.ChatMessageActionType.InsertAbove:o.insertBeforeMe(new CKEDITOR.dom.text(t.selection));break;case h.ChatMessageActionType.InsertBelow:new CKEDITOR.dom.text(t.selection).insertAfter(a);break}this.removeHighlight(e)}selectHighlighted(e){if(!e||e.readOnly)return;const t=this._getElementsBySelector(e,this._highlightClass),i=t.getItem(0),o=t.getItem(t.count()-1);if(!i||!o)return;this._removeSelection(e);const a=this._createRange(e,i,o),r=e.getSelection();r.selectRanges([a]);const p=r.createBookmarks(a);this._removeHighlighting(e),r.selectBookmarks(p),e.fire("saveSnapshot")}static{this.\u0275fac=function(t){return new(t||U)}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:U,factory:U.\u0275fac})}}const he=["tooltipLink"],me=["selectionActionsPanel"],ge=["*"],_e=d=>({"crt-input-required":d});function Ce(d,e){d&1&&n.\u0275\u0275elementContainer(0)}function fe(d,e){if(d&1&&n.\u0275\u0275element(0,"crt-base-input-width-holder",11),d&2){const t=n.\u0275\u0275nextContext();n.\u0275\u0275property("label",t.label)("minWidth",180)}}function Te(d,e){if(d&1&&n.\u0275\u0275element(0,"div",12,2),d&2){const t=n.\u0275\u0275nextContext();n.\u0275\u0275property("tooltipConfig",t.getTooltipConfig())}}function ke(d,e){d&1&&n.\u0275\u0275element(0,"crt-skeleton-loader")}function be(d,e){if(d&1){const t=n.\u0275\u0275getCurrentView();n.\u0275\u0275elementStart(0,"ckeditor",24),n.\u0275\u0275twoWayListener("dataChange",function(o){n.\u0275\u0275restoreView(t);const a=n.\u0275\u0275nextContext(2);return n.\u0275\u0275twoWayBindingSet(a.control.value,o)||(a.control.value=o),n.\u0275\u0275resetView(o)})("configChange",function(o){n.\u0275\u0275restoreView(t);const a=n.\u0275\u0275nextContext(2);return n.\u0275\u0275twoWayBindingSet(a.editorConfig,o)||(a.editorConfig=o),n.\u0275\u0275resetView(o)}),n.\u0275\u0275listener("ready",function(o){n.\u0275\u0275restoreView(t);const a=n.\u0275\u0275nextContext(2);return n.\u0275\u0275resetView(a.onEditorReady(o))})("focus",function(o){n.\u0275\u0275restoreView(t);const a=n.\u0275\u0275nextContext(2);return n.\u0275\u0275resetView(a.onEditorFocus(o))})("blur",function(o){n.\u0275\u0275restoreView(t);const a=n.\u0275\u0275nextContext(2);return n.\u0275\u0275resetView(a.onEditorBlur(o))})("click",function(o){n.\u0275\u0275restoreView(t);const a=n.\u0275\u0275nextContext(2);return n.\u0275\u0275resetView(a.onClick(o))}),n.\u0275\u0275elementEnd()}if(d&2){const t=n.\u0275\u0275nextContext(2);n.\u0275\u0275property("toggleImageHandlers",(!t.isFocused||t.readonly)&&t.isReady),n.\u0275\u0275twoWayProperty("data",t.control.value)("config",t.editorConfig),n.\u0275\u0275property("type",t.editorType)("editorUrl",t.editorUrl)}}function ye(d,e){if(d&1){const t=n.\u0275\u0275getCurrentView();n.\u0275\u0275elementStart(0,"mat-icon",25),n.\u0275\u0275pipe(1,"translate"),n.\u0275\u0275listener("click",function(){n.\u0275\u0275restoreView(t);const o=n.\u0275\u0275nextContext(2);return n.\u0275\u0275resetView(o.onClipClicked())})("keyup.enter",function(o){n.\u0275\u0275restoreView(t);const a=n.\u0275\u0275nextContext(2);return o.stopPropagation(),n.\u0275\u0275resetView(a.onClipClicked())}),n.\u0275\u0275elementEnd()}d&2&&n.\u0275\u0275property("crtTooltip",n.\u0275\u0275pipeBind1(1,1,"RichTextEditor.UploadAttachments"))}function xe(d,e){if(d&1){const t=n.\u0275\u0275getCurrentView();n.\u0275\u0275elementStart(0,"mat-icon",26),n.\u0275\u0275pipe(1,"translate"),n.\u0275\u0275listener("click",function(){n.\u0275\u0275restoreView(t);const o=n.\u0275\u0275nextContext(2);return n.\u0275\u0275resetView(o.onSelectTemplateClicked())})("keyup.enter",function(o){n.\u0275\u0275restoreView(t);const a=n.\u0275\u0275nextContext(2);return o.stopPropagation(),n.\u0275\u0275resetView(a.onSelectTemplateClicked())}),n.\u0275\u0275elementEnd()}d&2&&n.\u0275\u0275property("crtTooltip",n.\u0275\u0275pipeBind1(1,1,"RichTextEditor.SelectTemplate"))}function Se(d,e){if(d&1){const t=n.\u0275\u0275getCurrentView();n.\u0275\u0275elementStart(0,"mat-icon",27),n.\u0275\u0275pipe(1,"translate"),n.\u0275\u0275listener("click",function(){n.\u0275\u0275restoreView(t);const o=n.\u0275\u0275nextContext(2);return n.\u0275\u0275resetView(o.toggleToolbar())})("focus",function(){n.\u0275\u0275restoreView(t);const o=n.\u0275\u0275nextContext(2);return n.\u0275\u0275resetView(o.lockBlur=!0)})("blur",function(){n.\u0275\u0275restoreView(t);const o=n.\u0275\u0275nextContext(2);return n.\u0275\u0275resetView(o.blurToggle())})("keyup.enter",function(o){n.\u0275\u0275restoreView(t);const a=n.\u0275\u0275nextContext(2);return o.stopPropagation(),n.\u0275\u0275resetView(a.toggleToolbar())})("mousedown",function(){n.\u0275\u0275restoreView(t);const o=n.\u0275\u0275nextContext(2);return n.\u0275\u0275resetView(o.lockBlur=!0)}),n.\u0275\u0275elementEnd()}if(d&2){const t=n.\u0275\u0275nextContext(2);n.\u0275\u0275classMap("toggle-icon toggle-"+(t.showToolbar?"selected":"default")),n.\u0275\u0275property("crtTooltip",n.\u0275\u0275pipeBind1(1,3,"RichTextEditor.ToggleToolbar"))}}function Ee(d,e){d&1&&(n.\u0275\u0275element(0,"mat-icon",28),n.\u0275\u0275pipe(1,"translate")),d&2&&n.\u0275\u0275property("title",n.\u0275\u0275pipeBind1(1,1,"Input.Readonly"))}function ve(d,e){if(d&1&&(n.\u0275\u0275elementContainerStart(0),n.\u0275\u0275element(1,"mat-icon",29),n.\u0275\u0275elementContainerEnd()),d&2){const t=n.\u0275\u0275nextContext(2);n.\u0275\u0275advance(),n.\u0275\u0275property("crtTooltip",t.errorMessages)}}function Le(d,e){if(d&1&&n.\u0275\u0275element(0,"mat-icon",31),d&2){const t=n.\u0275\u0275nextContext(3);n.\u0275\u0275property("crtTooltip",t.tooltip)}}function Oe(d,e){if(d&1&&n.\u0275\u0275template(0,Le,1,1,"mat-icon",30),d&2){const t=n.\u0275\u0275nextContext(2);n.\u0275\u0275property("ngIf",t.tooltip)}}function Re(d,e){if(d&1&&(n.\u0275\u0275elementStart(0,"div",13)(1,"label",14),n.\u0275\u0275text(2),n.\u0275\u0275elementEnd()(),n.\u0275\u0275elementStart(3,"div",15)(4,"div",16)(5,"div",17),n.\u0275\u0275template(6,be,1,5,"ckeditor",18),n.\u0275\u0275elementStart(7,"div",19),n.\u0275\u0275template(8,ye,2,3,"mat-icon",20)(9,xe,2,3,"mat-icon",21)(10,Se,2,5,"mat-icon",22)(11,Ee,2,3,"mat-icon",23)(12,ve,2,1,"ng-container",10)(13,Oe,1,1,"ng-template",null,3,n.\u0275\u0275templateRefExtractor),n.\u0275\u0275elementEnd()()()()),d&2){const t=n.\u0275\u0275reference(14),i=n.\u0275\u0275nextContext();n.\u0275\u0275advance(),n.\u0275\u0275property("ngClass",n.\u0275\u0275pureFunction1(16,_e,i.isShownRequiredMark)),n.\u0275\u0275advance(),n.\u0275\u0275textInterpolate(i.label),n.\u0275\u0275advance(),n.\u0275\u0275property("ngClass","label-position-"+i.displayLabelPosition),n.\u0275\u0275advance(2),n.\u0275\u0275classProp("invalid",i.invalid)("readonly",i.readonly)("hasTooltip",i.tooltip),n.\u0275\u0275advance(),n.\u0275\u0275property("ngIf",i.control),n.\u0275\u0275advance(2),n.\u0275\u0275property("ngIf",i.showClip&&i.isFocused&&!i.readonly),n.\u0275\u0275advance(),n.\u0275\u0275property("ngIf",i.useTemplates&&i.isFocused&&!i.readonly),n.\u0275\u0275advance(),n.\u0275\u0275property("ngIf",i.isFocused&&!i.readonly),n.\u0275\u0275advance(),n.\u0275\u0275property("ngIf",i.readonly),n.\u0275\u0275advance(),n.\u0275\u0275property("ngIf",i.invalid)("ngIfElse",t)}}let _=class Y extends C.CrtInputComponent{get _useMentions(){return!!this.mentionsService||!!this._mentionsConfig}get showToolbar(){return this._showToolbar}set showToolbar(e){this._showToolbar=e,this._setToolbarVisibility(e),this.currentEditor.fire("toggleToolbar",{display:e})}get editorConfig(){return this._editorConfig}set editorConfig(e){Object.assign(this._editorConfig,e)}get mentionsConfig(){return this._mentionsConfig||this._defaultMentionsConfig}set mentionsConfig(e){Object.assign(this._mentionsConfig,e)}set content(e){this.control.setValue(e)}constructor(e,t,i,o,a,r,p,c,f,T,b,ie,z,K,$,Ie,we){super(e,t),this.matDateLocale=i,this.window=o,this.ckeditorUrl=a,this.themeCssUrlSearchTemplate=r,this._messageDialogProvider=p,this._contactColorService=c,this._initialsService=f,this._currentTheme$=T,this._platform=b,this._featureValues=ie,this._domPurifier=z,this._fileUploadProcessingService=K,this._fileIconService=$,this._uploadService=Ie,this._rightsService=we,this._editorConfig={skin:"freedom",customConfig:"",toolbar:[["Format","-","CopyFormatting","Bold","Italic","Underline","Strike","-","TextColor","-","NumberedList","BulletedList","-","CreatioLink","CreatioImageFileUploadButton","CreatioFileUploadButton","CreatioTable","-","JustifyLeft","JustifyCenter","JustifyRight","-","Outdent","Indent","Expand","Collapse"]],extraPlugins:"creatioeditorplaceholder, expandcollapse, textmatch, autolink, link, creatiolink, imagebase, uploadimage, creatiouploadfile, creatioImageFileUpload, dragresize, creatiotabletools, tableresize, justify, copyformatting, indent, creatiofixedtoolbox",removePlugins:"smiley,pagebreak,iframe,language,flash,image,magicline,scayt,editorplaceholder",format_tags:"p;h1;h2;h3",colorButton_enableMore:!1,context_menu:[],title:!1,allowedContent:!0,removeButtons:"Link,Image",toolbarStartupExpanded:!1,enterMode:2,startupShowBorders:!1,entities_greek:!1,entities_latin:!1,disableNativeSpellChecker:!1,versionCheck:!1},this._toolbarClassName="crt-rich-text-editor-toolbar",this._defaultMentionsConfig={feed:(Me,Be)=>this._getMentions(Me.query,Be),itemTemplate:'<li data-id="{id}" data-qa="{id}-mention-option" class="mention-item"><span class="contact-no-photo" color="{color}" style="background:{color}">{initials}</span><img src="{icon}">{name}<img src="{typeIcon}" class="user-type-icon"></li>',outputTemplate:'<a href="{pageUrl}" contentEditable="false" style="{styles}" data-value="{id}" mention-info="{contactDto}" data-mention-display-value="{name}" data-link="mention" target="_blank"><img style="{iconStyles}" src="{icon}"/><span color="{color}" style="{initialsStyles}">{shortInitials}</span>{name}</a>',minChars:0,marker:"@",throttle:0},this._uploadedFileClassName="file-download-link",this._uploadedFileNameAttribute="crt-uploaded-file-name",this._selectionDebounceDelay=250,this._showToolbar=!1,this._tooltipOffset=24,this._dialogIsShowing=!1,this._namespaceInitialized=!1,this._selectionDebounceFn=(0,x.debounce)(this._onSelectionChange,this._selectionDebounceDelay),this.isFocused=!1,this.isReady=!1,this.lockBlur=!1,this.plainTextChange=new n.EventEmitter,this.editorType="inline",this.needHandleSave=!0,this.filesStorage={masterRecordColumnValue:"$Id",recordEntitySchemaName:"",recordColumnName:"RecordId",entitySchemaName:"SysFile"},this.selectAttachments=new n.EventEmitter,this.selectionChange=new n.EventEmitter,this.selectTemplate=new n.EventEmitter,this.filesUploaded=new n.EventEmitter,this.useBodyFilesLinks=!0,this.editorBlur=new n.EventEmitter,this.editorFocus=new n.EventEmitter,this.editorValueChanged=new n.EventEmitter,this.newMention=new n.EventEmitter,this.editorUrl=a,this._sanitizeHtmlPipe=this.injector.get(h.SanitizeHtmlPipe),this._matIconRegistry=this.injector.get(A.MatIconRegistry),this._mentionUtils=new ue(this._contactColorService,this._initialsService,this._matIconRegistry),this._selectionActionsPositionService=e.get(B),this._copilotToEditorCommunicationService=e.get(h.CopilotToEditorCommunicationService),this._selectionUtils=e.get(U)}_updateValue(){CKEDITOR.currentInstance&&CKEDITOR.currentInstance.name===this.currentEditor?.name&&(this._currentRecordId=this.control.parent?.value?.Id,this.currentEditor.schemaRecordId=this._currentRecordId,this._updateValueInControl(CKEDITOR.currentInstance)),this.editorValueChanged.emit()}_updateValueInControl(e){const t=e.getData();this.control.setValue(t);const o=e.editable().$?.innerText;this.plainTextChange.emit(o),this._updateValidity()}_setToolbarVisibility(e){const t=(this._lastEditor||CKEDITOR.currentInstance)?.name,i=document.getElementById("cke_"+t);i&&(e?(i.style.opacity="1",i.style.pointerEvents="auto"):(i.style.opacity="0",i.style.pointerEvents="none"))}_updateValidity(){this.control.updateValueAndValidity(),this.control.markAsTouched()}_openUrl(e,t){e&&this.window.open(e,t)}_setContenteditable(e,t){e?.editable().$.setAttribute("contenteditable",t)}_subscribeBeforeDestroyEvent(e){e.editor.on("beforeDestroy",t=>{this.isReady=!1,this._hideTooltip(),t.editor.fire("blur")},this)}_subscribeEvents(e){const t=e.editor;CKEDITOR.on("ariaWidget",this.onPanelElementCreated.bind(this)),t.on("change",this._updateValue.bind(this)),t.on("insertHtml",this._onInsertHtml.bind(this)),t.on("fileUploadRequest",this._handleFileUploadRequest.bind(this)),t.on("CreatioImageClick",()=>this.lockBlur=!0,this),t.on("CreatioImageWindowClose",()=>this.lockBlur=!1,this),t.on("CreatioLinkClick",this._showTooltip.bind(this)),t.on("CreatioLinkDoubleClick",this._showTooltip.bind(this)),t.on("CreatioFileUploadFailed",this._removeFailedLink.bind(this)),t.document.on("keydown",this._handleKeyDownEvent.bind(this)),this._subscribeImageResize(t),this._subscribeToSelectionChange(t),t.container.$.addEventListener("contextmenu",function(i){i.stopPropagation()},!0)}_subscribeToSelectionChange(e){this.disableSelectionOptions||!this._featureValues.SelectionRewriteActions||(e.document.$.body.append(this.selectionActionsPanel.nativeElement),e.document.$.addEventListener("selectionchange",()=>{const t=this._selectionUtils.isEditorContainingSelection(this.currentEditor);(this.selectionActionsPanel.nativeElement.style.display==="unset"||t)&&this._selectionDebounceFn()}))}_handleKeyDownEvent(e){const o=e.data.getKey();[8,46].includes(o)&&this._removeBRBeforeFile(e)}_removeBRBeforeFile(e){const o=this.currentEditor.getSelection().getRanges()[0]?.getNextNode(),a=o?.$;if(a){const r=a.previousElementSibling?.tagName?.toUpperCase()==="BR"&&a.previousSibling?.wholeText?.length===0,p=o.hasClass?.("crt-file-wrapper"),c=a.nextElementSibling?.classList.contains("crt-file-wrapper"),f=a.nodeType===CKEDITOR.NODE_TEXT&&a.nodeValue?.length===0&&c,T=a.tagName?.toUpperCase()==="BR";r&&(p||f)?(a.previousElementSibling.remove(),e.data.preventDefault()):T&&c&&(o.remove(),e.data.preventDefault())}}_removeFailedLink(e){this._replaceUploadedFileContainer(e.editor,e.data.fileName,""),this._showDialogMessage("InfoDialog.FileUpload.InvalidRequestParams")}_validateFileUploadRequest(){var e=this;return(0,E.A)(function*(){if(e.filesStorage.entitySchemaName==="SysFile"&&e.filesStorage.recordColumnName==="RecordId")return!0;if(!e.filesStorage.masterRecordColumnValue||!e.filesStorage.entitySchemaName||!e.filesStorage.recordColumnName||!e.filesStorage.recordEntitySchemaName)return e._showDialogMessage("InfoDialog.FileUpload.InvalidRequestParams"),!1;const t=(yield(0,m.lastValueFrom)(e._rightsService.getCanAdd([e.filesStorage.entitySchemaName]).pipe((0,X.catchError)(()=>(0,m.of)([])))))[0];return t?.errorMessage&&e._showDialogMessage(t.errorMessage),t?.result})()}_handleFileUploadRequest(e){const{editor:t}=e,i=e?.data?.requestData?.upload?.file,o=e?.data?.fileLoader;o&&(o.abort=()=>{}),e.stop(),i&&(t.crtUploadingFiles=t.crtUploadingFiles||[],t.crtUploadingFiles.push(i)),!(t.crtPastedFiles?.length>t.crtUploadingFiles.length)&&(t.crtPastedFiles=[],this._processFilesUpload(t.crtUploadingFiles).then(a=>{t.crtUploadingFiles=[],t.uploadFilesData={readyToUploadFiles:t.uploadFilesData?.readyToUploadFiles||[],filesStorage:this.filesStorage,uploadEvent:e},a.forEach(r=>{const p=(0,s.generateGuid)();t.uploadFilesData.readyToUploadFiles.push({fileId:p,file:r});const c=this._uploadService.getUploadUrl({fileEntitySchemaName:this.filesStorage.entitySchemaName,id:p});this._wrapFileLink(r.name,c)}),setTimeout(()=>{document.querySelectorAll(".crt-file-wrapper").forEach(r=>r.setAttribute("contenteditable","false"))},0),this.filesUploaded.emit(t.uploadFilesData?.readyToUploadFiles)}))}_processFilesUpload(e){var t=this;return(0,E.A)(function*(){let i;if(!(yield t._validateFileUploadRequest()))return e.forEach(c=>t._replaceUploadedFileContainer(t.currentEditor,c.name,"")),[];const o=yield t._fileUploadProcessingService.processSelectedFiles(e,null),a=o?.files?(0,x.differenceBy)(e,o?.files,"name"):[],r=[];o?.errors?.length>0&&(i=t._fileUploadProcessingService.createFileErrorMessageForLogs(o.errors));for(const c of e)(yield t._fileUploadProcessingService.isFileExtensionDeny(c))&&r.push(c);if(r.length>0){const c=t._fileUploadProcessingService.createExtensionAttachmentsErrorMessage(r);i=i?`${c}\r
\r
${i}`:c}const p=[...a,...r];return o.files=(0,x.differenceBy)(e,p,"name"),i&&(t._showDialogMessage(i),p.forEach(c=>t._replaceUploadedFileContainer(t.currentEditor,c.name,""))),t.useBodyFilesLinks||o.files.forEach(c=>t._replaceUploadedFileContainer(t.currentEditor,c.name,"")),o.files})()}_showDialogMessage(e){this._dialogIsShowing||(this._dialogIsShowing=!0,this._messageDialogProvider.open({data:{message:e,actions:[C.DEFAULT_DIALOG_ACTIONS.OK]}}).subscribe(()=>{this._dialogIsShowing=!1}))}_wrapFileLink(e,t){const i=this._fileIconService.getFileIcon(e);this._matIconRegistry.getNamedSvgIcon(i).pipe((0,X.catchError)(()=>(0,m.of)(null)),(0,X.map)(o=>{let a="";o&&(o.classList.add(I.fileIconImageCssClass),o.style.width="16px",o.style.height="16px",a=o.outerHTML);const r=`<a ${this._uploadedFileNameAttribute}="${e}" class="${this._uploadedFileClassName}" href="${t}" target="_self">${e}</a>`;return`<span contenteditable="false" class="crt-file-wrapper">${a}${r}</span> `})).subscribe(o=>{this._replaceUploadedFileContainer(this.currentEditor,e,o),this._moveCaretPositionAfterFileLink(e)})}_moveCaretPositionAfterFileLink(e){const t=this.currentEditor,o=t.document?.find(`a[${this._uploadedFileNameAttribute}="${e}"]`)?.getItem(0)?.getParent()?.getNext();if(o){const a=t.getSelection(),r=t.createRange();r.setStart(o,1),r.setEnd(o,1),a.selectRanges([r])}}_replaceUploadedFileContainer(e,t,i){const o=e?.document?.$?.querySelector(`a[${this._uploadedFileNameAttribute}="${t}"]`);o?.parentNode&&(o.parentNode.outerHTML=i,this.currentEditor.fire("change"))}_replaceAnchorTags(e){return e.replace(/<a[^>]*data-mention-display-value="([^"]*)"[^>]*>(.*?)<\/a>/gs,function(t,i){return i})}_subscribeImageResize(e){const t=i=>{["*"].includes(i.data.type)&&(i.data.dataValue="")};e.on("paste",i=>{const o=i.editor?.elementPath()?.lastElement;o&&(i.data.dataValue=this._replaceAnchorTags(i.data.dataValue),i.editor.sizeBeforePaste={width:o.getSize("width"),height:o.getSize("height")}),i.editor.crtPastedFiles=i.data?.dataTransfer?.$?.files,t(i)}),e.on("resizeComplete",i=>{const o=i.data.element;o.style.width&&o.style.removeProperty("max-width")})}_onInsertHtml(e){const t=e?.data?.dataValue,i=this._mentionUtils.getMentionsFromHtml(t);i&&i.length>0&&this.newMention.next(i),e.editor?.elementPath()?.lastElement?.find("img").toArray().forEach(o=>{t.includes(CKEDITOR.tools.htmlEncode(o.getAttribute("src")))&&o.setStyle("max-width",`${e.editor.sizeBeforePaste?.width-20}px`)})}_loadSkin(){const e=this._getDomElement(this.window.document,"head");if(e){const t=this.ckeditorUrl.replace("ckeditor.js","");I.appendLink(e,t+"skins/freedom/editor.css")}}_overrideShowNotification(e){e.editor.showNotification=t=>{t&&(t=this._sanitizeHtmlPipe.transform(t,{mode:"textOnly",dataType:s.DataValueType.MAXSIZE_TEXT}),this._messageDialogProvider.open({data:{message:t,actions:[C.DEFAULT_DIALOG_ACTIONS.OK]}}))}}_getDomElement(e,t){const i=e?.getElementsByTagName(t);return!i||i.length<1?null:i[0]}_restoreSelectionRanges(){this.currentEditor?.getSelection().selectRanges(this.currentEditor?.oldRanges)}_getMentions(e,t){this._mentionUtils.getMentionsWithDebounce(this.mentionsService,e,t)}_isFileLink(){const t=CKEDITOR.plugins.link.getSelectedLink(this.currentEditor,!0)?.[0]||null;return t?.is("a")&&t.hasClass(this._uploadedFileClassName)}_showTooltip(e){if(this._isFileLink())return;this.toggleLink(!0);const t=this.tooltipLink.nativeElement,i=e.editor.getSelectedRanges()[0];if(i){const o=i?.getClientRects()?.[0],a=e.editor.container.getClientRect(),r=(o?.x||0)-a.x,p=(o?.bottom||0)-a.y;t.style.left=`${r}px`,t.style.top=`${p}px`,t.click()}}_hideTooltip(){this.tooltipLink.nativeElement.dispatchEvent(new Event("blur")),this.toggleLink(!1)}_sanitizeGlobalStyleTagContent(e){if(!e.data.sanitized&&!this._featureValues.DisableRemoveRichtextGlobalStyles){const t=this._domPurifier.sanitize(e.data.dataValue,{FORBID_TAGS:["style"],ADD_TAGS:["signature"],ADD_ATTR:["bodylimiter","crt-file-name"]});e.data.dataValue=t,e.data.sanitized=!0}}_disableUploadFilePlugin(){(!this.needHandleSave||!this._featureValues.UseRichTextUploadFile)&&(this.editorConfig.toolbar[0]=this.editorConfig.toolbar[0].filter(e=>e!=="CreatioFileUploadButton"),this.editorConfig.extraPlugins=this.editorConfig.extraPlugins.replace(/creatiouploadfile,/g,""))}_subscribeInstanceCreated(){this._namespaceInitialized?this._namespaceInitialized=!0:CKEDITOR?.on("instanceCreated",e=>e.editor.on("setData",this._sanitizeGlobalStyleTagContent.bind(this)))}_getSelection(){const e=this.currentEditor;return e?e.getSelection():null}_onSelectionChange(){const t=this._getSelection()?.getSelectedText()??"";if((0,x.isEmpty)(this.selection)&&this.selection===t)return;this.selectionChange.emit(t),this._selectionActionsPositionService.updatePosition(this.selectionActionsPanel,this.currentEditor?.container?.$)&&this._subscribeToHighlightSelection()}_subscribeToHighlightSelection(){this._copilotToEditorCommunicationService.subscribeToNotifications(this.currentEditor.id,e=>{switch(e.editorAction){case h.EditorActionType.SetHighlighting:this._selectionUtils.highlightSelection(this.currentEditor);break;case h.EditorActionType.RemoveHighlighting:this._selectionUtils.removeHighlight(this.currentEditor),this._updateValueInControl(this.currentEditor);break;case h.ChatMessageActionType.Replace:case h.ChatMessageActionType.InsertAbove:case h.ChatMessageActionType.InsertBelow:this._selectionUtils.replaceSelection(this.currentEditor,e);break}})}onPanelElementCreated(e){const t=this._getDomElement(e.data.$.contentDocument,"head");if(t){const o=this.ckeditorUrl.replace("ckeditor.js","");I.appendLink(t,o+"contents.css"),I.appendLink(t,o+"skins/freedom/editor.css");const a=I.getThemeCssLink(document,this.themeCssUrlSearchTemplate);a?I.appendLink(t,a):console.warn(`Not found css-file by ${this.themeCssUrlSearchTemplate}`)}const i=this._getDomElement(e.data.$.contentDocument,"body");i&&(i.classList.contains(this._currentTheme.cssSelector)||i.classList.add(this._currentTheme.cssSelector))}ngOnInit(){this.editorConfig.language=this.matDateLocale?.split("-")[0],this.editorConfig.editorplaceholder=this.placeholder,this.editorConfig.fileStorageName=this.filesStorage.entitySchemaName,this.editorConfig.recordColumnName=this.filesStorage.recordColumnName,this._loadSkin(),this._useMentions&&(Object.assign(this.editorConfig,{mentions:[this.mentionsConfig]}),this.editorConfig.extraPlugins+=", mentions"),this._disableUploadFilePlugin(),(0,se.$)(this.editorUrl).then(this._subscribeInstanceCreated.bind(this))}ngAfterViewInit(){var e=()=>super.ngAfterViewInit,t=this;return(0,E.A)(function*(){e().call(t),t._currentTheme=yield(0,m.firstValueFrom)(t._currentTheme$)})()}onEditorReady(e){this._platform.SAFARI&&e.editor.setActiveEnterMode(CKEDITOR.ENTER_DIV),this._subscribeEvents(e),e.editor.setReadOnly(this.readonly),this.editorName=e.editor.name,document.querySelector(`#cke_${e.editor.name}.cke_float`)?.classList.add(this._toolbarClassName),this.currentEditor=this._lastEditor=e.editor,e.editor.schemaRecordId=this._currentRecordId,this._subscribeBeforeDestroyEvent(e),e.editor.needHandleSave=this.needHandleSave,this._overrideShowNotification(e),this.detectChanges(),this.isReady=!0}toggleLink(e){this.currentEditor.oldRanges=this.currentEditor.getSelectedRanges(),this._setToolbarVisibility(!e)}onEditorFocus(e){const t=document.querySelectorAll(":hover");if(t[t.length-1]instanceof HTMLAnchorElement){this._setContenteditable(e.editor,!1),this._setToolbarVisibility(!1);return}this.isFocused=!0,this.editorFocus.emit(),this.showToolbar?e.editor.focus():this._setToolbarVisibility(!1),e.editor.editable().setAttribute("spellcheck",!0),this._selectionUtils.selectHighlighted(e.editor)}clearSelection(){this._selectionUtils.clearSelection(this.currentEditor)}focus(){this.currentEditor?.focus()}onEditorBlur(e){this._lastEditor=e.editor,e.editor?.editable()&&e.editor.editable().setAttribute("spellcheck",!1),this.lockBlur?e.stop():(this.showToolbar=!1,this.isFocused&&(this.editorBlur.emit(),this.isFocused=!1),this._updateValidity())}toggleToolbar(){this.lockBlur=!1,this.showToolbar=!this.showToolbar,(CKEDITOR.currentInstance||this._lastEditor)?.focus()}onClick(e){const t=e.target;if(t instanceof HTMLAnchorElement&&!this.isFocused){const i=t.getAttribute("href");this._openUrl(i,t.target||"_blank")}this.currentEditor.readOnly||this._setContenteditable(CKEDITOR.currentInstance,!0)}blurToggle(){this.lockBlur&&(this.lockBlur=!1,this.onEditorBlur({}))}onClipClicked(){this.selectAttachments.emit()}onSelectTemplateClicked(){this.selectTemplate.emit()}ngOnChanges(e){e.readonly&&this.currentEditor&&this.currentEditor.setReadOnly(e.readonly.currentValue)}removeReadyToUploadFile(e){const t=this.currentEditor?.uploadFilesData?.readyToUploadFiles;t&&(this.currentEditor.uploadFilesData.readyToUploadFiles=t.filter(i=>i.fileId!==e))}getTooltipConfig(){return new u.TooltipOverlayConfig({showEvent:"click",hideEvent:"blur",closeOnOutsideClick:!0,tooltipConfig:{value:{editor:this.currentEditor},onClose:this.onLinkWindowClosed.bind(this),onSave:this.onLinkSaved.bind(this),onUnlink:this.onLinkUnlink.bind(this)},preferredPositions:[{originX:"end",originY:"bottom",overlayX:"start",overlayY:"top",offsetY:this._tooltipOffset,offsetX:-this._tooltipOffset},{originX:"end",originY:"top",overlayX:"start",overlayY:"bottom",offsetY:-this._tooltipOffset,offsetX:-this._tooltipOffset}],componentType:w})}onLinkSaved(){this._hideTooltip(),this.focus(),this._updateValueInControl(this.currentEditor)}onLinkWindowClosed(){this.focus(),this._restoreSelectionRanges(),this._hideTooltip()}onLinkUnlink(){this._hideTooltip(),this._updateValueInControl(this.currentEditor)}onBeforeUnload(){this._selectionUtils.removeHighlight(this.currentEditor),this._updateValueInControl(this.currentEditor)}static{this.\u0275fac=function(t){return new(t||Y)(n.\u0275\u0275directiveInject(n.Injector),n.\u0275\u0275directiveInject(n.ChangeDetectorRef),n.\u0275\u0275directiveInject(ae.MAT_DATE_LOCALE,8),n.\u0275\u0275directiveInject(k.WINDOW_TOKEN),n.\u0275\u0275directiveInject(G),n.\u0275\u0275directiveInject(q),n.\u0275\u0275directiveInject(C.MessageDialogProvider),n.\u0275\u0275directiveInject(h.ContactColorService),n.\u0275\u0275directiveInject(h.InitialsService),n.\u0275\u0275directiveInject(h.THEME),n.\u0275\u0275directiveInject(te.Platform),n.\u0275\u0275directiveInject(h.FEATURE_VALUES),n.\u0275\u0275directiveInject(k.DOM_PURIFIER),n.\u0275\u0275directiveInject(h.BaseFileUploadProcessingService),n.\u0275\u0275directiveInject(y.FileIconService),n.\u0275\u0275directiveInject(v),n.\u0275\u0275directiveInject(ne.RightsService))}}static{this.\u0275cmp=n.\u0275\u0275defineComponent({type:Y,selectors:[["crt-rich-text-editor"]],viewQuery:function(t,i){if(t&1&&(n.\u0275\u0275viewQuery(he,5,n.ElementRef),n.\u0275\u0275viewQuery(me,5,n.ElementRef)),t&2){let o;n.\u0275\u0275queryRefresh(o=n.\u0275\u0275loadQuery())&&(i.tooltipLink=o.first),n.\u0275\u0275queryRefresh(o=n.\u0275\u0275loadQuery())&&(i.selectionActionsPanel=o.first)}},hostBindings:function(t,i){t&1&&n.\u0275\u0275listener("beforeunload",function(){return i.onBeforeUnload()},!1,n.\u0275\u0275resolveWindow)},inputs:{plainText:"plainText",editorConfig:"editorConfig",mentionsConfig:"mentionsConfig",mentionsService:"mentionsService",editorType:"editorType",content:"content",editorUrl:"editorUrl",needHandleSave:"needHandleSave",showClip:"showClip",useTemplates:"useTemplates",filesStorage:"filesStorage",selection:"selection",disableSelectionOptions:"disableSelectionOptions",useBodyFilesLinks:"useBodyFilesLinks",selectionActions:"selectionActions"},outputs:{plainTextChange:"plainTextChange",selectAttachments:"selectAttachments",selectionChange:"selectionChange",selectTemplate:"selectTemplate",filesUploaded:"filesUploaded",editorBlur:"editorBlur",editorFocus:"editorFocus",editorValueChanged:"editorValueChanged",newMention:"newMention"},features:[n.\u0275\u0275ProvidersFeature([re.defaultComponentLoaderVisibilityDelayProvider]),n.\u0275\u0275InheritDefinitionFeature,n.\u0275\u0275NgOnChangesFeature],ngContentSelectors:ge,decls:11,vars:7,consts:[["selectionActionsPanel",""],["input",""],["tooltipLink",""],["tooltipIcon",""],[1,"rich-text-selection-actions"],[4,"ngTemplateOutlet"],[3,"label","minWidth",4,"ngIf"],[1,"crt-base-input-container"],["class","link-tooltip","crtTooltip","",3,"tooltipConfig",4,"ngIf"],["crtResizable","",1,"crt-input",3,"resized","ngClass","crtResizableDisabled"],[4,"ngIf","ngIfElse"],[3,"label","minWidth"],["crtTooltip","",1,"link-tooltip",3,"tooltipConfig"],[1,"crt-input-label-container"],[1,"crt-input-label",3,"ngClass"],["floatLabel","never",1,"crt-input-control-container","rich-editor","mat-form-field",3,"ngClass"],[1,"crt-input-control"],[1,"rich-editor-wrapper"],["crtFullSizeImage","","class","rich-editor",3,"toggleImageHandlers","data","config","type","editorUrl","dataChange","configChange","ready","focus","blur","click",4,"ngIf"],[1,"icons"],["matSuffix","","class","clip-icon","svgIcon","clip-filled","tabindex","0",3,"crtTooltip","click","keyup.enter",4,"ngIf"],["class","select-template-icon","matSuffix","","svgIcon","select-template-icon","tabindex","1",3,"crtTooltip","click","keyup.enter",4,"ngIf"],["matSuffix","","svgIcon","richtext-toggle","tabindex","2",3,"class","crtTooltip","click","focus","blur","keyup.enter","mousedown",4,"ngIf"],["matSuffix","","svgIcon","lock","class","readonly-icon",3,"title",4,"ngIf"],["crtFullSizeImage","",1,"rich-editor",3,"dataChange","configChange","ready","focus","blur","click","toggleImageHandlers","data","config","type","editorUrl"],["matSuffix","","svgIcon","clip-filled","tabindex","0",1,"clip-icon",3,"click","keyup.enter","crtTooltip"],["matSuffix","","svgIcon","select-template-icon","tabindex","1",1,"select-template-icon",3,"click","keyup.enter","crtTooltip"],["matSuffix","","svgIcon","richtext-toggle","tabindex","2",3,"click","focus","blur","keyup.enter","mousedown","crtTooltip"],["matSuffix","","svgIcon","lock",1,"readonly-icon",3,"title"],["matSuffix","","svgIcon","info-icon",1,"inner-icon","invalid-icon",3,"crtTooltip"],["matSuffix","","svgIcon","info-icon","class","inner-icon tooltip-icon",3,"crtTooltip",4,"ngIf"],["matSuffix","","svgIcon","info-icon",1,"inner-icon","tooltip-icon",3,"crtTooltip"]],template:function(t,i){if(t&1){const o=n.\u0275\u0275getCurrentView();n.\u0275\u0275projectionDef(),n.\u0275\u0275elementStart(0,"div",4,0),n.\u0275\u0275projection(2),n.\u0275\u0275template(3,Ce,1,0,"ng-container",5),n.\u0275\u0275elementEnd(),n.\u0275\u0275template(4,fe,1,2,"crt-base-input-width-holder",6),n.\u0275\u0275elementStart(5,"div",7),n.\u0275\u0275template(6,Te,2,1,"div",8),n.\u0275\u0275elementStart(7,"div",9),n.\u0275\u0275listener("resized",function(r){return n.\u0275\u0275restoreView(o),n.\u0275\u0275resetView(i.onResized(r))}),n.\u0275\u0275template(8,ke,1,0,"crt-skeleton-loader",10)(9,Re,15,18,"ng-template",null,1,n.\u0275\u0275templateRefExtractor),n.\u0275\u0275elementEnd()()}if(t&2){const o=n.\u0275\u0275reference(10);n.\u0275\u0275advance(3),n.\u0275\u0275property("ngTemplateOutlet",i.selectionActions),n.\u0275\u0275advance(),n.\u0275\u0275property("ngIf",i.displayLabelPosition==="auto"),n.\u0275\u0275advance(2),n.\u0275\u0275property("ngIf",!i.loading),n.\u0275\u0275advance(),n.\u0275\u0275property("ngClass","label-position-"+i.displayLabelPosition+" appearance-"+i.appearance)("crtResizableDisabled",!i.isAutoLabelPosition||i.containerQueryMechanismAvailable),n.\u0275\u0275advance(),n.\u0275\u0275property("ngIf",i.loading)("ngIfElse",o)}},dependencies:[L.NgClass,L.NgIf,L.NgTemplateOutlet,R.CKEditorComponent,A.MatIcon,u.SkeletonLoaderComponent,u.TooltipDirective,O.MatLegacySuffix,u.CrtResizableDirective,u.CrtBaseInputWidthHolderComponent,u.CrtFullSizeImageDirective,j.TranslatePipe],styles:["[_nghost-%COMP%]{display:block}[_nghost-%COMP%]   .link-tooltip[_ngcontent-%COMP%]{width:0px;height:0px;position:relative}[_nghost-%COMP%]   .rich-editor[_ngcontent-%COMP%]{width:100%;overflow:auto}[_nghost-%COMP%]   .rich-editor-wrapper[_ngcontent-%COMP%]{width:100%;float:left;overflow:hidden;display:flex;position:relative}[_nghost-%COMP%]   .rich-editor-wrapper.hasTooltip[_ngcontent-%COMP%]   .icons[_ngcontent-%COMP%]{min-width:40px;max-width:40px}[_nghost-%COMP%]   .rich-editor-wrapper[_ngcontent-%COMP%]   .icons[_ngcontent-%COMP%]{display:flex;align-self:flex-end;justify-content:flex-end;padding:0 0 4px;min-width:20px;max-width:20px}[_nghost-%COMP%]   .rich-editor-wrapper[_ngcontent-%COMP%]   .icons[_ngcontent-%COMP%]   .select-template-icon[_ngcontent-%COMP%], [_nghost-%COMP%]   .rich-editor-wrapper[_ngcontent-%COMP%]   .icons[_ngcontent-%COMP%]   .clip-icon[_ngcontent-%COMP%]{cursor:pointer;color:var(--crt-palette-secondary-500)}[_nghost-%COMP%]   .rich-editor-wrapper[_ngcontent-%COMP%]   .icons[_ngcontent-%COMP%]   .select-template-icon[_ngcontent-%COMP%]:hover, [_nghost-%COMP%]   .rich-editor-wrapper[_ngcontent-%COMP%]   .icons[_ngcontent-%COMP%]   .clip-icon[_ngcontent-%COMP%]:hover{color:var(--crt-palette-primary-500)}[_nghost-%COMP%]   .rich-editor-wrapper[_ngcontent-%COMP%]   .icons[_ngcontent-%COMP%]   .toggle-icon[_ngcontent-%COMP%]{cursor:pointer}[_nghost-%COMP%]   .rich-editor-wrapper[_ngcontent-%COMP%]   .icons[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{max-width:16px;max-height:16px}.rich-text-selection-actions[_ngcontent-%COMP%]{position:fixed;display:none;z-index:2010}","[_nghost-%COMP%]{max-width:100%}.crt-base-edit-input-responsible[_nghost-%COMP%]   .crt-base-input-container[_ngcontent-%COMP%]{container-type:inline-size}@container (width <= 320px){[_nghost-%COMP%]   .crt-input.label-position-auto[_ngcontent-%COMP%]{min-height:52px;flex-direction:column;padding-top:0}[_nghost-%COMP%]   .crt-input.label-position-auto[_ngcontent-%COMP%]   .crt-input-label-container[_ngcontent-%COMP%]{display:flex}[_nghost-%COMP%]   .crt-input.label-position-auto[_ngcontent-%COMP%]   .crt-input-label-container[_ngcontent-%COMP%]   .crt-input-label[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-top:8px}[_nghost-%COMP%]   .crt-input.label-position-auto.appearance-outline[_ngcontent-%COMP%]   .crt-input-label-container[_ngcontent-%COMP%]{margin-bottom:8px}}@container (width > 320px){[_nghost-%COMP%]   .crt-input.label-position-auto[_ngcontent-%COMP%]{min-height:32px;flex-direction:row;padding-top:8px}[_nghost-%COMP%]   .crt-input.label-position-auto[_ngcontent-%COMP%]   .crt-input-control-container[_ngcontent-%COMP%]{align-self:baseline}[_nghost-%COMP%]   .crt-input.label-position-auto[_ngcontent-%COMP%]   .crt-input-label-container[_ngcontent-%COMP%]{margin-inline-end:10px;display:flex;align-items:flex-start;align-self:baseline;word-break:break-word;width:136px;min-width:136px}[_nghost-%COMP%]   .crt-input.label-position-auto[_ngcontent-%COMP%]   .crt-input-label-container[_ngcontent-%COMP%]   .crt-input-label[_ngcontent-%COMP%]{width:100%;margin:9px 0 4px;overflow:hidden;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical}}[_nghost-%COMP%]   .crt-input[_ngcontent-%COMP%]{overflow:hidden;padding-bottom:1px}[_nghost-%COMP%]   .crt-input.label-position-left[_ngcontent-%COMP%], [_nghost-%COMP%]   .crt-input.label-position-hidden[_ngcontent-%COMP%]{min-height:32px;flex-direction:row;padding-top:8px}[_nghost-%COMP%]   .crt-input.label-position-left[_ngcontent-%COMP%]   .crt-input-control-container[_ngcontent-%COMP%], [_nghost-%COMP%]   .crt-input.label-position-hidden[_ngcontent-%COMP%]   .crt-input-control-container[_ngcontent-%COMP%]{align-self:baseline}[_nghost-%COMP%]   .crt-input.label-position-left[_ngcontent-%COMP%]   .crt-input-label-container[_ngcontent-%COMP%], [_nghost-%COMP%]   .crt-input.label-position-hidden[_ngcontent-%COMP%]   .crt-input-label-container[_ngcontent-%COMP%]{margin-inline-end:10px;display:flex;align-items:flex-start;align-self:baseline;word-break:break-word;width:136px;min-width:136px}[_nghost-%COMP%]   .crt-input.label-position-left[_ngcontent-%COMP%]   .crt-input-label-container[_ngcontent-%COMP%]   .crt-input-label[_ngcontent-%COMP%], [_nghost-%COMP%]   .crt-input.label-position-hidden[_ngcontent-%COMP%]   .crt-input-label-container[_ngcontent-%COMP%]   .crt-input-label[_ngcontent-%COMP%]{width:100%;margin:9px 0 4px;overflow:hidden;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical}[_nghost-%COMP%]   .crt-input.label-position-above[_ngcontent-%COMP%]{min-height:52px;flex-direction:column;padding-top:0}[_nghost-%COMP%]   .crt-input.label-position-above[_ngcontent-%COMP%]   .crt-input-label-container[_ngcontent-%COMP%]{display:flex}[_nghost-%COMP%]   .crt-input.label-position-above[_ngcontent-%COMP%]   .crt-input-label-container[_ngcontent-%COMP%]   .crt-input-label[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-top:8px}[_nghost-%COMP%]   .crt-input.label-position-above.appearance-outline[_ngcontent-%COMP%]   .crt-input-label-container[_ngcontent-%COMP%]{margin-bottom:8px}[_nghost-%COMP%]   .crt-input.label-position-hidden[_ngcontent-%COMP%]   .crt-input-label-container[_ngcontent-%COMP%]{width:0;min-width:0;margin:0}[_nghost-%COMP%]   .crt-input.label-position-hidden[_ngcontent-%COMP%]   .crt-input-label-container[_ngcontent-%COMP%]   .crt-input-label[_ngcontent-%COMP%]{height:0;color:transparent}[_nghost-%COMP%]   .crt-input[_ngcontent-%COMP%]   .crt-input-control[_ngcontent-%COMP%]   .inner-tools-panel[_ngcontent-%COMP%]{opacity:1;display:inline-flex;flex-direction:row;flex-wrap:nowrap;justify-content:flex-end;align-items:center}[_nghost-%COMP%]   .crt-input[_ngcontent-%COMP%]:not(:hover)   .readonly-icon[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   .crt-input[_ngcontent-%COMP%], [_nghost-%COMP%]   .crt-input[_ngcontent-%COMP%]   .crt-input-control[_ngcontent-%COMP%]{display:flex;padding-inline-end:2px}[_nghost-%COMP%]   .crt-input[_ngcontent-%COMP%]   textarea.mat-input-element[_ngcontent-%COMP%]{padding:0;margin:0}[_nghost-%COMP%]   .crt-input-control[_ngcontent-%COMP%]{display:flex;align-items:center;padding-inline-end:2px}"]})}};(0,l.__decorate)([(0,s.CrtInput)(),(0,l.__metadata)("design:type",String)],_.prototype,"plainText",void 0),(0,l.__decorate)([(0,s.CrtOutput)(),(0,l.__metadata)("design:type",Object)],_.prototype,"plainTextChange",void 0),(0,l.__decorate)([(0,s.CrtInput)(),(0,l.__metadata)("design:type",Object),(0,l.__metadata)("design:paramtypes",[Object])],_.prototype,"editorConfig",null),(0,l.__decorate)([(0,s.CrtInput)(),(0,l.__metadata)("design:type",Object),(0,l.__metadata)("design:paramtypes",[Object])],_.prototype,"mentionsConfig",null),(0,l.__decorate)([(0,s.CrtInput)(),(0,l.__metadata)("design:type",Object)],_.prototype,"mentionsService",void 0),(0,l.__decorate)([(0,s.CrtInput)(),(0,l.__metadata)("design:type",String)],_.prototype,"editorType",void 0),(0,l.__decorate)([(0,s.CrtInput)(),(0,l.__metadata)("design:type",Object),(0,l.__metadata)("design:paramtypes",[Object])],_.prototype,"content",null),(0,l.__decorate)([(0,s.CrtInput)(),(0,l.__metadata)("design:type",String)],_.prototype,"editorUrl",void 0),(0,l.__decorate)([(0,s.CrtInput)(),(0,l.__metadata)("design:type",Object)],_.prototype,"needHandleSave",void 0),(0,l.__decorate)([(0,s.CrtInput)(),(0,l.__metadata)("design:type",Boolean)],_.prototype,"showClip",void 0),(0,l.__decorate)([(0,s.CrtInput)(),(0,l.__metadata)("design:type",Boolean)],_.prototype,"useTemplates",void 0),(0,l.__decorate)([(0,s.CrtInput)(),(0,l.__metadata)("design:type",Object)],_.prototype,"filesStorage",void 0),(0,l.__decorate)([(0,s.CrtOutput)(),(0,l.__metadata)("design:type",Object)],_.prototype,"selectAttachments",void 0),(0,l.__decorate)([(0,s.CrtInput)(),(0,l.__metadata)("design:type",String)],_.prototype,"selection",void 0),(0,l.__decorate)([(0,s.CrtOutput)(),(0,l.__metadata)("design:type",Object)],_.prototype,"selectionChange",void 0),(0,l.__decorate)([(0,s.CrtInput)(),(0,l.__metadata)("design:type",Boolean)],_.prototype,"disableSelectionOptions",void 0),(0,l.__decorate)([(0,s.CrtOutput)(),(0,l.__metadata)("design:type",Object)],_.prototype,"selectTemplate",void 0),(0,l.__decorate)([(0,s.CrtOutput)(),(0,l.__metadata)("design:type",Object)],_.prototype,"filesUploaded",void 0),(0,l.__decorate)([(0,s.CrtInput)(),(0,l.__metadata)("design:type",Object)],_.prototype,"useBodyFilesLinks",void 0),(0,l.__decorate)([(0,s.CrtOutput)(),(0,l.__metadata)("design:type",Object)],_.prototype,"editorBlur",void 0),(0,l.__decorate)([(0,s.CrtOutput)(),(0,l.__metadata)("design:type",Object)],_.prototype,"editorFocus",void 0),(0,l.__decorate)([(0,s.CrtOutput)(),(0,l.__metadata)("design:type",Object)],_.prototype,"editorValueChanged",void 0),(0,l.__decorate)([(0,s.CrtOutput)(),(0,l.__metadata)("design:type",Object)],_.prototype,"newMention",void 0),_=(0,l.__decorate)([(0,s.CrtViewElement)({type:"crt.RichTextEditor",contentSlots:["selectionActions"],formControlConfig:{relatesTo:"control"},reuseStrategy:s.ViewElementReuseStrategy.Reuse,placeholderSize:{height:"52px"}}),(0,s.CrtInterfaceDesignerItem)({toolbarConfig:{groupType:s.DesignerToolGroupType.Inputs,position:41,icon:g(14560),defaultPropertyValues:{label:"",control:"",labelPosition:"auto",placeholder:"",tooltip:"",needHandleSave:!0,filesStorage:{masterRecordColumnValue:"$Id",entitySchemaName:"SysFile",recordColumnName:"RecordId"}},defaultLocalizableStrings:{caption:"Components.RichTextEditor.Caption",label:"Components.RichTextEditor.Caption"}},dataValueTypes:[s.DataValueType.RICH_TEXT],propertiesPanelComponentTypeName:"crt.RichTextPropertiesPanel",viewElementGroupType:s.ViewElementGroupType.Inputs,typeCaption:"Components.RichTextEditor.Caption"}),(0,l.__metadata)("design:paramtypes",[n.Injector,n.ChangeDetectorRef,String,Window,String,String,C.MessageDialogProvider,h.ContactColorService,h.InitialsService,m.Observable,te.Platform,h.FeatureValues,Object,h.BaseFileUploadProcessingService,y.FileIconService,v,ne.RightsService])],_);let V=class extends s.BaseRequestHandler{constructor(e,t,i){super(),this._service=e,this._maskService=t,this._copilotToEditorCommunicationService=i}_getEditors(e){return window.CKEDITOR?.instances?Object.values(CKEDITOR.instances).filter(i=>i.needHandleSave&&i.schemaRecordId===e):[]}_removeCopilotHighlighting(){this._copilotToEditorCommunicationService?.notify({editorAction:h.EditorActionType.RemoveHighlighting})}_saveToEditor(e,t,i){var o=this;return(0,E.A)(function*(){const a=o._getEditors(e);if(a.length>0){const r=o._service.uploadImages(a,{schemaName:t.name,recordId:i.$context.attributes.Id}).pipe((0,m.take)(1)),p=o._service.uploadFile(a,{schemaName:t.name,recordId:i.$context.attributes.Id},i.$context.attributes).pipe((0,m.take)(1));yield(0,m.lastValueFrom)((0,m.forkJoin)([r,p]),{defaultValue:null}),o._service.removeImages(a),a.forEach(c=>{c.uploadFilesData=null})}})()}handle(e){var t=this;return(0,E.A)(function*(){const i="RECORD_SAVING",o=e.$context,a=yield o.Id,r=yield o.getPrimaryDataSchema();if(!r)return t.next?.handle(e);yield t._maskService.showMask(i,e.$context);const p=yield e.$context.CardState;p===s.ModelInPageAction.Edit&&(yield t._saveToEditor(a,r,e)),t._removeCopilotHighlighting();const c=yield t.next?.handle(e);return c&&window.CKEDITOR&&p===s.ModelInPageAction.Add&&(yield t._saveToEditor(a,r,e),yield t.next?.handle(e)),yield t._maskService.hideMask(i,e.$context),c})()}};V=(0,l.__decorate)([(0,s.CrtRequestHandler)({type:"crt.RichTextEditorSaveHandler",requestType:"crt.SaveRecordRequest",scopes:[N.Scopes.AllCards,"BasePageFreedomTemplate",N.Scopes.AllSections]}),(0,l.__metadata)("design:paramtypes",[v,s.MaskService,h.CopilotToEditorCommunicationService])],V);class F{constructor(e){this._selectionActionsMetadataService=e}_getViewConfigs(e,t){return h.MetadataSchemaUtils.getViewConfigInfoByProperty("type",t,e.viewConfig).map(i=>i?.viewConfig).filter(Boolean)}crtOnMetaDataInit(e){var t=this;return(0,E.A)(function*(){const i=e,o=t._getViewConfigs(i,"crt.RichTextEditor");for(const a of o)yield t._selectionActionsMetadataService.setRewriteOptions(i,a);return Promise.resolve(e)})()}static{this.\u0275fac=function(t){return new(t||F)(n.\u0275\u0275inject(M))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:F,factory:F.\u0275fac})}}let H=class ee{static{this.\u0275fac=function(t){return new(t||ee)}}static{this.\u0275mod=n.\u0275\u0275defineNgModule({type:ee})}static{this.\u0275inj=n.\u0275\u0275defineInjector({providers:[{provide:G,useValue:(0,h.getWorkspaceBaseUrl)()+"core/hash/CKEditor/ckeditor.js"},{provide:q,useFactory:()=>window.Terrasoft?.isAngularHost?"shell/styles":"schema-view-component/styles.css"},{provide:h.CRT_METADATA_PREPROCESSOR,useClass:F,multi:!0},M,B,v,h.FileReaderService,U],imports:[L.CommonModule,R.CKEditorModule,C.CrtButtonModule,C.CrtDialogModule,A.MatIconModule,J.MatLegacyTooltipModule,S.FormsModule,S.ReactiveFormsModule,u.CrtSkeletonLoaderModule,y.CdkModule,u.TooltipModule,O.MatLegacyFormFieldModule,P.MatLegacyInputModule,C.CrtInputModule,k.CrtLibTranslateModule.forRoot({i18n:oe}),u.CrtBaseInputWidthHolderModule,u.CrtFullSizeImageModule]})}};H=(0,l.__decorate)([(0,s.CrtModule)({viewElements:[_,w],requestHandlers:[V]})],H),function(){(typeof ngJitMode>"u"||ngJitMode)&&n.\u0275\u0275setNgModuleScope(H,{declarations:[_,w],imports:[L.CommonModule,R.CKEditorModule,C.CrtButtonModule,C.CrtDialogModule,A.MatIconModule,J.MatLegacyTooltipModule,S.FormsModule,S.ReactiveFormsModule,u.CrtSkeletonLoaderModule,y.CdkModule,u.TooltipModule,O.MatLegacyFormFieldModule,P.MatLegacyInputModule,C.CrtInputModule,k.CrtLibTranslateModule,u.CrtResizableDirective,u.CrtBaseInputWidthHolderModule,u.CrtFullSizeImageModule],exports:[_,w]})}();let Q=class extends s.BaseRequest{};Q=(0,l.__decorate)([(0,s.CrtRequest)({type:"crt.SelectionActionRequest"})],Q)},14560:W=>{W.exports=`<svg width="72" height="40" viewBox="0 0 72 40" fill="none" xmlns="http://www.w3.org/2000/svg">
<rect x="8.5" y="8.5" width="55" height="23" rx="0.5" fill="white" stroke="#0D2E4E"/>
<path d="M37 17H19C17.3431 17 16 18.3431 16 20C16 21.6569 17.3431 23 19 23H37C38.6569 23 40 21.6569 40 20C40 18.3431 38.6569 17 37 17Z" fill="#D1D1D1"/>
<path d="M57 13H47C45.8954 13 45 13.8954 45 15V25C45 26.1046 45.8954 27 47 27H57C58.1046 27 59 26.1046 59 25V15C59 13.8954 58.1046 13 57 13Z" stroke="#FF4013" stroke-width="2" stroke-miterlimit="10"/>
<path d="M53 24H51V18H48V16H56V18H53V24Z" fill="#FF4013"/>
</svg>
`}}]);
