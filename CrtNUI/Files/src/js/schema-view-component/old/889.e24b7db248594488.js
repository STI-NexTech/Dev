(self.webpackChunkapp_studio_enterprise_schema_view=self.webpackChunkapp_studio_enterprise_schema_view||[]).push([[889],{30268:(j,B,s)=>{"use strict";s.d(B,{$:()=>x});/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md.
 */function _(i,d,c){var p=document.head||document.getElementsByTagName("head")[0],g=document.createElement("script");typeof d=="function"&&(c=d,d={}),d=d||{},c=c||function(){},g.type=d.type||"text/javascript",g.charset=d.charset||"utf8",g.async="async"in d?!!d.async:!0,g.src=i,d.attrs&&a(g,d.attrs),d.text&&(g.text=String(d.text));var h="onload"in g?L:t;h(g,c),g.onload||L(g,c),p.appendChild(g)}function a(i,d){for(var c in d)i.setAttribute(c,d[c])}function L(i,d){i.onload=function(){this.onerror=this.onload=null,d(null,i)},i.onerror=function(){this.onerror=this.onload=null,d(new Error("Failed to load "+this.src),i)}}function t(i,d){i.onreadystatechange=function(){this.readyState!="complete"&&this.readyState!="loaded"||(this.onreadystatechange=null,d(null,i))}}var f;function x(i,d){return"CKEDITOR"in window?Promise.resolve(CKEDITOR):typeof i!="string"||i.length<1?Promise.reject(new TypeError("CKEditor URL must be a non-empty string.")):(f||(f=x.scriptLoader(i).then(function(c){return d&&d(c),c})),f)}x.scriptLoader=function(i){return new Promise(function(d,c){_(i,function(p){if(f=void 0,p)return c(p);if(!window.CKEDITOR)return c(new Error("Script loaded from editorUrl doesn't provide CKEDITOR namespace."));d(CKEDITOR)})})};function T(i,d){var c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},p;return function(){clearTimeout(p);for(var g=arguments.length,h=new Array(g),r=0;r<g;r++)h[r]=arguments[r];p=setTimeout(i.bind.apply(i,[c].concat(h)),d)}}},26165:(j,B,s)=>{"use strict";s.d(B,{C:()=>L});var _=s(99314),a=s.n(_);const L=new _.InjectionToken("CkeditorThemeStyleUrl")},91945:(j,B,s)=>{"use strict";s.d(B,{i:()=>L});var _=s(99314),a=s.n(_);const L=new _.InjectionToken("CkeditorUrl")},50340:(j,B,s)=>{"use strict";s.d(B,{R:()=>v});var _=s(73308),a=s(97270),L=s(71857),t=s(99314),f=s(98278),x=s(26182),T=s(44537),i=s(27643),d=s(96590),c=s(69244),p=s(59861),g=s(38628),h=s(32942),r=s(16837),m=s(30268),u=s(7557),E=s(87096),b=s(62441),U=s(96091),y=s(34526),R=s(93527),O=s(91756),P=s(26165),X=s(91945),W=s(8517),H=s(47243);class Q{constructor(e,n,o){this._contactColorService=e,this._initialsService=n,this._matIconRegistry=o,this._getMentionsWithDebounce=(0,u.A)(this._getMentions,500),this._mentionStyles="padding-inline-start: 5px;padding-inline-end: 10px;margin-top: 2px;margin-inline-start: 2px;border-radius: 16px;text-decoration: none;max-width: calc(100% - 10px);display: inline-flex;max-height: 1.23em;overflow: hidden;text-overflow: ellipsis;white-space: nowrap;line-height: 1.23em;vertical-align: text-bottom;",this._mentionUserIconStyles="display: inline-flex;height: 2em;line-height: 1.9em;margin-inline-end: 5px;border-radius: 50%;width: 2em;align-self: center;color: white;font-size: 0.6em;justify-content: space-evenly;box-sizing: border-box;font-weight: 400;",this._generalUserMentionStyles="color: var(--crt-palette-primary-500);background-color: var(--crt-palette-interaction-900);",this._externalUserMentionStyles="color: var(--crt-palette-success-700);background-color: var(--crt-palette-success-100);",this._initialsBorderStyle="border: 1px solid var(--crt-palette-border-400)",this._loadExternalUserIcon()}_loadExternalUserIcon(){this._matIconRegistry.getNamedSvgIcon("external-user-type-icon").pipe((0,U.catchError)(()=>(0,U.of)(null))).subscribe(e=>{if(e){const n=(0,r.M6v)(e.outerHTML);this._userIcon=`data:image/svg+xml;base64,${n}`}})}_getPhotoUrl(e){return!e||(0,T.isEmptyGuid)(e)?"":(0,r.Mcf)(e)}_mapMention(e){const n=e.connectionType===`${r.Uo.External}`,o=this._getPhotoUrl(e.primaryImageValue),l=!(0,b.A)(o),C=l?"":this._contactColorService.getNextColor(e.value),S=this._mentionStyles+(n?this._externalUserMentionStyles:this._generalUserMentionStyles),D=l?this._mentionUserIconStyles:"display:none;";let I="display:none;";l||(I=this._mentionUserIconStyles+`background: ${C};`+this._initialsBorderStyle);const K=this._initialsService.getInitials(e.displayValue),N=n?this._userIcon:"",w=JSON.stringify(e);return{id:e.value,name:e.displayValue,icon:o,typeIcon:N,pageUrl:(0,r.TXQ)("Contact",e.value),styles:S,iconStyles:D,initialsStyles:I,initials:K,shortInitials:(0,b.A)(K)?"":K[0],color:C,contactDto:encodeURIComponent(w)}}_getMentions(e){this._mentionRequestOptions=e;const{mentionsService:n,queryString:o,callback:l}=e;n.getContacts(o).pipe((0,U.catchError)(()=>(0,U.of)(null))).subscribe(C=>{l&&l(C?.map(S=>this._mapMention(S))),this._processQueuedRequest(o)})}_processQueuedRequest(e){this._mentionRequestOptions&&this._mentionRequestOptions.queryString!==e?this._getMentions(this._mentionRequestOptions):this._mentionRequestOptions=null}getMentionsWithDebounce(e,n,o){if(!e)return o([]);if(this._mentionRequestOptions){this._mentionRequestOptions={mentionsService:e,queryString:n,callback:o};return}n===""?this._getMentions({mentionsService:e,queryString:n,callback:o}):this._getMentionsWithDebounce({mentionsService:e,queryString:n,callback:o})}getMentionsFromHtml(e){if((0,b.A)(e))return[];const n=new RegExp(/mention-info="(.+?)"/gi);return[...e.matchAll(n)].map(o=>{try{const l=decodeURIComponent(o[1]),C=JSON.parse(l);return C.value?C:null}catch{return null}}).filter(o=>!!o)}}var at=s(99161),Y=s(76696),st=s(54887),rt=s(58433),lt=s(84137),ct=s(73772),dt=s(38641),pt=s(58083),ht=s(45667),ut=s(86731);const mt=["tooltipLink"],gt=["selectionActionsPanel"],Ct=["*"],_t=k=>({"crt-input-required":k});function ft(k,e){k&1&&t.\u0275\u0275elementContainer(0)}function Tt(k,e){if(k&1&&t.\u0275\u0275element(0,"crt-base-input-width-holder",11),k&2){const n=t.\u0275\u0275nextContext();t.\u0275\u0275property("label",n.label)("minWidth",180)}}function Et(k,e){if(k&1&&t.\u0275\u0275element(0,"div",12,2),k&2){const n=t.\u0275\u0275nextContext();t.\u0275\u0275property("tooltipConfig",n.getTooltipConfig())}}function kt(k,e){k&1&&t.\u0275\u0275element(0,"crt-skeleton-loader")}function yt(k,e){if(k&1){const n=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"ckeditor",24),t.\u0275\u0275twoWayListener("dataChange",function(l){t.\u0275\u0275restoreView(n);const C=t.\u0275\u0275nextContext(2);return t.\u0275\u0275twoWayBindingSet(C.control.value,l)||(C.control.value=l),t.\u0275\u0275resetView(l)})("configChange",function(l){t.\u0275\u0275restoreView(n);const C=t.\u0275\u0275nextContext(2);return t.\u0275\u0275twoWayBindingSet(C.editorConfig,l)||(C.editorConfig=l),t.\u0275\u0275resetView(l)}),t.\u0275\u0275listener("ready",function(l){t.\u0275\u0275restoreView(n);const C=t.\u0275\u0275nextContext(2);return t.\u0275\u0275resetView(C.onEditorReady(l))})("focus",function(l){t.\u0275\u0275restoreView(n);const C=t.\u0275\u0275nextContext(2);return t.\u0275\u0275resetView(C.onEditorFocus(l))})("blur",function(l){t.\u0275\u0275restoreView(n);const C=t.\u0275\u0275nextContext(2);return t.\u0275\u0275resetView(C.onEditorBlur(l))})("click",function(l){t.\u0275\u0275restoreView(n);const C=t.\u0275\u0275nextContext(2);return t.\u0275\u0275resetView(C.onClick(l))}),t.\u0275\u0275elementEnd()}if(k&2){const n=t.\u0275\u0275nextContext(2);t.\u0275\u0275property("toggleImageHandlers",(!n.isFocused||n.readonly)&&n.isReady),t.\u0275\u0275twoWayProperty("data",n.control.value)("config",n.editorConfig),t.\u0275\u0275property("type",n.editorType)("editorUrl",n.editorUrl)}}function xt(k,e){if(k&1){const n=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"mat-icon",25),t.\u0275\u0275pipe(1,"translate"),t.\u0275\u0275listener("click",function(){t.\u0275\u0275restoreView(n);const l=t.\u0275\u0275nextContext(2);return t.\u0275\u0275resetView(l.onClipClicked())})("keyup.enter",function(l){t.\u0275\u0275restoreView(n);const C=t.\u0275\u0275nextContext(2);return l.stopPropagation(),t.\u0275\u0275resetView(C.onClipClicked())}),t.\u0275\u0275elementEnd()}k&2&&t.\u0275\u0275property("crtTooltip",t.\u0275\u0275pipeBind1(1,1,"RichTextEditor.UploadAttachments"))}function bt(k,e){if(k&1){const n=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"mat-icon",26),t.\u0275\u0275pipe(1,"translate"),t.\u0275\u0275listener("click",function(){t.\u0275\u0275restoreView(n);const l=t.\u0275\u0275nextContext(2);return t.\u0275\u0275resetView(l.onSelectTemplateClicked())})("keyup.enter",function(l){t.\u0275\u0275restoreView(n);const C=t.\u0275\u0275nextContext(2);return l.stopPropagation(),t.\u0275\u0275resetView(C.onSelectTemplateClicked())}),t.\u0275\u0275elementEnd()}k&2&&t.\u0275\u0275property("crtTooltip",t.\u0275\u0275pipeBind1(1,1,"RichTextEditor.SelectTemplate"))}function vt(k,e){if(k&1){const n=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"mat-icon",27),t.\u0275\u0275pipe(1,"translate"),t.\u0275\u0275listener("click",function(){t.\u0275\u0275restoreView(n);const l=t.\u0275\u0275nextContext(2);return t.\u0275\u0275resetView(l.toggleToolbar())})("focus",function(){t.\u0275\u0275restoreView(n);const l=t.\u0275\u0275nextContext(2);return t.\u0275\u0275resetView(l.lockBlur=!0)})("blur",function(){t.\u0275\u0275restoreView(n);const l=t.\u0275\u0275nextContext(2);return t.\u0275\u0275resetView(l.blurToggle())})("keyup.enter",function(l){t.\u0275\u0275restoreView(n);const C=t.\u0275\u0275nextContext(2);return l.stopPropagation(),t.\u0275\u0275resetView(C.toggleToolbar())})("mousedown",function(){t.\u0275\u0275restoreView(n);const l=t.\u0275\u0275nextContext(2);return t.\u0275\u0275resetView(l.lockBlur=!0)}),t.\u0275\u0275elementEnd()}if(k&2){const n=t.\u0275\u0275nextContext(2);t.\u0275\u0275classMap("toggle-icon toggle-"+(n.showToolbar?"selected":"default")),t.\u0275\u0275property("crtTooltip",t.\u0275\u0275pipeBind1(1,3,"RichTextEditor.ToggleToolbar"))}}function et(k,e){k&1&&(t.\u0275\u0275element(0,"mat-icon",28),t.\u0275\u0275pipe(1,"translate")),k&2&&t.\u0275\u0275property("title",t.\u0275\u0275pipeBind1(1,1,"Input.Readonly"))}function q(k,e){if(k&1&&(t.\u0275\u0275elementContainerStart(0),t.\u0275\u0275element(1,"mat-icon",29),t.\u0275\u0275elementContainerEnd()),k&2){const n=t.\u0275\u0275nextContext(2);t.\u0275\u0275advance(),t.\u0275\u0275property("crtTooltip",n.errorMessages)}}function tt(k,e){if(k&1&&t.\u0275\u0275element(0,"mat-icon",31),k&2){const n=t.\u0275\u0275nextContext(3);t.\u0275\u0275property("crtTooltip",n.tooltip)}}function $(k,e){if(k&1&&t.\u0275\u0275template(0,tt,1,1,"mat-icon",30),k&2){const n=t.\u0275\u0275nextContext(2);t.\u0275\u0275property("ngIf",n.tooltip)}}function J(k,e){if(k&1&&(t.\u0275\u0275elementStart(0,"div",13)(1,"label",14),t.\u0275\u0275text(2),t.\u0275\u0275elementEnd()(),t.\u0275\u0275elementStart(3,"div",15)(4,"div",16)(5,"div",17),t.\u0275\u0275template(6,yt,1,5,"ckeditor",18),t.\u0275\u0275elementStart(7,"div",19),t.\u0275\u0275template(8,xt,2,3,"mat-icon",20)(9,bt,2,3,"mat-icon",21)(10,vt,2,5,"mat-icon",22)(11,et,2,3,"mat-icon",23)(12,q,2,1,"ng-container",10)(13,$,1,1,"ng-template",null,3,t.\u0275\u0275templateRefExtractor),t.\u0275\u0275elementEnd()()()()),k&2){const n=t.\u0275\u0275reference(14),o=t.\u0275\u0275nextContext();t.\u0275\u0275advance(),t.\u0275\u0275property("ngClass",t.\u0275\u0275pureFunction1(16,_t,o.isShownRequiredMark)),t.\u0275\u0275advance(),t.\u0275\u0275textInterpolate(o.label),t.\u0275\u0275advance(),t.\u0275\u0275property("ngClass","label-position-"+o.displayLabelPosition),t.\u0275\u0275advance(2),t.\u0275\u0275classProp("invalid",o.invalid)("readonly",o.readonly)("hasTooltip",o.tooltip),t.\u0275\u0275advance(),t.\u0275\u0275property("ngIf",o.control),t.\u0275\u0275advance(2),t.\u0275\u0275property("ngIf",o.showClip&&o.isFocused&&!o.readonly),t.\u0275\u0275advance(),t.\u0275\u0275property("ngIf",o.useTemplates&&o.isFocused&&!o.readonly),t.\u0275\u0275advance(),t.\u0275\u0275property("ngIf",o.isFocused&&!o.readonly),t.\u0275\u0275advance(),t.\u0275\u0275property("ngIf",o.readonly),t.\u0275\u0275advance(),t.\u0275\u0275property("ngIf",o.invalid)("ngIfElse",n)}}let v=class nt extends g.j_3{get _useMentions(){return!!this.mentionsService||!!this._mentionsConfig}get showToolbar(){return this._showToolbar}set showToolbar(e){this._showToolbar=e,this._setToolbarVisibility(e),this.currentEditor.fire("toggleToolbar",{display:e})}get editorConfig(){return this._editorConfig}set editorConfig(e){Object.assign(this._editorConfig,e)}get mentionsConfig(){return this._mentionsConfig||this._defaultMentionsConfig}set mentionsConfig(e){Object.assign(this._mentionsConfig,e)}set content(e){this.control.setValue(e)}constructor(e,n,o,l,C,S,D,I,K,N,w,M,A,F,V,z,Z){super(e,n),this.matDateLocale=o,this.window=l,this.ckeditorUrl=C,this.themeCssUrlSearchTemplate=S,this._messageDialogProvider=D,this._contactColorService=I,this._initialsService=K,this._currentTheme$=N,this._platform=w,this._featureValues=M,this._domPurifier=A,this._fileUploadProcessingService=F,this._fileIconService=V,this._uploadService=z,this._rightsService=Z,this._editorConfig={skin:"freedom",customConfig:"",toolbar:[["Format","-","CopyFormatting","Bold","Italic","Underline","Strike","-","TextColor","-","NumberedList","BulletedList","-","CreatioLink","CreatioImageFileUploadButton","CreatioFileUploadButton","CreatioTable","-","JustifyLeft","JustifyCenter","JustifyRight","-","Outdent","Indent","Expand","Collapse"]],extraPlugins:"creatioeditorplaceholder, expandcollapse, textmatch, autolink, link, creatiolink, imagebase, uploadimage, creatiouploadfile, creatioImageFileUpload, dragresize, creatiotabletools, tableresize, justify, copyformatting, indent, creatiofixedtoolbox",removePlugins:"smiley,pagebreak,iframe,language,flash,image,magicline,scayt,editorplaceholder",format_tags:"p;h1;h2;h3",colorButton_enableMore:!1,context_menu:[],title:!1,allowedContent:!0,removeButtons:"Link,Image",toolbarStartupExpanded:!1,enterMode:2,startupShowBorders:!1,entities_greek:!1,entities_latin:!1,disableNativeSpellChecker:!1,versionCheck:!1},this._toolbarClassName="crt-rich-text-editor-toolbar",this._defaultMentionsConfig={feed:(G,St)=>this._getMentions(G.query,St),itemTemplate:'<li data-id="{id}" data-qa="{id}-mention-option" class="mention-item"><span class="contact-no-photo" color="{color}" style="background:{color}">{initials}</span><img src="{icon}">{name}<img src="{typeIcon}" class="user-type-icon"></li>',outputTemplate:'<a href="{pageUrl}" contentEditable="false" style="{styles}" data-value="{id}" mention-info="{contactDto}" data-mention-display-value="{name}" data-link="mention" target="_blank"><img style="{iconStyles}" src="{icon}"/><span color="{color}" style="{initialsStyles}">{shortInitials}</span>{name}</a>',minChars:0,marker:"@",throttle:0},this._uploadedFileClassName="file-download-link",this._uploadedFileNameAttribute="crt-uploaded-file-name",this._selectionDebounceDelay=250,this._showToolbar=!1,this._tooltipOffset=24,this._dialogIsShowing=!1,this._namespaceInitialized=!1,this._selectionDebounceFn=(0,u.A)(this._onSelectionChange,this._selectionDebounceDelay),this.isFocused=!1,this.isReady=!1,this.lockBlur=!1,this.plainTextChange=new t.EventEmitter,this.editorType="inline",this.needHandleSave=!0,this.filesStorage={masterRecordColumnValue:"$Id",recordEntitySchemaName:"",recordColumnName:"RecordId",entitySchemaName:"SysFile"},this.selectAttachments=new t.EventEmitter,this.selectionChange=new t.EventEmitter,this.selectTemplate=new t.EventEmitter,this.filesUploaded=new t.EventEmitter,this.useBodyFilesLinks=!0,this.editorBlur=new t.EventEmitter,this.editorFocus=new t.EventEmitter,this.editorValueChanged=new t.EventEmitter,this.newMention=new t.EventEmitter,this.editorUrl=C,this._sanitizeHtmlPipe=this.injector.get(r.b8r),this._matIconRegistry=this.injector.get(x.tp),this._mentionUtils=new Q(this._contactColorService,this._initialsService,this._matIconRegistry),this._selectionActionsPositionService=e.get(W.OP),this._copilotToEditorCommunicationService=e.get(r.iKh),this._selectionUtils=e.get(at.O)}_updateValue(){CKEDITOR.currentInstance&&CKEDITOR.currentInstance.name===this.currentEditor?.name&&(this._currentRecordId=this.control.parent?.value?.Id,this.currentEditor.schemaRecordId=this._currentRecordId,this._updateValueInControl(CKEDITOR.currentInstance)),this.editorValueChanged.emit()}_updateValueInControl(e){const n=e.getData();this.control.setValue(n);const l=e.editable().$?.innerText;this.plainTextChange.emit(l),this._updateValidity()}_setToolbarVisibility(e){const n=(this._lastEditor||CKEDITOR.currentInstance)?.name,o=document.getElementById("cke_"+n);o&&(e?(o.style.opacity="1",o.style.pointerEvents="auto"):(o.style.opacity="0",o.style.pointerEvents="none"))}_updateValidity(){this.control.updateValueAndValidity(),this.control.markAsTouched()}_openUrl(e,n){e&&this.window.open(e,n)}_setContenteditable(e,n){e?.editable().$.setAttribute("contenteditable",n)}_subscribeBeforeDestroyEvent(e){e.editor.on("beforeDestroy",n=>{this.isReady=!1,this._hideTooltip(),n.editor.fire("blur")},this)}_subscribeEvents(e){const n=e.editor;CKEDITOR.on("ariaWidget",this.onPanelElementCreated.bind(this)),n.on("change",this._updateValue.bind(this)),n.on("insertHtml",this._onInsertHtml.bind(this)),n.on("fileUploadRequest",this._handleFileUploadRequest.bind(this)),n.on("CreatioImageClick",()=>this.lockBlur=!0,this),n.on("CreatioImageWindowClose",()=>this.lockBlur=!1,this),n.on("CreatioLinkClick",this._showTooltip.bind(this)),n.on("CreatioLinkDoubleClick",this._showTooltip.bind(this)),n.on("CreatioFileUploadFailed",this._removeFailedLink.bind(this)),n.document.on("keydown",this._handleKeyDownEvent.bind(this)),this._subscribeImageResize(n),this._subscribeToSelectionChange(n),n.container.$.addEventListener("contextmenu",function(o){o.stopPropagation()},!0)}_subscribeToSelectionChange(e){this.disableSelectionOptions||!this._featureValues.SelectionRewriteActions||(e.document.$.body.append(this.selectionActionsPanel.nativeElement),e.document.$.addEventListener("selectionchange",()=>{const n=this._selectionUtils.isEditorContainingSelection(this.currentEditor);(this.selectionActionsPanel.nativeElement.style.display==="unset"||n)&&this._selectionDebounceFn()}))}_handleKeyDownEvent(e){const l=e.data.getKey();[8,46].includes(l)&&this._removeBRBeforeFile(e)}_removeBRBeforeFile(e){const l=this.currentEditor.getSelection().getRanges()[0]?.getNextNode(),C=l?.$;if(C){const S=C.previousElementSibling?.tagName?.toUpperCase()==="BR"&&C.previousSibling?.wholeText?.length===0,D=l.hasClass?.("crt-file-wrapper"),I=C.nextElementSibling?.classList.contains("crt-file-wrapper"),K=C.nodeType===CKEDITOR.NODE_TEXT&&C.nodeValue?.length===0&&I,N=C.tagName?.toUpperCase()==="BR";S&&(D||K)?(C.previousElementSibling.remove(),e.data.preventDefault()):N&&I&&(l.remove(),e.data.preventDefault())}}_removeFailedLink(e){this._replaceUploadedFileContainer(e.editor,e.data.fileName,""),this._showDialogMessage("InfoDialog.FileUpload.InvalidRequestParams")}_validateFileUploadRequest(){var e=this;return(0,_.A)(function*(){if(e.filesStorage.entitySchemaName==="SysFile"&&e.filesStorage.recordColumnName==="RecordId")return!0;if(!e.filesStorage.masterRecordColumnValue||!e.filesStorage.entitySchemaName||!e.filesStorage.recordColumnName||!e.filesStorage.recordEntitySchemaName)return e._showDialogMessage("InfoDialog.FileUpload.InvalidRequestParams"),!1;const n=(yield(0,U.lastValueFrom)(e._rightsService.getCanAdd([e.filesStorage.entitySchemaName]).pipe((0,y.W)(()=>(0,U.of)([])))))[0];return n?.errorMessage&&e._showDialogMessage(n.errorMessage),n?.result})()}_handleFileUploadRequest(e){const{editor:n}=e,o=e?.data?.requestData?.upload?.file,l=e?.data?.fileLoader;l&&(l.abort=()=>{}),e.stop(),o&&(n.crtUploadingFiles=n.crtUploadingFiles||[],n.crtUploadingFiles.push(o)),!(n.crtPastedFiles?.length>n.crtUploadingFiles.length)&&(n.crtPastedFiles=[],this._processFilesUpload(n.crtUploadingFiles).then(C=>{n.crtUploadingFiles=[],n.uploadFilesData={readyToUploadFiles:n.uploadFilesData?.readyToUploadFiles||[],filesStorage:this.filesStorage,uploadEvent:e},C.forEach(S=>{const D=(0,T.generateGuid)();n.uploadFilesData.readyToUploadFiles.push({fileId:D,file:S});const I=this._uploadService.getUploadUrl({fileEntitySchemaName:this.filesStorage.entitySchemaName,id:D});this._wrapFileLink(S.name,I)}),setTimeout(()=>{document.querySelectorAll(".crt-file-wrapper").forEach(S=>S.setAttribute("contenteditable","false"))},0),this.filesUploaded.emit(n.uploadFilesData?.readyToUploadFiles)}))}_processFilesUpload(e){var n=this;return(0,_.A)(function*(){let o;if(!(yield n._validateFileUploadRequest()))return e.forEach(I=>n._replaceUploadedFileContainer(n.currentEditor,I.name,"")),[];const l=yield n._fileUploadProcessingService.processSelectedFiles(e,null),C=l?.files?(0,E.A)(e,l?.files,"name"):[],S=[];l?.errors?.length>0&&(o=n._fileUploadProcessingService.createFileErrorMessageForLogs(l.errors));for(const I of e)(yield n._fileUploadProcessingService.isFileExtensionDeny(I))&&S.push(I);if(S.length>0){const I=n._fileUploadProcessingService.createExtensionAttachmentsErrorMessage(S);o=o?`${I}\r
\r
${o}`:I}const D=[...C,...S];return l.files=(0,E.A)(e,D,"name"),o&&(n._showDialogMessage(o),D.forEach(I=>n._replaceUploadedFileContainer(n.currentEditor,I.name,""))),n.useBodyFilesLinks||l.files.forEach(I=>n._replaceUploadedFileContainer(n.currentEditor,I.name,"")),l.files})()}_showDialogMessage(e){this._dialogIsShowing||(this._dialogIsShowing=!0,this._messageDialogProvider.open({data:{message:e,actions:[g.NNA.OK]}}).subscribe(()=>{this._dialogIsShowing=!1}))}_wrapFileLink(e,n){const o=this._fileIconService.getFileIcon(e);this._matIconRegistry.getNamedSvgIcon(o).pipe((0,y.W)(()=>(0,U.of)(null)),(0,R.T)(l=>{let C="";l&&(l.classList.add(H.E.fileIconImageCssClass),l.style.width="16px",l.style.height="16px",C=l.outerHTML);const S=`<a ${this._uploadedFileNameAttribute}="${e}" class="${this._uploadedFileClassName}" href="${n}" target="_self">${e}</a>`;return`<span contenteditable="false" class="crt-file-wrapper">${C}${S}</span> `})).subscribe(l=>{this._replaceUploadedFileContainer(this.currentEditor,e,l),this._moveCaretPositionAfterFileLink(e)})}_moveCaretPositionAfterFileLink(e){const n=this.currentEditor,l=n.document?.find(`a[${this._uploadedFileNameAttribute}="${e}"]`)?.getItem(0)?.getParent()?.getNext();if(l){const C=n.getSelection(),S=n.createRange();S.setStart(l,1),S.setEnd(l,1),C.selectRanges([S])}}_replaceUploadedFileContainer(e,n,o){const l=e?.document?.$?.querySelector(`a[${this._uploadedFileNameAttribute}="${n}"]`);l?.parentNode&&(l.parentNode.outerHTML=o,this.currentEditor.fire("change"))}_replaceAnchorTags(e){return e.replace(/<a[^>]*data-mention-display-value="([^"]*)"[^>]*>(.*?)<\/a>/gs,function(n,o){return o})}_subscribeImageResize(e){const n=o=>{["*"].includes(o.data.type)&&(o.data.dataValue="")};e.on("paste",o=>{const l=o.editor?.elementPath()?.lastElement;l&&(o.data.dataValue=this._replaceAnchorTags(o.data.dataValue),o.editor.sizeBeforePaste={width:l.getSize("width"),height:l.getSize("height")}),o.editor.crtPastedFiles=o.data?.dataTransfer?.$?.files,n(o)}),e.on("resizeComplete",o=>{const l=o.data.element;l.style.width&&l.style.removeProperty("max-width")})}_onInsertHtml(e){const n=e?.data?.dataValue,o=this._mentionUtils.getMentionsFromHtml(n);o&&o.length>0&&this.newMention.next(o),e.editor?.elementPath()?.lastElement?.find("img").toArray().forEach(l=>{n.includes(CKEDITOR.tools.htmlEncode(l.getAttribute("src")))&&l.setStyle("max-width",`${e.editor.sizeBeforePaste?.width-20}px`)})}_loadSkin(){const e=this._getDomElement(this.window.document,"head");if(e){const n=this.ckeditorUrl.replace("ckeditor.js","");H.E.appendLink(e,n+"skins/freedom/editor.css")}}_overrideShowNotification(e){e.editor.showNotification=n=>{n&&(n=this._sanitizeHtmlPipe.transform(n,{mode:"textOnly",dataType:T.DataValueType.MAXSIZE_TEXT}),this._messageDialogProvider.open({data:{message:n,actions:[g.NNA.OK]}}))}}_getDomElement(e,n){const o=e?.getElementsByTagName(n);return!o||o.length<1?null:o[0]}_restoreSelectionRanges(){this.currentEditor?.getSelection().selectRanges(this.currentEditor?.oldRanges)}_getMentions(e,n){this._mentionUtils.getMentionsWithDebounce(this.mentionsService,e,n)}_isFileLink(){const n=CKEDITOR.plugins.link.getSelectedLink(this.currentEditor,!0)?.[0]||null;return n?.is("a")&&n.hasClass(this._uploadedFileClassName)}_showTooltip(e){if(this._isFileLink())return;this.toggleLink(!0);const n=this.tooltipLink.nativeElement,o=e.editor.getSelectedRanges()[0];if(o){const l=o?.getClientRects()?.[0],C=e.editor.container.getClientRect(),S=(l?.x||0)-C.x,D=(l?.bottom||0)-C.y;n.style.left=`${S}px`,n.style.top=`${D}px`,n.click()}}_hideTooltip(){this.tooltipLink.nativeElement.dispatchEvent(new Event("blur")),this.toggleLink(!1)}_sanitizeGlobalStyleTagContent(e){if(!e.data.sanitized&&!this._featureValues.DisableRemoveRichtextGlobalStyles){const n=this._domPurifier.sanitize(e.data.dataValue,{FORBID_TAGS:["style"],ADD_TAGS:["signature"],ADD_ATTR:["bodylimiter","crt-file-name"]});e.data.dataValue=n,e.data.sanitized=!0}}_disableUploadFilePlugin(){(!this.needHandleSave||!this._featureValues.UseRichTextUploadFile)&&(this.editorConfig.toolbar[0]=this.editorConfig.toolbar[0].filter(e=>e!=="CreatioFileUploadButton"),this.editorConfig.extraPlugins=this.editorConfig.extraPlugins.replace(/creatiouploadfile,/g,""))}_subscribeInstanceCreated(){this._namespaceInitialized?this._namespaceInitialized=!0:CKEDITOR?.on("instanceCreated",e=>e.editor.on("setData",this._sanitizeGlobalStyleTagContent.bind(this)))}_getSelection(){const e=this.currentEditor;return e?e.getSelection():null}_onSelectionChange(){const n=this._getSelection()?.getSelectedText()??"";if((0,b.A)(this.selection)&&this.selection===n)return;this.selectionChange.emit(n),this._selectionActionsPositionService.updatePosition(this.selectionActionsPanel,this.currentEditor?.container?.$)&&this._subscribeToHighlightSelection()}_subscribeToHighlightSelection(){this._copilotToEditorCommunicationService.subscribeToNotifications(this.currentEditor.id,e=>{switch(e.editorAction){case r.uB4.SetHighlighting:this._selectionUtils.highlightSelection(this.currentEditor);break;case r.uB4.RemoveHighlighting:this._selectionUtils.removeHighlight(this.currentEditor),this._updateValueInControl(this.currentEditor);break;case r.Uhu.Replace:case r.Uhu.InsertAbove:case r.Uhu.InsertBelow:this._selectionUtils.replaceSelection(this.currentEditor,e);break}})}onPanelElementCreated(e){const n=this._getDomElement(e.data.$.contentDocument,"head");if(n){const l=this.ckeditorUrl.replace("ckeditor.js","");H.E.appendLink(n,l+"contents.css"),H.E.appendLink(n,l+"skins/freedom/editor.css");const C=H.E.getThemeCssLink(document,this.themeCssUrlSearchTemplate);C?H.E.appendLink(n,C):console.warn(`Not found css-file by ${this.themeCssUrlSearchTemplate}`)}const o=this._getDomElement(e.data.$.contentDocument,"body");o&&(o.classList.contains(this._currentTheme.cssSelector)||o.classList.add(this._currentTheme.cssSelector))}ngOnInit(){this.editorConfig.language=this.matDateLocale?.split("-")[0],this.editorConfig.editorplaceholder=this.placeholder,this.editorConfig.fileStorageName=this.filesStorage.entitySchemaName,this.editorConfig.recordColumnName=this.filesStorage.recordColumnName,this._loadSkin(),this._useMentions&&(Object.assign(this.editorConfig,{mentions:[this.mentionsConfig]}),this.editorConfig.extraPlugins+=", mentions"),this._disableUploadFilePlugin(),(0,m.$)(this.editorUrl).then(this._subscribeInstanceCreated.bind(this))}ngAfterViewInit(){var e=()=>super.ngAfterViewInit,n=this;return(0,_.A)(function*(){e().call(n),n._currentTheme=yield(0,U.firstValueFrom)(n._currentTheme$)})()}onEditorReady(e){this._platform.SAFARI&&e.editor.setActiveEnterMode(CKEDITOR.ENTER_DIV),this._subscribeEvents(e),e.editor.setReadOnly(this.readonly),this.editorName=e.editor.name,document.querySelector(`#cke_${e.editor.name}.cke_float`)?.classList.add(this._toolbarClassName),this.currentEditor=this._lastEditor=e.editor,e.editor.schemaRecordId=this._currentRecordId,this._subscribeBeforeDestroyEvent(e),e.editor.needHandleSave=this.needHandleSave,this._overrideShowNotification(e),this.detectChanges(),this.isReady=!0}toggleLink(e){this.currentEditor.oldRanges=this.currentEditor.getSelectedRanges(),this._setToolbarVisibility(!e)}onEditorFocus(e){const n=document.querySelectorAll(":hover");if(n[n.length-1]instanceof HTMLAnchorElement){this._setContenteditable(e.editor,!1),this._setToolbarVisibility(!1);return}this.isFocused=!0,this.editorFocus.emit(),this.showToolbar?e.editor.focus():this._setToolbarVisibility(!1),e.editor.editable().setAttribute("spellcheck",!0),this._selectionUtils.selectHighlighted(e.editor)}clearSelection(){this._selectionUtils.clearSelection(this.currentEditor)}focus(){this.currentEditor?.focus()}onEditorBlur(e){this._lastEditor=e.editor,e.editor?.editable()&&e.editor.editable().setAttribute("spellcheck",!1),this.lockBlur?e.stop():(this.showToolbar=!1,this.isFocused&&(this.editorBlur.emit(),this.isFocused=!1),this._updateValidity())}toggleToolbar(){this.lockBlur=!1,this.showToolbar=!this.showToolbar,(CKEDITOR.currentInstance||this._lastEditor)?.focus()}onClick(e){const n=e.target;if(n instanceof HTMLAnchorElement&&!this.isFocused){const o=n.getAttribute("href");this._openUrl(o,n.target||"_blank")}this.currentEditor.readOnly||this._setContenteditable(CKEDITOR.currentInstance,!0)}blurToggle(){this.lockBlur&&(this.lockBlur=!1,this.onEditorBlur({}))}onClipClicked(){this.selectAttachments.emit()}onSelectTemplateClicked(){this.selectTemplate.emit()}ngOnChanges(e){e.readonly&&this.currentEditor&&this.currentEditor.setReadOnly(e.readonly.currentValue)}removeReadyToUploadFile(e){const n=this.currentEditor?.uploadFilesData?.readyToUploadFiles;n&&(this.currentEditor.uploadFilesData.readyToUploadFiles=n.filter(o=>o.fileId!==e))}getTooltipConfig(){return new i.Ie({showEvent:"click",hideEvent:"blur",closeOnOutsideClick:!0,tooltipConfig:{value:{editor:this.currentEditor},onClose:this.onLinkWindowClosed.bind(this),onSave:this.onLinkSaved.bind(this),onUnlink:this.onLinkUnlink.bind(this)},preferredPositions:[{originX:"end",originY:"bottom",overlayX:"start",overlayY:"top",offsetY:this._tooltipOffset,offsetX:-this._tooltipOffset},{originX:"end",originY:"top",overlayX:"start",overlayY:"bottom",offsetY:-this._tooltipOffset,offsetX:-this._tooltipOffset}],componentType:O.U})}onLinkSaved(){this._hideTooltip(),this.focus(),this._updateValueInControl(this.currentEditor)}onLinkWindowClosed(){this.focus(),this._restoreSelectionRanges(),this._hideTooltip()}onLinkUnlink(){this._hideTooltip(),this._updateValueInControl(this.currentEditor)}onBeforeUnload(){this._selectionUtils.removeHighlight(this.currentEditor),this._updateValueInControl(this.currentEditor)}static{this.\u0275fac=function(n){return new(n||nt)(t.\u0275\u0275directiveInject(t.Injector),t.\u0275\u0275directiveInject(t.ChangeDetectorRef),t.\u0275\u0275directiveInject(f.Ju,8),t.\u0275\u0275directiveInject(d.WINDOW_TOKEN),t.\u0275\u0275directiveInject(X.i),t.\u0275\u0275directiveInject(P.C),t.\u0275\u0275directiveInject(g.rRR),t.\u0275\u0275directiveInject(r.dKb),t.\u0275\u0275directiveInject(r.jGu),t.\u0275\u0275directiveInject(r.CVM),t.\u0275\u0275directiveInject(L.OD),t.\u0275\u0275directiveInject(r.G2Y),t.\u0275\u0275directiveInject(d.DOM_PURIFIER),t.\u0275\u0275directiveInject(r.TQf),t.\u0275\u0275directiveInject(p.H3),t.\u0275\u0275directiveInject(W.H0),t.\u0275\u0275directiveInject(c.fr))}}static{this.\u0275cmp=t.\u0275\u0275defineComponent({type:nt,selectors:[["crt-rich-text-editor"]],viewQuery:function(n,o){if(n&1&&(t.\u0275\u0275viewQuery(mt,5,t.ElementRef),t.\u0275\u0275viewQuery(gt,5,t.ElementRef)),n&2){let l;t.\u0275\u0275queryRefresh(l=t.\u0275\u0275loadQuery())&&(o.tooltipLink=l.first),t.\u0275\u0275queryRefresh(l=t.\u0275\u0275loadQuery())&&(o.selectionActionsPanel=l.first)}},hostBindings:function(n,o){n&1&&t.\u0275\u0275listener("beforeunload",function(){return o.onBeforeUnload()},!1,t.\u0275\u0275resolveWindow)},inputs:{plainText:"plainText",editorConfig:"editorConfig",mentionsConfig:"mentionsConfig",mentionsService:"mentionsService",editorType:"editorType",content:"content",editorUrl:"editorUrl",needHandleSave:"needHandleSave",showClip:"showClip",useTemplates:"useTemplates",filesStorage:"filesStorage",selection:"selection",disableSelectionOptions:"disableSelectionOptions",useBodyFilesLinks:"useBodyFilesLinks",selectionActions:"selectionActions"},outputs:{plainTextChange:"plainTextChange",selectAttachments:"selectAttachments",selectionChange:"selectionChange",selectTemplate:"selectTemplate",filesUploaded:"filesUploaded",editorBlur:"editorBlur",editorFocus:"editorFocus",editorValueChanged:"editorValueChanged",newMention:"newMention"},features:[t.\u0275\u0275ProvidersFeature([h.IJ]),t.\u0275\u0275InheritDefinitionFeature,t.\u0275\u0275NgOnChangesFeature],ngContentSelectors:Ct,decls:11,vars:7,consts:[["selectionActionsPanel",""],["input",""],["tooltipLink",""],["tooltipIcon",""],[1,"rich-text-selection-actions"],[4,"ngTemplateOutlet"],[3,"label","minWidth",4,"ngIf"],[1,"crt-base-input-container"],["class","link-tooltip","crtTooltip","",3,"tooltipConfig",4,"ngIf"],["crtResizable","",1,"crt-input",3,"resized","ngClass","crtResizableDisabled"],[4,"ngIf","ngIfElse"],[3,"label","minWidth"],["crtTooltip","",1,"link-tooltip",3,"tooltipConfig"],[1,"crt-input-label-container"],[1,"crt-input-label",3,"ngClass"],["floatLabel","never",1,"crt-input-control-container","rich-editor","mat-form-field",3,"ngClass"],[1,"crt-input-control"],[1,"rich-editor-wrapper"],["crtFullSizeImage","","class","rich-editor",3,"toggleImageHandlers","data","config","type","editorUrl","dataChange","configChange","ready","focus","blur","click",4,"ngIf"],[1,"icons"],["matSuffix","","class","clip-icon","svgIcon","clip-filled","tabindex","0",3,"crtTooltip","click","keyup.enter",4,"ngIf"],["class","select-template-icon","matSuffix","","svgIcon","select-template-icon","tabindex","1",3,"crtTooltip","click","keyup.enter",4,"ngIf"],["matSuffix","","svgIcon","richtext-toggle","tabindex","2",3,"class","crtTooltip","click","focus","blur","keyup.enter","mousedown",4,"ngIf"],["matSuffix","","svgIcon","lock","class","readonly-icon",3,"title",4,"ngIf"],["crtFullSizeImage","",1,"rich-editor",3,"dataChange","configChange","ready","focus","blur","click","toggleImageHandlers","data","config","type","editorUrl"],["matSuffix","","svgIcon","clip-filled","tabindex","0",1,"clip-icon",3,"click","keyup.enter","crtTooltip"],["matSuffix","","svgIcon","select-template-icon","tabindex","1",1,"select-template-icon",3,"click","keyup.enter","crtTooltip"],["matSuffix","","svgIcon","richtext-toggle","tabindex","2",3,"click","focus","blur","keyup.enter","mousedown","crtTooltip"],["matSuffix","","svgIcon","lock",1,"readonly-icon",3,"title"],["matSuffix","","svgIcon","info-icon",1,"inner-icon","invalid-icon",3,"crtTooltip"],["matSuffix","","svgIcon","info-icon","class","inner-icon tooltip-icon",3,"crtTooltip",4,"ngIf"],["matSuffix","","svgIcon","info-icon",1,"inner-icon","tooltip-icon",3,"crtTooltip"]],template:function(n,o){if(n&1){const l=t.\u0275\u0275getCurrentView();t.\u0275\u0275projectionDef(),t.\u0275\u0275elementStart(0,"div",4,0),t.\u0275\u0275projection(2),t.\u0275\u0275template(3,ft,1,0,"ng-container",5),t.\u0275\u0275elementEnd(),t.\u0275\u0275template(4,Tt,1,2,"crt-base-input-width-holder",6),t.\u0275\u0275elementStart(5,"div",7),t.\u0275\u0275template(6,Et,2,1,"div",8),t.\u0275\u0275elementStart(7,"div",9),t.\u0275\u0275listener("resized",function(S){return t.\u0275\u0275restoreView(l),t.\u0275\u0275resetView(o.onResized(S))}),t.\u0275\u0275template(8,kt,1,0,"crt-skeleton-loader",10)(9,J,15,18,"ng-template",null,1,t.\u0275\u0275templateRefExtractor),t.\u0275\u0275elementEnd()()}if(n&2){const l=t.\u0275\u0275reference(10);t.\u0275\u0275advance(3),t.\u0275\u0275property("ngTemplateOutlet",o.selectionActions),t.\u0275\u0275advance(),t.\u0275\u0275property("ngIf",o.displayLabelPosition==="auto"),t.\u0275\u0275advance(2),t.\u0275\u0275property("ngIf",!o.loading),t.\u0275\u0275advance(),t.\u0275\u0275property("ngClass","label-position-"+o.displayLabelPosition+" appearance-"+o.appearance)("crtResizableDisabled",!o.isAutoLabelPosition||o.containerQueryMechanismAvailable),t.\u0275\u0275advance(),t.\u0275\u0275property("ngIf",o.loading)("ngIfElse",l)}},dependencies:[Y.NgClass,Y.NgIf,Y.NgTemplateOutlet,st.h,x.An,rt.W,lt.d,ct.xZ,dt.C,pt.q,ht.w,ut.D9],styles:["[_nghost-%COMP%]{display:block}[_nghost-%COMP%]   .link-tooltip[_ngcontent-%COMP%]{width:0px;height:0px;position:relative}[_nghost-%COMP%]   .rich-editor[_ngcontent-%COMP%]{width:100%;overflow:auto}[_nghost-%COMP%]   .rich-editor-wrapper[_ngcontent-%COMP%]{width:100%;float:left;overflow:hidden;display:flex;position:relative}[_nghost-%COMP%]   .rich-editor-wrapper.hasTooltip[_ngcontent-%COMP%]   .icons[_ngcontent-%COMP%]{min-width:40px;max-width:40px}[_nghost-%COMP%]   .rich-editor-wrapper[_ngcontent-%COMP%]   .icons[_ngcontent-%COMP%]{display:flex;align-self:flex-end;justify-content:flex-end;padding:0 0 4px;min-width:20px;max-width:20px}[_nghost-%COMP%]   .rich-editor-wrapper[_ngcontent-%COMP%]   .icons[_ngcontent-%COMP%]   .select-template-icon[_ngcontent-%COMP%], [_nghost-%COMP%]   .rich-editor-wrapper[_ngcontent-%COMP%]   .icons[_ngcontent-%COMP%]   .clip-icon[_ngcontent-%COMP%]{cursor:pointer;color:var(--crt-palette-secondary-500)}[_nghost-%COMP%]   .rich-editor-wrapper[_ngcontent-%COMP%]   .icons[_ngcontent-%COMP%]   .select-template-icon[_ngcontent-%COMP%]:hover, [_nghost-%COMP%]   .rich-editor-wrapper[_ngcontent-%COMP%]   .icons[_ngcontent-%COMP%]   .clip-icon[_ngcontent-%COMP%]:hover{color:var(--crt-palette-primary-500)}[_nghost-%COMP%]   .rich-editor-wrapper[_ngcontent-%COMP%]   .icons[_ngcontent-%COMP%]   .toggle-icon[_ngcontent-%COMP%]{cursor:pointer}[_nghost-%COMP%]   .rich-editor-wrapper[_ngcontent-%COMP%]   .icons[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{max-width:16px;max-height:16px}.rich-text-selection-actions[_ngcontent-%COMP%]{position:fixed;display:none;z-index:2010}","[_nghost-%COMP%]{max-width:100%}.crt-base-edit-input-responsible[_nghost-%COMP%]   .crt-base-input-container[_ngcontent-%COMP%]{container-type:inline-size}@container (width <= 320px){[_nghost-%COMP%]   .crt-input.label-position-auto[_ngcontent-%COMP%]{min-height:52px;flex-direction:column;padding-top:0}[_nghost-%COMP%]   .crt-input.label-position-auto[_ngcontent-%COMP%]   .crt-input-label-container[_ngcontent-%COMP%]{display:flex}[_nghost-%COMP%]   .crt-input.label-position-auto[_ngcontent-%COMP%]   .crt-input-label-container[_ngcontent-%COMP%]   .crt-input-label[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-top:8px}[_nghost-%COMP%]   .crt-input.label-position-auto.appearance-outline[_ngcontent-%COMP%]   .crt-input-label-container[_ngcontent-%COMP%]{margin-bottom:8px}}@container (width > 320px){[_nghost-%COMP%]   .crt-input.label-position-auto[_ngcontent-%COMP%]{min-height:32px;flex-direction:row;padding-top:8px}[_nghost-%COMP%]   .crt-input.label-position-auto[_ngcontent-%COMP%]   .crt-input-control-container[_ngcontent-%COMP%]{align-self:baseline}[_nghost-%COMP%]   .crt-input.label-position-auto[_ngcontent-%COMP%]   .crt-input-label-container[_ngcontent-%COMP%]{margin-inline-end:10px;display:flex;align-items:flex-start;align-self:baseline;word-break:break-word;width:136px;min-width:136px}[_nghost-%COMP%]   .crt-input.label-position-auto[_ngcontent-%COMP%]   .crt-input-label-container[_ngcontent-%COMP%]   .crt-input-label[_ngcontent-%COMP%]{width:100%;margin:9px 0 4px;overflow:hidden;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical}}[_nghost-%COMP%]   .crt-input[_ngcontent-%COMP%]{overflow:hidden;padding-bottom:1px}[_nghost-%COMP%]   .crt-input.label-position-left[_ngcontent-%COMP%], [_nghost-%COMP%]   .crt-input.label-position-hidden[_ngcontent-%COMP%]{min-height:32px;flex-direction:row;padding-top:8px}[_nghost-%COMP%]   .crt-input.label-position-left[_ngcontent-%COMP%]   .crt-input-control-container[_ngcontent-%COMP%], [_nghost-%COMP%]   .crt-input.label-position-hidden[_ngcontent-%COMP%]   .crt-input-control-container[_ngcontent-%COMP%]{align-self:baseline}[_nghost-%COMP%]   .crt-input.label-position-left[_ngcontent-%COMP%]   .crt-input-label-container[_ngcontent-%COMP%], [_nghost-%COMP%]   .crt-input.label-position-hidden[_ngcontent-%COMP%]   .crt-input-label-container[_ngcontent-%COMP%]{margin-inline-end:10px;display:flex;align-items:flex-start;align-self:baseline;word-break:break-word;width:136px;min-width:136px}[_nghost-%COMP%]   .crt-input.label-position-left[_ngcontent-%COMP%]   .crt-input-label-container[_ngcontent-%COMP%]   .crt-input-label[_ngcontent-%COMP%], [_nghost-%COMP%]   .crt-input.label-position-hidden[_ngcontent-%COMP%]   .crt-input-label-container[_ngcontent-%COMP%]   .crt-input-label[_ngcontent-%COMP%]{width:100%;margin:9px 0 4px;overflow:hidden;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical}[_nghost-%COMP%]   .crt-input.label-position-above[_ngcontent-%COMP%]{min-height:52px;flex-direction:column;padding-top:0}[_nghost-%COMP%]   .crt-input.label-position-above[_ngcontent-%COMP%]   .crt-input-label-container[_ngcontent-%COMP%]{display:flex}[_nghost-%COMP%]   .crt-input.label-position-above[_ngcontent-%COMP%]   .crt-input-label-container[_ngcontent-%COMP%]   .crt-input-label[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-top:8px}[_nghost-%COMP%]   .crt-input.label-position-above.appearance-outline[_ngcontent-%COMP%]   .crt-input-label-container[_ngcontent-%COMP%]{margin-bottom:8px}[_nghost-%COMP%]   .crt-input.label-position-hidden[_ngcontent-%COMP%]   .crt-input-label-container[_ngcontent-%COMP%]{width:0;min-width:0;margin:0}[_nghost-%COMP%]   .crt-input.label-position-hidden[_ngcontent-%COMP%]   .crt-input-label-container[_ngcontent-%COMP%]   .crt-input-label[_ngcontent-%COMP%]{height:0;color:transparent}[_nghost-%COMP%]   .crt-input[_ngcontent-%COMP%]   .crt-input-control[_ngcontent-%COMP%]   .inner-tools-panel[_ngcontent-%COMP%]{opacity:1;display:inline-flex;flex-direction:row;flex-wrap:nowrap;justify-content:flex-end;align-items:center}[_nghost-%COMP%]   .crt-input[_ngcontent-%COMP%]:not(:hover)   .readonly-icon[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   .crt-input[_ngcontent-%COMP%], [_nghost-%COMP%]   .crt-input[_ngcontent-%COMP%]   .crt-input-control[_ngcontent-%COMP%]{display:flex;padding-inline-end:2px}[_nghost-%COMP%]   .crt-input[_ngcontent-%COMP%]   textarea.mat-input-element[_ngcontent-%COMP%]{padding:0;margin:0}[_nghost-%COMP%]   .crt-input-control[_ngcontent-%COMP%]{display:flex;align-items:center;padding-inline-end:2px}"]})}};(0,a.Cg)([(0,T.CrtInput)(),(0,a.Sn)("design:type",String)],v.prototype,"plainText",void 0),(0,a.Cg)([(0,T.CrtOutput)(),(0,a.Sn)("design:type",Object)],v.prototype,"plainTextChange",void 0),(0,a.Cg)([(0,T.CrtInput)(),(0,a.Sn)("design:type",Object),(0,a.Sn)("design:paramtypes",[Object])],v.prototype,"editorConfig",null),(0,a.Cg)([(0,T.CrtInput)(),(0,a.Sn)("design:type",Object),(0,a.Sn)("design:paramtypes",[Object])],v.prototype,"mentionsConfig",null),(0,a.Cg)([(0,T.CrtInput)(),(0,a.Sn)("design:type",Object)],v.prototype,"mentionsService",void 0),(0,a.Cg)([(0,T.CrtInput)(),(0,a.Sn)("design:type",String)],v.prototype,"editorType",void 0),(0,a.Cg)([(0,T.CrtInput)(),(0,a.Sn)("design:type",Object),(0,a.Sn)("design:paramtypes",[Object])],v.prototype,"content",null),(0,a.Cg)([(0,T.CrtInput)(),(0,a.Sn)("design:type",String)],v.prototype,"editorUrl",void 0),(0,a.Cg)([(0,T.CrtInput)(),(0,a.Sn)("design:type",Object)],v.prototype,"needHandleSave",void 0),(0,a.Cg)([(0,T.CrtInput)(),(0,a.Sn)("design:type",Boolean)],v.prototype,"showClip",void 0),(0,a.Cg)([(0,T.CrtInput)(),(0,a.Sn)("design:type",Boolean)],v.prototype,"useTemplates",void 0),(0,a.Cg)([(0,T.CrtInput)(),(0,a.Sn)("design:type",Object)],v.prototype,"filesStorage",void 0),(0,a.Cg)([(0,T.CrtOutput)(),(0,a.Sn)("design:type",Object)],v.prototype,"selectAttachments",void 0),(0,a.Cg)([(0,T.CrtInput)(),(0,a.Sn)("design:type",String)],v.prototype,"selection",void 0),(0,a.Cg)([(0,T.CrtOutput)(),(0,a.Sn)("design:type",Object)],v.prototype,"selectionChange",void 0),(0,a.Cg)([(0,T.CrtInput)(),(0,a.Sn)("design:type",Boolean)],v.prototype,"disableSelectionOptions",void 0),(0,a.Cg)([(0,T.CrtOutput)(),(0,a.Sn)("design:type",Object)],v.prototype,"selectTemplate",void 0),(0,a.Cg)([(0,T.CrtOutput)(),(0,a.Sn)("design:type",Object)],v.prototype,"filesUploaded",void 0),(0,a.Cg)([(0,T.CrtInput)(),(0,a.Sn)("design:type",Object)],v.prototype,"useBodyFilesLinks",void 0),(0,a.Cg)([(0,T.CrtOutput)(),(0,a.Sn)("design:type",Object)],v.prototype,"editorBlur",void 0),(0,a.Cg)([(0,T.CrtOutput)(),(0,a.Sn)("design:type",Object)],v.prototype,"editorFocus",void 0),(0,a.Cg)([(0,T.CrtOutput)(),(0,a.Sn)("design:type",Object)],v.prototype,"editorValueChanged",void 0),(0,a.Cg)([(0,T.CrtOutput)(),(0,a.Sn)("design:type",Object)],v.prototype,"newMention",void 0),v=(0,a.Cg)([(0,T.CrtViewElement)({type:"crt.RichTextEditor",contentSlots:["selectionActions"],formControlConfig:{relatesTo:"control"},reuseStrategy:T.ViewElementReuseStrategy.Reuse,placeholderSize:{height:"52px"}}),(0,T.CrtInterfaceDesignerItem)({toolbarConfig:{groupType:T.DesignerToolGroupType.Inputs,position:41,icon:s(14560),defaultPropertyValues:{label:"",control:"",labelPosition:"auto",placeholder:"",tooltip:"",needHandleSave:!0,filesStorage:{masterRecordColumnValue:"$Id",entitySchemaName:"SysFile",recordColumnName:"RecordId"}},defaultLocalizableStrings:{caption:"Components.RichTextEditor.Caption",label:"Components.RichTextEditor.Caption"}},dataValueTypes:[T.DataValueType.RICH_TEXT],propertiesPanelComponentTypeName:"crt.RichTextPropertiesPanel",viewElementGroupType:T.ViewElementGroupType.Inputs,typeCaption:"Components.RichTextEditor.Caption"}),(0,a.Sn)("design:paramtypes",[t.Injector,t.ChangeDetectorRef,String,Window,String,String,g.rRR,r.dKb,r.jGu,U.Observable,L.OD,r.xRQ,Object,r.TQf,p.H3,W.H0,c.fr])],v)},91756:(j,B,s)=>{"use strict";s.d(B,{U:()=>b});var _=s(97270),a=s(99314),L=s.n(a),t=s(37222),f=s(44537),x=s.n(f),T=s(86731),i=s(27643),d=s(96590),c=s.n(d),p=s(16837),g=s(85970),h=s(76696),r=s.n(h),m=s(62115),u=s(19344);function E(U,y){if(U&1){const R=a.\u0275\u0275getCurrentView();a.\u0275\u0275elementStart(0,"crt-button",9),a.\u0275\u0275pipe(1,"translate"),a.\u0275\u0275listener("clicked",function(){a.\u0275\u0275restoreView(R);const P=a.\u0275\u0275nextContext();return a.\u0275\u0275resetView(P.unlink())}),a.\u0275\u0275elementEnd()}U&2&&a.\u0275\u0275property("caption",a.\u0275\u0275pipeBind1(1,1,"RichTextEditorLink.UnlinkLinkButtonCaption"))}let b=class it{get linkControl(){return this.richTextLinkForm.get("linkControl")}get displayTextControl(){return this.richTextLinkForm.get("displayTextControl")}get editor(){return this._editor}set editor(y){!this._isEditorInitialize&&y&&(this._editor=y,this._isEditorInitialize=!0)}set tooltipConfig(y){this.editor=y.value.editor,this._tooltipConfig=y}constructor(y,R,O,P,X,W){this._translate=y,this.window=R,this._changeDetector=O,this._injector=P,this._crtControlStateAdapter=X,this._element=W,this._isEditorInitialize=!1,this.isUnlinkButtonVisible=!1,this.richTextLinkForm=new t.gE({linkControl:new t.MJ("",{validators:[this._crtControlStateAdapter.transform({instance:new g.YSZ(this._injector)}),this._createLinkPatternValidatorFn.bind(this)]}),displayTextControl:new t.MJ("",{})})}_clearFields(){this.linkControl.reset(),this.linkControl.setErrors(null),this.linkControl.updateValueAndValidity(),this.displayTextControl.setValue(""),this.displayTextControl.updateValueAndValidity()}_createLinkPatternValidatorFn(y){return p.NeZ.linkValidator()(y)!==null?this._createValidatorErrorsMessage("InvalidLink","Validators.Link.Message"):null}_createValidatorErrorsMessage(y,R){return{[y]:{message:this._translate.instant(`${R}`)}}}_initialize(){if(!this.editor)return;const y=this.editor.getSelection()?.getSelectedText(),R=CKEDITOR.plugins.link.getSelectedLink(this.editor,!0),O=R?.[0]||null;O?.is("a")?(this.displayTextControl.setValue(O.$.innerText),this.linkControl.setValue(O.getAttribute("href"))):y&&this.displayTextControl.setValue(y),this.isUnlinkButtonVisible=R?.length>0,this._changeDetector.detectChanges(),this.focusLink()}focusLink(){setTimeout(()=>this._element.nativeElement.querySelector(".rich-text-link-container .rich-text-link-field input").focus(),0)}closeLink(){this._clearFields(),this._tooltipConfig?.onClose?.()}openLink(){this.window.open(this.linkControl.value,"_blank")}unlink(){this.editor.execCommand("unlink"),this._tooltipConfig?.onUnlink?.()}save(){if(this.richTextLinkForm.updateValueAndValidity(),this.richTextLinkForm.valid){const y={url:this.linkControl.value,linkText:this.displayTextControl.value};CKEDITOR.plugins.creatiolink.insertOrUpdateLink(y,this.editor),this._clearFields(),this._tooltipConfig?.onSave?.()}}ngOnInit(){this._initialize()}static{this.\u0275fac=function(R){return new(R||it)(a.\u0275\u0275directiveInject(T.c$),a.\u0275\u0275directiveInject(d.WINDOW_TOKEN),a.\u0275\u0275directiveInject(a.ChangeDetectorRef),a.\u0275\u0275directiveInject(a.Injector),a.\u0275\u0275directiveInject(g.ffW),a.\u0275\u0275directiveInject(a.ElementRef))}}static{this.\u0275cmp=a.\u0275\u0275defineComponent({type:it,selectors:[["crt-rich-text-link"]],inputs:{editor:"editor"},decls:14,vars:25,consts:[[1,"rich-text-link-page"],[1,"rich-text-link-container"],["data-qa","input-link",1,"rich-text-link-field",3,"keyup.enter","control","labelPosition","appearance","label"],["data-qa","input-displayText",3,"keyup.enter","control","labelPosition","appearance","label"],[1,"link-button-container"],["iconPosition","left-icon","icon","open-link","size","small","displayType","text","color","default",1,"open-link-button","link-button",3,"clicked","disabled","caption"],["class","unlink-link-button link-button","iconPosition","left-icon","icon","unlink-link","size","small","displayType","text","color","default",3,"caption","clicked",4,"ngIf"],["iconPosition","left-icon","icon","close-link","size","small","displayType","text","color","default",1,"close-link-button","link-button",3,"clicked","caption"],["icon","save-link","size","small","displayType","text","color","default",1,"save-link-button","link-button",3,"clicked","disabled","iconPosition","caption"],["iconPosition","left-icon","icon","unlink-link","size","small","displayType","text","color","default",1,"unlink-link-button","link-button",3,"clicked","caption"]],template:function(R,O){R&1&&(a.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"crt-input",2),a.\u0275\u0275pipe(3,"translate"),a.\u0275\u0275listener("keyup.enter",function(){return O.save()}),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementStart(4,"crt-input",3),a.\u0275\u0275pipe(5,"translate"),a.\u0275\u0275listener("keyup.enter",function(){return O.save()}),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementStart(6,"div",4)(7,"crt-button",5),a.\u0275\u0275pipe(8,"translate"),a.\u0275\u0275listener("clicked",function(){return O.openLink()}),a.\u0275\u0275elementEnd(),a.\u0275\u0275template(9,E,2,3,"crt-button",6),a.\u0275\u0275elementStart(10,"crt-button",7),a.\u0275\u0275pipe(11,"translate"),a.\u0275\u0275listener("clicked",function(){return O.closeLink()}),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementStart(12,"crt-button",8),a.\u0275\u0275pipe(13,"translate"),a.\u0275\u0275listener("clicked",function(){return O.save()}),a.\u0275\u0275elementEnd()()()()),R&2&&(a.\u0275\u0275advance(2),a.\u0275\u0275property("control",O.richTextLinkForm.controls.linkControl)("labelPosition","above")("appearance","legacy")("label",a.\u0275\u0275pipeBind1(3,15,"RichTextEditorLink.LinkLabelCaption")),a.\u0275\u0275advance(2),a.\u0275\u0275property("control",O.richTextLinkForm.controls.displayTextControl)("labelPosition","above")("appearance","legacy")("label",a.\u0275\u0275pipeBind1(5,17,"RichTextEditorLink.TextLabelCaption")),a.\u0275\u0275advance(3),a.\u0275\u0275property("disabled",O.linkControl.invalid)("caption",a.\u0275\u0275pipeBind1(8,19,"RichTextEditorLink.OpenLinkButtonCaption")),a.\u0275\u0275advance(2),a.\u0275\u0275property("ngIf",O.isUnlinkButtonVisible),a.\u0275\u0275advance(),a.\u0275\u0275property("caption",a.\u0275\u0275pipeBind1(11,21,"RichTextEditorLink.CloseLinkButtonCaption")),a.\u0275\u0275advance(2),a.\u0275\u0275property("disabled",O.richTextLinkForm.invalid)("iconPosition","left-icon")("caption",a.\u0275\u0275pipeBind1(13,23,"RichTextEditorLink.SaveLinkButtonCaption")))},dependencies:[h.NgIf,m.B,u.j,T.D9],styles:[".rich-text-link-page[_ngcontent-%COMP%]{width:500px;box-shadow:0 2px 4px #0003;border-radius:4px;padding:16px 16px 0}.link-button-container[_ngcontent-%COMP%]{display:flex;gap:16px;align-items:center;justify-content:right;margin:12px 0}"]})}};b=(0,_.Cg)([(0,f.CrtViewElement)({type:"crt.RichTextLinkComponent"}),(0,_.Sn)("design:paramtypes",[T.c$,Window,a.ChangeDetectorRef,a.Injector,g.ffW,a.ElementRef])],b)},99889:(j,B,s)=>{"use strict";s.r(B),s.d(B,{CKEDITOR_THEME_STYLE_URL:()=>q.C,CKEDITOR_URL:()=>tt.i,CrtRichTextEditorComponent:()=>$.R,CrtRichTextEditorModule:()=>I,CrtRichTextLinkComponent:()=>J.U,RichTextEditorPreprocessor:()=>S,RichTextEditorSaveHandler:()=>o,RichTextEditorUploadService:()=>l.H0,SelectionActionRequest:()=>K,SelectionActionsMetadataService:()=>l.S_,SelectionActionsPositionService:()=>l.OP});var _=s(97270),a=s(76696),L=s(37222),t=s(26182),f=s(73772),x=s(61971),T=s(45202),i=s(44537),d=s(27643),c=s(96590),p=s(59861),g=s(38628),h=s(16837),r=s(54887);const et={"hu-HU":JSON.parse('{"RichTextEditor":{"ToggleToolbar":"Form\xE1z\xE1si lehet\u0151s\xE9gek","UploadAttachments":"V\xE1lassza ki a mell\xE9kleteket","SelectTemplate":"Sablon besz\xFAr\xE1sa"},"RichTextEditorLink":{"SaveLinkButtonCaption":"Ment\xE9s","OpenLinkButtonCaption":"Megnyit\xE1s \xFAj lapon","CloseLinkButtonCaption":"Bez\xE1r","UnlinkLinkButtonCaption":"Link T\xF6rl\xE9se","LinkLabelCaption":"Link c\xEDme","TextLabelCaption":"Megjelen\xEDtend\u0151 sz\xF6veg"}}'),"zh-CN":JSON.parse('{"RichTextEditor":{"ToggleToolbar":"Formatting options","UploadAttachments":"\u9009\u62E9\u9644\u4EF6","SelectTemplate":"\u63D2\u5165\u6A21\u677F"},"RichTextEditorLink":{"SaveLinkButtonCaption":"\u4FDD\u5B58","OpenLinkButtonCaption":"\u5728\u65B0\u6807\u7B7E\u4E2D\u6253\u5F00","CloseLinkButtonCaption":"\u5173\u95ED","UnlinkLinkButtonCaption":"\u53D6\u6D88\u94FE\u63A5","LinkLabelCaption":"\u94FE\u63A5\u5730\u5740","TextLabelCaption":"\u663E\u793A\u5185\u5BB9"}}'),"sq-AL":JSON.parse('{"RichTextEditor":{"ToggleToolbar":"Opsionet e formatimit","UploadAttachments":"P\xEBrzgjidh bashk\xEBngjitjet","SelectTemplate":"Nd\xEBrfut modelin"},"RichTextEditorLink":{"SaveLinkButtonCaption":"Ruaj","OpenLinkButtonCaption":"Hap n\xEB faqe t\xEB re","CloseLinkButtonCaption":"Mbyll","UnlinkLinkButtonCaption":"Shk\xEBput","LinkLabelCaption":"Adresa e linkut","TextLabelCaption":"Teksti i shfaqur"}}'),"en-GB":JSON.parse('{"RichTextEditor":{"ToggleToolbar":"Display toolbar","UploadAttachments":"Select attachments"},"RichTextEditorLink":{"SaveLinkButtonCaption":"Save","OpenLinkButtonCaption":"Open in new tab","CloseLinkButtonCaption":"Close","UnlinkLinkButtonCaption":"Unlink","LinkLabelCaption":"Link address","TextLabelCaption":"Text to display"}}'),"bg-BG":JSON.parse('{"RichTextEditor":{"ToggleToolbar":"\u041E\u043F\u0446\u0438\u0438 \u0437\u0430 \u0444\u043E\u0440\u043C\u0430\u0442\u0438\u0440\u0430\u043D\u0435","UploadAttachments":"\u0418\u0437\u0431\u0435\u0440\u0438 \u043F\u0440\u0438\u043A\u0430\u0447\u0435\u043D\u0438 \u0444\u0430\u0439\u043B\u043E\u0432\u0435","SelectTemplate":"\u0412\u043C\u044A\u043A\u043D\u0438 \u0448\u0430\u0431\u043B\u043E\u043D\u0430"},"RichTextEditorLink":{"SaveLinkButtonCaption":"\u0417\u0430\u043F\u0430\u0437\u0438","OpenLinkButtonCaption":"\u041E\u0442\u0432\u043E\u0440\u0438 \u0432 \u043D\u043E\u0432 \u0440\u0430\u0437\u0434\u0435\u043B","CloseLinkButtonCaption":"\u0417\u0430\u0442\u0432\u043E\u0440\u0438","UnlinkLinkButtonCaption":"\u041F\u0440\u0435\u043A\u0440\u0430\u0442\u0438 \u0432\u0440\u044A\u0437\u043A\u0430\u0442\u0430","LinkLabelCaption":"\u0410\u0434\u0440\u0435\u0441 \u043D\u0430 \u043B\u0438\u043D\u043A\u0430","TextLabelCaption":"\u0422\u0435\u043A\u0441\u0442 \u0437\u0430 \u043F\u043E\u043A\u0430\u0437\u0432\u0430\u043D\u0435"}}'),"zh-TW":JSON.parse('{"RichTextEditor":{"ToggleToolbar":"\u683C\u5F0F\u9078\u9805","UploadAttachments":"\u9009\u62E9\u9644\u4EF6","SelectTemplate":"\u63D2\u5165\u6A21\u677F"},"RichTextEditorLink":{"SaveLinkButtonCaption":"\u5132\u5B58","OpenLinkButtonCaption":"\u5728\u65B0\u6807\u7B7E\u4E2D\u6253\u5F00","CloseLinkButtonCaption":"\u5173\u95ED","UnlinkLinkButtonCaption":"\u53D6\u6D88\u94FE\u63A5","LinkLabelCaption":"\u94FE\u63A5\u5730\u5740","TextLabelCaption":"\u663E\u793A\u5185\u5BB9"}}'),"no-NO":JSON.parse('{"RichTextEditor":{"ToggleToolbar":"Vis verkt\xF8ylinje","UploadAttachments":"Velg vedlegg"},"RichTextEditorLink":{"SaveLinkButtonCaption":"Lagre","OpenLinkButtonCaption":"\xC5pne i ny fane","CloseLinkButtonCaption":"Lukk","UnlinkLinkButtonCaption":"Frakoble","LinkLabelCaption":"Lenke adresse","TextLabelCaption":"Tekst som skal vises"}}'),"ko-KR":JSON.parse('{"RichTextEditor":{"ToggleToolbar":"\uD3EC\uB9F7 \uC635\uC158","UploadAttachments":"\uCCA8\uBD80\uD30C\uC77C \uC120\uD0DD","SelectTemplate":"\uD15C\uD50C\uB9BF \uC0BD\uC785"},"RichTextEditorLink":{"SaveLinkButtonCaption":"\uC644\uB8CC","OpenLinkButtonCaption":"\uC0C8 \uD0ED\uC5D0\uC11C \uC5F4\uAE30","CloseLinkButtonCaption":"\uC885\uACB0","UnlinkLinkButtonCaption":"\uC5F0\uACB0 \uD574\uC81C","LinkLabelCaption":"\uB9C1\uD06C \uC8FC\uC18C","TextLabelCaption":"\uD45C\uC2DC\uD560 \uD14D\uC2A4\uD2B8"}}'),"ja-JP":JSON.parse('{"RichTextEditor":{"ToggleToolbar":"\u66F8\u5F0F\u8A2D\u5B9A","UploadAttachments":"\u6DFB\u4ED8\u30D5\u30A1\u30A4\u30EB\u306E\u9078\u629E","SelectTemplate":"\u30C6\u30F3\u30D7\u30EC\u30FC\u30C8\u306E\u633F\u5165"},"RichTextEditorLink":{"SaveLinkButtonCaption":"\u4FDD\u5B58","OpenLinkButtonCaption":"\u65B0\u3057\u3044\u30BF\u30D6\u3067\u958B\u304F","CloseLinkButtonCaption":"Close","UnlinkLinkButtonCaption":"\u30EA\u30F3\u30AF\u306E\u89E3\u9664","LinkLabelCaption":"\u30EA\u30F3\u30AF\u306E\u30A2\u30C9\u30EC\u30B9","TextLabelCaption":"\u8868\u793A\u3059\u308B\u30C6\u30AD\u30B9\u30C8"}}'),"fr-CA":JSON.parse('{"RichTextEditor":{"ToggleToolbar":"Display toolbar"},"RichTextEditorLink":{"SaveLinkButtonCaption":"Save","OpenLinkButtonCaption":"Open in new tab","CloseLinkButtonCaption":"Close","UnlinkLinkButtonCaption":"Unlink","LinkLabelCaption":"Link address","TextLabelCaption":"Text to display"}}'),zh:JSON.parse('{"RichTextEditor":{"ToggleToolbar":"Display toolbar"},"RichTextEditorLink":{"SaveLinkButtonCaption":"Save","OpenLinkButtonCaption":"Open in new tab","CloseLinkButtonCaption":"Close","UnlinkLinkButtonCaption":"Unlink","LinkLabelCaption":"Link address","TextLabelCaption":"Text to display"}}'),"vi-VN":JSON.parse('{"RichTextEditor":{"ToggleToolbar":"Formatting options","UploadAttachments":"Select attachments","SelectTemplate":"Insert template"},"RichTextEditorLink":{"SaveLinkButtonCaption":"L\u01B0u","OpenLinkButtonCaption":"Open in new tab","CloseLinkButtonCaption":"\u0110\xF3ng","UnlinkLinkButtonCaption":"Unlink","LinkLabelCaption":"Link address","TextLabelCaption":"Text to display"}}'),"tr-TR":JSON.parse('{"RichTextEditor":{"ToggleToolbar":"Formatting options","UploadAttachments":"Select attachments","SelectTemplate":"Insert template"},"RichTextEditorLink":{"SaveLinkButtonCaption":"Kay\u0131t etmek","OpenLinkButtonCaption":"Open in new tab","CloseLinkButtonCaption":"Kapat","UnlinkLinkButtonCaption":"Unlink","LinkLabelCaption":"Link address","TextLabelCaption":"Text to display"}}'),"th-TH":JSON.parse('{"RichTextEditor":{"ToggleToolbar":"Formatting options","UploadAttachments":"Select attachments","SelectTemplate":"Insert template"},"RichTextEditorLink":{"SaveLinkButtonCaption":"\u0E1A\u0E31\u0E19\u0E17\u0E36\u0E01","OpenLinkButtonCaption":"Open in new tab","CloseLinkButtonCaption":"\u0E1B\u0E34\u0E14","UnlinkLinkButtonCaption":"Unlink","LinkLabelCaption":"Link address","TextLabelCaption":"Text to display"}}'),"sv-SE":JSON.parse('{"RichTextEditor":{"ToggleToolbar":"Formatting options","UploadAttachments":"Select attachments","SelectTemplate":"Insert template"},"RichTextEditorLink":{"SaveLinkButtonCaption":"Spara","OpenLinkButtonCaption":"Open in new tab","CloseLinkButtonCaption":"St\xE4ng","UnlinkLinkButtonCaption":"Unlink","LinkLabelCaption":"Link address","TextLabelCaption":"Text to display"}}'),"ro-RO":JSON.parse('{"RichTextEditor":{"ToggleToolbar":"Op\u021Biuni de formatare","UploadAttachments":"Selecta\u021Bi ata\u0219amentele","SelectTemplate":"Inserare template"},"RichTextEditorLink":{"SaveLinkButtonCaption":"Salveaza","OpenLinkButtonCaption":"Deschide \xEEntr-un tab nou","CloseLinkButtonCaption":"Inchideti","UnlinkLinkButtonCaption":"Deconectare","LinkLabelCaption":"Adresa link-ului","TextLabelCaption":"Text de afi\u0219at"}}'),"pt-PT":JSON.parse('{"RichTextEditor":{"ToggleToolbar":"Formatting options","UploadAttachments":"Selecionar anexos","SelectTemplate":"Insert template"},"RichTextEditorLink":{"SaveLinkButtonCaption":"Gravar","OpenLinkButtonCaption":"Abrir novo tabulador","CloseLinkButtonCaption":"Fechar","UnlinkLinkButtonCaption":"Desvincular","LinkLabelCaption":"Link de endere\xE7o","TextLabelCaption":"Texto a ser exibido"}}'),"pt-BR":JSON.parse('{"RichTextEditor":{"ToggleToolbar":"Op\xE7\xF5es de formata\xE7\xE3o","UploadAttachments":"Selecionar anexos","SelectTemplate":"Inserir o modelo"},"RichTextEditorLink":{"SaveLinkButtonCaption":"Salvar","OpenLinkButtonCaption":"Abrir em uma nova aba","CloseLinkButtonCaption":"Fechar","UnlinkLinkButtonCaption":"Desvincular","LinkLabelCaption":"Endere\xE7o do link","TextLabelCaption":"Texto para exibi\xE7\xE3o"}}'),"pl-PL":JSON.parse('{"RichTextEditor":{"ToggleToolbar":"Opcje formatowania","UploadAttachments":"Wybierz za\u0142\u0105czniki","SelectTemplate":"Wstaw szablon"},"RichTextEditorLink":{"SaveLinkButtonCaption":"Zapisz","OpenLinkButtonCaption":"Otw\xF3rz w nowej karcie","CloseLinkButtonCaption":"Zamknij","UnlinkLinkButtonCaption":"Od\u0142\u0105cz","LinkLabelCaption":"Adres linku","TextLabelCaption":"Tekst do wy\u015Bwietlenia"}}'),no:JSON.parse('{"RichTextEditor":{"ToggleToolbar":"Display toolbar"},"RichTextEditorLink":{"SaveLinkButtonCaption":"Save","OpenLinkButtonCaption":"Open in new tab","CloseLinkButtonCaption":"Close","UnlinkLinkButtonCaption":"Unlink","LinkLabelCaption":"Link address","TextLabelCaption":"Text to display"}}'),"nl-NL":JSON.parse('{"RichTextEditor":{"ToggleToolbar":"Formatting options","UploadAttachments":"Select attachments","SelectTemplate":"Insert template"},"RichTextEditorLink":{"SaveLinkButtonCaption":"Opslaan","OpenLinkButtonCaption":"Open in new tab","CloseLinkButtonCaption":"Sluiten","UnlinkLinkButtonCaption":"Unlink","LinkLabelCaption":"Link address","TextLabelCaption":"Text to display"}}'),"lv-LV":JSON.parse('{"RichTextEditor":{"ToggleToolbar":"Formatting options","UploadAttachments":"Select attachments","SelectTemplate":"Insert template"},"RichTextEditorLink":{"SaveLinkButtonCaption":"Save","OpenLinkButtonCaption":"Open in new tab","CloseLinkButtonCaption":"Close","UnlinkLinkButtonCaption":"Unlink","LinkLabelCaption":"Link address","TextLabelCaption":"Text to display"}}'),"kk-KZ":JSON.parse('{"RichTextEditor":{"ToggleToolbar":"Display toolbar","UploadAttachments":"Select attachments"},"RichTextEditorLink":{"SaveLinkButtonCaption":"Save","OpenLinkButtonCaption":"Open in new tab","CloseLinkButtonCaption":"Close","UnlinkLinkButtonCaption":"Unlink","LinkLabelCaption":"Link address","TextLabelCaption":"Text to display"}}'),"it-IT":JSON.parse('{"RichTextEditor":{"ToggleToolbar":"Opzioni di formattazione","UploadAttachments":"Seleziona allegati","SelectTemplate":"Inserisci modello"},"RichTextEditorLink":{"SaveLinkButtonCaption":"Salva","OpenLinkButtonCaption":"Apri in una nuova tab","CloseLinkButtonCaption":"Chiudi","UnlinkLinkButtonCaption":"Scollega","LinkLabelCaption":"Indirizzo del link","TextLabelCaption":"Testo da mostrare"}}'),"id-ID":JSON.parse('{"RichTextEditor":{"ToggleToolbar":"Opsi pemformatan","UploadAttachments":"Pilih lampiran","SelectTemplate":"Sisipkan templat"},"RichTextEditorLink":{"SaveLinkButtonCaption":"Simpan","OpenLinkButtonCaption":"Buka di tab baru","CloseLinkButtonCaption":"Tutup","UnlinkLinkButtonCaption":"Putuskan tautan","LinkLabelCaption":"Alamat tautan","TextLabelCaption":"Teks untuk ditampilkan"}}'),"he-IL":JSON.parse('{"RichTextEditor":{"ToggleToolbar":"Formatting options","UploadAttachments":"\u05D1\u05D7\u05E8 \u05E7\u05D5\u05D1\u05E5 \u05DE\u05E6\u05D5\u05E8\u05E3","SelectTemplate":"Insert template"},"RichTextEditorLink":{"SaveLinkButtonCaption":"\u05E9\u05DE\u05D5\u05E8","OpenLinkButtonCaption":"\u05E4\u05EA\u05D7 \u05D1\u05DB\u05E8\u05D8\u05D9\u05E1\u05D9\u05D9\u05D4 \u05D7\u05D3\u05E9\u05D4","CloseLinkButtonCaption":"\u05E1\u05D2\u05D5\u05E8","UnlinkLinkButtonCaption":"\u05D1\u05D8\u05DC \u05D0\u05EA \u05D4\u05E7\u05D9\u05E9\u05D5\u05E8","LinkLabelCaption":"Link address","TextLabelCaption":"\u05D8\u05E7\u05E1\u05D8 \u05DC\u05EA\u05E6\u05D5\u05D2\u05D4"}}'),"fr-FR":JSON.parse(`{"RichTextEditor":{"ToggleToolbar":"Options de mise en forme","UploadAttachments":"S\xE9lectionner les pi\xE8ces jointes","SelectTemplate":"Ins\xE9rer un template"},"RichTextEditorLink":{"SaveLinkButtonCaption":"Enregistrer","OpenLinkButtonCaption":"Ouvrir dans un nouvel onglet","CloseLinkButtonCaption":"Fermer","UnlinkLinkButtonCaption":"Dissocier","LinkLabelCaption":"Associer l'adresse","TextLabelCaption":"Texte \xE0 afficher"}}`),"fa-IR":JSON.parse('{"RichTextEditor":{"ToggleToolbar":"Display toolbar","UploadAttachments":"Select attachments"},"RichTextEditorLink":{"SaveLinkButtonCaption":"\u0630\u062E\u06CC\u0631\u0647","OpenLinkButtonCaption":"Open in new tab","CloseLinkButtonCaption":"\u0628\u0633\u062A\u0646","UnlinkLinkButtonCaption":"Unlink","LinkLabelCaption":"Link address","TextLabelCaption":"Text to display"}}'),"es-ES":JSON.parse('{"RichTextEditor":{"ToggleToolbar":"Opciones de formato","UploadAttachments":"Seleccionar archivos adjuntos","SelectTemplate":"Insertar plantilla"},"RichTextEditorLink":{"SaveLinkButtonCaption":"Guardar","OpenLinkButtonCaption":"Abrir en una nueva pesta\xF1a","CloseLinkButtonCaption":"Cerrar","UnlinkLinkButtonCaption":"Desvincular","LinkLabelCaption":"Direcci\xF3n del enlace","TextLabelCaption":"Texto a mostrar"}}'),"de-DE":JSON.parse('{"RichTextEditor":{"ToggleToolbar":"Formatierungsoptionen","UploadAttachments":"Anh\xE4nge ausw\xE4hlen","SelectTemplate":"Vorlage einf\xFCgen"},"RichTextEditorLink":{"SaveLinkButtonCaption":"Speichern","OpenLinkButtonCaption":"In neuem Tab \xF6ffnen","CloseLinkButtonCaption":"Schlie\xDFen","UnlinkLinkButtonCaption":"Link entfernen","LinkLabelCaption":"Linkadresse","TextLabelCaption":"anzuzeigender Text"}}'),"cs-CZ":JSON.parse('{"RichTextEditor":{"ToggleToolbar":"Formatting options","UploadAttachments":"Select attachments","SelectTemplate":"Insert template"},"RichTextEditorLink":{"SaveLinkButtonCaption":"Ulo\u017Eit","OpenLinkButtonCaption":"Open in new tab","CloseLinkButtonCaption":"Zav\u0159\xEDt","UnlinkLinkButtonCaption":"Unlink","LinkLabelCaption":"Link address","TextLabelCaption":"Text to display"}}'),"ar-SA":JSON.parse('{"RichTextEditor":{"ToggleToolbar":"\u062E\u064A\u0627\u0631\u0627\u062A \u0627\u0644\u062A\u0646\u0633\u064A\u0642","UploadAttachments":"\u062D\u062F\u062F \u0627\u0644\u0645\u0631\u0641\u0642\u0627\u062A","SelectTemplate":"\u0625\u062F\u062E\u0627\u0644 \u0642\u0627\u0644\u0628"},"RichTextEditorLink":{"SaveLinkButtonCaption":"\u062D\u0641\u0638","OpenLinkButtonCaption":"\u0641\u062A\u062D \u0641\u064A \u0639\u0644\u0627\u0645\u0629 \u062A\u0628\u0648\u064A\u0628 \u062C\u062F\u064A\u062F\u0629","CloseLinkButtonCaption":"\u0623\u063A\u0644\u0642","UnlinkLinkButtonCaption":"\u0625\u0644\u063A\u0627\u0621 \u0627\u0644\u0631\u0628\u0637","LinkLabelCaption":"\u0639\u0646\u0648\u0627\u0646 \u0627\u0644\u0631\u0627\u0628\u0637","TextLabelCaption":"\u0627\u0644\u0646\u0635 \u0627\u0644\u0645\u0631\u0627\u062F \u0639\u0631\u0636\u0647"}}'),"en-US":JSON.parse('{"RichTextEditor":{"ToggleToolbar":"Formatting options","UploadAttachments":"Select attachments","SelectTemplate":"Insert template","SelectionActions":{"AskCopilot":"Ask Copilot","Friendly":"Friendly","Formal":"Formal","Shorten":"Shorten","Extend":"Extend","Rephrase":"Rephrase","RewriteCaption":"Rewrite text"}},"RichTextEditorLink":{"SaveLinkButtonCaption":"Save","OpenLinkButtonCaption":"Open in new tab","CloseLinkButtonCaption":"Close","UnlinkLinkButtonCaption":"Unlink","LinkLabelCaption":"Link address","TextLabelCaption":"Text to display"}}'),"ru-RU":JSON.parse('{"RichTextEditor":{"ToggleToolbar":"\u0424\u043E\u0440\u043C\u0430\u0442\u0438\u0440\u043E\u0432\u0430\u043D\u0438\u0435","UploadAttachments":"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0432\u043B\u043E\u0436\u0435\u043D\u0438\u0435","SelectTemplate":"\u0412\u0441\u0442\u0430\u0432\u0438\u0442\u044C \u0448\u0430\u0431\u043B\u043E\u043D","SelectionActions":{"AskCopilot":"\u0421\u043F\u0440\u043E\u0441\u0438\u0442\u044C Copilot","Friendly":"\u0414\u0440\u0443\u0436\u0435\u043B\u044E\u0431\u043D\u044B\u0439","Formal":"\u0424\u043E\u0440\u043C\u0430\u043B\u044C\u043D\u044B\u0439","Shorten":"\u0421\u043E\u043A\u0440\u0430\u0442\u0438","Extend":"\u0420\u0430\u0441\u0448\u0438\u0440\u044C","Rephrase":"\u041F\u0435\u0440\u0435\u0444\u0440\u0430\u0437\u0438\u0440\u0443\u0439","RewriteCaption":"\u041F\u0435\u0440\u0435\u043F\u0438\u0441\u0430\u0442\u044C \u0442\u0435\u043A\u0441\u0442"}},"RichTextEditorLink":{"SaveLinkButtonCaption":"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C","OpenLinkButtonCaption":"\u041E\u0442\u043A\u0440\u044B\u0442\u044C \u0432 \u043D\u043E\u0432\u043E\u0439 \u0432\u043A\u043B\u0430\u0434\u043A\u0435","CloseLinkButtonCaption":"\u0417\u0430\u043A\u0440\u044B\u0442\u044C","UnlinkLinkButtonCaption":"\u041E\u0442\u043A\u0440\u0435\u043F\u0438\u0442\u044C","LinkLabelCaption":"\u0410\u0434\u0440\u0435\u0441 \u0441\u0441\u044B\u043B\u043A\u0438","TextLabelCaption":"\u0422\u0435\u043A\u0441\u0442 \u0434\u043B\u044F \u043E\u0442\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u044F"}}'),"uk-UA":JSON.parse(`{"RichTextEditor":{"ToggleToolbar":"\u041F\u0430\u0440\u0430\u043C\u0435\u0442\u0440\u0438 \u0444\u043E\u0440\u043C\u0430\u0442\u0443\u0432\u0430\u043D\u043D\u044F","UploadAttachments":"\u0412\u0438\u0431\u0440\u0430\u0442\u0438 \u0432\u043A\u043B\u0430\u0434\u0435\u043D\u043D\u044F","SelectTemplate":"\u0412\u0441\u0442\u0430\u0432\u0438\u0442\u0438 \u0448\u0430\u0431\u043B\u043E\u043D"},"RichTextEditorLink":{"SaveLinkButtonCaption":"\u0417\u0431\u0435\u0440\u0435\u0433\u0442\u0438","OpenLinkButtonCaption":"\u0412\u0456\u0434\u043A\u0440\u0438\u0442\u0438 \u0432 \u043D\u043E\u0432\u0456\u0439 \u0432\u043A\u043B\u0430\u0434\u0446\u0456","CloseLinkButtonCaption":"\u0417\u0430\u043A\u0440\u0438\u0442\u0438","UnlinkLinkButtonCaption":"\u0412\u0456\u0434'\u0454\u0434\u043D\u0430\u0442\u0438","LinkLabelCaption":"\u0410\u0434\u0440\u0435\u0441\u0430 \u043F\u043E\u0441\u0438\u043B\u0430\u043D\u043D\u044F","TextLabelCaption":"\u0422\u0435\u043A\u0441\u0442 \u0434\u043B\u044F \u0432\u0456\u0434\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u043D\u044F"}}`)};var q=s(26165),tt=s(91945),$=s(50340),J=s(91756),v=s(73308),k=s(85970),e=s(96091),n=s(2122);let o=class extends i.BaseRequestHandler{constructor(w,M,A){super(),this._service=w,this._maskService=M,this._copilotToEditorCommunicationService=A}_getEditors(w){return window.CKEDITOR?.instances?Object.values(CKEDITOR.instances).filter(A=>A.needHandleSave&&A.schemaRecordId===w):[]}_removeCopilotHighlighting(){this._copilotToEditorCommunicationService?.notify({editorAction:h.uB4.RemoveHighlighting})}_saveToEditor(w,M,A){var F=this;return(0,v.A)(function*(){const V=F._getEditors(w);if(V.length>0){const z=F._service.uploadImages(V,{schemaName:M.name,recordId:A.$context.attributes.Id}).pipe((0,e.take)(1)),Z=F._service.uploadFile(V,{schemaName:M.name,recordId:A.$context.attributes.Id},A.$context.attributes).pipe((0,e.take)(1));yield(0,e.lastValueFrom)((0,e.forkJoin)([z,Z]),{defaultValue:null}),F._service.removeImages(V),V.forEach(G=>{G.uploadFilesData=null})}})()}handle(w){var M=this;return(0,v.A)(function*(){const A="RECORD_SAVING",F=w.$context,V=yield F.Id,z=yield F.getPrimaryDataSchema();if(!z)return M.next?.handle(w);yield M._maskService.showMask(A,w.$context);const Z=yield w.$context.CardState;Z===i.ModelInPageAction.Edit&&(yield M._saveToEditor(V,z,w)),M._removeCopilotHighlighting();const G=yield M.next?.handle(w);return G&&window.CKEDITOR&&Z===i.ModelInPageAction.Add&&(yield M._saveToEditor(V,z,w),yield M.next?.handle(w)),yield M._maskService.hideMask(A,w.$context),G})()}};o=(0,_.Cg)([(0,i.CrtRequestHandler)({type:"crt.RichTextEditorSaveHandler",requestType:"crt.SaveRecordRequest",scopes:[k.MJm.AllCards,"BasePageFreedomTemplate",k.MJm.AllSections]}),(0,_.Sn)("design:paramtypes",[n.H,i.MaskService,h.iKh])],o);var l=s(8517),C=s(99314);let S=(()=>{class N{constructor(M){this._selectionActionsMetadataService=M}_getViewConfigs(M,A){return h.uSH.getViewConfigInfoByProperty("type",A,M.viewConfig).map(F=>F?.viewConfig).filter(Boolean)}crtOnMetaDataInit(M){var A=this;return(0,v.A)(function*(){const F=M,V=A._getViewConfigs(F,"crt.RichTextEditor");for(const z of V)yield A._selectionActionsMetadataService.setRewriteOptions(F,z);return Promise.resolve(M)})()}static{this.\u0275fac=function(A){return new(A||N)(C.\u0275\u0275inject(l.S_))}}static{this.\u0275prov=C.\u0275\u0275defineInjectable({token:N,factory:N.\u0275fac})}}return N})();var D=s(99161);let I=class ot{static{this.\u0275fac=function(M){return new(M||ot)}}static{this.\u0275mod=C.\u0275\u0275defineNgModule({type:ot})}static{this.\u0275inj=C.\u0275\u0275defineInjector({providers:[{provide:tt.i,useValue:(0,h.cIr)()+"core/hash/CKEditor/ckeditor.js"},{provide:q.C,useFactory:()=>window.Terrasoft?.isAngularHost?"shell/styles":"schema-view-component/styles.css"},{provide:h.m9D,useClass:S,multi:!0},l.S_,l.OP,l.H0,h.dh$,D.O],imports:[a.CommonModule,r.w,g.qOu,g.kdL,t.m_,T.T7,L.YN,L.X1,d.q8,p.V5,d.Ss,f.C,x.mz,g.ugs,c.CrtLibTranslateModule.forRoot({i18n:et}),d.ND,d.bn]})}};I=(0,_.Cg)([(0,i.CrtModule)({viewElements:[$.R,J.U],requestHandlers:[o]})],I),function(){(typeof ngJitMode>"u"||ngJitMode)&&C.\u0275\u0275setNgModuleScope(I,{declarations:[$.R,J.U],imports:[a.CommonModule,r.w,g.qOu,g.kdL,t.m_,T.T7,L.YN,L.X1,d.q8,p.V5,d.Ss,f.C,x.mz,g.ugs,c.CrtLibTranslateModule,d.CT,d.ND,d.bn],exports:[$.R,J.U]})}();let K=class extends i.BaseRequest{};K=(0,_.Cg)([(0,i.CrtRequest)({type:"crt.SelectionActionRequest"})],K)},8517:(j,B,s)=>{"use strict";s.d(B,{H0:()=>_.H,S_:()=>c,OP:()=>p});var _=s(2122),a=s(73308),L=s(44537),t=s(16837),f=s(80759),x=s(62441);const T=["EmailMiniPage","CommunicationsPanel_FeedsTab"];var i=s(99314),d=s(86731);let c=(()=>{class g{constructor(r,m,u){this._translateService=r,this._sysSettingsService=m,this._featureValues=u}_createAttribute(r,m,u){const E=r.viewModelConfig.attributes;return E[m]={value:u},m}_rewriteOptionsAvailable(r,m){var u=this;return(0,a.A)(function*(){return u._featureValues.SelectionRewriteActions&&u._featureValues["GenAIFeatures.Copilot"]&&u._featureValues.SidebarExtensions&&!m.disableSelectionOptions&&(yield u._useNewShell())&&!T.includes(r)})()}_useNewShell(){var r=this;return(0,a.A)(function*(){return(yield r._sysSettingsService.getByCode("UseNewShell"))?.value})()}setRewriteOptions(r,m){var u=this;return(0,a.A)(function*(){if(!(yield u._rewriteOptionsAvailable(r.name,m))){m.disableSelectionOptions=!0;return}const E=(0,x.A)(m.selection)?u._createAttribute(r,`${m.name}_Selection`,""):m.selection.replace("$","");m.selection=`$${E}`,(0,x.A)(m.selectionActions)&&(m.selectionActions=[{type:"crt.Button",icon:"copilot-rewrite-btn-icon",color:"outline",iconPosition:f.q9.OnlyIcon,clickMode:"menu",menuItems:[{type:"crt.MenuLabel",caption:u._translateService.instant("RichTextEditor.SelectionActions.RewriteCaption")},{type:"crt.MenuItem",caption:u._translateService.instant("RichTextEditor.SelectionActions.Friendly"),icon:"copilot-rewrite-friendly-icon",clicked:{request:"crt.SelectionActionRequest",params:{selectionAttributeName:E,rewriteAction:"Friendly"}}},{type:"crt.MenuItem",caption:u._translateService.instant("RichTextEditor.SelectionActions.Formal"),icon:"copilot-rewrite-formal-icon",clicked:{request:"crt.SelectionActionRequest",params:{selectionAttributeName:E,rewriteAction:"Formal"}}},{type:"crt.MenuItem",caption:u._translateService.instant("RichTextEditor.SelectionActions.Shorten"),icon:"copilot-rewrite-shorten-icon",clicked:{request:"crt.SelectionActionRequest",params:{selectionAttributeName:E,rewriteAction:"Shorten"}}},{type:"crt.MenuItem",caption:u._translateService.instant("RichTextEditor.SelectionActions.Extend"),icon:"copilot-rewrite-extend-icon",clicked:{request:"crt.SelectionActionRequest",params:{selectionAttributeName:E,rewriteAction:"Extend"}}},{type:"crt.MenuItem",caption:u._translateService.instant("RichTextEditor.SelectionActions.Rephrase"),icon:"copilot-rewrite-rephrase-icon",clicked:{request:"crt.SelectionActionRequest",params:{selectionAttributeName:E,rewriteAction:"Rephrase"}}},{type:"crt.MenuDivider"},{type:"crt.MenuItem",caption:u._translateService.instant("RichTextEditor.SelectionActions.AskCopilot"),icon:"copilot-action-button-icon",clicked:{request:"crt.SelectionActionRequest",params:{selectionAttributeName:E,rewriteAction:"AskCopilot"}}}]}])})()}static{this.\u0275fac=function(m){return new(m||g)(i.\u0275\u0275inject(d.c$),i.\u0275\u0275inject(L.SysSettingsService),i.\u0275\u0275inject(t.G2Y))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:g,factory:g.\u0275fac,providedIn:"any"})}}return g})(),p=(()=>{class g{constructor(){this._editorClassName=".cke_editable"}_setSelectionActionsVisibility(r,m){if(r){const u=this._getSelectionActionsPanelPosition();m.nativeElement.style.display="unset",m.nativeElement.style.top=u.clientY,m.nativeElement.style.left=u.clientX}else m.nativeElement.style.display="none"}_getSelectionActionsPanelPosition(){return this._getPositionFromSelection()||{clientX:"50%",clientY:"50%"}}_getPositionFromSelection(){const r=getSelection()?.getRangeAt(0)?.getClientRects(),m=Array.from(r||[]);if(m.length===0)return null;let u=m[0];const E=getSelection()?.getRangeAt(0)?.getBoundingClientRect();return m.forEach(b=>{(b.top>u.top||b.top===u.top&&b.right>u.right)&&(u=b)}),{clientX:`${Math.min(u.right,E.right)}px`,clientY:`${u.bottom}px`}}updatePosition(r,m){if(!r)return!1;const u=getSelection(),E=u?.type==="Range",b=m?.contains(u?.focusNode),y=!!(u.focusNode?.nodeType===Node.ELEMENT_NODE?u.focusNode:u.focusNode?.parentElement)?.closest(this._editorClassName),R=E&&b&&y;return this._setSelectionActionsVisibility(R,r),R}static{this.\u0275fac=function(m){return new(m||g)}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:g,factory:g.\u0275fac,providedIn:"any"})}}return g})()},2122:(j,B,s)=>{"use strict";s.d(B,{H:()=>c});var _=s(44537),a=s.n(_),L=s(37603),t=s(16837),f=s(96091),x=s.n(f),T=s(47243),i=s(99314),d=s.n(i);let c=(()=>{class p{constructor(h,r,m){this._fileApiService=h,this._fileService=r,this.queryExecutor=m,this._sysDownloadMethod="/rest/FileService/Download"}_replaceSrc(h,r,m){h.removeAttribute("data-cke-saved-src"),h.setAttribute("src",r),h.setAttribute("data-uploaded-image-id",m)}_getFileType(h){const r=h.match(/data:(.*);base64/);return r?r[1]:null}_mapFileDto(h,r){return{...h,id:(0,_.generateGuid)(),fileEntitySchemaName:r.fileSchemaName||"SysFile",recordColumnName:r.recordColumnName||"RecordId",recordEntitySchemaName:r.schemaName,recordId:r.recordId,tag:"inline"}}_getFile(h,r,m){const u=this._getFileData(h,r);return new File([u],m,{type:r})}_getFileData(h,r){const m=h.split(";base64,"),u=window.atob(m[1]),E=new Array(u.length);for(let y=0;y<u.length;y++)E[y]=u.charCodeAt(y);const b=new Uint8Array(E);return new Blob([b],{type:r})}_getImageIdentifiers(h){const r=/data-uploaded-image-id="([^"]*)"/gim,m=[];let u=r.exec(h);for(;u!=null;)m.push(u[1]),u=r.exec(h);return m}_catchErrorResponse(h){return console.error(h),(0,f.of)({success:!1,errorInfo:{errorCode:null,message:h.message,stackTrace:h.stack},result:null})}_getDeleteQuery(h){const r=new _.DeleteQuery("SysFile");return r.filters.addSchemaColumnInFilterWithParameters(_.ComparisonType.Equal,"Id",h),r}getUploadUrl(h){return(0,t.uJ3)((0,t.cIr)(),this._sysDownloadMethod,h.fileEntitySchemaName||"SysFile",h.id)}uploadImages(h,r){const m=h.map(u=>{const E=T.E.getEditorImages(u),b=[];r.fileSchemaName=r.fileSchemaName||u.config.fileStorageName,r.recordColumnName=r.recordColumnName||u.config.recordColumnName;for(let U=0;U<E?.length;U++){const y=E[U],R=y.getAttribute("src"),O=y.getAttribute("crt-file-name"),P=this._getFileType(R);if(P){const W=P.match(/\/(\w+)/)?.[1],H=(0,_.generateGuid)();let Q=O||`${r.schemaName}_${r.recordId}_${H}`;W&&!O&&(Q+=`.${W}`),b.push({element:y,file:this._getFile(R,P,Q),fileId:H})}}return{editor:u,imageFiles:b}}).filter(u=>u.imageFiles.length>0);return m.length===0?(0,f.of)({}):(0,f.from)(m).pipe((0,f.concatMap)(u=>(0,f.from)(u.imageFiles).pipe((0,f.concatMap)(E=>(0,f.zip)(this._fileService.read(E.file),(0,f.of)(E))),(0,f.map)(E=>({dto:this._mapFileDto(E[0],r),image:E[1]})),(0,f.concatMap)(E=>this._fileApiService.upload(E.dto).pipe((0,f.map)(()=>{this._replaceSrc(E.image.element,this.getUploadUrl(E.dto),E.dto.id),u.editor.fire("change")}),(0,f.catchError)(b=>this._catchErrorResponse(b)))),(0,f.toArray)())),(0,f.toArray)())}removeImages(h){h.forEach(r=>{const m=this._getImageIdentifiers(T.E.getLastSnapshotContent(r)),u=this._getImageIdentifiers(r.getData()),E=m.filter(b=>!u.includes(b));if(E.length>0){const b=this._getDeleteQuery(E);this.queryExecutor.execute(b).pipe((0,f.map)(()=>({success:!0,errorInfo:null,result:[]})),(0,f.catchError)(U=>this._catchErrorResponse(U))).subscribe()}})}uploadFile(h,r,m){const u=h.filter(E=>E.uploadFilesData);return(0,f.from)(u).pipe((0,f.concatMap)(E=>{const{readyToUploadFiles:b,uploadEvent:U}=E.uploadFilesData,y=E.uploadFilesData.filesStorage;return U.stop(),(0,f.from)(b).pipe((0,f.concatMap)(R=>this._fileService.read(R.file).pipe((0,f.map)(O=>{let P=y.masterRecordColumnValue?m[y.masterRecordColumnValue.replace("$","")]:r.recordId;return P=P?.value?P.value:P,{...O,id:R.fileId,fileEntitySchemaName:y.entitySchemaName,recordColumnName:y.recordColumnName,recordEntitySchemaName:y.recordEntitySchemaName||r.schemaName,recordId:P}}),(0,f.concatMap)(O=>this._fileApiService.upload(O).pipe((0,f.catchError)(P=>(P?.status!==200&&E.fire("CreatioFileUploadFailed",{fileName:O.file.name}),this._catchErrorResponse(P))))))),(0,f.toArray)())}),(0,f.toArray)())}static{this.\u0275fac=function(r){return new(r||p)(i.\u0275\u0275inject(t.kzi),i.\u0275\u0275inject(t.dh$),i.\u0275\u0275inject(L.wU))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:p,factory:p.\u0275fac,providedIn:"any"})}}return p})()},47243:(j,B,s)=>{"use strict";s.d(B,{E:()=>_});let _=(()=>{class a{static{this.fileIconImageCssClass="file-icon-system-image"}static getLastSnapshotContent(t){const f=t.undoManager.snapshots;return f[f.length-1].contents}static getEditorImages(t){const f=t.editable().$.getElementsByTagName("img");return Array.from(f).filter(x=>!x.classList.contains(this.fileIconImageCssClass))}static getThemeCssLink(t,f){const x=t.styleSheets;let T;for(let i=0;i<x.length;i++)if(x[i].href&&(T=T??x[i].href,x[i].href?.toLowerCase().indexOf(f)>-1))return x[i].href;return T}static appendLink(t,f){function x(i){const d=document.createElement("link");return d.rel="stylesheet",d.type="text/css",d.href=i,d.media="all",d}function T(i,d){function c(h){const r=h.indexOf("?");return r>=0?h.substr(0,r):h}const p=c(d),g=i.getElementsByTagName("link");for(let h=0;h<g.length;h++)if(c(g[h].href).endsWith(p.replace("./","")))return!0;return!1}f&&!T(t,f)&&t.appendChild(x(f))}}return a})()},99161:(j,B,s)=>{"use strict";s.d(B,{O:()=>f});var _=s(16837),a=s(62441),L=s(99314),t=s.n(L);let f=(()=>{class x{constructor(){this._highlightClass="rich-editor-highlight",this._wrapperClass="rich-editor-highlight-wrapper"}_deleteElementsInRange(i,d,c){const p=i.createRange();p.setStartBefore(d),p.setEndAfter(c);let g=[],h;if(d.getUniqueId()===c.getUniqueId()){let r=!1;g=c.getParent().getChildren().toArray().filter(m=>r||(r=m.getUniqueId()===c.getUniqueId()))}else{const r=new CKEDITOR.dom.walker(p);for(;h=r.next();)g.push(h)}g.forEach(r=>r.remove())}_highlightElements(i){const d=[],c=new CKEDITOR.dom.walker(i);let p;for(;p=c.next();)if(p.type===CKEDITOR.NODE_TEXT)d.push(p);else if(p.contains(i.endContainer)){d.push(p);break}d.forEach(g=>{this._wrapElements(g,i)})}_wrapElements(i,d){if(i.type===CKEDITOR.NODE_TEXT){const c=i.getUniqueId()===d.startContainer.getUniqueId()?d.startOffset:0,p=i.getUniqueId()===d.endContainer.getUniqueId()?d.endOffset:0;this._wrapTextElement(i,c,p)}else{const c=i.getChildren();for(let p=0;p<c.count();p++)this._wrapElements(c.getItem(p),d)}}_wrapTextElement(i,d=0,c=0){const p=this._createWrapElement(this._wrapperClass),g=i.getText();if(d>0&&c===0){const h=g.slice(0,d),r=new CKEDITOR.dom.text(h);p.append(r);const m=g.slice(d),u=this._createWrapElement();u.setHtml(m),p.append(u)}else if(d===0&&c>0){const h=g.slice(0,c),r=this._createWrapElement();r.setHtml(h),p.append(r);const m=g.slice(c),u=new CKEDITOR.dom.text(m);p.append(u)}else if(d>0&&c>0){const h=g.slice(0,d),r=new CKEDITOR.dom.text(h);p.append(r);const m=g.slice(d,c),u=this._createWrapElement();u.setHtml(m),p.append(u);const E=g.slice(c),b=new CKEDITOR.dom.text(E);p.append(b)}else if(d===0||c===0){const h=this._createWrapElement();h.setHtml(g),p.append(h)}p.replace(i)}_createWrapElement(i=this._highlightClass){const d=new CKEDITOR.dom.element("span");return(0,a.A)(i)||d.setAttribute("class",i),d}_removeHighlighting(i){this._getElementsBySelector(i,this._highlightClass).toArray().forEach(p=>{p.remove(!0)}),this._getElementsBySelector(i,this._wrapperClass).toArray().forEach(p=>{p.remove(!0)})}_removeSelection(i){if(!this.isEditorContainingSelection(i))return;i.getSelection()?.removeAllRanges(),getSelection()?.empty()}_getElementsBySelector(i,d){return i.editable().find("."+d)}_createRange(i,d,c){const p=i.createRange();return p.setStartBefore(d),p.setEndAfter(c),p}highlightSelection(i){if(!i||i.readOnly)return;this._removeHighlighting(i),i.getSelection().getRanges().forEach(p=>{i.fire("saveSnapshot"),this._highlightElements(p)}),this.clearSelection(i),i.fire("saveSnapshot")}removeHighlight(i){!i||i.readOnly||(this._removeHighlighting(i),this._removeSelection(i))}isEditorContainingSelection(i){const d=getSelection();return!d||!i?!1:!!i?.container?.$?.contains(d?.focusNode)}clearSelection(i){!i||i.readOnly||this._removeSelection(i)}replaceSelection(i,d){if(!i||i.readOnly)return;const c=this._getElementsBySelector(i,this._highlightClass);if(c.count()===0)return;const p=c.getItem(0),g=c.getItem(c.count()-1);switch(d.editorAction){case _.Uhu.Replace:{const h=p.getParent();let r=!1;const m=g.getParent().getChildren().toArray().filter(u=>r||(r=u.getUniqueId()===g.getUniqueId()));m.shift(),this._deleteElementsInRange(i,p,g),h.appendText(d.selection),m.forEach(u=>h.append(u));break}case _.Uhu.InsertAbove:p.insertBeforeMe(new CKEDITOR.dom.text(d.selection));break;case _.Uhu.InsertBelow:new CKEDITOR.dom.text(d.selection).insertAfter(g);break}this.removeHighlight(i)}selectHighlighted(i){if(!i||i.readOnly)return;const d=this._getElementsBySelector(i,this._highlightClass),c=d.getItem(0),p=d.getItem(d.count()-1);if(!c||!p)return;this._removeSelection(i);const g=this._createRange(i,c,p),h=i.getSelection();h.selectRanges([g]);const r=h.createBookmarks(g);this._removeHighlighting(i),h.selectBookmarks(r),i.fire("saveSnapshot")}static{this.\u0275fac=function(d){return new(d||x)}}static{this.\u0275prov=L.\u0275\u0275defineInjectable({token:x,factory:x.\u0275fac})}}return x})()},14560:j=>{j.exports=`<svg width="72" height="40" viewBox="0 0 72 40" fill="none" xmlns="http://www.w3.org/2000/svg">
<rect x="8.5" y="8.5" width="55" height="23" rx="0.5" fill="white" stroke="#0D2E4E"/>
<path d="M37 17H19C17.3431 17 16 18.3431 16 20C16 21.6569 17.3431 23 19 23H37C38.6569 23 40 21.6569 40 20C40 18.3431 38.6569 17 37 17Z" fill="#D1D1D1"/>
<path d="M57 13H47C45.8954 13 45 13.8954 45 15V25C45 26.1046 45.8954 27 47 27H57C58.1046 27 59 26.1046 59 25V15C59 13.8954 58.1046 13 57 13Z" stroke="#FF4013" stroke-width="2" stroke-miterlimit="10"/>
<path d="M53 24H51V18H48V16H56V18H53V24Z" fill="#FF4013"/>
</svg>
`},54887:(j,B,s)=>{"use strict";s.d(B,{h:()=>x,w:()=>T});var _=s(99314),a=s(76696),L=s(37222),t=s(30268);/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md.
 */function f(i,d){}let x=(()=>{class i{constructor(c,p){this.elementRef=c,this.ngZone=p,this.editorUrl="https://cdn.ckeditor.com/4.22.1/standard-all/ckeditor.js",this.tagName="textarea",this.type="classic",this.namespaceLoaded=new _.EventEmitter,this.ready=new _.EventEmitter,this.dataReady=new _.EventEmitter,this.change=new _.EventEmitter,this.dataChange=new _.EventEmitter,this.dragStart=new _.EventEmitter,this.dragEnd=new _.EventEmitter,this.drop=new _.EventEmitter,this.fileUploadResponse=new _.EventEmitter,this.fileUploadRequest=new _.EventEmitter,this.focus=new _.EventEmitter,this.paste=new _.EventEmitter,this.afterPaste=new _.EventEmitter,this.blur=new _.EventEmitter,this._readOnly=null,this._data=null,this._destroyed=!1}set data(c){if(c!==this._data){if(this.instance){this.instance.setData(c),this._data=this.instance.getData();return}this._data=c}}get data(){return this._data}set readOnly(c){if(this.instance){this.instance.setReadOnly(c);return}this._readOnly=c}get readOnly(){return this.instance?this.instance.readOnly:this._readOnly}ngAfterViewInit(){(0,t.$)(this.editorUrl,c=>{this.namespaceLoaded.emit(c)}).then(()=>{this._destroyed||this.ngZone.runOutsideAngular(this.createEditor.bind(this))}).catch(window.console.error)}ngOnDestroy(){this._destroyed=!0,this.ngZone.runOutsideAngular(()=>{this.instance&&(this.instance.destroy(),this.instance=null)})}writeValue(c){this.data=c}registerOnChange(c){this.onChange=c}registerOnTouched(c){this.onTouched=c}createEditor(){const c=document.createElement(this.tagName);this.elementRef.nativeElement.appendChild(c);const p=this.config?.on?.instanceReady,h={...{delayIfDetached:!0},...this.config};typeof h.on>"u"&&(h.on={}),h.on.instanceReady=r=>{const m=r.editor;this.instance=m,this.readOnly=this._readOnly!==null?this._readOnly:this.instance.readOnly,this.subscribe(this.instance);const u=m.undoManager;this.data!==null?(u&&u.lock(),m.setData(this.data,{callback:()=>{this.data!==m.getData()&&(u?m.fire("change"):m.fire("dataReady")),u&&u.unlock(),this.ngZone.run(()=>{typeof p=="function"&&p(r),this.ready.emit(r)})}})):this.ngZone.run(()=>{typeof p=="function"&&p(r),this.ready.emit(r)})},this.type==="inline"?CKEDITOR.inline(c,h):CKEDITOR.replace(c,h)}subscribe(c){c.on("focus",p=>{this.ngZone.run(()=>{this.focus.emit(p)})}),c.on("paste",p=>{this.ngZone.run(()=>{this.paste.emit(p)})}),c.on("afterPaste",p=>{this.ngZone.run(()=>{this.afterPaste.emit(p)})}),c.on("dragend",p=>{this.ngZone.run(()=>{this.dragEnd.emit(p)})}),c.on("dragstart",p=>{this.ngZone.run(()=>{this.dragStart.emit(p)})}),c.on("drop",p=>{this.ngZone.run(()=>{this.drop.emit(p)})}),c.on("fileUploadRequest",p=>{this.ngZone.run(()=>{this.fileUploadRequest.emit(p)})}),c.on("fileUploadResponse",p=>{this.ngZone.run(()=>{this.fileUploadResponse.emit(p)})}),c.on("blur",p=>{this.ngZone.run(()=>{this.onTouched&&this.onTouched(),this.blur.emit(p)})}),c.on("dataReady",this.propagateChange,this),this.instance.undoManager?c.on("change",this.propagateChange,this):c.on("selectionCheck",this.propagateChange,this)}propagateChange(c){this.ngZone.run(()=>{const p=this.instance.getData();c.name==="change"?this.change.emit(c):c.name==="dataReady"&&this.dataReady.emit(c),p!==this.data&&(this._data=p,this.dataChange.emit(p),this.onChange&&this.onChange(p))})}}return i.\u0275fac=function(c){return new(c||i)(_.\u0275\u0275directiveInject(_.ElementRef),_.\u0275\u0275directiveInject(_.NgZone))},i.\u0275cmp=_.\u0275\u0275defineComponent({type:i,selectors:[["ckeditor"]],inputs:{config:"config",editorUrl:"editorUrl",tagName:"tagName",type:"type",data:"data",readOnly:"readOnly"},outputs:{namespaceLoaded:"namespaceLoaded",ready:"ready",dataReady:"dataReady",change:"change",dataChange:"dataChange",dragStart:"dragStart",dragEnd:"dragEnd",drop:"drop",fileUploadResponse:"fileUploadResponse",fileUploadRequest:"fileUploadRequest",focus:"focus",paste:"paste",afterPaste:"afterPaste",blur:"blur"},features:[_.\u0275\u0275ProvidersFeature([{provide:L.kq,useExisting:(0,_.forwardRef)(()=>i),multi:!0}])],decls:1,vars:0,template:function(c,p){c&1&&_.\u0275\u0275template(0,f,0,0,"ng-template")},encapsulation:2}),i})();/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md.
 *//**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md.
 */let T=(()=>{class i{}return i.\u0275fac=function(c){return new(c||i)},i.\u0275mod=_.\u0275\u0275defineNgModule({type:i}),i.\u0275inj=_.\u0275\u0275defineInjector({imports:[[L.YN,a.CommonModule]]}),i})()}}]);
