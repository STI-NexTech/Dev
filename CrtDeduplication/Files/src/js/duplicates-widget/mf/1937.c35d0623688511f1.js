(self.webpackChunkapp_studio_enterprise_duplicates_widget=self.webpackChunkapp_studio_enterprise_duplicates_widget||[]).push([[1937],{1937:(h,E,r)=>{r.r(E),r.d(E,{ExpressionEngine:()=>p.t,ExpressionEngineModule:()=>c.D,ExpressionMetadataAdapter:()=>p.X});var c=r(73113),p=r(37577),n=r(52972),o=r.n(n),d={};for(const l in n)["default","ExpressionEngineModule","ExpressionEngine","ExpressionMetadataAdapter"].indexOf(l)<0&&(d[l]=()=>n[l]);r.d(E,d)},73113:(h,E,r)=>{r.d(E,{D:()=>a});var c=r(5960),p=r(40297),n=r(38495),o=r(52972);let d=class{convert(i,u){const m={type:"crt.ExecuteExpressionRequest",$context:u,metadata:i};return n.HandlerChainService.instance.process(m).then(y=>y?.result).catch(y=>(console.warn(y),null))}};d=(0,c.__decorate)([(0,n.CrtConverter)({type:"crt.ExecuteExpression"})],d);let l=class{convert(i,u){const m={type:"crt.ExecuteExpressionRequest",$context:u,metadata:i};return n.HandlerChainService.instance.process(m).then(y=>y).catch(y=>({success:!1,result:null,errorInfo:y}))}};l=(0,c.__decorate)([(0,n.CrtConverter)({type:"crt.ToExpressionResult"})],l);var x=r(37577);let _=class extends n.BaseRequest{constructor(){super(...arguments),this.type="crt.ExecuteExpressionRequest"}};_=(0,c.__decorate)([(0,n.CrtRequest)({type:"crt.ExecuteExpressionRequest"})],_);let e=class extends n.BaseRequestHandler{constructor(i){super(),this._engine=i}handle(i){return this._engine.execute(i.metadata)}};e=(0,c.__decorate)([(0,n.CrtRequestHandler)({type:"crt.ExecuteExpressionHandler",requestType:"crt.ExecuteExpressionRequest"}),(0,c.__metadata)("design:paramtypes",[x.t])],e);var s=r(59131);let a=class T{static{this.\u0275fac=function(u){return new(u||T)}}static{this.\u0275mod=s.\u0275\u0275defineNgModule({type:T})}static{this.\u0275inj=s.\u0275\u0275defineInjector({providers:[x.t,x.X],imports:[p.CommonModule,o.ExpressionSchemaModule,o.ExpressionSchemaModule]})}};a=(0,c.__decorate)([(0,n.CrtModule)({converters:[d,l],requestHandlers:[e]})],a),function(){(typeof ngJitMode>"u"||ngJitMode)&&s.\u0275\u0275setNgModuleScope(a,{imports:[p.CommonModule,o.ExpressionSchemaModule],exports:[o.ExpressionSchemaModule]})}()},37577:(h,E,r)=>{r.d(E,{t:()=>x,X:()=>l});var c=r(73308),p=r(63721),n=r(38495),o=r(62278),d=r(59131);class l{_getDataValueTypeName(e){switch(e){case n.DataValueType.FLOAT1:return"Float1";case n.DataValueType.FLOAT2:return"Float2";case n.DataValueType.FLOAT3:return"Float3";case n.DataValueType.FLOAT4:return"Float4";case n.DataValueType.FLOAT8:return"Float8";case n.DataValueType.CUSTOM_OBJECT:return"Object";case n.DataValueType.COMPOSITE_OBJECT_LIST:return"CompositeObjectList";default:return n.DataValueType[e]}}_getRequestParameterValueDto(e){const s=e.value;if(Array.isArray(s)){const a=s[0];return Array.isArray(a)?s.map(t=>t.map(i=>({...i,value:this._encodeValue(i.value,i.dataValueType),dataValueType:this._getDataValueTypeName(i.dataValueType)}))):s.map(t=>({...t,value:this._encodeValue(t.value,t.dataValueType),dataValueType:this._getDataValueTypeName(t.dataValueType)}))}return this._encodeValue(s,e.dataValueType)}_encodeValue(e,s){return[n.DataValueType.Date,n.DataValueType.Time,n.DataValueType.DateTime].includes(s)?(0,n.toLocalISOString)(e):e}decodeValue(e,s){return[n.DataValueType.Date,n.DataValueType.Time,n.DataValueType.DateTime].includes(s)?new Date(e):e}getExecutionMetadata(e){const s=e.parameters.map(t=>({...t,dataValueType:this._getDataValueTypeName(t.dataValueType),value:this._getRequestParameterValueDto(t)})),a=e.expressionVariables.map(t=>({...t,dataValueType:this._getDataValueTypeName(t.dataValueType)}));return JSON.stringify({...e,parameters:s,expressionVariables:a,resultDataValueType:this._getDataValueTypeName(e.resultDataValueType)})}static{this.\u0275fac=function(s){return new(s||l)}}static{this.\u0275prov=d.\u0275\u0275defineInjectable({token:l,factory:l.\u0275fac,providedIn:"root"})}}class x{constructor(e,s,a,t){this._httpClient=e,this._featureService=s,this._sysSettingsService=a,this._expressionMetadataAdapter=t,this._expressionEngineEndpoint="ServiceModel/ExpressionService.svc/Execute",this._expressionsEngineEndpoint="ServiceModel/ExpressionService.svc/ExecuteMany",this._defaultDebounceTime=200,this._defaultBundleCount=20,this._debounceTimeSysSettingName="ExpressionEngineDebounceTime",this._bundleCountSysSettingName="ExpressionEngineBundleCount",this._requests=new o.Subject}_executeImmediate(e){const s={metadata:e};return(0,o.lastValueFrom)(this._httpClient.post(this._expressionEngineEndpoint,s,{headers:new p.HttpHeaders({"Content-Type":"application/json"})}))}_getBundleSettings(){var e=this;return(0,c.A)(function*(){const s=yield e._sysSettingsService.getByCodes([e._debounceTimeSysSettingName,e._bundleCountSysSettingName]),a=s.values[e._debounceTimeSysSettingName]?.value||e._defaultDebounceTime,t=s.values[e._bundleCountSysSettingName]?.value||e._defaultBundleCount;return{executionDebounceTime:a,bundleCount:t}})()}_prepareDebouncedResponsesStream(){var e=this;return(0,c.A)(function*(){const{executionDebounceTime:s,bundleCount:a}=yield e._getBundleSettings();if(e._responses)return;const t=new o.BehaviorSubject(0),i=(0,o.merge)(t.pipe((0,o.filter)(u=>u>=a)),e._requests.pipe((0,o.tap)(()=>{t.next(t.value+1)}),(0,o.debounceTime)(s)));e._responses=e._requests.pipe((0,o.buffer)(i),(0,o.filter)(u=>!!u.length),(0,o.mergeMap)(u=>(t.next(0),e._httpClient.post(e._expressionsEngineEndpoint,u,{headers:new p.HttpHeaders({"Content-Type":"application/json"})}))),(0,o.share)())})()}_executeThrottled(e){var s=this;return(0,c.A)(function*(){yield s._prepareDebouncedResponsesStream();const a=(0,n.generateGuid)(),t=(0,o.firstValueFrom)(s._responses.pipe((0,o.filter)(i=>i.some(u=>u.executionId===a)),(0,o.map)(i=>i.find(u=>u.executionId===a).result)));return s._requests.next({executionId:a,metadata:e}),t})()}safeExecute(e,s={immediate:!1}){var a=this;return(0,c.A)(function*(){try{return yield a.execute(e,s)}catch(t){return{success:!1,errorInfo:t,result:null}}})()}execute(e,s={immediate:!1}){var a=this;return(0,c.A)(function*(){let t;const i=a._expressionMetadataAdapter.getExecutionMetadata(e),u=yield a._featureService.getFeatureState("ExpressionEngineDisableBundling");if(s.immediate||u?t=yield a._executeImmediate(i):t=yield a._executeThrottled(i),!t.success){const m=t.errorInfo;return Promise.reject(`${m.message}`)}return{...t,result:a._expressionMetadataAdapter.decodeValue(t.result,e.resultDataValueType)}})()}static{this.\u0275fac=function(s){return new(s||x)(d.\u0275\u0275inject(p.HttpClient),d.\u0275\u0275inject(n.FeatureService),d.\u0275\u0275inject(n.SysSettingsService),d.\u0275\u0275inject(l))}}static{this.\u0275prov=d.\u0275\u0275defineInjectable({token:x,factory:x.\u0275fac,providedIn:"root"})}}}}]);
